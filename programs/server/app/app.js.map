{"version":3,"sources":["meteor://ðŸ’»app/server/lib/cordova/facebook-login.js","meteor://ðŸ’»app/server/lib/accounts.js","meteor://ðŸ’»app/server/lib/cordova.js","meteor://ðŸ’»app/server/startup/migrations/v001.js","meteor://ðŸ’»app/server/startup/migrations/v002.js","meteor://ðŸ’»app/server/startup/migrations/v003.js","meteor://ðŸ’»app/server/startup/migrations/v004.js","meteor://ðŸ’»app/server/startup/migrations/v005.js","meteor://ðŸ’»app/server/startup/migrations/v006.js","meteor://ðŸ’»app/server/startup/migrations/v007.js","meteor://ðŸ’»app/server/startup/migrations/v008.js","meteor://ðŸ’»app/server/startup/migrations/v009.js","meteor://ðŸ’»app/server/startup/migrations/v010.js","meteor://ðŸ’»app/server/startup/migrations/v011.js","meteor://ðŸ’»app/server/startup/migrations/v012.js","meteor://ðŸ’»app/server/startup/migrations/v013.js","meteor://ðŸ’»app/server/startup/migrations/v014.js","meteor://ðŸ’»app/server/startup/migrations/v015.js","meteor://ðŸ’»app/server/startup/migrations/v016.js","meteor://ðŸ’»app/server/startup/migrations/v017.js","meteor://ðŸ’»app/server/startup/migrations/v018.js","meteor://ðŸ’»app/server/startup/migrations/v019.js","meteor://ðŸ’»app/server/startup/migrations/v020.js","meteor://ðŸ’»app/server/startup/migrations/v021.js","meteor://ðŸ’»app/server/startup/migrations/v022.js","meteor://ðŸ’»app/server/startup/migrations/v023.js","meteor://ðŸ’»app/server/startup/migrations/v024.js","meteor://ðŸ’»app/server/startup/migrations/v025.js","meteor://ðŸ’»app/server/startup/migrations/v026.js","meteor://ðŸ’»app/server/startup/migrations/v027.js","meteor://ðŸ’»app/server/startup/migrations/v028.js","meteor://ðŸ’»app/server/startup/migrations/v029.js","meteor://ðŸ’»app/server/startup/migrations/v030.js","meteor://ðŸ’»app/server/startup/migrations/v031.js","meteor://ðŸ’»app/server/startup/migrations/v032.js","meteor://ðŸ’»app/server/startup/migrations/v033.js","meteor://ðŸ’»app/server/startup/migrations/v034.js","meteor://ðŸ’»app/server/startup/migrations/v035.js","meteor://ðŸ’»app/server/startup/migrations/v036.js","meteor://ðŸ’»app/server/startup/migrations/v037.js","meteor://ðŸ’»app/server/startup/migrations/v038.js","meteor://ðŸ’»app/server/startup/migrations/v039.js","meteor://ðŸ’»app/server/startup/migrations/v040.js","meteor://ðŸ’»app/server/startup/migrations/v041.js","meteor://ðŸ’»app/server/startup/migrations/v042.js","meteor://ðŸ’»app/server/startup/migrations/v043.js","meteor://ðŸ’»app/server/startup/migrations/v044.js","meteor://ðŸ’»app/server/startup/migrations/v045.js","meteor://ðŸ’»app/server/startup/migrations/v046.js","meteor://ðŸ’»app/server/startup/migrations/v047.js","meteor://ðŸ’»app/server/startup/migrations/v048.js","meteor://ðŸ’»app/server/startup/migrations/v049.js","meteor://ðŸ’»app/server/startup/migrations/v050.js","meteor://ðŸ’»app/server/startup/migrations/v051.js","meteor://ðŸ’»app/server/startup/migrations/v052.js","meteor://ðŸ’»app/server/startup/migrations/v053.js","meteor://ðŸ’»app/server/startup/migrations/v054.js","meteor://ðŸ’»app/server/startup/migrations/v055.js","meteor://ðŸ’»app/server/startup/migrations/v056.js","meteor://ðŸ’»app/server/startup/migrations/v057.js","meteor://ðŸ’»app/server/startup/migrations/v058.js","meteor://ðŸ’»app/server/startup/migrations/v059.js","meteor://ðŸ’»app/server/startup/migrations/v060.js","meteor://ðŸ’»app/server/startup/migrations/v061.js","meteor://ðŸ’»app/server/startup/migrations/v062.js","meteor://ðŸ’»app/server/startup/migrations/v063.js","meteor://ðŸ’»app/server/startup/migrations/v064.js","meteor://ðŸ’»app/server/startup/migrations/v065.js","meteor://ðŸ’»app/server/startup/migrations/v066.js","meteor://ðŸ’»app/server/startup/migrations/v067.js","meteor://ðŸ’»app/server/startup/migrations/v068.js","meteor://ðŸ’»app/server/startup/migrations/v069.js","meteor://ðŸ’»app/server/startup/migrations/v070.js","meteor://ðŸ’»app/server/startup/migrations/v071.js","meteor://ðŸ’»app/server/startup/migrations/v072.js","meteor://ðŸ’»app/server/startup/migrations/v073.js","meteor://ðŸ’»app/server/startup/migrations/v074.js","meteor://ðŸ’»app/server/startup/migrations/v075.js","meteor://ðŸ’»app/server/startup/migrations/v076.js","meteor://ðŸ’»app/server/startup/migrations/v077.js","meteor://ðŸ’»app/server/startup/migrations/v078.js","meteor://ðŸ’»app/server/startup/migrations/v079.js","meteor://ðŸ’»app/server/startup/migrations/v080.js","meteor://ðŸ’»app/server/startup/migrations/v081.js","meteor://ðŸ’»app/server/startup/migrations/v082.js","meteor://ðŸ’»app/server/startup/migrations/v083.js","meteor://ðŸ’»app/server/startup/migrations/v084.js","meteor://ðŸ’»app/server/startup/migrations/v085.js","meteor://ðŸ’»app/server/startup/migrations/v086.js","meteor://ðŸ’»app/server/startup/migrations/v087.js","meteor://ðŸ’»app/server/startup/migrations/v088.js","meteor://ðŸ’»app/server/startup/migrations/v089.js","meteor://ðŸ’»app/server/startup/migrations/v090.js","meteor://ðŸ’»app/server/startup/migrations/v091.js","meteor://ðŸ’»app/server/startup/migrations/v092.js","meteor://ðŸ’»app/server/startup/migrations/v093.js","meteor://ðŸ’»app/server/startup/migrations/v094.js","meteor://ðŸ’»app/server/startup/migrations/v095.js","meteor://ðŸ’»app/server/startup/migrations/v096.js","meteor://ðŸ’»app/server/startup/migrations/v097.js","meteor://ðŸ’»app/server/startup/migrations/v098.js","meteor://ðŸ’»app/server/startup/migrations/v099.js","meteor://ðŸ’»app/server/startup/migrations/v100.js","meteor://ðŸ’»app/server/startup/migrations/v101.js","meteor://ðŸ’»app/server/startup/migrations/v102.js","meteor://ðŸ’»app/server/startup/migrations/v103.js","meteor://ðŸ’»app/server/startup/migrations/v104.js","meteor://ðŸ’»app/server/startup/migrations/xrun.js","meteor://ðŸ’»app/server/startup/appcache.js","meteor://ðŸ’»app/server/startup/avatar.js","meteor://ðŸ’»app/server/startup/cron.js","meteor://ðŸ’»app/server/startup/i18n-validation.js","meteor://ðŸ’»app/server/startup/initialData.js","meteor://ðŸ’»app/server/startup/presence.js","meteor://ðŸ’»app/server/startup/roomPublishes.js","meteor://ðŸ’»app/server/startup/serverRunning.js","meteor://ðŸ’»app/server/configuration/accounts_meld.js","meteor://ðŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ðŸ’»app/server/methods/addAllUserToRoom.js","meteor://ðŸ’»app/server/methods/addRoomLeader.js","meteor://ðŸ’»app/server/methods/addRoomModerator.js","meteor://ðŸ’»app/server/methods/addRoomOwner.js","meteor://ðŸ’»app/server/methods/afterVerifyEmail.js","meteor://ðŸ’»app/server/methods/canAccessRoom.js","meteor://ðŸ’»app/server/methods/channelsList.js","meteor://ðŸ’»app/server/methods/createDirectMessage.js","meteor://ðŸ’»app/server/methods/deleteFileMessage.js","meteor://ðŸ’»app/server/methods/deleteUser.js","meteor://ðŸ’»app/server/methods/eraseRoom.js","meteor://ðŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ðŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ðŸ’»app/server/methods/getRoomNameById.js","meteor://ðŸ’»app/server/methods/getTotalChannels.js","meteor://ðŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ðŸ’»app/server/methods/getUsersOfRoom.js","meteor://ðŸ’»app/server/methods/groupsList.js","meteor://ðŸ’»app/server/methods/hideRoom.js","meteor://ðŸ’»app/server/methods/loadHistory.js","meteor://ðŸ’»app/server/methods/loadLocale.js","meteor://ðŸ’»app/server/methods/loadMissedMessages.js","meteor://ðŸ’»app/server/methods/loadNextMessages.js","meteor://ðŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ðŸ’»app/server/methods/logoutCleanUp.js","meteor://ðŸ’»app/server/methods/messageSearch.js","meteor://ðŸ’»app/server/methods/migrate.js","meteor://ðŸ’»app/server/methods/muteUserInRoom.js","meteor://ðŸ’»app/server/methods/openRoom.js","meteor://ðŸ’»app/server/methods/readMessages.js","meteor://ðŸ’»app/server/methods/registerUser.js","meteor://ðŸ’»app/server/methods/removeRoomLeader.js","meteor://ðŸ’»app/server/methods/removeRoomModerator.js","meteor://ðŸ’»app/server/methods/removeRoomOwner.js","meteor://ðŸ’»app/server/methods/removeUserFromRoom.js","meteor://ðŸ’»app/server/methods/reportMessage.js","meteor://ðŸ’»app/server/methods/resetAvatar.js","meteor://ðŸ’»app/server/methods/roomNameExists.js","meteor://ðŸ’»app/server/methods/saveUserPreferences.js","meteor://ðŸ’»app/server/methods/saveUserProfile.js","meteor://ðŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ðŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ðŸ’»app/server/methods/setAvatarFromService.js","meteor://ðŸ’»app/server/methods/setUserActiveStatus.js","meteor://ðŸ’»app/server/methods/setUserPassword.js","meteor://ðŸ’»app/server/methods/toogleFavorite.js","meteor://ðŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ðŸ’»app/server/methods/userSetUtcOffset.js","meteor://ðŸ’»app/server/publications/activeUsers.js","meteor://ðŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ðŸ’»app/server/publications/fullUserData.js","meteor://ðŸ’»app/server/publications/messages.js","meteor://ðŸ’»app/server/publications/privateHistory.js","meteor://ðŸ’»app/server/publications/room.js","meteor://ðŸ’»app/server/publications/roomFiles.js","meteor://ðŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ðŸ’»app/server/publications/spotlight.js","meteor://ðŸ’»app/server/publications/subscription.js","meteor://ðŸ’»app/server/publications/userAutocomplete.js","meteor://ðŸ’»app/server/publications/userChannels.js","meteor://ðŸ’»app/server/publications/userData.js","meteor://ðŸ’»app/server/stream/messages.js","meteor://ðŸ’»app/server/stream/streamBroadcast.js","meteor://ðŸ’»app/lib/RegExp.js","meteor://ðŸ’»app/lib/francocatena_fix.js","meteor://ðŸ’»app/lib/underscore.string.js"],"names":["getIdentity","accessToken","HTTP","get","params","access_token","data","error","_","extend","Error","message","response","Accounts","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","Date","now","expiresIn","whitelisted","fields","pick","options","profile","updateOrCreateUserFromExternalService","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","RocketChat","settings","config","emailTemplates","siteName","from","verifyEmailHtml","verifyEmail","text","html","user","url","replace","Meteor","absoluteUrl","resetPasswordHtml","resetPassword","enrollAccount","subject","TAPi18n","__","lng","language","placeholders","header","footer","name","email","emails","address","onCreateUser","callbacks","run","status","active","firstName","lastName","services","Object","values","service","username","verified","insertUserDoc","wrap","roles","Match","test","globalRoles","String","length","concat","password","defaultAuthServiceRoles","split","map","s","trim","type","_id","call","users","findOne","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","hasAdmin","models","Users","dolphin","Role","una","role","trident","push","authz","addUserRoles","validateLoginAttempt","login","allowed","includes","validEmail","filter","updateLastLoginById","defer","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","methods","push_test","method","hasRole","Push","enabled","query","$and","userId","$or","$exists","tokens","appCollection","find","count","send","title","apn","sound","sendPush","token","tries","post","statusCode","console","log","remove","SystemLogger","milli","Math","pow","setTimeout","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","forEach","app","topic","appName","startup","Migrations","add","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","RocketChatFile","dataURIParse","image","contentType","rs","bufferToStream","Buffer","fileStore","FileUpload","getStore","deleteByName","file","insert","setAvatarOrigin","Subscriptions","tryDropIndex","uid","nonreactive","sub","update","findOneById","$set","$unset","Rooms","room","$in","uids","usernames","t","k","v","oldId","sort","join","removeById","rid","multi","Messages","rn","$rename","item","Random","id","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","u","by","findOneByName","upsert","index","urls","isString","OEmbed","rocketUrlParser","Settings","CDN_PREFIX","value","group","ENV","MAIL_URL","denyUnverifiedEmails","public","avatarStore","path","toMigrate","source","Mongo","Collection","target","model","OEmbedCache","collection","rawCollection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","createdAt","setAllUsersActive","metaKeys","old","oldAndNew","oldSetting","oldValue","newSetting","new","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","Uploads","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","record","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","to","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","Roles","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","module","watch","require","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","e","addUserPermission","allowPinning","$addToSet","footerValue","packageValue","customOauth","parts","bot","__migration_assets_files","chunks","__migration_assets_chunks","list","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","i18nDescription","favoriteRooms","lastVisitor","limit","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","ts","code","tryEnsureIndex","label","escapeHTML","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","section","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","linkedin","setName","runOnEdits","emailAddress","existingUser","emailHeader","emailFooter","startWithHTML","endsWithHTML","fs","args","logError","insertAvatar","details","avatarsFileStore","stream","callback","Promise","batch","arr","fn","all","splice","then","s3","direct","AmazonS3","GoogleStorage","googleCloudStorage","avatarOrigins","avatarsPathRecord","avatarStoreTypeRecord","avatarsPath","process","env","AVATARS_PATH","avatarStoreType","oldAvatarGridFS","GridFS","countSync","Number","error_box","usersTotal","current","gridFSAvatar","getFileWithReadStream","readStream","deleteFile","filePath","stat","statSync","isFile","createReadStream","unlinkSync","avatarsFiles","avatarsChunks","audioNotification","lastActivity","LDAP_Domain_Base","LDAP_Domain_Search_User_ID","LDAP_Use_Custom_Domain_Search","LDAP_Custom_Domain_Search","LDAP_Domain_Search_User","LDAP_Domain_Search_Password","LDAP_Domain_Search_Filter","LDAP_Domain_Search_Object_Class","LDAP_Domain_Search_Object_Category","Custom_Domain_Search","parse","userDN","LDAP_Sync_User_Data","LDAP_Import_Users","majorColors","newvariables","lightenDarkenColor","col","amt","usePound","slice","num","r","b","g","toString","color","editor","getVersion","migrateTo","MIGRATION_VERSION","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","WebApp","connectHandlers","use","bindEnvironment","req","res","decodeURIComponent","writeHead","write","end","exec","sandstorm","picture","setHeader","Avatars","reqModifiedHeader","colors","initials","position","usernameParts","first","substr","toUpperCase","svg","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","host","warn","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","obj","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","db","create","statusDefault","utcOffset","getBinary","ADMIN_PASS","adminUser","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","INITIAL_USER","initialUser","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","roomTypes","setPublish","identifier","cl","announcement","muted","archived","ro","reactWhenReadOnly","jitsiTimeout","description","sysMes","joinCodeRequired","hasPermission","findByTypeAndName","roomId","findByTypeNameAndUserId","findById","ready","findByTypeAndNameContainingUsername","hasAtLeastOnePermission","findByTypeContainingUsernames","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","desiredNodeVersionMajor","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","Array","isArray","primaryEmail","a","primary","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","arguments","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","activeUsersOnly","check","Boolean","userCount","userFilter","findOneByRoomIdAndUserId","addUsernameById","createWithRoomAndUser","open","alert","unread","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addRoomLeader","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","Notifications","notifyLogged","addRoomModerator","addRoomOwner","afterVerifyEmail","verifiedEmail","removeUserRoles","canAccessRoom","Maybe","channelsList","channelType","unblock","Optional","isNumber","roomIds","findByTypeAndUserId","userPref","mergeChannels","roomsListExhibitionMode","globalPref","channels","findByNameContainingTypesWithUsername","findContainingTypesWithUsername","createDirectMessage","me","upsertSubscription","ls","RateLimiter","limitMethod","deleteFileMessage","fileID","getMessageByFileId","deleteById","deleteUser","adminCount","userIsAdmin","indexOf","action","eraseRoom","fromId","facebook","google","github","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getRoomNameById","getTotalChannels","slug","slugify","usernameIsAvaliable","$regex","generateSuggestion","preferredHandle","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","_user","records","findByRoomId","total","groupsList","nameFilter","groups","escapeRegExp","findByIds","hideRoom","hideByRoomIdAndUserId","hideMessagesOfType","types","loadHistory","canAnonymous","canPreview","editedAt","findVisibleByRoomIdBeforeTimestampNotContainingTypes","findVisibleByRoomIdNotContainingTypes","UI_Use_Real_Name","messages","starred","mention","unreadNotLoaded","firstUnread","firstMessage","unreadMessages","findVisibleByRoomIdBetweenTimestampsNotContainingTypes","loadLocale","locale","getText","shift","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","currentUserId","currentUserName","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","location","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","$gte","filterOnDate","dayAfter","filterLabel","tag","sortByTimestamp","direction","startsWith","$options","$text","$search","score","$meta","getMigrationVersion","muteUserInRoom","ObjectIncluding","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","setAsReadByRoomIdAndUserId","registerUser","formData","AllowAnonymousRead","AllowAnonymousWrite","_loginUser","pass","secretURL","validateEmailDomain","userData","importedUser","importIds","createUser","saveCustomFields","userModel","sendVerificationEmail","removeRoomLeader","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomModerator","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeUsernameById","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","messageId","Reports","createWithMessageDescriptionAndUserId","resetAvatar","unsetAvatarOrigin","DDPRateLimiter","addRule","roomNameExists","saveUserPreferences","setLanguage","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","unreadRoomsMode","autoImageLoad","emailNotificationMode","unreadAlert","notificationsSoundVolume","audioNotifications","desktopNotifications","mobileNotifications","audioNotificationValue","desktopNotificationDuration","viewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","highlights","sendOnEnter","setPreferences","saveUserProfile","customFields","checkPassword","typedPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","realname","setRealName","newPassword","logout","setProfile","sendConfirmationEmail","sendForgotPasswordEmail","regex","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","setUserActive","unsetLoginTokens","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","publish","findUsersNotOffline","selector","pub","cursorHandle","findByNameStartingAndTypes","observeChanges","added","changed","removed","onStop","stop","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","findByContainingUsername","lm","fname","_updatedAt","livechatData","tags","sms","sentiment","roomMap","_room","findByDefaultAndTypes","findBySubscriptionUserIdUpdatedAfter","trashFindDeletedAfter","_deletedAt","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","cache","on","notifyUserInThisInstance","cursorFileListHandle","findNotHiddenFilesOfRoom","findByRoomIdAndRoles","spotlight","roomOptions","findByNameAndTypeNotDefault","userOptions","findByActiveUsersExcept","findByNameAndTypeNotContainingUsername","$nin","mobilePushNotifications","emailNotifications","blocked","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","findByUserId","processQueryOptionsOnResult","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","roomType","publishMessage","imported","emitWithoutBroadcast","_db","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","StreamerCentral","instances","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","broadcast","fromInstance","results","connected","endpoint","conn","assign","currentStatus","i18n_status_func","mixin","each","functions","prototype","exports"],"mappings":"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","file":"/app.js","sourcesContent":["function getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken\n\t\t\t}\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${ error.message }`), {\n\t\t\tresponse: error.response\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {}\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","const accountsConfig = {\n\tforbidClientAccountCreation: true,\n\tloginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration')\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\nconst verifyEmailHtml = Accounts.emailTemplates.verifyEmail.text;\n\nAccounts.emailTemplates.verifyEmail.html = function(user, url) {\n\turl = url.replace(Meteor.absoluteUrl(), `${ Meteor.absoluteUrl() }login/`);\n\treturn verifyEmailHtml(user, url);\n};\n\nconst resetPasswordHtml = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.resetPassword.html = function(user, url) {\n\turl = url.replace(/\\/#\\//, '/');\n\treturn resetPasswordHtml(user, url);\n};\n\nAccounts.emailTemplates.enrollAccount.subject = function(user = {}) {\n\tlet subject;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\tsubject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n\t} else {\n\t\tsubject = TAPi18n.__('Accounts_Enrollment_Email_Subject_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\treturn RocketChat.placeholders.replace(subject);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function(user = {}/*, url*/) {\n\tlet html;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\thtml = RocketChat.settings.get('Accounts_Enrollment_Email');\n\t} else {\n\t\thtml = TAPi18n.__('Accounts_Enrollment_Email_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\thtml = RocketChat.placeholders.replace(html, {\n\t\tname: user.name,\n\t\temail: user.emails && user.emails[0] && user.emails[0].address\n\t});\n\n\treturn header + html + footer;\n};\n\nAccounts.onCreateUser(function(options, user = {}) {\n\tRocketChat.callbacks.run('beforeCreateUser', options, user);\n\n\tuser.status = 'offline';\n\tuser.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n\tif (!user.name) {\n\t\tif (options.profile) {\n\t\t\tif (options.profile.name) {\n\t\t\t\tuser.name = options.profile.name;\n\t\t\t} else if (options.profile.firstName && options.profile.lastName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = `${ options.profile.firstName } ${ options.profile.lastName }`;\n\t\t\t} else if (options.profile.firstName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = options.profile.firstName;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.services) {\n\t\tfor (const service of Object.values(user.services)) {\n\t\t\tif (!user.name) {\n\t\t\t\tuser.name = service.name || service.username;\n\t\t\t}\n\n\t\t\tif (!user.emails && service.email) {\n\t\t\t\tuser.emails = [{\n\t\t\t\t\taddress: service.email,\n\t\t\t\t\tverified: true\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function(insertUserDoc, options, user) {\n\tlet roles = [];\n\n\tif (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n\t\troles = roles.concat(user.globalRoles);\n\t}\n\n\tdelete user.globalRoles;\n\n\tif (user.services && !user.services.password) {\n\t\tconst defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n\t\tif (defaultAuthServiceRoles.length > 0) {\n\t\t\troles = roles.concat(defaultAuthServiceRoles.map(s => s.trim()));\n\t\t}\n\t}\n\n\tif (!user.type) {\n\t\tuser.type = 'user';\n\t}\n\n\tconst _id = insertUserDoc.call(Accounts, options, user);\n\n\tuser = Meteor.users.findOne({\n\t\t_id\n\t});\n\n\tif (user.username && options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n\t\tMeteor.runAsUser(_id, function() {\n\t\t\treturn Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n\t\t});\n\t}\n\n\tif (roles.length === 0) {\n\t\tconst hasAdmin = RocketChat.models.Users.findOne({\n\t\t\troles: 'admin',\n\t\t\ttype: 'user'\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!hasAdmin || (user.services.dolphin && 3 == user.services.dolphin.Role) || (user.services.una && 3 == user.services.una.role) || (user.services.trident && 3 == user.services.trident.role)) {\n\t\t\troles.push('admin');\n\t\t} else {\n\t\t\troles.push('user');\n\t\t}\n\t}\n\n\tRocketChat.authz.addUserRoles(_id, roles);\n\n\treturn _id;\n});\n\nAccounts.validateLoginAttempt(function(login) {\n\tlogin = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n\tif (login.allowed !== true) {\n\t\treturn login.allowed;\n\t}\n\n\tif (login.user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (!!login.user.active !== true) {\n\t\tthrow new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n\t\tconst validEmail = login.user.emails.filter(email => email.verified === true);\n\t\tif (validEmail.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n\t\t}\n\t}\n\n\tlogin = RocketChat.callbacks.run('onValidateLogin', login);\n\n\tRocketChat.models.Users.updateLastLoginById(login.user._id);\n\tMeteor.defer(function() {\n\t\treturn RocketChat.callbacks.run('afterValidateLogin', login);\n\t});\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n\t\tthrow new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n\t}\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tlet domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n\tif (_.isEmpty(s.trim(domainWhiteList))) {\n\t\treturn true;\n\t}\n\n\tdomainWhiteList = domainWhiteList.split(',').map(domain => domain.trim());\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tconst email = user.emails[0].address;\n\t\tconst inWhiteList = domainWhiteList.some(domain => email.match(`@${ RegExp.escape(domain) }$`));\n\n\t\tif (inWhiteList === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain');\n\t\t}\n\t}\n\n\treturn true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${ user.username }`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${ user.username }:\\n${ TAPi18n.__('This_is_a_push_test_messsage') }`\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens]\n\t\t};\n\t}\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken,\n\t\t\toptions\n\t\t}\n\t};\n\n\treturn HTTP.post(`${ RocketChat.settings.get('Push_gateway') }/push/${ service }/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${ tries } try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend(userId/*, notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t}\n\t\t});\n\n\t\tlet apn;\n\t\tlet gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number')\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert')\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn,\n\t\t\tgcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 1000,\n\t\t\tsendBatchSize: 10\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = {badge: 0}) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${ options.title }\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\treturn Push.enabled = true;\n\t}\n}\n\nMeteor.startup(function() {\n\treturn configurePush();\n});\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst {image, contentType} = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName(user.username);\n\n\t\t\tconst file = {\n\t\t\t\tuserId: user._id,\n\t\t\t\ttype: contentType\n\t\t\t};\n\n\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: ''\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: true\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id\n\t\t\t\t}\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = `${ room.name }-${ Random.id(2).toLowerCase() }`;\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${ newUserName } to all user ${ user._id }`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${ room._id } to ${ newId }`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0]\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${ user.username } to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL'\n\t\t\t}, {\n\t\t\t\t$set: room\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t}\n});\n","/* globals OEmbed */\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${ index + 1 } / ${ count }`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings'\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General'});\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP'});\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings'\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Mongo.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Mongo.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model\n\t\t\t}\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst {target, source} = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${ source.rawCollection().collectionName } to: ${ target.rawCollection().collectionName }`);\n\n\t\t\tsource.find().forEach((doc) => {\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\treturn target.upsert({\n\t\t\t\t\t_id: doc._id\n\t\t\t\t}, doc);\n\t\t\t});\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/*, res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${ rawSource.collectionName } collection due to: ${ err.errmsg }`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${ count } rooms`);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'default': true\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_URL'});\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_ID'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Edit'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Delete'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_KeepStatusHistory'});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowEditedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowDeletedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language'\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id'\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots'\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification'\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01'\n\t\t\t}\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.old});\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.new});\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Mongo.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Mongo.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Mongo.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Mongo.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Mongo.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${ cfsRecord._id }`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = `${ url }.${ extension }`;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}]\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${ url }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({_id: message._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({_id: cfsRecord._id});\n\t\t\toldGridFSCollection.remove({_id: oldGridFsFile._id});\n\t\t\toldChunkCollection.remove({files_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)});\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: ''\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${ usernames } from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${ usernames } to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1\n\t\t\t}\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => {\n\t\t\treturn RocketChat.models.Uploads.update({\n\t\t\t\t_id: msg.file && msg.file._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: msg.rid\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$multi: true\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails'\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: []\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Host'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Encryption'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls'\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Domain_Base'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Username_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Unique_Identifier_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Use_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Url'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_TLS'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_DN'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Bind_Search'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_STUN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Username'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Password'});\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += `${ encodeURIComponent(WebRTC_TURN_Username) }:${ encodeURIComponent(WebRTC_TURN_Password) }@`;\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({_id: 'WebRTC_Servers'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += `${ integration.processIncomingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += `${ integration.prepareOutgoingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += `${ integration.processOutgoingResponseScript }\\n\\n`;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// ')\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, update, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tconst result = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tconst addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tconst allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tlet footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tconst parts = customOauth._id.split('_');\n\t\t\tconst name = parts[3];\n\t\t\tconst id = `Accounts_OAuth_Custom_${ name }_token_sent_via`;\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t'_id': id,\n\t\t\t\t\t'type': 'select',\n\t\t\t\t\t'group': 'OAuth',\n\t\t\t\t\t'section': `Custom OAuth: ${ name }`,\n\t\t\t\t\t'i18nLabel': 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\t'persistent': true,\n\t\t\t\t\t'values': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'header',\n\t\t\t\t\t\t\t'i18nLabel': 'Header'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'payload',\n\t\t\t\t\t\t\t'i18nLabel': 'Payload'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t'packageValue': 'payload',\n\t\t\t\t\t'valueSource': 'packageValue',\n\t\t\t\t\t'ts': new Date(),\n\t\t\t\t\t'hidden': false,\n\t\t\t\t\t'blocked': false,\n\t\t\t\t\t'sorter': 255,\n\t\t\t\t\t'i18nDescription': `Accounts_OAuth_Custom_${ name }_token_sent_via_Description`,\n\t\t\t\t\t'createdAt': new Date(),\n\t\t\t\t\t'value': 'payload'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256'\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${ from }`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${ to }`, {\n\t\t\t\t\t\turl: `/assets/${ to }.${ extension }`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [ { 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } } ] }).forEach(function(user) {\n\t\t\t\tconst newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tconst newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup() {\n\n\t\t// finds the latest created visitor\n\t\tconst lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tconst lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tconst RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup() {\n\n\t\tlet count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false }}).forEach(function(room) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username\n\t\t\t\t\t}\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">'\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 55,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ 'topic': { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic }});\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst createdAt = users[0].createdAt;\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 60,\n\tup() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [ { name: { $exists: 0 } }, { name: { $not: { $type: 2 } } } ] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup() {\n\t\tconst forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tconst timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 64,\n\tup() {\n\t\tRocketChat.models.Messages.find({ 't': 'room_changed_topic', 'msg': /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tconst replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tconst replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tconst replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tconst replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tconst replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tconst oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true\n\t\t\t\t}\n\t\t\t}, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup() {\n\t\tconst GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-custom-scrollbar-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.05)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-info-font-color',\n\t\t\t'value': '#aaaaaa'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@secondary-font-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-link-font-color',\n\t\t\t'value': '#008ce3'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@primary-action-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-away',\n\t\t\t'value': '#fcb316'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@pending-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-busy',\n\t\t\t'value': '#d30230'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@error-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-offline',\n\t\t\t'value': 'rgba(150, 150, 150, 0.50)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-online',\n\t\t\t'value': '#35ac19'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@success-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-background-color',\n\t\t\t'value': '#eaeaea'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@component-color'\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-font-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.6)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-lightest'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst _id = setting._id;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup() {\n\t\t//Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ 't': 'rm', 'reactions': { $exists: true, $not: {$size: 0} } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_64'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_96'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_128'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_256'});\n\t\t\tRocketChat.models.Settings.update({_id: 'Assets_favicon_192'}, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({section: 'Colors (alphas)'}).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false }\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] }}, { $addToSet: { roles: 'bot' }}, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup() {\n\t\tconst integrations = RocketChat.models.Integrations.find({type: 'webhook-incoming'}).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({_id: integration._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map(channel => channel.trim())\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: []\n\t\t\t}, {\n\t\t\t\tchannel: ''\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels']\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tconst username = setting.value;\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tconst oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: {$size: 2},\n\t\t\tu: {$exists: false},\n\t\t\tname: {$exists: false}\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map(room => room._id);\n\t\t\tRocketChat.models.Rooms.update({_id: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t\tRocketChat.models.Subscriptions.update({rid: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup() {\n\t\t// Disabled this migration for it was not updating any user\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' }});\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' }}, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 90,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Piwik', type: 'group' });\n\n\t\tconst settings = RocketChat.models.Settings.find({$or: [{_id: 'PiwikAnalytics_url', value: {$ne: null}}, {_id: 'PiwikAnalytics_siteId', value: {$ne: null}}]}).fetch();\n\n\t\tif (settings && settings.length === 2) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'PiwikAnalytics_enabled'}, {$set: {value: true}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 91,\n\tup() {\n\t\tconst query = {\n\t\t\t'services.linkedin': {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\tname: {\n\t\t\t\t\t$exists: 0\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tname: null\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'services.linkedin.firstName': 1, username: 1}).forEach((user) => {\n\t\t\tconst name = `${ user.services.linkedin.firstName } ${ user.services.linkedin.lastName }`;\n\n\t\t\tRocketChat.models.Users.setName(user._id, name);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 92,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', 'event': 'sendMessage' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { runOnEdits: true }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 93,\n\tup() {\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_AllowAnonymousAccess' });\n\t\t\tif (setting && setting.value === true) {\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Accounts_AllowAnonymousRead' }, { $set: { value: setting.value } });\n\t\t\t}\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: [\n\t\t\t\t\t'view-c-room',\n\t\t\t\t\t'view-history',\n\t\t\t\t\t'view-joined-room',\n\t\t\t\t\t'view-p-room',\n\t\t\t\t\t'preview-c-room'\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: 'anonymous'\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Permissions.update(query, update, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 94,\n\tup() {\n\t\tconst query = {\n\t\t\t'emails.address.address': { $exists: true }\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'emails.address.address': 1}).forEach((user) => {\n\t\t\tlet emailAddress;\n\t\t\tuser.emails.some(email => {\n\t\t\t\tif (email.address && email.address.address) {\n\t\t\t\t\temailAddress = email.address.address;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst existingUser = RocketChat.models.Users.findOne({ 'emails.address': emailAddress }, { fields: { _id: 1 } });\n\t\t\tif (existingUser) {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'emails.$': 1\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'emails.$.address': emailAddress\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 95,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst emailHeader = RocketChat.models.Settings.findOne({ _id: 'Email_Header' });\n\t\t\tconst emailFooter = RocketChat.models.Settings.findOne({ _id: 'Email_Footer' });\n\t\t\tconst startWithHTML = emailHeader.value.match(/^<html>/);\n\t\t\tconst endsWithHTML = emailFooter.value.match(/<\\/html>$/);\n\n\t\t\tif (!startWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Header' },\n\t\t\t\t\t{ $set: { value: `<html>${ emailHeader.value }`} }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!endsWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Footer' },\n\t\t\t\t\t{ $set: { value: `${ emailFooter.value }</html>`} }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 96,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_ScriptsToLoad' }, { $set: { value: '' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 97,\n\tup() {\n\t\t// Migration moved to 099.js to fix a bug\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 98,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/'\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\n\nfunction log(...args) {\n\tconsole.log('[AVATAR]', ...args);\n}\n\nfunction logError(...args) {\n\tconsole.error('[AVATAR]', ...args);\n}\n\nfunction insertAvatar({ details, avatarsFileStore, stream, callback = () => {} }) {\n\treturn new Promise((resolve) => {\n\t\tMeteor.defer(() => {\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tavatarsFileStore.insert(details, stream, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tlogError({err});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction batch(arr, limit, fn) {\n\tif (!arr.length) {\n\t\treturn Promise.resolve();\n\t}\n\treturn Promise.all(arr.splice(0, limit).map((item) => {\n\t\treturn fn(item);\n\t})).then(() => { return batch(arr, limit, fn); });\n}\n\nRocketChat.Migrations.add({\n\tversion: 99,\n\tup() {\n\t\tlog('Migrating avatars. This might take a while.');\n\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t's3.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t'googleCloudStorage.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Uploads.find(query).forEach((record) => {\n\t\t\tif (record.s3) {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'store': 'AmazonS3:Uploads',\n\t\t\t\t\t\tAmazonS3: {\n\t\t\t\t\t\t\tpath: record.s3.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\ts3: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'GoogleCloudStorage:Uploads',\n\t\t\t\t\t\tGoogleStorage: {\n\t\t\t\t\t\t\tpath: record.googleCloudStorage.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\tgoogleCloudStorage: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'fileSystem'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'FileSystem:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'rocketchat_uploads'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'GridFS:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconst avatarOrigins = [\n\t\t\t'upload',\n\t\t\t'gravatar',\n\t\t\t'facebook',\n\t\t\t'twitter',\n\t\t\t'github',\n\t\t\t'google',\n\t\t\t'url',\n\t\t\t'gitlab',\n\t\t\t'linkedin'\n\t\t];\n\n\t\tconst avatarsPathRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStorePath'});\n\t\tconst avatarStoreTypeRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStoreType'});\n\n\t\tconst avatarsPath = avatarsPathRecord ? avatarsPathRecord.value : process.env.AVATARS_PATH;\n\t\tlet avatarStoreType = avatarStoreTypeRecord && avatarStoreTypeRecord.value;\n\n\t\tconst oldAvatarGridFS = new RocketChatFile.GridFS({\n\t\t\tname: 'avatars'\n\t\t});\n\n\t\tif (avatarStoreType == null) {\n\t\t\tconst count = oldAvatarGridFS.countSync();\n\t\t\tif (Match.test(count, Number) && count > 0) {\n\t\t\t\tavatarStoreType = 'GridFS';\n\t\t\t} else if (Match.test(avatarsPath, String) && avatarsPath.length > 0) {\n\t\t\t\tavatarStoreType = 'FileSystem';\n\t\t\t} else {\n\t\t\t\tSystemLogger.error_box('Can\\'t define the avatar\\'s storage type.\\nIf you have avatars missing and they was stored in your file system\\nrun the process including the following environment variables: \\n  AVATARS_PATH=\\'YOUR AVATAR\\'S DIRECTORY\\'\\n  MIGRATION_VERSION=99,rerun', 'WARNING');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tMeteor.startup(function() {\n\t\t\tMeteor.setTimeout(function() {\n\t\t\t\tconst avatarsFileStore = FileUpload.getStore('Avatars');\n\n\t\t\t\tconst users = RocketChat.models.Users.find({avatarOrigin: {$in: avatarOrigins}}, {avatarOrigin: 1, username: 1}).fetch();\n\n\t\t\t\tconst usersTotal = users.length;\n\n\t\t\t\tlog('Total users to migrate avatars ->', usersTotal);\n\n\t\t\t\tlet current = 0;\n\n\t\t\t\tbatch(users, 300, (user) => {\n\t\t\t\t\tconst id = `${ user.username }.jpg`;\n\n\t\t\t\t\tconst gridFSAvatar = oldAvatarGridFS.getFileWithReadStream(id);\n\n\t\t\t\t\tlog('Migrating', ++current, 'of', usersTotal);\n\n\t\t\t\t\tif (gridFSAvatar) {\n\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\ttype: gridFSAvatar.contentType,\n\t\t\t\t\t\t\tsize: gridFSAvatar.length\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\tstream: gridFSAvatar.readStream,\n\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\toldAvatarGridFS.deleteFile(id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (avatarStoreType === 'FileSystem' && avatarsPath && avatarsPath.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst filePath = path.join(avatarsPath, id);\n\t\t\t\t\t\t\tconst stat = fs.statSync(filePath);\n\t\t\t\t\t\t\tif (stat && stat.isFile()) {\n\t\t\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t\t\t\t\t\tsize: stat.size\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\t\t\tstream: fs.createReadStream(filePath),\n\t\t\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\t\t\tfs.unlinkSync(filePath);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlogError('Error migrating old avatar', e);\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst avatarsFiles = new Mongo.Collection('avatars.files');\n\t\t\t\t\tconst avatarsChunks = new Mongo.Collection('avatars.chunks');\n\t\t\t\t\tavatarsFiles.rawCollection().drop();\n\t\t\t\t\tavatarsChunks.rawCollection().drop();\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStoreType'});\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStorePath'});\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 100,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({audioNotification:{$exists:1}}, { $rename: { 'audioNotification': 'audioNotifications' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 101,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({lastActivity:{$exists:1}}, { $unset: { 'lastActivity': '' } }, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 102,\n\tup() {\n\t\tif (!RocketChat || !RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Connect_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Idle_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tconst LDAP_Domain_Base = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Base' });\n\t\tif (LDAP_Domain_Base) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_BaseDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Base.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Base' });\n\n\t\tconst LDAP_Domain_Search_User_ID = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User_ID' });\n\t\tif (LDAP_Domain_Search_User_ID) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Field' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User_ID.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User_ID' });\n\n\t\tconst LDAP_Use_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tconst LDAP_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Custom_Domain_Search' });\n\n\t\tconst LDAP_Domain_Search_User = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User' });\n\t\tconst LDAP_Domain_Search_Password = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Password' });\n\t\tconst LDAP_Domain_Search_Filter = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tconst LDAP_Domain_Search_Object_Class = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tconst LDAP_Domain_Search_Object_Category = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Category' });\n\n\t\tif (LDAP_Use_Custom_Domain_Search) {\n\t\t\tif (LDAP_Use_Custom_Domain_Search.value === true) {\n\t\t\t\tlet Custom_Domain_Search;\n\t\t\t\ttry {\n\t\t\t\t\tCustom_Domain_Search = JSON.parse(LDAP_Custom_Domain_Search.value);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Error('Invalid Custom Domain Search JSON');\n\t\t\t\t}\n\n\t\t\t\tLDAP_Domain_Search_User.value = Custom_Domain_Search.userDN || '';\n\t\t\t\tLDAP_Domain_Search_Password.value = Custom_Domain_Search.password || '';\n\t\t\t\tLDAP_Domain_Search_Filter.value = Custom_Domain_Search.filter;\n\t\t\t} else {\n\t\t\t\tconst filter = [];\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Category.value !== '') {\n\t\t\t\t\tfilter.push(`(objectCategory=${ LDAP_Domain_Search_Object_Category.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Class.value !== '') {\n\t\t\t\t\tfilter.push(`(objectclass=${ LDAP_Domain_Search_Object_Class.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Filter.value !== '') {\n\t\t\t\t\tfilter.push(`(${ LDAP_Domain_Search_Filter.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (filter.length === 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = filter[0];\n\t\t\t\t} else if (filter.length > 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = `(&${ filter.join('') })`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (LDAP_Domain_Search_Filter && LDAP_Domain_Search_Filter.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Filter' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Filter.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_UserDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User' });\n\n\n\t\tif (LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_Password' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Password.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Password' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value && LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Category' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Sync_Users' }); //Button\n\n\t\tconst LDAP_Sync_User_Data = RocketChat.models.Settings.findOne({ _id: 'LDAP_Sync_User_Data' });\n\t\tif (LDAP_Sync_User_Data && LDAP_Sync_User_Data.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tconst LDAP_Import_Users = RocketChat.models.Settings.findOne({ _id: 'LDAP_Import_Users' });\n\t\tif (LDAP_Import_Users && LDAP_Import_Users.value === false) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync_Import_New_Users' },\n\t\t\t\t{ $set: { value: false } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Import_Users' });\n\t}\n});\n","const majorColors = {\n\t'content-background-color': '#FFFFFF',\n\t'primary-background-color': '#04436A',\n\t'primary-font-color': '#444444',\n\t'primary-action-color': '#13679A', // was action-buttons-color\n\t'secondary-background-color': '#F4F4F4',\n\t'secondary-font-color': '#A0A0A0',\n\t'secondary-action-color': '#DDDDDD',\n\t'component-color': '#EAEAEA',\n\t'success-color': '#4dff4d',\n\t'pending-color': '#FCB316',\n\t'error-color': '#BC2031',\n\t'selection-color': '#02ACEC',\n\t'attention-color': '#9C27B0'\n};\n\n// Minor colours implement major colours by default, but can be overruled\n// const minorColors = {\n// \t'tertiary-background-color': '@component-color',\n// \t'tertiary-font-color': '@transparent-lightest',\n// \t'link-font-color': '@primary-action-color',\n// \t'info-font-color': '@secondary-font-color',\n// \t'custom-scrollbar-color': '@transparent-darker',\n// \t'status-online': '@success-color',\n// \t'status-away': '@pending-color',\n// \t'status-busy': '@error-color',\n// \t'status-offline': '@transparent-darker'\n// };\n\nconst newvariables = {\n\t'content-background-color': 'rc-color-primary-lightest',\n\t'primary-background-color': 'rc-color-primary',\n\t'success-color': 'rc-color-success',\n\t'pending-color': 'rc-color-alert',\n\t'error-color': 'rc-color-error',\n\t'status-online': 'rc-color-success',\n\t'status-away': 'rc-color-alert',\n\t'status-busy': 'rc-color-error',\n\t'status-offline': 'rc-color-primary-darkest'\n};\n\nfunction lightenDarkenColor(col, amt) {\n\tlet usePound = false;\n\tif (col[0] === '#') {\n\t\tcol = col.slice(1);\n\t\tusePound = true;\n\t}\n\n\tconst num = parseInt(col, 16);\n\tlet r = (num >> 16) + amt;\n\n\tif (r > 255) { r = 255; } else if (r < 0) { r = 0; }\n\n\tlet b = ((num >> 8) & 0x00FF) + amt;\n\n\tif (b > 255) { b = 255; } else if (b < 0) { b = 0; }\n\n\tlet g = (num & 0x0000FF) + amt;\n\n\tif (g > 255) { g = 255; } else if (g < 0) { g = 0; }\n\n\treturn (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n}\n\nRocketChat.Migrations.add({\n\tversion: 103,\n\tup() {\n\t\tObject.keys(majorColors).forEach(function(_id) {\n\t\t\tconst color = RocketChat.models.Settings.findOne({_id: `theme-color-${ _id }`});\n\t\t\tconst key = newvariables[_id];\n\t\t\tif (color && color.value !== majorColors[_id] && key) {\n\t\t\t\tif (/^@.+/.test(color.value)) {\n\t\t\t\t\tcolor.value = newvariables[color.value.replace('@', '')];\n\t\t\t\t}\n\t\t\t\tconst id = `theme-color-${ key }`;\n\t\t\t\tRocketChat.models.Settings.update({_id: id}, {$set: { value : color.value, editor: /^#.+/.test(color.value) ? 'color' : 'expression' }});\n\t\t\t\tif (key === 'rc-color-primary') {\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-darkest'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, -16)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-dark'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 18)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 110)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light-medium'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 156)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-lightest'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 200)}});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n});\n","RocketChat.Migrations.add({\n\tversion: 104,\n\tup() {\n\t\tif ((RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary'}) || {}).value === '#04436A' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-darkest'}) || {}).value === '#335a' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-dark'}) || {}).value === '#16557c' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-light'}) || {}).value === '#72b1d8' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-light-medium'}) || {}).value === '#a0dfff' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-lightest'}) || {}).value === '#ccffff'\n\t\t) {\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary'}, {$set: {editor: 'expression', value: 'color-dark'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-darkest'}, {$set: {editor: 'expression', value: 'color-darkest'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-dark'}, {$set: {editor: 'expression', value: 'color-dark-medium'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light'}, {$set: {editor: 'expression', value: 'color-gray'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light-medium'}, {$set: {editor: 'expression', value: 'color-gray-medium'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-lightest'}, {$set: {editor: 'expression', value: 'color-gray-lightest'}});\n\t\t}\n\t}\n});\n","if (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo(process.env.MIGRATION_VERSION || 'latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/']\n\t});\n}\n","/* globals FileUpload */\n\nMeteor.startup(function() {\n\tWebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/*, next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, ''))\n\t\t};\n\n\t\tif (_.isEmpty(params.username)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = /^\\/([^?]*)/.exec(req.url);\n\n\t\tif (match[1]) {\n\t\t\tlet username = decodeURIComponent(match[1]);\n\t\t\tlet file;\n\n\t\t\tusername = username.replace(/\\.jpg$/, '');\n\n\t\t\tif (username[0] !== '@') {\n\t\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfile = RocketChat.models.Avatars.findOneByName(username);\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\tres.setHeader('Content-Security-Policy', 'default-src \\'none\\'');\n\n\t\t\t\treturn FileUpload.get(file, req, res);\n\t\t\t} else {\n\t\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\t\tif (reqModifiedHeader) {\n\t\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst colors = ['#F44336', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#03A9F4', '#00BCD4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFC107', '#FF9800', '#FF5722', '#795548', '#9E9E9E', '#607D8B'];\n\n\t\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tname: 1\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (user && user.name) {\n\t\t\t\t\t\tusername = user.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet color = '';\n\t\t\t\tlet initials = '';\n\n\t\t\t\tif (username === '?') {\n\t\t\t\t\tcolor = '#000';\n\t\t\t\t\tinitials = username;\n\t\t\t\t} else {\n\t\t\t\t\tconst position = username.length % colors.length;\n\n\t\t\t\t\tcolor = colors[position];\n\t\t\t\t\tusername = username.replace(/[^A-Za-z0-9]/g, '.').replace(/\\.+/g, '.').replace(/(^\\.)|(\\.$)/g, '');\n\n\t\t\t\t\tconst usernameParts = username.split('.');\n\n\t\t\t\t\tinitials = usernameParts.length > 1 ? _.first(usernameParts)[0] + _.last(usernameParts)[0] : username.replace(/[^A-Za-z0-9]/g, '').substr(0, 2);\n\t\t\t\t\tinitials = initials.toUpperCase();\n\t\t\t\t}\n\n\t\t\t\tconst svg = `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" standalone=\\\"no\\\"?>\\n<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" pointer-events=\\\"none\\\" width=\\\"50\\\" height=\\\"50\\\">\\n<rect height=\"50\" width=\"50\" fill=\\\"${ color }\\\"/>\\n<text text-anchor=\\\"middle\\\" y=\\\"50%\\\" x=\\\"50%\\\" dy=\\\"0.36em\\\" pointer-events=\\\"auto\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" font-weight=\"400\" font-size=\"28\">\\n${ initials }\\n</text>\\n</svg>`;\n\n\t\t\t\tres.write(svg);\n\t\t\t\tres.end();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history'\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/*error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule(parser) {\n\t\t\t\treturn parser.cron(`${ new Date().getMinutes() } * * * *`);\n\t\t\t},\n\t\t\tjob: generateStatistics\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(`${ now.getMinutes() } ${ now.getHours() } * * *`);\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache\n\t\t});\n\t\treturn SyncedCron.start();\n\t});\n});\n","function flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, `${ key }.`);\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = (`${ _.difference(langs, present).join(',') }: missing translation for `).red + key.white + (`. Present in [${ present.join(',') }]`).red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad(`${ error }`, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","Meteor.startup(function() {\n\tMeteor.defer(function() {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\t'default': true\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.db.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot'\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName('rocket.cat');\n\n\t\t\tconst file = {\n\t\t\t\tuserId: 'rocket.cat',\n\t\t\t\ttype: 'image/png'\n\t\t\t};\n\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log((`Email: ${ process.env.ADMIN_EMAIL }`).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log((`Password: ${ process.env.ADMIN_PASS }`).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\t\tif (!initialUser._id) {\n\t\t\t\t\tconsole.log('No _id provided; Ignoring environment variable INITIAL_USER'.red);\n\t\t\t\t} else if (!RocketChat.models.Users.findOneById(initialUser._id)) {\n\t\t\t\t\tconsole.log('Inserting initial user:'.green);\n\t\t\t\t\tconsole.log(JSON.stringify(initialUser, null, 2).green);\n\t\t\t\t\tRocketChat.models.Users.create(initialUser);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('Error processing environment variable INITIAL_USER'.red, e);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: 'rocket.cat'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user'\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\t\t\tconsole.log((`Email: ${ adminUser.emails[0].address }`).green);\n\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\t\t\tconsole.log((`Password: ${ adminUser._id }`).green);\n\n\t\t\tif (RocketChat.models.Users.db.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${ adminUser.emails[0].address } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${ adminUser.username } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: String(process.env.PORT).trim()\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = String(process.env.INSTANCE_IP).trim();\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","Meteor.startup(function() {\n\tRocketChat.roomTypes.setPublish('c', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1,\n\t\t\t\tjoinCodeRequired: 1\n\t\t\t}\n\t\t};\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeAndName('c', identifier, options);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\tconst roomId = RocketChat.models.Subscriptions.findByTypeNameAndUserId('c', identifier, this.userId).fetch();\n\t\t\tif (roomId.length > 0) {\n\t\t\t\treturn RocketChat.models.Rooms.findById(roomId[0].rid, options);\n\t\t\t}\n\t\t}\n\n\t\treturn this.ready();\n\t});\n\n\tRocketChat.roomTypes.setPublish('p', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', identifier, user.username, options);\n\t});\n\n\treturn RocketChat.roomTypes.setPublish('d', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tjitsiTimeout: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\tif (RocketChat.authz.hasAtLeastOnePermission(this.userId, ['view-d-room', 'view-joined-room'])) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeContainingUsernames('d', [user.username, identifier], options);\n\t\t}\n\n\t\treturn this.ready();\n\t});\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${ RocketChat.Info.version }`,\n\t\t\t`     NodeJS Version: ${ process.versions.node } - ${ process.arch }`,\n\t\t\t`           Platform: ${ process.platform }`,\n\t\t\t`       Process Port: ${ process.env.PORT }`,\n\t\t\t`           Site URL: ${ RocketChat.settings.get('Site_Url') }`,\n\t\t\t`   ReplicaSet OpLog: ${ oplogState }`\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${ RocketChat.Info.commit.hash.substr(0, 10) }`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${ RocketChat.Info.commit.branch }`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${ desiredNodeVersionMajor }.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","const orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function(serviceName, serviceData = {} /*, options*/) {\n\tconst services = [\n\t\t'facebook',\n\t\t'github',\n\t\t'gitlab',\n\t\t'google',\n\t\t'meteor-developer',\n\t\t'linkedin',\n\t\t'twitter',\n\t\t'sandstorm'\n\t];\n\n\tif (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n\t\treturn;\n\t}\n\n\tif (serviceName === 'meteor-developer') {\n\t\tif (Array.isArray(serviceData.emails)) {\n\t\t\tconst primaryEmail = serviceData.emails.sort(a => a.primary !== true).filter(item => item.verified === true)[0];\n\t\t\tserviceData.email = primaryEmail && primaryEmail.address;\n\t\t}\n\t}\n\n\tif (serviceName === 'linkedin') {\n\t\tserviceData.email = serviceData.emailAddress;\n\t}\n\n\tif (serviceData.email) {\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n\t\tif (user != null) {\n\t\t\tconst findQuery = {\n\t\t\t\taddress: serviceData.email,\n\t\t\t\tverified: true\n\t\t\t};\n\n\t\t\tif (!_.findWhere(user.emails, findQuery)) {\n\t\t\t\tRocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n\t\t\tRocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n\t\t}\n\t}\n\n\treturn orig_updateOrCreateUserFromExternalService.apply(this, arguments);\n};\n","Meteor.methods({\n\tOEmbedCacheCleanup() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup'\n\t\t\t});\n\t\t}\n\n\t\tconst date = new Date();\n\t\tconst expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared'\n\t\t};\n\t}\n});\n","Meteor.methods({\n\taddAllUserToRoom(rid, activeUsersOnly = false) {\n\n\t\tcheck (rid, String);\n\t\tcheck (activeUsersOnly, Boolean);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tconst userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userFilter = {};\n\t\t\tif (activeUsersOnly === true) {\n\t\t\t\tuserFilter.active = true;\n\t\t\t}\n\n\t\t\tconst users = RocketChat.models.Users.find(userFilter).fetch();\n\t\t\tconst now = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Rooms.addUsernameById(rid, user.username);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1,\n\t\t\t\t\tuserMentions: 1,\n\t\t\t\t\tgroupMentions: 0\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t}));\n\t\t}\n\t}\n});\n","Meteor.methods({\n\taddRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-leader', 'User is already a leader', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: fromUser.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tafterVerifyEmail() {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'afterVerifyEmail'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tconst verifiedEmail = _.find(user.emails, (email) => email.verified);\n\n\t\tif (verifiedEmail) {\n\t\t\tRocketChat.models.Roles.addUserRoles(user._id, 'user');\n\t\t\tRocketChat.models.Roles.removeUserRoles(user._id, 'anonymous');\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tcanAccessRoom(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, Match.Maybe(String));\n\n\t\tlet user;\n\n\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (userId) {\n\t\t\tuser = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!user || !user.username) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user)) {\n\t\t\t\tif (user) {\n\t\t\t\t\troom.username = user.username;\n\t\t\t\t}\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1\n\t\t\t}\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (_.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst roomTypes = [];\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room')) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c'\n\t\t\t\t});\n\t\t\t} else if (RocketChat.authz.hasPermission(Meteor.userId(), 'view-joined-room')) {\n\t\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', Meteor.userId()).fetch(), 'rid');\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c',\n\t\t\t\t\tids: roomIds\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(Meteor.userId(), 'view-p-room')) {\n\t\t\tconst user = Meteor.user();\n\t\t\tconst userPref = user && user.settings && user.settings.preferences && user.settings.preferences.mergeChannels && user.settings.preferences.roomsListExhibitionMode === 'category';\n\t\t\tconst globalPref = RocketChat.settings.get('UI_Merge_Channels_Groups');\n\t\t\tconst mergeChannels = userPref !== undefined ? userPref : globalPref;\n\n\t\t\tif (mergeChannels) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'p',\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (roomTypes.length) {\n\t\t\tif (filter) {\n\t\t\t\treturn {\n\t\t\t\t\tchannels: RocketChat.models.Rooms.findByNameContainingTypesWithUsername(filter, roomTypes, options).fetch()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tchannels: RocketChat.models.Rooms.findContainingTypesWithUsername(roomTypes, options).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tchannels: []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username]\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now\n\t\t\t}\n\t\t});\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tts: now,\n\t\t\t\tls: now,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': me._id}] // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': to._id}] // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\trid\n\t\t};\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('createDirectMessage', 10, 60000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t}\n});\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.getStore('Uploads').deleteById(fileID);\n\t}\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({roles: 'admin'}).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(fromId, `delete-${ room.t }`, rid)) {\n\t\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\t\treturn RocketChat.models.Rooms.removeById(rid);\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: `https://graph.facebook.com/${ user.services.facebook.id }/picture?type=large`\n\t\t});\n\t}\n\n        if (user.services.dolphin && user.services.dolphin.picture && RocketChat.settings.get('Accounts_OAuth_Dolphin')) {\n                avatars.push({\n                        service: 'dolphin',\n                        url: user.services.dolphin.picture\n                });\n        }\n\n        if (user.services.trident && user.services.trident.picture && RocketChat.settings.get('Accounts_OAuth_Trident')) {\n                avatars.push({\n                        service: 'trident',\n                        url: user.services.trident.picture\n                });\n        }\n\n        if (user.services.una && user.services.una.picture && RocketChat.settings.get('Accounts_OAuth_UNA')) {\n                avatars.push({\n                        service: 'una',\n                        url: user.services.una.picture\n                });\n        }\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: `https://avatars.githubusercontent.com/${ user.services.github.username }?s=200`\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, '')\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings['public'].sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = `data:${ result.headers['content-type'] };base64,`;\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t}\n});\n","Meteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room._id;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t}\n});\n","Meteor.methods({\n\tgetRoomNameById(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room.name;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\treturn room.name;\n\t}\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c'\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t}\n});\n","/* global slugify */\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername({\n\t\t$regex: new RegExp(`^${ username }$`, 'i')\n\t});\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings['public'].sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => {\n\t\t\treturn _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName'));\n\t\t});\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push(RocketChat.settings.get('Accounts_DefaultUsernamePrefixSuggestion'));\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${ usernames[0] }-${ index }`)) {\n\t\t\tusername = `${ usernames[0] }-${ index }`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t}\n});\n","Meteor.methods({\n\tgetUsersOfRoom(roomId, showAll) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', roomId, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst filter = (record) => {\n\t\t\tif (!record._user) {\n\t\t\t\tconsole.log('Subscription without user', record._id);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (showAll === true) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn record._user.status !== 'offline';\n\t\t};\n\n\t\tconst map = (record) => {\n\t\t\treturn {\n\t\t\t\t_id: record._user._id,\n\t\t\t\tusername: record._user.username,\n\t\t\t\tname: record._user.name\n\t\t\t};\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByRoomId(roomId).fetch();\n\n\t\treturn {\n\t\t\ttotal: records.length,\n\t\t\trecords: records.filter(filter).map(map)\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tgroupsList(nameFilter, limit, sort) {\n\n\t\tcheck(nameFilter, Match.Optional(String));\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'groupsList' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: { name: 1 },\n\t\t\tsort: { name: 1 }\n\t\t};\n\n\t\t//Verify the limit param is a number\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\t//Verify there is a sort option and it's a string\n\t\tif (_.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = { name: 1 };\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = { msgs: -1 };\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//Determine if they are searching or not, base it upon the name field\n\t\tif (nameFilter) {\n\t\t\treturn { groups: RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', new RegExp(s.trim(s.escapeRegExp(nameFilter)), 'i'), Meteor.user().username, options).fetch() };\n\t\t} else {\n\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', Meteor.userId()).fetch(), 'rid');\n\t\t\treturn { groups: RocketChat.models.Rooms.findByIds(roomIds, options).fetch() };\n\t\t}\n\t}\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","const hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canAnonymous = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst canPreview = RocketChat.authz.hasPermission(fromId, 'preview-c-room');\n\t\tif (room.t === 'c' && !canAnonymous && !canPreview && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end != null) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampNotContainingTypes(rid, end, hideMessagesOfType, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdNotContainingTypes(rid, hideMessagesOfType, options).fetch();\n\t\t}\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\tif (message.u && message.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\t\t\t\tmessage.u.name = user && user.name;\n\t\t\t}\n\t\t\tif (message.mentions && message.mentions.length && UI_Use_Real_Name) {\n\t\t\t\tmessage.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn message;\n\t\t});\n\n\t\tlet unreadNotLoaded = 0;\n\t\tlet firstUnread;\n\n\t\tif (ls != null) {\n\t\t\tconst firstMessage = messages[messages.length - 1];\n\n\t\t\tif ((firstMessage != null ? firstMessage.ts : undefined) > ls) {\n\t\t\t\tdelete options.limit;\n\n\t\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsNotContainingTypes(rid, ls, firstMessage.ts, hideMessagesOfType, {\n\t\t\t\t\tlimit: 1,\n\t\t\t\t\tsort: {\n\t\t\t\t\t\tts: 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmessages,\n\t\t\tfirstUnread,\n\t\t\tunreadNotLoaded\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${ locale.toLowerCase() }.js`);\n\t\t} catch (error) {\n\t\t\ttry {\n\t\t\t\treturn Assets.getText(`moment-locales/${ locale.split('-').shift().toLowerCase() }.js`);\n\t\t\t} catch (error) {\n\t\t\t\treturn console.log(error);\n\t\t\t}\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\t'editedAt': 0\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t}\n});\n","Meteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2)\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore,\n\t\t\tmoreAfter\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t}\n});\n","Meteor.methods({\n\tmessageSearch(text, rid, limit) {\n\t\tconst result = {\n\t\t\tmessages: [],\n\t\t\tusers: [],\n\t\t\tchannels: []\n\t\t};\n\t\tconst query = {};\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: limit || 20\n\t\t};\n\n\t\tcheck(text, String);\n\t\tcheck(rid, String);\n\t\tcheck(limit, Match.Optional(Number));\n\n\t\tconst currentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch'\n\t\t\t});\n\t\t}\n\t\tconst currentUserName = Meteor.user().username;\n\t\tconst currentUserTimezoneOffset = Meteor.user().utcOffset;\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tconst afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst date = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLabel(_, tag) {\n\t\t\tquery['attachments.0.labels'] = new RegExp(s.escapeRegExp(tag), 'i');\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\n\t\t// Query for senders\n\t\tconst from = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\t\t// Query for senders\n\t\tconst mention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filter image tags\n\t\ttext = text.replace(/label:(\\w+)/g, filterLabel);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tconst r = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2]\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i'\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm' //hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true // don't return _hidden messages\n\t\t\t};\n\t\t\tif (rid != null) {\n\t\t\t\tquery.rid = rid;\n\t\t\t\tif (Meteor.call('canAccessRoom', rid, currentUserId) !== false) {\n\t\t\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\t\t\toptions.fields = {\n\t\t\t\t\t\t\t'editedAt': 0\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tresult.messages = RocketChat.models.Messages.find(query, options).fetch();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t}\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tregisterUser(formData) {\n\t\tconst AllowAnonymousRead = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst AllowAnonymousWrite = RocketChat.settings.get('Accounts_AllowAnonymousWrite');\n\t\tif (AllowAnonymousRead === true && AllowAnonymousWrite === true && formData.email == null) {\n\t\t\tconst userId = Accounts.insertUserDoc({}, {\n\t\t\t\tglobalRoles: [\n\t\t\t\t\t'anonymous'\n\t\t\t\t]\n\t\t\t});\n\n\t\t\tconst { id, token } = Accounts._loginUser(this, userId);\n\n\t\t\treturn { id, token };\n\t\t} else {\n\t\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\t\temail: String,\n\t\t\t\tpass: String,\n\t\t\t\tname: String,\n\t\t\t\tsecretURL: Match.Optional(String)\n\t\t\t}));\n\t\t}\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => html.replace(/\\[Verification_Url]/g, url);\n\t\t\t}\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-leader', 'User is not a leader', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Rooms.removeUsernameById(data.rid, data.username);\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username\n\t\t});\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.methods({\n\troomNameExists(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'roomExists'\n\t\t\t});\n\t\t}\n\t\tconst room = RocketChat.models.Rooms.findOneByName(rid);\n\t\treturn !!room;\n\t}\n});\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tcheck(settings, Object);\n\n\t\tif (Meteor.userId()) {\n\t\t\tconst preferences = {};\n\n\t\t\tif (settings.language != null) {\n\t\t\t\tRocketChat.models.Users.setLanguage(Meteor.userId(), settings.language);\n\t\t\t}\n\n\t\t\tif (settings.newRoomNotification) {\n\t\t\t\tpreferences.newRoomNotification = settings.newRoomNotification;\n\t\t\t}\n\n\t\t\tif (settings.newMessageNotification) {\n\t\t\t\tpreferences.newMessageNotification = settings.newMessageNotification;\n\t\t\t}\n\n\t\t\tif (settings.useEmojis) {\n\t\t\t\tpreferences.useEmojis = settings.useEmojis === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.convertAsciiEmoji) {\n\t\t\t\tpreferences.convertAsciiEmoji = settings.convertAsciiEmoji === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.saveMobileBandwidth) {\n\t\t\t\tpreferences.saveMobileBandwidth = settings.saveMobileBandwidth === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.collapseMediaByDefault) {\n\t\t\t\tpreferences.collapseMediaByDefault = settings.collapseMediaByDefault === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.unreadRoomsMode) {\n\t\t\t\tpreferences.unreadRoomsMode = settings.unreadRoomsMode === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.autoImageLoad) {\n\t\t\t\tpreferences.autoImageLoad = settings.autoImageLoad === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode) {\n\t\t\t\tpreferences.emailNotificationMode = settings.emailNotificationMode;\n\t\t\t}\n\n\t\t\tif (settings.mergeChannels !== '-1') {\n\t\t\t\tpreferences.mergeChannels = settings.mergeChannels === '1';\n\t\t\t} else {\n\t\t\t\tdelete preferences.mergeChannels;\n\t\t\t}\n\t\t\tif (settings.unreadRoomsMode) {\n\t\t\t\tpreferences.unreadRoomsMode = settings.unreadRoomsMode === '1' ? true : false;\n\t\t\t}\n\n\t\t\tpreferences.roomsListExhibitionMode = ['category', 'unread', 'activity'].includes(settings.roomsListExhibitionMode) ? settings.roomsListExhibitionMode : 'category';\n\t\t\tif (settings.unreadAlert) {\n\t\t\t\tpreferences.unreadAlert = settings.unreadAlert === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.notificationsSoundVolume) {\n\t\t\t\tpreferences.notificationsSoundVolume = settings.notificationsSoundVolume;\n\t\t\t}\n\n\t\t\tif (settings.audioNotifications) {\n\t\t\t\tpreferences.audioNotifications = settings.audioNotifications;\n\t\t\t}\n\t\t\tif (settings.desktopNotifications) {\n\t\t\t\tpreferences.desktopNotifications = settings.desktopNotifications;\n\t\t\t}\n\t\t\tif (settings.mobileNotifications) {\n\t\t\t\tpreferences.mobileNotifications = settings.mobileNotifications;\n\t\t\t}\n\n\t\t\tpreferences.audioNotificationValue = settings.audioNotificationValue - 0;\n\t\t\tpreferences.desktopNotificationDuration = settings.desktopNotificationDuration - 0;\n\t\t\tpreferences.viewMode = settings.viewMode || 0;\n\t\t\tpreferences.hideUsernames = settings.hideUsernames === '1';\n\t\t\tpreferences.hideRoles = settings.hideRoles === '1';\n\t\t\tpreferences.hideAvatars = settings.hideAvatars === '1';\n\t\t\tpreferences.hideFlexTab = settings.hideFlexTab === '1';\n\t\t\tpreferences.highlights = settings.highlights;\n\t\t\tpreferences.sendOnEnter = settings.sendOnEnter;\n\n\t\t\tRocketChat.models.Users.setPreferences(Meteor.userId(), preferences);\n\n\t\t\treturn true;\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, typedPassword) {\n\t\t\tif (!(user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: typedPassword,\n\t\t\t\talgorithm: 'sha-256'\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tRocketChat.setRealName(Meteor.userId(), settings.realname);\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\t// Should be the last check to prevent error when trying to check password for users without password\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsendConfirmationEmail(email) {\n\t\tcheck(email, String);\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Verification_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendVerificationEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsendForgotPasswordEmail(email) {\n\t\tcheck(email, String);\n\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(email) }$`, 'i');\n\t\t\temail = (user.emails || []).map(item => item.address).find(userEmail => regex.test(userEmail));\n\n\t\t\tif (RocketChat.settings.get('Forgot_Password_Customized')) {\n\t\t\t\tconst data = { name: user.name, email };\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', data);\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email') || '', data);\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\t\turl = url.replace('/#/', '/');\n\t\t\t\t\treturn html.replace(/\\[Forgot_Password_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendResetPasswordEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 5000);\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user) {\n\t\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\t\tif (user.username) {\n\t\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t\t}\n\n\t\t\tif (active === false) {\n\t\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t}\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t}\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tname: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1\n\t\t}\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findByNameStartingAndTypes(selector.name, ['c', 'p'], options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter,\n\t\tlimit\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","Meteor.publish('messages', function(rid/*, start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit: 50\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t}\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1\n\t\t}\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t},\n\t\tchanged(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n","Meteor.publish('privateHistory', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Rooms.findByContainingUsername(RocketChat.models.Users.findOneById(this.userId).username, {\n\t\tfields: {\n\t\t\tt: 1,\n\t\t\tname: 1,\n\t\t\tmsgs: 1,\n\t\t\tts: 1,\n\t\t\tlm: 1,\n\t\t\tcl: 1\n\t\t}\n\t});\n});\n","const fields = {\n\t_id: 1,\n\tname: 1,\n\tfname: 1,\n\tt: 1,\n\tcl: 1,\n\tu: 1,\n\t// usernames: 1,\n\ttopic: 1,\n\tannouncement: 1,\n\tmuted: 1,\n\t_updatedAt: 1,\n\tarchived: 1,\n\tjitsiTimeout: 1,\n\tdescription: 1,\n\tdefault: 1,\n\tcustomFields: 1,\n\n\t// @TODO create an API to register this fields based on room type\n\tlivechatData: 1,\n\ttags: 1,\n\tsms: 1,\n\tcode: 1,\n\tjoinCodeRequired: 1,\n\topen: 1,\n\tv: 1,\n\tlabel: 1,\n\tro: 1,\n\tsentiment: 1\n};\n\n\nconst roomMap = (record) => {\n\tif (record._room) {\n\t\treturn _.pick(record._room, ...Object.keys(fields));\n\t}\n\tconsole.log('Empty Room for Subscription', record);\n\treturn {};\n};\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tlet options = {fields};\n\n\t\tif (!Meteor.userId()) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\treturn RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c'], options).fetch();\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\toptions = {\n\t\t\tfields\n\t\t};\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, {fields: {_id: 1, _deletedAt: 1}}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, Meteor.userId())) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\treturn roomMap({_room: room});\n\t}\n});\n\nRocketChat.models.Rooms.cache.on('sync', (type, room/*, diff*/) => {\n\tconst records = RocketChat.models.Subscriptions.findByRoomId(room._id).fetch();\n\n\tconst _room = roomMap({_room: room});\n\tfor (const record of records) {\n\t\tRocketChat.Notifications.notifyUserInThisInstance(record.u._id, 'rooms-changed', type, _room);\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', (type, subscription/*, diff*/) => {\n\tif (type === 'inserted' || type === 'removed') {\n\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\tif (room) {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t\t}\n\t}\n});\n","Meteor.publish('roomFiles', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, limit).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('room_files', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('room_files', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('room_files', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.methods({\n\tspotlight(text, usernames, type = {users: true, rooms: true}, rid) {\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: []\n\t\t};\n\t\tconst roomOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\tname: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tname: 1\n\t\t\t}\n\t\t};\n\t\tconst userId = this.userId;\n\t\tif (userId == null) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\tresult.rooms = RocketChat.models.Rooms.findByNameAndTypeNotDefault(regex, 'c', roomOptions).fetch();\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tconst userOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1,\n\t\t\t\tstatus: 1\n\t\t\t},\n\t\t\tsort: {}\n\t\t};\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tuserOptions.sort.name = 1;\n\t\t} else {\n\t\t\tuserOptions.sort.username = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(userId, 'view-outside-room')) {\n\t\t\tif (type.users === true && RocketChat.authz.hasPermission(userId, 'view-d-room')) {\n\t\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersExcept(text, usernames, userOptions).fetch();\n\t\t\t}\n\n\t\t\tif (type.rooms === true && RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tconst username = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\t\tusername: 1\n\t\t\t\t}).username;\n\n\t\t\t\tresult.rooms = RocketChat.models.Rooms.findByNameAndTypeNotContainingUsername(regex, 'c', username, roomOptions).fetch();\n\t\t\t}\n\t\t} else if (type.users === true && rid) {\n\t\t\tconst subscriptions = RocketChat.models.Subscriptions.find({rid, 'u.username':{\n\t\t\t\t$regex: regex,\n\t\t\t\t$nin:[...usernames, Meteor.user().username]\n\t\t\t}}, {limit:userOptions.limit}).fetch().map(({u}) => u._id);\n\t\t\tresult.users = RocketChat.models.Users.find({_id:{$in:subscriptions}}, {fields:userOptions.fields, sort: userOptions.sort}).fetch();\n\t\t}\n\n\t\treturn result;\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tuserMentions: 1,\n\tgroupMentions: 1,\n\tarchived: 1,\n\taudioNotifications: 1,\n\taudioNotificationValue: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = {\n\t\t\tfields\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId()\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', function(type, subscription) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', type, RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n\n// TODO needs improvement\n// We are sending the record again cuz any update on subscription will send the record without the fname (join)\n// Then we need to sent it again listening to the join event.\nRocketChat.models.Subscriptions.on('join:fname:inserted', function(subscription/*, user*/) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', 'changed', RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n","Meteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1\n\t\t},\n\t\tlimit: 10\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\t'services.dolphin.profile_display_name': 1,\n\t\t\t'services.dolphin.profile_link': 1,\n\t\t\t'services.una.profile_display_name': 1,\n\t\t\t'services.una.profile_link': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\t'services.totp.enabled': 1,\n\t\t\tstatusLivechat: 1\n\t\t}\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = room.usernames.indexOf(room.username) > -1;\n\t\toptions.roomType = room.t;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\t\tif (record.u && record.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(record.u._id);\n\t\t\t\trecord.u.name = user && user.name;\n\t\t\t}\n\n\t\t\tif (record.mentions && record.mentions.length && UI_Use_Real_Name) {\n\t\t\t\trecord.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages._db.on('change', function({action, id, data/*, oplog*/}) {\n\t\tswitch (action) {\n\t\t\tcase 'insert':\n\t\t\t\tdata._id = id;\n\t\t\t\tpublishMessage('inserted', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:record':\n\t\t\t\tpublishMessage('updated', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:diff':\n\t\t\t\tpublishMessage('updated', RocketChat.models.Messages.findOne({\n\t\t\t\t\t_id: id\n\t\t\t\t}));\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport {DDPCommon} from 'meteor/ddp-common';\n\nprocess.env.PORT = String(process.env.PORT).trim();\nprocess.env.INSTANCE_IP = String(process.env.INSTANCE_IP).trim();\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream'\n\t}\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${ instance }`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${ instance } ${ InstanceStatus.id() } ${ connections[instance].instanceId }`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${ instance }`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id()\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true\n\t\t}\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1\n\t\t}\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t}\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t}\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {streamName, eventName, args} = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/*, userId*/) {\n\t\tconst fromInstance = `${ process.env.INSTANCE_IP }:${ process.env.PORT }`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n\nMeteor.methods({\n\t'instances/get'() {\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-statistics')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'List instances is not allowed', {\n\t\t\t\tmethod: 'instances/get'\n\t\t\t});\n\t\t}\n\n\t\treturn Object.keys(connections).map(address => {\n\t\t\tconst conn = connections[address];\n\t\t\treturn Object.assign({ address, currentStatus: conn._stream.currentStatus }, _.pick(conn, 'instanceRecord', 'broadcastAuth'));\n\t\t});\n\t}\n});\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n","/* globals mixin */\n\n// This will add underscore.string methods to Underscore.js\n// except for include, contains, reverse and join that are\n// dropped because they collide with the functions already\n// defined by Underscore.js.\n\nmixin = function(obj) {\n\t_.each(_.functions(obj), function(name) {\n\t\tif (!_[name] && !_.prototype[name]) {\n\t\t\t_[name] = obj[name];\n\t\t}\n\t});\n};\n\nmixin(s.exports());\n"]}