{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:ui-master/server/inject.js","meteor://ðŸ’»app/packages/rocketchat:ui-master/server/dynamic-css.js"],"names":["renderDynamicCssList","_","debounce","Meteor","bindEnvironment","colors","RocketChat","models","Settings","find","_id","fields","value","editor","fetch","filter","color","css","map","replace","join","Inject","rawBody","observe","changed","rawHead","require","default","toString","Assets","getText","process","env","DISABLE_ANIMATION","TEST_MODE","settings","get","key","standardFavicons","rawModHtml","html","script","defer","baseUrl","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","trim","test","module","exportDefault","func","wait","immediate","timeout","args","later","apply","callNow","clearTimeout","setTimeout","cssVarPoly","window","CSS","supports","init","console","time","ratifiedVars","varsByBlock","oldCSS","findCSS","updateCSS","timeEnd","styleBlocks","Array","prototype","concat","document","querySelectorAll","counter","block","nodeName","theCSS","innerHTML","findSetters","url","getAttribute","getLink","request","responseText","match","ratifySetters","e","forEach","id","newCSS","replaceGetters","el","querySelector","style","createElement","type","classList","add","getElementsByTagName","appendChild","varList","all","variable","curVars","theVar","matches","split","Object","keys","indexOf","success","XMLHttpRequest","open","overrideMimeType","onload","status","warn","onerror","send","stateCheck","setInterval","readyState","clearInterval","DynamicCss","run","collection"],"mappings":"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","file":"/packages/rocketchat_ui-master.js","sourcesContent":["/* globals Inject */\nconst renderDynamicCssList = _.debounce(Meteor.bindEnvironment(() => {\n\t// const variables = RocketChat.models.Settings.findOne({_id:'theme-custom-variables'}, {fields: { value: 1}});\n\tconst colors = RocketChat.models.Settings.find({_id:/theme-color-rc/i}, {fields: { value: 1, editor: 1}}).fetch().filter(color => color && color.value);\n\n\tif (!colors) {\n\t\treturn;\n\t}\n\tconst css = colors.map(({_id, value, editor}) => {\n\t\tif (editor === 'expression') {\n\t\t\treturn `--${ _id.replace('theme-color-', '') }: var(--${ value });`;\n\t\t}\n\t\treturn `--${ _id.replace('theme-color-', '') }: ${ value };`;\n\t}).join('\\n');\n\tInject.rawBody('dynamic-variables', `<style id='css-variables'> :root {${ css }}</style>`);\n}), 500);\n\nrenderDynamicCssList();\n\n// RocketChat.models.Settings.find({_id:'theme-custom-variables'}, {fields: { value: 1}}).observe({\n// \tchanged: renderDynamicCssList\n// });\n\nRocketChat.models.Settings.find({_id:/theme-color-rc/i}, {fields: { value: 1}}).observe({\n\tchanged: renderDynamicCssList\n});\n\nInject.rawHead('dynamic', `<script>(${ require('./dynamic-css.js').default.toString().replace(/\\/\\/.*?\\n/g, '') })()</script>`);\n\nInject.rawHead('page-loading', `<style>${ Assets.getText('public/loading.css') }</style>`);\n\nInject.rawBody('icons', Assets.getText('public/icons.svg'));\n\nInject.rawBody('page-loading-div', `\n<div id=\"initial-page-loading\" class=\"page-loading\">\n\t<div class=\"loading-animation\">\n\t\t<div class=\"bounce1\"></div>\n\t\t<div class=\"bounce2\"></div>\n\t\t<div class=\"bounce3\"></div>\n\t</div>\n</div>`);\n\nif (process.env.DISABLE_ANIMATION || process.env.TEST_MODE === 'true') {\n\tInject.rawHead('disable-animation', `\n\t<style>\n\t\tbody, body * {\n\t\t\tanimation: none !important;\n\t\t\ttransition: none !important;\n\t\t}\n\t</style>\n\t<script>\n\t\twindow.DISABLE_ANIMATION = true;\n\t</script>\n\t`);\n}\n\nRocketChat.settings.get('Assets_SvgFavicon_Enable', (key, value) => {\n\tconst standardFavicons = `\n\t\t<link rel=\"icon\" sizes=\"16x16\" type=\"image/png\" href=\"assets/favicon_16.png\" />\n\t\t<link rel=\"icon\" sizes=\"32x32\" type=\"image/png\" href=\"assets/favicon_32.png\" />`;\n\n\tif (value) {\n\t\tInject.rawHead(key,\n\t\t\t`${ standardFavicons }\n\t\t\t<link rel=\"icon\" sizes=\"any\" type=\"image/svg+xml\" href=\"assets/favicon.svg\" />`);\n\t} else {\n\t\tInject.rawHead(key, standardFavicons);\n\t}\n});\n\nRocketChat.settings.get('theme-color-sidebar-background', (key, value) => {\n\tInject.rawHead(key, `<style>body { background-color: ${ value };}</style>` +\n\t\t\t\t\t\t`<meta name=\"msapplication-TileColor\" content=\"${ value }\" />` +\n\t\t\t\t\t\t`<meta name=\"theme-color\" content=\"${ value }\" />`);\n});\n\nRocketChat.settings.get('Accounts_ForgetUserSessionOnWindowClose', (key, value) => {\n\tif (value) {\n\t\tInject.rawModHtml(key, (html) => {\n\t\t\tconst script = `\n\t\t\t\t<script>\n\t\t\t\t\tif (Meteor._localStorage._data === undefined && window.sessionStorage) {\n\t\t\t\t\t\tMeteor._localStorage = window.sessionStorage;\n\t\t\t\t\t}\n\t\t\t\t</script>\n\t\t\t`;\n\t\t\treturn html.replace(/<\\/body>/, `${ script }\\n</body>`);\n\t\t});\n\t} else {\n\t\tInject.rawModHtml(key, (html) => {\n\t\t\treturn html;\n\t\t});\n\t}\n});\n\nRocketChat.settings.get('Site_Name', (key, value = 'Chat') => {\n\tInject.rawHead(key,\n\t\t`<title>${ value }</title>` +\n\t\t`<meta name=\"application-name\" content=\"${ value }\">` +\n\t\t`<meta name=\"apple-mobile-web-app-title\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_language', (key, value = '') => {\n\tInject.rawHead(key,\n\t\t`<meta http-equiv=\"content-language\" content=\"${ value }\">` +\n\t\t`<meta name=\"language\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_robots', (key, value = '') => {\n\tInject.rawHead(key, `<meta name=\"robots\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_msvalidate01', (key, value = '') => {\n\tInject.rawHead(key, `<meta name=\"msvalidate.01\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_google-site-verification', (key, value = '') => {\n\tInject.rawHead(key, `<meta name=\"google-site-verification\" content=\"${ value }\" />`);\n});\n\nRocketChat.settings.get('Meta_fb_app_id', (key, value = '') => {\n\tInject.rawHead(key, `<meta property=\"fb:app_id\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_custom', (key, value = '') => {\n\tInject.rawHead(key, value);\n});\n\nMeteor.defer(() => {\n\tlet baseUrl;\n\tif (__meteor_runtime_config__.ROOT_URL_PATH_PREFIX && __meteor_runtime_config__.ROOT_URL_PATH_PREFIX.trim() !== '') {\n\t\tbaseUrl = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\t} else {\n\t\tbaseUrl = '/';\n\t}\n\tif (/\\/$/.test(baseUrl) === false) {\n\t\tbaseUrl += '/';\n\t}\n\tInject.rawHead('base', `<base href=\"${ baseUrl }\">`);\n});\n","/* global DynamicCss */\n\n'use strict';\nexport default () => {\n\n\tconst debounce = (func, wait, immediate) => {\n\t\tlet timeout;\n\t\treturn function(...args) {\n\t\t\tconst later = () => {\n\t\t\t\ttimeout = null;\n\t\t\t\t!immediate && func.apply(this, args);\n\t\t\t};\n\t\t\tconst callNow = immediate && !timeout;\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(later, wait);\n\t\t\tcallNow && func.apply(this, args);\n\t\t};\n\t};\n\tconst cssVarPoly = {\n\t\ttest() { return window.CSS && window.CSS.supports && window.CSS.supports('(--foo: red)'); },\n\t\tinit() {\n\t\t\tif (this.test()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconsole.time('cssVarPoly');\n\t\t\tcssVarPoly.ratifiedVars = {};\n\t\t\tcssVarPoly.varsByBlock = [];\n\t\t\tcssVarPoly.oldCSS = [];\n\n\t\t\tcssVarPoly.findCSS();\n\t\t\tcssVarPoly.updateCSS();\n\t\t\tconsole.timeEnd('cssVarPoly');\n\t\t},\n\t\tfindCSS() {\n\t\t\tconst styleBlocks = Array.prototype.concat.apply([], document.querySelectorAll('#css-variables, link[type=\"text/css\"].__meteor-css__'));\n\n\t\t\t// we need to track the order of the style/link elements when we save off the CSS, set a counter\n\t\t\tlet counter = 1;\n\n\t\t\t// loop through all CSS blocks looking for CSS variables being set\n\t\t\tstyleBlocks.map(block => {\n\t\t\t\t// console.log(block.nodeName);\n\t\t\t\tif (block.nodeName === 'STYLE') {\n\t\t\t\t\tconst theCSS = block.innerHTML;\n\t\t\t\t\tcssVarPoly.findSetters(theCSS, counter);\n\t\t\t\t\tcssVarPoly.oldCSS[counter++] = theCSS;\n\t\t\t\t} else if (block.nodeName === 'LINK') {\n\t\t\t\t\tconst url = block.getAttribute('href');\n\t\t\t\t\tcssVarPoly.oldCSS[counter] = '';\n\t\t\t\t\tcssVarPoly.getLink(url, counter, function(counter, request) {\n\t\t\t\t\t\tcssVarPoly.findSetters(request.responseText, counter);\n\t\t\t\t\t\tcssVarPoly.oldCSS[counter++] = request.responseText;\n\t\t\t\t\t\tcssVarPoly.updateCSS();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// find all the \"--variable: value\" matches in a provided block of CSS and add them to the master list\n\t\tfindSetters(theCSS, counter) {\n\t\t\t// console.log(theCSS);\n\t\t\tcssVarPoly.varsByBlock[counter] = theCSS.match(/(--[^:; ]+:..*?;)/g);\n\t\t},\n\n\t\t// run through all the CSS blocks to update the variables and then inject on the page\n\t\tupdateCSS: debounce(() => {\n\t\t\t// first lets loop through all the variables to make sure later vars trump earlier vars\n\t\t\tcssVarPoly.ratifySetters(cssVarPoly.varsByBlock);\n\n\t\t\t// loop through the css blocks (styles and links)\n\t\t\tcssVarPoly.oldCSS.filter(e => e).forEach((css, id) => {\n\t\t\t\tconst newCSS = cssVarPoly.replaceGetters(css, cssVarPoly.ratifiedVars);\n\t\t\t\tconst el = document.querySelector(`#inserted${ id }`);\n\t\t\t\tif (el) {\n\t\t\t\t\t// console.log(\"updating\")\n\t\t\t\t\tel.innerHTML = newCSS;\n\t\t\t\t} else {\n\t\t\t\t\t// console.log(\"adding\");\n\t\t\t\t\tconst style = document.createElement('style');\n\t\t\t\t\tstyle.type = 'text/css';\n\t\t\t\t\tstyle.innerHTML = newCSS;\n\t\t\t\t\tstyle.classList.add('inserted');\n\t\t\t\t\tstyle.id = `inserted${ id }`;\n\t\t\t\t\tdocument.getElementsByTagName('head')[0].appendChild(style);\n\t\t\t\t}\n\t\t\t});\n\t\t}, 100),\n\n\t\t// parse a provided block of CSS looking for a provided list of variables and replace the --var-name with the correct value\n\t\treplaceGetters(oldCSS, varList) {\n\t\t\treturn oldCSS.replace(/var\\((--.*?)\\)/gm, (all, variable) => varList[variable]);\n\t\t},\n\n\t\t// determine the css variable name value pair and track the latest\n\t\tratifySetters(varList) {\n\t\t\t// loop through each block in order, to maintain order specificity\n\t\t\tvarList.filter(curVars => curVars).forEach(curVars => {\n\t\t\t\t// const curVars = varList[curBlock] || [];\n\t\t\t\tcurVars.forEach(function(theVar) {\n\t\t\t\t\t// console.log(theVar);\n\t\t\t\t\t// split on the name value pair separator\n\t\t\t\t\tconst matches = theVar.split(/:\\s*/);\n\t\t\t\t\t// console.log(matches);\n\t\t\t\t\t// put it in an object based on the varName. Each time we do this it will override a previous use and so will always have the last set be the winner\n\t\t\t\t\t// 0 = the name, 1 = the value, strip off the ; if it is there\n\t\t\t\t\tcssVarPoly.ratifiedVars[matches[0]] = matches[1].replace(/;/, '');\n\t\t\t\t});\n\t\t\t});\n\t\t\tObject.keys(cssVarPoly.ratifiedVars).filter(key => {\n\t\t\t\treturn cssVarPoly.ratifiedVars[key].indexOf('var') > -1;\n\t\t\t}).forEach(key => {\n\t\t\t\tcssVarPoly.ratifiedVars[key] = cssVarPoly.ratifiedVars[key].replace(/var\\((--.*?)\\)/gm, function(all, variable) {\n\t\t\t\t\treturn cssVarPoly.ratifiedVars[variable];\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t// get the CSS file (same domain for now)\n\t\tgetLink(url, counter, success) {\n\t\t\tconst request = new XMLHttpRequest();\n\t\t\trequest.open('GET', url, true);\n\t\t\trequest.overrideMimeType('text/css;');\n\t\t\trequest.onload = function() {\n\t\t\t\tif (request.status >= 200 && request.status < 400) {\n\t\t\t\t\t// Success!\n\t\t\t\t\t// console.log(request.responseText);\n\t\t\t\t\tif (typeof success === 'function') {\n\t\t\t\t\t\tsuccess(counter, request);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// We reached our target server, but it returned an error\n\t\t\t\t\tconsole.warn('an error was returned from:', url);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\trequest.onerror = function() {\n\t\t\t\t// There was a connection error of some sort\n\t\t\t\tconsole.warn('we could not get anything from:', url);\n\t\t\t};\n\n\t\t\trequest.send();\n\t\t}\n\n\t};\n\tconst stateCheck = setInterval(() => {\n\t\tif (document.readyState === 'complete' && typeof Meteor !== 'undefined') {\n\t\t\tclearInterval(stateCheck);\n\t\t\t// document ready\n\t\t\tcssVarPoly.init();\n\t\t}\n\t}, 100);\n\n\tDynamicCss = typeof DynamicCss !=='undefined'? DynamicCss : {};\n\tDynamicCss.test = () => window.CSS && window.CSS.supports && window.CSS.supports('(--foo: red)');\n\tDynamicCss.run = debounce((replace = false) => {\n\t\tif (replace) {\n\t\t\t// const variables = RocketChat.models.Settings.findOne({_id:'theme-custom-variables'}, {fields: { value: 1}});\n\t\t\tconst colors = RocketChat.settings.collection.find({_id:/theme-color-rc/i}, {fields: { value: 1, editor: 1}}).fetch().filter(color => color && color.value);\n\n\t\t\tif (!colors) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst css = colors.map(({_id, value, editor}) => {\n\t\t\t\tif (editor === 'expression') {\n\t\t\t\t\treturn `--${ _id.replace('theme-color-', '') }: var(--${ value });`;\n\t\t\t\t}\n\t\t\t\treturn `--${ _id.replace('theme-color-', '') }: ${ value };`;\n\t\t\t}).join('\\n');\n\t\t\tdocument.querySelector('#css-variables').innerHTML = `:root {${ css }}`;\n\t\t}\n\t\tcssVarPoly.init();\n\t}, 1000);\n};\n"]}