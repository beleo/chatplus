{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/server/models/OAuthApps.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/oauth/server/oauth2-server.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/oauth/server/default-services.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/admin/server/publications/oauthApps.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/admin/server/methods/addOAuthApp.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/admin/server/methods/updateOAuthApp.js","meteor://ðŸ’»app/packages/rocketchat:oauth2-server-config/admin/server/methods/deleteOAuthApp.js"],"names":["RocketChat","models","OAuthApps","_Base","oauth2server","OAuth2Server","accessTokensCollectionName","refreshTokensCollectionName","authCodesCollectionName","clientsCollection","model","debug","WebApp","connectHandlers","use","app","routes","get","req","res","headers","authorization","sendStatus","send","accessToken","replace","token","oauth","AccessTokens","findOne","user","Users","findOneById","userId","sub","_id","name","email","emails","address","email_verified","verified","department","birthdate","preffered_username","username","updated_at","_updatedAt","picture","Meteor","absoluteUrl","publish","clientId","ready","find","active","fields","API","v1","addAuthMethod","headerToken","request","getToken","query","access_token","matches","match","undefined","bearerToken","getAccessToken","wrapAsync","expires","Date","_","omit","insert","clientSecret","redirectUri","_createdAt","_createdBy","authz","hasPermission","error","Error","methods","addOAuthApp","application","method","isString","trim","isBoolean","Random","id","secret","updateOAuthApp","applicationId","currentApplication","update","$set","_updatedBy","deleteOAuthApp","remove"],"mappings":"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","file":"/packages/rocketchat_oauth2-server-config.js","sourcesContent":["RocketChat.models.OAuthApps = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('oauth_apps');\n\t}\n};\n\n\n\n\n// FIND\n// findByRole: (role, options) ->\n// \tquery =\n// \troles: role\n\n// \treturn @find query, options\n\n// CREATE\n","/*global OAuth2Server */\n\nconst oauth2server = new OAuth2Server({\n\taccessTokensCollectionName: 'rocketchat_oauth_access_tokens',\n\trefreshTokensCollectionName: 'rocketchat_oauth_refresh_tokens',\n\tauthCodesCollectionName: 'rocketchat_oauth_auth_codes',\n\tclientsCollection: RocketChat.models.OAuthApps.model,\n\tdebug: true\n});\n\nWebApp.connectHandlers.use(oauth2server.app);\n\noauth2server.routes.get('/oauth/userinfo', function(req, res) {\n\tif (req.headers.authorization == null) {\n\t\treturn res.sendStatus(401).send('No token');\n\t}\n\tconst accessToken = req.headers.authorization.replace('Bearer ', '');\n\tconst token = oauth2server.oauth.model.AccessTokens.findOne({\n\t\taccessToken\n\t});\n\tif (token == null) {\n\t\treturn res.sendStatus(401).send('Invalid Token');\n\t}\n\tconst user = RocketChat.models.Users.findOneById(token.userId);\n\tif (user == null) {\n\t\treturn res.sendStatus(401).send('Invalid Token');\n\t}\n\treturn res.send({\n\t\tsub: user._id,\n\t\tname: user.name,\n\t\temail: user.emails[0].address,\n\t\temail_verified: user.emails[0].verified,\n\t\tdepartment: '',\n\t\tbirthdate: '',\n\t\tpreffered_username: user.username,\n\t\tupdated_at: user._updatedAt,\n\t\tpicture: `${ Meteor.absoluteUrl() }avatar/${ user.username }`\n\t});\n});\n\nMeteor.publish('oauthClient', function(clientId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\treturn RocketChat.models.OAuthApps.find({\n\t\tclientId,\n\t\tactive: true\n\t}, {\n\t\tfields: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n\nRocketChat.API.v1.addAuthMethod(function() {\n\tlet headerToken = this.request.headers['authorization'];\n\tconst getToken = this.request.query.access_token;\n\tif (headerToken != null) {\n\t\tconst matches = headerToken.match(/Bearer\\s(\\S+)/);\n\t\tif (matches) {\n\t\t\theaderToken = matches[1];\n\t\t} else {\n\t\t\theaderToken = undefined;\n\t\t}\n\t}\n\tconst bearerToken = headerToken || getToken;\n\tif (bearerToken == null) {\n\t\treturn;\n\t}\n\tconst getAccessToken = Meteor.wrapAsync(oauth2server.oauth.model.getAccessToken, oauth2server.oauth.model);\n\tconst accessToken = getAccessToken(bearerToken);\n\tif (accessToken == null) {\n\t\treturn;\n\t}\n\tif ((accessToken.expires != null) && accessToken.expires !== 0 && accessToken.expires < new Date()) {\n\t\treturn;\n\t}\n\tconst user = RocketChat.models.Users.findOne(accessToken.userId);\n\tif (user == null) {\n\t\treturn;\n\t}\n\treturn { user: _.omit(user, '$loki') };\n});\n","if (!RocketChat.models.OAuthApps.findOne('zapier')) {\n\tRocketChat.models.OAuthApps.insert({\n\t\t_id: 'zapier',\n\t\tname: 'Zapier',\n\t\tactive: true,\n\t\tclientId: 'zapier',\n\t\tclientSecret: 'RTK6TlndaCIolhQhZ7_KHIGOKj41RnlaOq_o-7JKwLr',\n\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/',\n\t\t_createdAt: new Date,\n\t\t_createdBy: {\n\t\t\t_id: 'system',\n\t\t\tusername: 'system'\n\t\t}\n\t});\n}\n","Meteor.publish('oauthApps', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-oauth-apps')) {\n\t\tthis.error(Meteor.Error('error-not-allowed', 'Not allowed', { publish: 'oauthApps' }));\n\t}\n\treturn RocketChat.models.OAuthApps.find();\n});\n","Meteor.methods({\n\taddOAuthApp(application) {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-oauth-apps')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'addOAuthApp' });\n\t\t}\n\t\tif (!_.isString(application.name) || application.name.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-name', 'Invalid name', { method: 'addOAuthApp' });\n\t\t}\n\t\tif (!_.isString(application.redirectUri) || application.redirectUri.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-redirectUri', 'Invalid redirectUri', { method: 'addOAuthApp' });\n\t\t}\n\t\tif (!_.isBoolean(application.active)) {\n\t\t\tthrow new Meteor.Error('error-invalid-arguments', 'Invalid arguments', { method: 'addOAuthApp' });\n\t\t}\n\t\tapplication.clientId = Random.id();\n\t\tapplication.clientSecret = Random.secret();\n\t\tapplication._createdAt = new Date;\n\t\tapplication._createdBy = RocketChat.models.Users.findOne(this.userId, { fields: { username: 1 } });\n\t\tapplication._id = RocketChat.models.OAuthApps.insert(application);\n\t\treturn application;\n\t}\n});\n","Meteor.methods({\n\tupdateOAuthApp(applicationId, application) {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-oauth-apps')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'updateOAuthApp' });\n\t\t}\n\t\tif (!_.isString(application.name) || application.name.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-name', 'Invalid name', { method: 'updateOAuthApp' });\n\t\t}\n\t\tif (!_.isString(application.redirectUri) || application.redirectUri.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-redirectUri', 'Invalid redirectUri', { method: 'updateOAuthApp' });\n\t\t}\n\t\tif (!_.isBoolean(application.active)) {\n\t\t\tthrow new Meteor.Error('error-invalid-arguments', 'Invalid arguments', { method: 'updateOAuthApp' });\n\t\t}\n\t\tconst currentApplication = RocketChat.models.OAuthApps.findOne(applicationId);\n\t\tif (currentApplication == null) {\n\t\t\tthrow new Meteor.Error('error-application-not-found', 'Application not found', { method: 'updateOAuthApp' });\n\t\t}\n\t\tRocketChat.models.OAuthApps.update(applicationId, {\n\t\t\t$set: {\n\t\t\t\tname: application.name,\n\t\t\t\tactive: application.active,\n\t\t\t\tredirectUri: application.redirectUri,\n\t\t\t\t_updatedAt: new Date,\n\t\t\t\t_updatedBy: RocketChat.models.Users.findOne(this.userId, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\tusername: 1\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.OAuthApps.findOne(applicationId);\n\t}\n});\n","Meteor.methods({\n\tdeleteOAuthApp(applicationId) {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-oauth-apps')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'deleteOAuthApp' });\n\t\t}\n\t\tconst application = RocketChat.models.OAuthApps.findOne(applicationId);\n\t\tif (application == null) {\n\t\t\tthrow new Meteor.Error('error-application-not-found', 'Application not found', { method: 'deleteOAuthApp' });\n\t\t}\n\t\tRocketChat.models.OAuthApps.remove({ _id: applicationId });\n\t\treturn true;\n\t}\n});\n"]}