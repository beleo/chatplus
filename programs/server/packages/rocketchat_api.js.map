{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:api/server/api.js","meteor://ðŸ’»app/packages/rocketchat:api/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/requestParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getPaginationItems.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/isUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/parseJsonQuery.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/channels.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/chat.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/groups.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/im.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/integrations.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/misc.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/stats.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/users.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/info.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/metrics.js"],"names":["API","properties","logger","Logger","version","authMethods","helperMethods","Map","fieldSeparator","defaultFieldsToExclude","joinCode","$loki","meta","members","importIds","limitedUserFieldsToExclude","avatarOrigin","emails","phone","statusConnection","createdAt","lastLogin","services","requirePasswordChange","requirePasswordChangeReason","roles","statusDefault","_updatedAt","customFields","_config","defaultOptionsEndpoint","request","method","headers","RocketChat","settings","get","response","writeHead","write","done","addAuthMethod","push","success","result","_","isObject","statusCode","body","failure","errorType","error","unauthorized","msg","addRoute","routes","options","endpoints","isArray","forEach","route","Object","keys","action","originalAction","debug","toUpperCase","url","apply","e","stack","v1","message","name","helperMethod","Restivus","getUserAuth","_getUserAuth","invalidResults","undefined","token","user","bodyParams","payload","JSON","parse","i","length","arguments","includes","Accounts","_hashLoginToken","userId","useDefaultAuth","prettyJson","enableCors","auth","default","addGroup","section","add","type","enableQuery","_id","value","set","_requestParams","queryParams","_getPaginationItems","hardUpperLimit","defaultCount","offset","parseInt","count","_getUserFromParams","doesntExist","_doesntExist","params","requestParams","trim","models","Users","findOneById","username","findOneByUsername","Meteor","Error","_isUserFromParams","_parseJsonQuery","sort","warn","fields","nonSelectableFields","authz","hasPermission","concat","k","split","assign","query","nonQuerableFields","_getLoggedInUser","findOne","findChannelByIdOrName","checkedArchived","roomId","roomName","room","Rooms","findOneByName","t","archived","authRequired","post","findResult","runAsUser","call","activeUsersOnly","channel","getUserFromParams","latest","oldest","Date","inclusive","sub","Subscriptions","findOneByRoomIdAndUserId","open","readOnly","id","rid","getPaginationItems","parseJsonQuery","ourQuery","files","Uploads","find","skip","limit","fetch","total","includeAllPublicChannels","$in","integrations","Integrations","_createdAt","latestDate","oldestDate","unreads","usernames","rooms","channels","pluck","findByTypeAndUserId","totalCount","processQueryOptionsOnResult","Array","from","users","status","utcOffset","messages","Messages","ts","online","findUsersNotOffline","onlineInRoom","indexOf","description","purpose","ro","topic","check","Match","ObjectIncluding","msgId","String","asUser","Maybe","Boolean","u","now","messageId","pinnedMessage","messageReturn","processWebhookMessage","starred","text","findPrivateGroupByIdOrName","roomSub","findOneByRoomNameAndUserId","group","_room","includeAllPrivateGroups","channelsToSearch","groups","findByType","findDirectMessageRoom","getRoomByNameOrIdWithOptionToJoin","currentUserId","nameOrId","subscription","console","log","msgs","ims","enabled","urls","event","triggerWords","alias","avatar","emoji","scriptEnabled","script","targetChannel","integration","history","IntegrationHistory","items","target_url","integrationId","getLoggedInUser","hasRole","info","Info","pick","onlineCache","onlineCacheDate","cacheInvalid","icon","types","map","hideIcon","TAPi18n","__","iconSize","leftSize","rightSize","width","height","replace","hidden","$ne","public","Settings","findOneNotHiddenById","urlParams","Any","updateValueNotHiddenById","refresh","stats","statistics","Statistics","email","password","active","joinDefaultChannels","sendWelcomeEmail","verified","validateCustomFields","newUserId","saveUser","saveCustomFieldsWithoutValidation","getURL","cdn","full","setHeader","isUserFromParams","presence","connectionStatus","filter","avatarUrl","setUserAvatar","Busboy","Npm","require","busboy","wrapAsync","callback","on","bindEnvironment","fieldname","file","filename","encoding","mimetype","imageData","data","Buffer","pipe","userData","extend","saveCustomFields","promclient","register","metrics"],"mappings":"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","file":"/packages/rocketchat_api.js","sourcesContent":["/* global Restivus */\nclass API extends Restivus {\n\tconstructor(properties) {\n\t\tsuper(properties);\n\t\tthis.logger = new Logger(`API ${ properties.version ? properties.version : 'default' } Logger`, {});\n\t\tthis.authMethods = [];\n\t\tthis.helperMethods = new Map();\n\t\tthis.fieldSeparator = '.';\n\t\tthis.defaultFieldsToExclude = {\n\t\t\tjoinCode: 0,\n\t\t\t$loki: 0,\n\t\t\tmeta: 0,\n\t\t\tmembers: 0,\n\t\t\timportIds: 0\n\t\t};\n\t\tthis.limitedUserFieldsToExclude = {\n\t\t\tavatarOrigin: 0,\n\t\t\temails: 0,\n\t\t\tphone: 0,\n\t\t\tstatusConnection: 0,\n\t\t\tcreatedAt: 0,\n\t\t\tlastLogin: 0,\n\t\t\tservices: 0,\n\t\t\trequirePasswordChange: 0,\n\t\t\trequirePasswordChangeReason: 0,\n\t\t\troles: 0,\n\t\t\tstatusDefault: 0,\n\t\t\t_updatedAt: 0,\n\t\t\tcustomFields: 0\n\t\t};\n\n\t\tthis._config.defaultOptionsEndpoint = function() {\n\t\t\tif (this.request.method === 'OPTIONS' && this.request.headers['access-control-request-method']) {\n\t\t\t\tif (RocketChat.settings.get('API_Enable_CORS') === true) {\n\t\t\t\t\tthis.response.writeHead(200, {\n\t\t\t\t\t\t'Access-Control-Allow-Origin': RocketChat.settings.get('API_CORS_Origin'),\n\t\t\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept, X-User-Id, X-Auth-Token'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.response.writeHead(405);\n\t\t\t\t\tthis.response.write('CORS not enabled. Go to \"Admin > General > REST Api\" to enable it.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.response.writeHead(404);\n\t\t\t}\n\n\t\t\tthis.done();\n\t\t};\n\t}\n\n\taddAuthMethod(method) {\n\t\tthis.authMethods.push(method);\n\t}\n\n\tsuccess(result={}) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = true;\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 200,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\tfailure(result, errorType) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = false;\n\t\t} else {\n\t\t\tresult = {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result\n\t\t\t};\n\n\t\t\tif (errorType) {\n\t\t\t\tresult.errorType = errorType;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 400,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\n\tunauthorized(msg) {\n\t\treturn {\n\t\t\tstatusCode: 403,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'unauthorized'\n\t\t\t}\n\t\t};\n\t}\n\n\taddRoute(routes, options, endpoints) {\n\t\t//Note: required if the developer didn't provide options\n\t\tif (typeof endpoints === 'undefined') {\n\t\t\tendpoints = options;\n\t\t\toptions = {};\n\t\t}\n\n\t\t//Allow for more than one route using the same option and endpoints\n\t\tif (!_.isArray(routes)) {\n\t\t\troutes = [routes];\n\t\t}\n\n\t\troutes.forEach((route) => {\n\t\t\t//Note: This is required due to Restivus calling `addRoute` in the constructor of itself\n\t\t\tif (this.helperMethods) {\n\t\t\t\tObject.keys(endpoints).forEach((method) => {\n\t\t\t\t\tif (typeof endpoints[method] === 'function') {\n\t\t\t\t\t\tendpoints[method] = { action: endpoints[method] };\n\t\t\t\t\t}\n\n\t\t\t\t\t//Add a try/catch for each endpoint\n\t\t\t\t\tconst originalAction = endpoints[method].action;\n\t\t\t\t\tendpoints[method].action = function() {\n\t\t\t\t\t\tthis.logger.debug(`${ this.request.method.toUpperCase() }: ${ this.request.url }`);\n\t\t\t\t\t\tlet result;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = originalAction.apply(this);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis.logger.debug(`${ method } ${ route } threw an error:`, e.stack);\n\t\t\t\t\t\t\treturn RocketChat.API.v1.failure(e.message, e.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result ? result : RocketChat.API.v1.success();\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (const [name, helperMethod] of this.helperMethods) {\n\t\t\t\t\t\tendpoints[method][name] = helperMethod;\n\t\t\t\t\t}\n\n\t\t\t\t\t//Allow the endpoints to make usage of the logger which respects the user's settings\n\t\t\t\t\tendpoints[method].logger = this.logger;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsuper.addRoute(route, options, endpoints);\n\t\t});\n\t}\n}\n\nRocketChat.API = {};\n\nconst getUserAuth = function _getUserAuth() {\n\tconst invalidResults = [undefined, null, false];\n\treturn {\n\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\tuser() {\n\t\t\tif (this.bodyParams && this.bodyParams.payload) {\n\t\t\t\tthis.bodyParams = JSON.parse(this.bodyParams.payload);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < RocketChat.API.v1.authMethods.length; i++) {\n\t\t\t\tconst method = RocketChat.API.v1.authMethods[i];\n\n\t\t\t\tif (typeof method === 'function') {\n\t\t\t\t\tconst result = method.apply(this, arguments);\n\t\t\t\t\tif (!invalidResults.includes(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet token;\n\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\ttoken\n\t\t\t};\n\t\t}\n\t};\n};\n\nRocketChat.API.v1 = new API({\n\tversion: 'v1',\n\tuseDefaultAuth: true,\n\tprettyJson: true,\n\tenableCors: false,\n\tauth: getUserAuth()\n});\n\nRocketChat.API.default = new API({\n\tuseDefaultAuth: true,\n\tprettyJson: true,\n\tenableCors: false,\n\tauth: getUserAuth()\n});\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Upper_Count_Limit', 100, { type: 'int', public: false });\n\t\tthis.add('API_Default_Count', 50, { type: 'int', public: false });\n\t\tthis.add('API_Allow_Infinite_Count', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Direct_Message_History_EndPoint', false, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Shields', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Shield_Types', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_Shields', value: true } });\n\t\tthis.add('API_Enable_CORS', false, { type: 'boolean', public: false });\n\t\tthis.add('API_CORS_Origin', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_CORS', value: true } });\n\t});\n});\n","RocketChat.API.v1.helperMethods.set('requestParams', function _requestParams() {\n\treturn ['POST', 'PUT'].includes(this.request.method) ? this.bodyParams : this.queryParams;\n});\n","// If the count query param is higher than the \"API_Upper_Count_Limit\" setting, then we limit that\n// If the count query param isn't defined, then we set it to the \"API_Default_Count\" setting\n// If the count is zero, then that means unlimited and is only allowed if the setting \"API_Allow_Infinite_Count\" is true\n\nRocketChat.API.v1.helperMethods.set('getPaginationItems', function _getPaginationItems() {\n\tconst hardUpperLimit = RocketChat.settings.get('API_Upper_Count_Limit') <= 0 ? 100 : RocketChat.settings.get('API_Upper_Count_Limit');\n\tconst defaultCount = RocketChat.settings.get('API_Default_Count') <= 0 ? 50 : RocketChat.settings.get('API_Default_Count');\n\tconst offset = this.queryParams.offset ? parseInt(this.queryParams.offset) : 0;\n\tlet count = defaultCount;\n\n\t// Ensure count is an appropiate amount\n\tif (typeof this.queryParams.count !== 'undefined') {\n\t\tcount = parseInt(this.queryParams.count);\n\t} else {\n\t\tcount = defaultCount;\n\t}\n\n\tif (count > hardUpperLimit) {\n\t\tcount = hardUpperLimit;\n\t}\n\n\tif (count === 0 && !RocketChat.settings.get('API_Allow_Infinite_Count')) {\n\t\tcount = defaultCount;\n\t}\n\n\treturn {\n\t\toffset,\n\t\tcount\n\t};\n});\n","//Convenience method, almost need to turn it into a middleware of sorts\nRocketChat.API.v1.helperMethods.set('getUserFromParams', function _getUserFromParams() {\n\tconst doesntExist = { _doesntExist: true };\n\tlet user;\n\tconst params = this.requestParams();\n\n\tif (params.userId && params.userId.trim()) {\n\t\tuser = RocketChat.models.Users.findOneById(params.userId) || doesntExist;\n\t} else if (params.username && params.username.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.username) || doesntExist;\n\t} else if (params.user && params.user.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.user) || doesntExist;\n\t} else {\n\t\tthrow new Meteor.Error('error-user-param-not-provided', 'The required \"userId\" or \"username\" param was not provided');\n\t}\n\n\tif (user._doesntExist) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'The required \"userId\" or \"username\" param provided does not match any users');\n\t}\n\n\treturn user;\n});\n","RocketChat.API.v1.helperMethods.set('isUserFromParams', function _isUserFromParams() {\n\tconst params = this.requestParams();\n\n\treturn (!params.userId && !params.username && !params.user) ||\n\t\t(params.userId && this.userId === params.userId) ||\n\t\t(params.username && this.user.username === params.username) ||\n\t\t(params.user && this.user.username === params.user);\n});\n","RocketChat.API.v1.helperMethods.set('parseJsonQuery', function _parseJsonQuery() {\n\tlet sort;\n\tif (this.queryParams.sort) {\n\t\ttry {\n\t\t\tsort = JSON.parse(this.queryParams.sort);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid sort parameter provided \"${ this.queryParams.sort }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-sort', `Invalid sort parameter provided: \"${ this.queryParams.sort }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet fields;\n\tif (this.queryParams.fields) {\n\t\ttry {\n\t\t\tfields = JSON.parse(this.queryParams.fields);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid fields parameter provided \"${ this.queryParams.fields }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-fields', `Invalid fields parameter provided: \"${ this.queryParams.fields }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\t// Verify the user's selected fields only contains ones which their role allows\n\tif (typeof fields === 'object') {\n\t\tlet nonSelectableFields = Object.keys(RocketChat.API.v1.defaultFieldsToExclude);\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\t\tnonSelectableFields = nonSelectableFields.concat(Object.keys(RocketChat.API.v1.limitedUserFieldsToExclude));\n\t\t}\n\n\t\tObject.keys(fields).forEach((k) => {\n\t\t\tif (nonSelectableFields.includes(k) || nonSelectableFields.includes(k.split(RocketChat.API.v1.fieldSeparator)[0])) {\n\t\t\t\tdelete fields[k];\n\t\t\t}\n\t\t});\n\t}\n\n\t// Limit the fields by default\n\tfields = Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude);\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\tfields = Object.assign(fields, RocketChat.API.v1.limitedUserFieldsToExclude);\n\t}\n\n\tlet query;\n\tif (this.queryParams.query) {\n\t\ttry {\n\t\t\tquery = JSON.parse(this.queryParams.query);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid query parameter provided \"${ this.queryParams.query }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-query', `Invalid query parameter provided: \"${ this.queryParams.query }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\t// Verify the user has permission to query the fields they are\n\tif (typeof query === 'object') {\n\t\tlet nonQuerableFields = Object.keys(RocketChat.API.v1.defaultFieldsToExclude);\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\t\tnonQuerableFields = nonQuerableFields.concat(Object.keys(RocketChat.API.v1.limitedUserFieldsToExclude));\n\t\t}\n\n\t\tObject.keys(query).forEach((k) => {\n\t\t\tif (nonQuerableFields.includes(k) || nonQuerableFields.includes(k.split(RocketChat.API.v1.fieldSeparator)[0])) {\n\t\t\t\tdelete query[k];\n\t\t\t}\n\t\t});\n\t}\n\n\treturn {\n\t\tsort,\n\t\tfields,\n\t\tquery\n\t};\n});\n","RocketChat.API.v1.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","//Returns the channel IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findChannelByIdOrName({ params, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet room;\n\tif (params.roomId) {\n\t\troom = RocketChat.models.Rooms.findOneById(params.roomId, { fields: RocketChat.API.v1.defaultFieldsToExclude });\n\t} else if (params.roomName) {\n\t\troom = RocketChat.models.Rooms.findOneByName(params.roomName, { fields: RocketChat.API.v1.defaultFieldsToExclude });\n\t}\n\n\tif (!room || room.t !== 'c') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any channel');\n\t}\n\n\tif (checkedArchived && room.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The channel, ${ room.name }, is archived`);\n\t}\n\n\treturn room;\n}\n\nRocketChat.API.v1.addRoute('channels.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult._id, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.cleanHistory', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (!this.bodyParams.latest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"latest\" is required.');\n\t\t}\n\n\t\tif (!this.bodyParams.oldest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"oldest\" is required.');\n\t\t}\n\n\t\tconst latest = new Date(this.bodyParams.latest);\n\t\tconst oldest = new Date(this.bodyParams.oldest);\n\n\t\tlet inclusive = false;\n\t\tif (typeof this.bodyParams.inclusive !== 'undefined') {\n\t\t\tinclusive = this.bodyParams.inclusive;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('cleanChannelHistory', { roomId: findResult._id, latest, oldest, inclusive });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }.`);\n\t\t}\n\n\t\tif (!sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-c')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createChannel', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: findResult\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.files', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('canAccessRoom', findResult._id, this.userId);\n\t\t});\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult._id });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet includeAllPublicChannels = true;\n\t\tif (typeof this.queryParams.includeAllPublicChannels !== 'undefined') {\n\t\t\tincludeAllPublicChannels = this.queryParams.includeAllPublicChannels === 'true';\n\t\t}\n\n\t\tlet ourQuery = {\n\t\t\tchannel: `#${ findResult.name }`\n\t\t};\n\n\t\tif (includeAllPublicChannels) {\n\t\t\tourQuery.channel = {\n\t\t\t\t$in: [ourQuery.channel, 'all_public_channels']\n\t\t\t};\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult._id, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.join', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('joinRoom', findResult._id, this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list', { authRequired: true }, {\n\tget: {\n\t\t//This is defined as such only to provide an example of how the routes can be defined :X\n\t\taction() {\n\t\t\tconst { offset, count } = this.getPaginationItems();\n\t\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\t\t//Special check for the permissions\n\t\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\t\tourQuery.usernames = {\n\t\t\t\t\t$in: [ this.user.username ]\n\t\t\t\t};\n\t\t\t} else if (!RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t\t}\n\n\t\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\t\tskip: offset,\n\t\t\t\tlimit: count,\n\t\t\t\tfields\n\t\t\t}).fetch();\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tchannels: rooms,\n\t\t\t\tcount: rooms.length,\n\t\t\t\toffset,\n\t\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t\t});\n\t\t}\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list.joined', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannels: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.members', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult.usernames), {\n\t\t\tsort: sort ? sort : -1,\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } },\n\t\t\t{ fields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 } }).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.messages', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult._id });\n\n\t\t//Special check for the permissions\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-joined-room') && !findResult.usernames.includes(this.user.username)) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t} else if (!RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Channel does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }\".`);\n\t\t}\n\n\t\tif (sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already open to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: { roomId: this.bodyParams.roomId} });\n\n\t\tif (findResult.name === this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('The channel name is the same as what it would be renamed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.description) {\n\t\t\treturn RocketChat.API.v1.failure('The channel description is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setJoinCode', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.joinCode || !this.bodyParams.joinCode.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"joinCode\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'joinCode', this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.purpose) {\n\t\t\treturn RocketChat.API.v1.failure('The channel purpose (description) is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The channel read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.topic === this.bodyParams.topic) {\n\t\t\treturn RocketChat.API.v1.failure('The channel topic is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The channel type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tif (!findResult.archived) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is not archived`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","/* global processWebhookMessage */\nRocketChat.API.v1.addRoute('chat.delete', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tmsgId: String,\n\t\t\troomId: String,\n\t\t\tasUser: Match.Maybe(Boolean)\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId, { fields: { u: 1, rid: 1 }});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.bodyParams.asUser ? msg.u._id : this.userId, () => {\n\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\t_id: msg._id,\n\t\t\tts: Date.now()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.getMessage', { authRequired: true }, {\n\tget() {\n\t\tif (!this.queryParams.msgId) {\n\t\t\treturn RocketChat.API.v1.failure('The \"msgId\" query parameter must be provided.');\n\t\t}\n\n\n\t\tlet msg;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tmsg = Meteor.call('getSingleMessage', this.queryParams.msgId);\n\t\t});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: msg\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.pinMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tlet pinnedMessage;\n\t\tMeteor.runAsUser(this.userId, () => pinnedMessage = Meteor.call('pinMessage', msg));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: pinnedMessage\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.postMessage', { authRequired: true }, {\n\tpost() {\n\t\tconst messageReturn = processWebhookMessage(this.bodyParams, this.user, undefined, true)[0];\n\n\t\tif (!messageReturn) {\n\t\t\treturn RocketChat.API.v1.failure('unknown-error');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tts: Date.now(),\n\t\t\tchannel: messageReturn.channel,\n\t\t\tmessage: messageReturn.message\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.starMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('starMessage', {\n\t\t\t_id: msg._id,\n\t\t\trid: msg.rid,\n\t\t\tstarred: true\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.unPinMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('unpinMessage', msg));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.unStarMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('starMessage', {\n\t\t\t_id: msg._id,\n\t\t\trid: msg.rid,\n\t\t\tstarred: false\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\troomId: String,\n\t\t\tmsgId: String,\n\t\t\ttext: String //Using text to be consistant with chat.postMessage\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId);\n\n\t\t//Ensure the message exists\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\t//Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: this.bodyParams.text, rid: msg.rid });\n\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: RocketChat.models.Messages.findOneById(msg._id)\n\t\t});\n\t}\n});\n","//Returns the private group subscription IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findPrivateGroupByIdOrName({ params, userId, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-room-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet roomSub;\n\tif (params.roomId) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(params.roomId, userId);\n\t} else if (params.roomName) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomNameAndUserId(params.roomName, userId);\n\t}\n\n\tif (!roomSub || roomSub.t !== 'p') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any group');\n\t}\n\n\tif (checkedArchived && roomSub.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The private group, ${ roomSub.name }, is archived`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute('groups.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult.rid, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst user = this.getUserFromParams();\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Archives a private group only if it wasn't\nRocketChat.API.v1.addRoute('groups.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Create Private Group\nRocketChat.API.v1.addRoute('groups.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createPrivateGroup', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.processQueryOptionsOnResult([findResult._room], { fields: RocketChat.API.v1.defaultFieldsToExclude })[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.files', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.rid });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet includeAllPrivateGroups = true;\n\t\tif (typeof this.queryParams.includeAllPrivateGroups !== 'undefined') {\n\t\t\tincludeAllPrivateGroups = this.queryParams.includeAllPrivateGroups === 'true';\n\t\t}\n\n\t\tconst channelsToSearch = [`#${ findResult.name }`];\n\t\tif (includeAllPrivateGroups) {\n\t\t\tchannelsToSearch.push('all_private_groups');\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { channel: { $in: channelsToSearch } });\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//List Private Groups a user has access to\nRocketChat.API.v1.addRoute('groups.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\n\nRocketChat.API.v1.addRoute('groups.listAll', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = RocketChat.models.Rooms.findByType('p').fetch();\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.members', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult._room.usernames), {\n\t\t\tsort: sort ? sort : -1,\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } },\n\t\t\t{ fields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 } }).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult._room.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.messages', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.rid });\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Group does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: { roomId: this.bodyParams.roomId}, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The private group read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The private group type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","function findDirectMessageRoom(params, user) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.username || !params.username.trim())) {\n\t\tthrow new Meteor.Error('error-room-param-not-provided', 'Body param \"roomId\" or \"username\" is required');\n\t}\n\n\tconst room = RocketChat.getRoomByNameOrIdWithOptionToJoin({\n\t\tcurrentUserId: user._id,\n\t\tnameOrId: params.username || params.roomId,\n\t\ttype: 'd'\n\t});\n\n\tif (!room || room.t !== 'd') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"username\" param provided does not match any dirct message');\n\t}\n\n\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id);\n\n\treturn {\n\t\troom,\n\t\tsubscription\n\t};\n}\n\nRocketChat.API.v1.addRoute(['dm.create', 'im.create'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\troom: findResult.room\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.close', 'im.close'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tif (!findResult.subscription.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.room._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.files', 'im.files'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.room._id });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.history', 'im.history'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', {\n\t\t\t\trid: findResult.room._id,\n\t\t\t\tlatest: latestDate,\n\t\t\t\toldest: oldestDate,\n\t\t\t\tinclusive,\n\t\t\t\tcount,\n\t\t\t\tunreads\n\t\t\t});\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.members', 'im.members'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult.room.usernames), {\n\t\t\tsort: sort ? sort : -1,\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } },\n\t\t\t{ fields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 } }).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult.room.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages', 'im.messages'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconsole.log(findResult);\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.room._id });\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages.others', 'im.messages.others'], { authRequired: true }, {\n\tget() {\n\t\tif (RocketChat.settings.get('API_Enable_Direct_Message_History_EndPoint') !== true) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/im.messages.others' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst roomId = this.queryParams.roomId;\n\t\tif (!roomId || !roomId.trim()) {\n\t\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" is required');\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\tif (!room || room.t !== 'd') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', `No direct message room found by the id of: ${ roomId }`);\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { rid: room._id });\n\n\t\tconst msgs = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: msgs,\n\t\t\toffset,\n\t\t\tcount: msgs.length,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list', 'im.list'], { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('d', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list.everyone', 'im.list.everyone'], { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { t: 'd' });\n\n\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.open', 'im.open'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tif (findResult.subscription.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.room._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.setTopic', 'im.setTopic'], { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.room._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('integrations.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\turls: Match.Maybe([String]),\n\t\t\tchannel: String,\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\talias: Match.Maybe(String),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\ttargetChannel: Match.Maybe(String)\n\t\t}));\n\n\t\tlet integration;\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addOutgoingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addIncomingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ integration });\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.history', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.queryParams.id || this.queryParams.id.trim() === '') {\n\t\t\treturn RocketChat.API.v1.failure('Invalid integration id.');\n\t\t}\n\n\t\tconst id = this.queryParams.id;\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { 'integration._id': id });\n\t\tconst history = RocketChat.models.IntegrationHistory.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _updatedAt: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\thistory,\n\t\t\toffset,\n\t\t\titems: history.length,\n\t\t\ttotal: RocketChat.models.IntegrationHistory.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\toffset,\n\t\t\titems: integrations.length,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.remove', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\ttarget_url: Match.Maybe(String),\n\t\t\tintegrationId: Match.Maybe(String)\n\t\t}));\n\n\t\tif (!this.bodyParams.target_url && !this.bodyParams.integrationId) {\n\t\t\treturn RocketChat.API.v1.failure('An integrationId or target_url needs to be provided.');\n\t\t}\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tlet integration;\n\n\t\t\t\tif (this.bodyParams.target_url) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ urls: this.bodyParams.target_url });\n\t\t\t\t} else if (this.bodyParams.integrationId) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\t\t\t\t}\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteOutgoingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteIncomingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\t}\n});\n","RocketChat.API.v1.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tinfo: {\n\t\t\t\t'version': RocketChat.Info.version\n\t\t\t}\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('me', { authRequired: true }, {\n\tget() {\n\t\treturn RocketChat.API.v1.success(_.pick(this.user, [\n\t\t\t'_id',\n\t\t\t'name',\n\t\t\t'emails',\n\t\t\t'status',\n\t\t\t'statusConnection',\n\t\t\t'username',\n\t\t\t'utcOffset',\n\t\t\t'active',\n\t\t\t'language'\n\t\t]));\n\t}\n});\n\nlet onlineCache = 0;\nlet onlineCacheDate = 0;\nconst cacheInvalid = 60000; // 1 minute\nRocketChat.API.v1.addRoute('shield.svg', { authRequired: false }, {\n\tget() {\n\t\tconst { type, channel, name, icon } = this.queryParams;\n\t\tif (!RocketChat.settings.get('API_Enable_Shields')) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/shields.svg' });\n\t\t}\n\t\tconst types = RocketChat.settings.get('API_Shield_Types');\n\t\tif (type && (types !== '*' && !types.split(',').map((t) => t.trim()).includes(type))) {\n\t\t\tthrow new Meteor.Error('error-shield-disabled', 'This shield type is disabled', { route: '/api/v1/shields.svg' });\n\t\t}\n\t\tconst hideIcon = icon === 'false';\n\t\tif (hideIcon && (!name || !name.trim())) {\n\t\t\treturn RocketChat.API.v1.failure('Name cannot be empty when icon is hidden');\n\t\t}\n\t\tlet text;\n\t\tswitch (type) {\n\t\t\tcase 'online':\n\t\t\t\tif (Date.now() - onlineCacheDate > cacheInvalid) {\n\t\t\t\t\tonlineCache = RocketChat.models.Users.findUsersNotOffline().count();\n\t\t\t\t\tonlineCacheDate = Date.now();\n\t\t\t\t}\n\t\t\t\ttext = `${ onlineCache } ${ TAPi18n.__('Online') }`;\n\t\t\t\tbreak;\n\t\t\tcase 'channel':\n\t\t\t\tif (!channel) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('Shield channel is required for type \"channel\"');\n\t\t\t\t}\n\t\t\t\ttext = `#${ channel }`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ttext = TAPi18n.__('Join_Chat').toUpperCase();\n\t\t}\n\t\tconst iconSize = hideIcon ? 7 : 24;\n\t\tconst leftSize = name ? name.length * 6 + 7 + iconSize : iconSize;\n\t\tconst rightSize = text.length * 6 + 20;\n\t\tconst width = leftSize + rightSize;\n\t\tconst height = 20;\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'image/svg+xml;charset=utf-8' },\n\t\t\tbody: `\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"${ width }\" height=\"${ height }\">\n\t\t\t\t  <linearGradient id=\"b\" x2=\"0\" y2=\"100%\">\n\t\t\t\t    <stop offset=\"0\" stop-color=\"#bbb\" stop-opacity=\".1\"/>\n\t\t\t\t    <stop offset=\"1\" stop-opacity=\".1\"/>\n\t\t\t\t  </linearGradient>\n\t\t\t\t  <mask id=\"a\">\n\t\t\t\t    <rect width=\"${ width }\" height=\"${ height }\" rx=\"3\" fill=\"#fff\"/>\n\t\t\t\t  </mask>\n\t\t\t\t  <g mask=\"url(#a)\">\n\t\t\t\t    <path fill=\"#555\" d=\"M0 0h${ leftSize }v${ height }H0z\"/>\n\t\t\t\t    <path fill=\"#4c1\" d=\"M${ leftSize } 0h${ rightSize }v${ height }H${ leftSize }z\"/>\n\t\t\t\t    <path fill=\"url(#b)\" d=\"M0 0h${ width }v${ height }H0z\"/>\n\t\t\t\t  </g>\n\t\t\t\t    ${ hideIcon ? '' : '<image x=\"5\" y=\"3\" width=\"14\" height=\"14\" xlink:href=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxwYXRoIGZpbGw9IiNDMTI3MkQiIGQ9Ik01MDIuNTg2LDI1NS4zMjJjMC0yNS4yMzYtNy41NS00OS40MzYtMjIuNDQ1LTcxLjkzMmMtMTMuMzczLTIwLjE5NS0zMi4xMDktMzguMDcyLTU1LjY4Ny01My4xMzJDMzc4LjkzNywxMDEuMTgyLDMxOS4xMDgsODUuMTY4LDI1Niw4NS4xNjhjLTIxLjA3OSwwLTQxLjg1NSwxLjc4MS02Mi4wMDksNS4zMWMtMTIuNTA0LTExLjcwMi0yNy4xMzktMjIuMjMyLTQyLjYyNy0zMC41NkM2OC42MTgsMTkuODE4LDAsNTguOTc1LDAsNTguOTc1czYzLjc5OCw1Mi40MDksNTMuNDI0LDk4LjM1Yy0yOC41NDIsMjguMzEzLTQ0LjAxLDYyLjQ1My00NC4wMSw5Ny45OThjMCwwLjExMywwLjAwNiwwLjIyNiwwLjAwNiwwLjM0YzAsMC4xMTMtMC4wMDYsMC4yMjYtMC4wMDYsMC4zMzljMCwzNS41NDUsMTUuNDY5LDY5LjY4NSw0NC4wMSw5Ny45OTlDNjMuNzk4LDM5OS45NCwwLDQ1Mi4zNSwwLDQ1Mi4zNXM2OC42MTgsMzkuMTU2LDE1MS4zNjMtMC45NDNjMTUuNDg4LTguMzI3LDMwLjEyNC0xOC44NTcsNDIuNjI3LTMwLjU2YzIwLjE1NCwzLjUyOCw0MC45MzEsNS4zMSw2Mi4wMDksNS4zMWM2My4xMDgsMCwxMjIuOTM3LTE2LjAxNCwxNjguNDU0LTQ1LjA5MWMyMy41NzctMTUuMDYsNDIuMzEzLTMyLjkzNyw1NS42ODctNTMuMTMyYzE0Ljg5Ni0yMi40OTYsMjIuNDQ1LTQ2LjY5NSwyMi40NDUtNzEuOTMyYzAtMC4xMTMtMC4wMDYtMC4yMjYtMC4wMDYtMC4zMzlDNTAyLjU4LDI1NS41NDgsNTAyLjU4NiwyNTUuNDM2LDUwMi41ODYsMjU1LjMyMnoiLz48cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjU2LDEyMC44NDdjMTE2Ljg1NCwwLDIxMS41ODYsNjAuNTA5LDIxMS41ODYsMTM1LjE1NGMwLDc0LjY0MS05NC43MzEsMTM1LjE1NS0yMTEuNTg2LDEzNS4xNTVjLTI2LjAxOSwwLTUwLjkzNy0zLjAwOS03My45NTktOC40OTVjLTIzLjM5NiwyOC4xNDctNzQuODY4LDY3LjI4LTEyNC44NjksNTQuNjI5YzE2LjI2NS0xNy40Nyw0MC4zNjEtNDYuOTg4LDM1LjIwMS05NS42MDNjLTI5Ljk2OC0yMy4zMjItNDcuOTU5LTUzLjE2My00Ny45NTktODUuNjg2QzQ0LjQxNCwxODEuMzU2LDEzOS4xNDUsMTIwLjg0NywyNTYsMTIwLjg0NyIvPjxnPjxnPjxjaXJjbGUgZmlsbD0iI0MxMjcyRCIgY3g9IjI1NiIgY3k9IjI2MC4zNTIiIHI9IjI4LjEwNSIvPjwvZz48Zz48Y2lyY2xlIGZpbGw9IiNDMTI3MkQiIGN4PSIzNTMuNzI4IiBjeT0iMjYwLjM1MiIgcj0iMjguMTA0Ii8+PC9nPjxnPjxjaXJjbGUgZmlsbD0iI0MxMjcyRCIgY3g9IjE1OC4yNzIiIGN5PSIyNjAuMzUyIiByPSIyOC4xMDUiLz48L2c+PC9nPjxnPjxwYXRoIGZpbGw9IiNDQ0NDQ0MiIGQ9Ik0yNTYsMzczLjM3M2MtMjYuMDE5LDAtNTAuOTM3LTIuNjA3LTczLjk1OS03LjM2MmMtMjAuNjU5LDIxLjU0LTYzLjIwOSw1MC40OTYtMTA3LjMwNyw0OS40M2MtNS44MDYsOC44MDUtMTIuMTIxLDE2LjAwNi0xNy41NjIsMjEuODVjNTAsMTIuNjUxLDEwMS40NzMtMjYuNDgxLDEyNC44NjktNTQuNjI5YzIzLjAyMyw1LjQ4Niw0Ny45NDEsOC40OTUsNzMuOTU5LDguNDk1YzExNS45MTcsMCwyMTAuMDQ4LTU5LjU1LDIxMS41NTEtMTMzLjM2NEM0NjYuMDQ4LDMyMS43NjUsMzcxLjkxNywzNzMuMzczLDI1NiwzNzMuMzczeiIvPjwvZz48L3N2Zz4=\"/>' }\n\t\t\t\t  <g fill=\"#fff\" font-family=\"DejaVu Sans,Verdana,Geneva,sans-serif\" font-size=\"11\">\n\t\t\t\t\t\t${ name ? `<text x=\"${ iconSize }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ name }</text>\n\t\t\t\t    <text x=\"${ iconSize }\" y=\"14\">${ name }</text>` : '' }\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ text }</text>\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"14\">${ text }</text>\n\t\t\t\t  </g>\n\t\t\t\t</svg>\n\t\t\t`.trim().replace(/\\>[\\s]+\\</gm, '><')\n\t\t};\n\t}\n});\n","// settings endpoints\nRocketChat.API.v1.addRoute('settings', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\tourQuery.public = true;\n\t\t}\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('settings/:_id', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(_.pick(RocketChat.models.Settings.findOneNotHiddenById(this.urlParams._id), '_id', 'value'));\n\t},\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'edit-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tcheck(this.bodyParams, {\n\t\t\tvalue: Match.Any\n\t\t});\n\n\t\tif (RocketChat.models.Settings.updateValueNotHiddenById(this.urlParams._id, this.bodyParams.value)) {\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\treturn RocketChat.API.v1.failure();\n\t}\n});\n","RocketChat.API.v1.addRoute('statistics', { authRequired: true }, {\n\tget() {\n\t\tlet refresh = false;\n\t\tif (typeof this.queryParams.refresh !== 'undefined' && this.queryParams.refresh === 'true') {\n\t\t\trefresh = true;\n\t\t}\n\n\t\tlet stats;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tstats = Meteor.call('getStatistics', refresh);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics: stats\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('statistics.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-statistics')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst statistics = RocketChat.models.Statistics.find(query, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics,\n\t\t\tcount: statistics.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Statistics.find(query).count()\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('users.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\temail: String,\n\t\t\tname: String,\n\t\t\tpassword: String,\n\t\t\tusername: String,\n\t\t\tactive: Match.Maybe(Boolean),\n\t\t\troles: Match.Maybe(Array),\n\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\tverified: Match.Maybe(Boolean),\n\t\t\tcustomFields: Match.Maybe(Object)\n\t\t});\n\n\t\t//New change made by pull request #5152\n\t\tif (typeof this.bodyParams.joinDefaultChannels === 'undefined') {\n\t\t\tthis.bodyParams.joinDefaultChannels = true;\n\t\t}\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.validateCustomFields(this.bodyParams.customFields);\n\t\t}\n\n\t\tconst newUserId = RocketChat.saveUser(this.userId, this.bodyParams);\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.saveCustomFieldsWithoutValidation(newUserId, this.bodyParams.customFields);\n\t\t}\n\n\n\t\tif (typeof this.bodyParams.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', newUserId, this.bodyParams.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(newUserId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.delete', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'delete-user')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('deleteUser', user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getAvatar', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tconst url = RocketChat.getURL(`/avatar/${ user.username }`, { cdn: false, full: true });\n\t\tthis.response.setHeader('Location', url);\n\n\t\treturn {\n\t\t\tstatusCode: 307,\n\t\t\tbody: url\n\t\t};\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getPresence', { authRequired: true }, {\n\tget() {\n\t\tif (this.isUserFromParams()) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpresence: user.status,\n\t\t\t\tconnectionStatus: user.statusConnection,\n\t\t\t\tlastLogin: user.lastLogin\n\t\t\t});\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpresence: user.status\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.info', { authRequired: true }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getFullUserData', { filter: user.username, limit: 1 });\n\t\t});\n\n\t\tif (!result || result.length !== 1) {\n\t\t\treturn RocketChat.API.v1.failure(`Failed to get the user data for the userId of \"${ user._id }\".`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tuser: result[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-d-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst users = RocketChat.models.Users.find(query, {\n\t\t\tsort: sort ? sort : { username: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tusers,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Users.find(query).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.register', { authRequired: false }, {\n\tpost() {\n\t\tif (this.userId) {\n\t\t\treturn RocketChat.API.v1.failure('Logged in users can not register again.');\n\t\t}\n\n\t\t//We set their username here, so require it\n\t\t//The `registerUser` checks for the other requirements\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tusername: String\n\t\t}));\n\n\t\t//Register the user\n\t\tconst userId = Meteor.call('registerUser', this.bodyParams);\n\n\t\t//Now set their username\n\t\tMeteor.runAsUser(userId, () => Meteor.call('setUsername', this.bodyParams.username));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.resetAvatar', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tif (user._id === this.userId) {\n\t\t\tMeteor.runAsUser(this.userId, () => Meteor.call('resetAvatar'));\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('resetAvatar'));\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.setAvatar', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tavatarUrl: Match.Maybe(String),\n\t\t\tuserId: Match.Maybe(String),\n\t\t\tusername: Match.Maybe(String)\n\t\t}));\n\n\t\tlet user;\n\t\tif (this.isUserFromParams()) {\n\t\t\tuser = Meteor.users.findOne(this.userId);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tuser = this.getUserFromParams();\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tif (this.bodyParams.avatarUrl) {\n\t\t\t\tRocketChat.setUserAvatar(user, this.bodyParams.avatarUrl, '', 'url');\n\t\t\t} else {\n\t\t\t\tconst Busboy = Npm.require('busboy');\n\t\t\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\n\t\t\t\tMeteor.wrapAsync((callback) => {\n\t\t\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\t\t\tif (fieldname !== 'image') {\n\t\t\t\t\t\t\treturn callback(new Meteor.Error('invalid-field'));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst imageData = [];\n\t\t\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\t\t\timageData.push(data);\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\t\tRocketChat.setUserAvatar(user, Buffer.concat(imageData), mimetype, 'rest');\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t}));\n\t\t\t\t\tthis.request.pipe(busboy);\n\t\t\t\t})();\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: String,\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tpassword: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tactive: Match.Maybe(Boolean),\n\t\t\t\troles: Match.Maybe(Array),\n\t\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\t\tverified: Match.Maybe(Boolean),\n\t\t\t\tcustomFields: Match.Maybe(Object)\n\t\t\t})\n\t\t});\n\n\t\tconst userData = _.extend({ _id: this.bodyParams.userId }, this.bodyParams.data);\n\n\t\tMeteor.runAsUser(this.userId, () => RocketChat.saveUser(this.userId, userData));\n\n\t\tif (this.bodyParams.data.customFields) {\n\t\t\tRocketChat.saveCustomFields(this.bodyParams.userId, this.bodyParams.data.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.data.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', this.bodyParams.userId, this.bodyParams.data.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.bodyParams.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.createToken', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\t\tlet data;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tdata = Meteor.call('createToken', user._id);\n\t\t});\n\t\treturn data ? RocketChat.API.v1.success({data}) : RocketChat.API.v1.unauthorized();\n\t}\n});\n","RocketChat.API.default.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","RocketChat.API.default.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tversion: RocketChat.Info.version\n\t\t});\n\t}\n});\n","RocketChat.API.default.addRoute('metrics', { authRequired: false }, {\n\tget() {\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'text/plain' },\n\t\t\tbody: RocketChat.promclient.register.metrics()\n\t\t};\n\t}\n});\n"]}