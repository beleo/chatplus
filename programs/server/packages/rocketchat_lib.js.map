{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:lib/lib/core.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getURL.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/callbacks.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/fileUploadRestrictions.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/getValidRoomName.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/placeholders.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/promises.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/roomTypesCommon.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/slashCommand.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/Message.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/messageBox.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/MessageTypes.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/templateVarHandler.js","meteor://ðŸ’»app/packages/rocketchat:lib/lib/startup/settingsOnLoadSiteUrl.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/debug.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/bugsnag.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/metrics.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/RateLimiter.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/configLogger.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/PushNotification.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/defaultBlockedDomainsList.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/interceptDirectReplyEmails.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/loginErrorMessageOverride.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/notifyUsersOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/processDirectEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/roomTypes.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/sendEmailOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/sendNotificationsOnMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/lib/validateEmailDomain.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/isDocker.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/addUserToDefaultChannels.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/addUserToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/archiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/checkUsernameAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/checkEmailAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/createRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/deleteMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/deleteUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/getFullUserData.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/getRoomByNameOrIdWithOptionToJoin.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/removeUserFromRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveCustomFields.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/saveCustomFieldsWithoutValidation.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/sendMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setUserAvatar.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setUsername.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setRealName.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/setEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/unarchiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/updateMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/validateCustomFields.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/functions/Notifications.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_Base.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Avatars.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Messages.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Reports.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Rooms.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Uploads.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/Users.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_BaseCache.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/models/_BaseDb.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/oauth.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/google.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/oauth/proxy.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/statsTracker.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/cache/CacheLoad.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadCdnPrefix.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadDirectReply.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settingsOnLoadSMTP.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/oAuthServicesUpdate.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/startup/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/publications/settings.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/refreshOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addUserToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/addUsersToRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/archiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/blockUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/checkRegistrationSecretURL.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/checkUsernameAvailability.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/cleanChannelHistory.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createChannel.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createToken.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/createPrivateGroup.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/deleteMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/deleteUserOwnAccount.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/filterBadWords.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/filterATAllTag.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getChannelHistory.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getFullUserData.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getRoomJoinCode.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getRoomRoles.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getServerInfo.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getSingleMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/getUserRoles.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/insertOrUpdateUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/joinDefaultChannels.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/joinRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/leaveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/removeOAuthService.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/restartServer.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/robotMethods.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/saveSetting.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendInvitationEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/sendSMTPTestEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setAdminStatus.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setRealName.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setUsername.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/setEmail.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/unarchiveRoom.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/unblockUser.js","meteor://ðŸ’»app/packages/rocketchat:lib/server/methods/updateMessage.js","meteor://ðŸ’»app/packages/rocketchat:lib/startup/defaultRoomTypes.js"],"names":["EventEmitter","module","watch","require","v","RocketChat","models","getURL","path","cdn","full","cdnPrefix","_","rtrim","trim","settings","get","pathPrefix","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","basePath","finalPath","ltrim","Meteor","isCordova","absoluteUrl","callbacks","regexCallbacks","ts","Date","_id","callback","onload","Object","keys","forEach","value","key","isRegExp","test","reduce","items","push","set","call","batchSet","save","setting","editor","actions","map","reduceRight","wrap","err","success","load","initialLoad","item","cbValue","cbKey","regex","concat","k","name","source","isServer","showTime","showTotalTime","priority","HIGH","MEDIUM","LOW","add","hook","id","isNumber","Random","Error","stack","find","cb","remove","hookName","reject","run","constant","length","totalTime","result","sortBy","time","now","callbackResult","currentTime","statsTracker","timing","split","match","console","log","String","runAsync","defer","fileUploadMediaWhiteList","mediaTypeWhiteList","fileUploadIsValidContentType","type","list","contains","wildCardGlob","wildcards","filter","indexOf","replace","getValidRoomName","displayName","rid","slugifiedName","room","Rooms","findOneByDisplayName","archived","channel_name","s","slugify","nameValidation","RegExp","error","findOneByName","tmpName","next","findOneByNameAndNotId","placeholders","str","data","strLeft","strRightBack","email","password","user","unsubscribe","promises","p","Promise","resolve","previousPromise","then","roomTypesCommon","roomTypes","roomTypesOrder","mainOrder","identifier","order","config","route","action","routeConfig","isClient","triggersExit","roomExit","FlowRouter","hasCustomLink","roomType","link","getRouteLink","subData","routeData","openRouteLink","queryParams","go","exportDefault","slashCommands","commands","command","options","params","description","clientOnly","methods","slashCommand","userId","method","cmd","msg","Message","parse","language","messageType","MessageTypes","getType","render","template","message","localStorage","getItem","TAPi18n","__","u","username","html","escapeHTML","messageBox","group","label","actionExists","ret","condition","getById","messageActions","types","registerType","t","isSystemMessage","system","startup","room_name","user_by","user_added","user_removed","user_left","user_muted","user_unmuted","role","logger","Logger","templateVarHandler","variable","object","templateRegex","exec","tmpVariable","hasOwnProperty","debug","tmplVar","tmplAttrName","attrVal","host","ROOT_URL","defaultOptions","rootUrl","hostname","process","env","MOBILE_ROOT_URL","MOBILE_DDP_URL","WebAppInternals","generateBoilerplate","publish","wrapMethods","originalHandler","methodsMap","args","Array","prototype","slice","arguments","apply","originalMeteorMethods","methodMap","each","handler","originalMeteorPublish","func","WebApp","rawConnectHandlers","use","req","res","setHeader","InstanceStatus","bugsnag","register","notify","Info","app","version","info","on","bindEnvironment","originalMeteorDebug","_debug","client","promclient","metrics","messagesSent","Counter","RateLimiter","limitFunction","fn","numRequests","timeInterval","matchers","TEST_MODE","rateLimiter","addRule","matcher","increment","rateLimitResult","check","allowed","Math","ceil","timeToReset","seconds","limitMethod","methodName","DDPRateLimiter","LoggerManager","showPackage","showFileAndLine","logLevel","parseInt","setTimeout","enable","PushNotification","getNotificationId","roomId","serverId","hash","i","charCodeAt","send","roomName","usersTo","payload","badge","title","icon","url","defaultUrl","from","sound","text","query","notId","gcm","style","summaryText","image","apn","Push","emailDomainDefaultBlackList","export","IMAPIntercepter","POP3Intercepter","POP3Helper","IMAP","POP3","simpleParser","imap","port","tls","connTimeout","keepalive","delete","state","openInbox","getEmails","end","openBox","start","connect","isActive","stop","Function","once","restart","search","newEmails","f","fetch","bodies","struct","markSeen","seqno","stream","headerBuffer","bodyBuffer","chunk","which","toString","body","headers","parseHeader","to","date","seq","addFlags","processDirectEmail","pop3","enabletls","totalMsgCount","currentMsgCount","login","status","msgcount","retr","quit","msgnumber","mail","initialProcess","dele","messageId","running","setInterval","max","clearInterval","_runLoginHandlers","Accounts","methodInvocation","reason","moment","editedAt","abs","diff","incMsgCountById","messageContainsHighlight","highlights","has","some","highlight","regexp","escapeRegExp","toAll","toHere","mentionIds","highlightsIds","Users","findUsersByUsernamesWithHighlights","usernames","fields","mentions","mention","preferences","unreadCountDM","Subscriptions","incUnreadForRoomIdExcludingUserId","incGroupMentionsAndUnreadForRoomIdExcludingUserId","incUserMentionsAndUnreadForRoomIdAndUserIds","compact","unique","unreadCount","incUnread","includes","incMsgCountAndSetLastMessageTimestampById","setAlertForRoomIdExcludingUserId","reply","EmailReplyParser","sendMessage","sentByEmail","groupable","tsDiff","join","findOneByEmailAddress","prevMessage","Messages","findOneById","mid","roomInfo","prevMessageLink","subscription","findOneByRoomIdAndUserId","blocked","blocker","muted","alias","inc","parse_reply","setPublish","setRoomFind","roomFind","getRoomFind","runPublish","scope","getMessageLink","sub","roomPath","divisorMessage","messageHTML","tokens","token","header","footer","usersToSendEmail","isMentionAll","maxMembersForNotification","undefined","findByRoomId","userIds","findByRoomIdAndUserIdsOrAllMessages","disableNotifications","emailNotifications","mentionedUser","userIdsToSendEmail","defaultLink","linkByUser","findByRoomIdAndUserIds","usersOfMention","getUsersToSendOfflineEmail","emailNotificationMode","emailSubject","emails","verified","address","subject","Email","replaceMentionedUsernamesWithFullNames","parseMessageText","lng","attachments","image_type","notifyDesktopUser","duration","UI_Use_Real_Name","Notifications","notifyUser","sender","notifyAudioUser","getBadgeCount","subscriptions","findUnreadByUserId","unread","sendPushNotifications","userIdsToPushNotify","push_room","push_username","push_message","enabled","userIdToNotify","callJoin","active","runAsUser","alwaysNotifyDesktopUsers","dontNotifyDesktopUsers","alwaysNotifyMobileUsers","dontNotifyMobileUsers","desktopNotificationDurations","alwaysNotifyAudioUsers","dontNotifyAudioUsers","audioNotificationValues","canBeNotified","mobile","desktop","audio","disableAllMessageNotifications","findNotificationPreferencesByRoom","userSettings","findUsersByIds","userAudioNotificationPreference","audioNotifications","userDesktopNotificationPreference","desktopNotifications","userMobileNotificationPreference","mobileNotifications","mobilePushNotifications","audioNotificationValue","desktopNotificationDuration","userIdsForAudio","userIdsToNotify","usersWithHighlights","userOfMentionId","userOfMention","findOne","statusConnection","Sandstorm","desktopMentionIds","union","difference","usersOfDesktopMentions","$in","usersOfMentionItem","pluck","mobileMentionIds","usersOfMobileMentions","$ne","audioMentionIds","usersOfAudioMentions","e","without","usersOfMentionId","allUserIdsToNotify","dns","Npm","emailDomainBlackList","emailDomainWhiteList","useDefaultBlackList","useDNSDomainCheck","domain","validateEmailDomain","emailValidation","emailDomain","substr","lastIndexOf","wrapAsync","resolveMx","fs","hasDockerEnv","statSync","hasDockerCGroup","readFileSync","isDocker","addUserToDefaultChannels","silenced","defaultRooms","findByDefaultAndTypes","ro","authz","hasPermission","addUsernameById","createWithRoomAndUser","open","alert","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addUserToRoom","inviter","createUserAddedWithRoomIdAndUser","archiveRoom","archiveById","archiveByRoomId","checkUsernameAvailability","usernameBlackList","every","restrictedUsername","users","$regex","checkEmailAvailability","createRoom","owner","members","readOnly","extraData","findOneByUsername","slugifiedRoomName","fname","sysMes","assign","createWithTypeNameUserAndUsernames","member","muteUsernameByRoomId","extra","ls","addUserRoles","deleteMessage","keepHistory","showDeletedStatus","deletedMsg","cloneAndSaveAsHistoryById","setHiddenById","file","Uploads","update","$set","_hidden","removeById","FileUpload","getStore","deleteById","setAsDeletedByIdAndUser","notifyRoom","deleteUser","removeByUserId","findByUserId","removeByRoomId","removeByTypeContainingUsername","removeUsernameFromAll","avatarOrigin","deleteByName","Integrations","disableByUserId","getFullUserData","limit","utcOffset","extend","phone","createdAt","lastLogin","services","requirePasswordChange","requirePasswordChangeReason","roles","customFields","sort","findByUsername","filterReg","findByUsernameNameOrEmailAddress","getRoomByNameOrIdWithOptionToJoin","_getRoomByNameOrIdWithOptionToJoin","currentUserId","nameOrId","tryDirectByUserIdOnly","joinChannel","errorOnEmpty","startsWith","substring","findOneByIdOrName","roomUser","$or","isObject","removeUserFromRoom","removeUsernameById","removedUser","createUserLeaveWithRoomIdAndUser","createCommandWithRoomIdAndUser","removeByRoomIdAndUserId","saveUser","userData","existingRoles","getRoles","field","escape","input","createUser","joinDefaultChannels","updateUser","sendWelcomeEmail","gravatarUrl","Gravatar","imageUrl","size","secure","setUserAvatar","setUsername","setRealName","setEmail","setPassword","saveCustomFields","formData","validateCustomFields","saveCustomFieldsWithoutValidation","customFieldsMeta","JSON","setCustomFields","fieldName","modifyRecordField","array","$addToSet","upsert","pick","Match","updated_room","parseUrls","urls","sandstormSessionId","insert","blockedSettings","SETTINGS_BLOCKED","settingId","hiddenSettings","SETTINGS_HIDDEN","_sorter","packageValue","valueSource","hidden","sorter","enableQuery","stringify","i18nDefaultQuery","toLowerCase","processEnvValue","meteorSettingsValue","i18nLabel","i18nDescription","updateOperations","$setOnInsert","force","section","$unset","$exists","existantSetting","Settings","db","addGroup","isFunction","updateById","updateValueAndEditorById","updateValueById","updateOptionsById","clearById","init","observe","added","record","changed","removed","afterInitialLoad","onAfterInitialLoad","dataURI","contentType","service","encoding","setAvatarOrigin","HTTP","npmRequestOptions","response","statusCode","content","fileData","RocketChatFile","dataURIParse","buffer","Buffer","fileStore","notifyLogged","_setUsername","previousUsername","sendEnrollmentEmail","avatarSuggestions","getAvatarSuggestionForUser","gravatar","avatarData","blob","updateAllUsernamesByUserId","updateUsernameOfEditByUserId","findByMention","updatedMsg","updateUsernameAndMessageOfMentionByIdAndOldUsername","replaceUsername","replaceMutedUsername","replaceUsernameOfUserByUserId","setUserUsernameByUserId","setNameForDirectRoomsWithOldName","model","updateFileNameById","_setRealName","setName","_setEmail","unarchiveRoom","unarchiveById","unarchiveByRoomId","updateMessage","editedBy","tempid","fieldValue","required","maxLength","minLength","streamAll","Streamer","streamLogged","streamRoom","streamRoomUsers","streamUser","allowWrite","eventName","findByRoomIdAndNotUserId","allowRead","warn","notifyAll","unshift","emit","notifyAllInThisInstance","emitWithoutBroadcast","notifyLoggedInThisInstance","notifyRoomInThisInstance","notifyUserInThisInstance","ModelsBaseDb","ModelsBaseCache","_CacheControl","EnvironmentVariable","ModelsBase","nameOrModel","useCache","_db","collectionName","_useCache","cache","bind","getDynamicView","processQueryOptionsOnResult","constructor","arrayToCursor","count","setUpdatedAt","origin","findOneByIds","ids","insertOrUpsert","allow","deny","ensureIndex","dropIndex","tryEnsureIndex","tryDropIndex","trashFind","trashFindDeletedAfter","_Base","Avatars","before","doc","instanceId","insertAvatarFileInit","store","complete","uploading","progress","extension","uploadedAt","updateFileComplete","fileId","direct","updateFileCompleteByNameAndUserId","deleteFile","sparse","expireAfterSeconds","findVisibleByMentionAndRoomId","findVisibleByRoomId","findVisibleByRoomIdNotContainingTypes","$nin","findInvisibleByRoomId","findVisibleByRoomIdAfterTimestamp","timestamp","$gt","findVisibleByRoomIdBeforeTimestamp","$lt","findVisibleByRoomIdBeforeTimestampInclusive","$lte","findVisibleByRoomIdBetweenTimestamps","afterTimestamp","beforeTimestamp","findVisibleByRoomIdBetweenTimestampsInclusive","$gte","findVisibleByRoomIdBeforeTimestampNotContainingTypes","findVisibleByRoomIdBetweenTimestampsNotContainingTypes","findVisibleCreatedOrEditedAfterTimestamp","findStarredByUserAtRoom","findPinnedByRoom","pinned","findSnippetedByRoom","snippeted","getLastTimestamp","findByRoomIdAndMessageIds","messageIds","findOneBySlackBotIdAndSlackTs","slackBotId","slackTs","findOneBySlackTs","me","parent","reactions","setPinnedByIdAndUserId","pinnedBy","pinnedAt","setSnippetedByIdAndUserId","snippetName","snippetedBy","snippetedAt","setUrlsById","multi","oldUsername","newUsername","newMessage","updateUserStarById","starred","$pull","upgradeEtsToEditAt","ets","$rename","setMessageAttachments","setSlackBotIdAndSlackTs","createWithTypeRoomIdMessageAndUser","createUserRemovedWithRoomIdAndUser","createUserMutedWithRoomIdAndUser","createUserUnmutedWithRoomIdAndUser","createNewModeratorWithRoomIdAndUser","createModeratorRemovedWithRoomIdAndUser","createNewOwnerWithRoomIdAndUser","createOwnerRemovedWithRoomIdAndUser","createNewLeaderWithRoomIdAndUser","createLeaderRemovedWithRoomIdAndUser","createSubscriptionRoleAddedWithRoomIdAndUser","createSubscriptionRoleRemovedWithRoomIdAndUser","getMessageByFileId","fileID","Reports","createWithMessageDescriptionAndUserId","ModelRooms","ignoreUpdatedFields","_idOrName","findOneByImportId","importIds","findOneByNameAndType","findOneByIdContainingUsername","findOneByNameAndTypeNotContainingUsername","findById","findByIds","roomIds","findByType","findByTypes","findBySubscriptionUserId","_room","findBySubscriptionUserIdUpdatedAfter","_updatedAt","findByNameContaining","nameRegex","findByNameContainingTypesWithUsername","obj","findContainingTypesWithUsername","findByNameContainingAndTypes","findByNameAndTypeNotDefault","findByNameAndTypeNotContainingUsername","findByNameStartingAndTypes","defaultValue","findByTypeContainingUsername","findByTypeContainingUsernames","$all","findByTypesAndNotUserIdContainingUsername","uid","findByContainingUsername","findByTypeAndName","findByIndex","findByTypeAndNameContainingUsername","findByTypeAndArchivationState","archivationstate","addImportIds","$each","addUsernamesById","addUsernameByName","removeUsernamesById","removeUsernameByName","setNameById","$inc","msgs","lastMessageTimestamp","lm","setJoinCodeById","joinCode","joinCodeRequired","setUserById","setTypeById","setTopicById","topic","setAnnouncementById","announcement","unmuteUsernameByRoomId","saveDefaultById","setTopicAndTagsById","tags","setData","unsetData","isEmpty","tag","createWithIdTypeAndName","ModelSettings","findOneNotHiddenById","findByRole","findPublic","findNotHiddenPublic","findNotHiddenPublicUpdatedAfter","updatedAt","findNotHiddenPrivate","findNotHidden","findNotHiddenUpdatedAfter","updateValueNotHiddenById","createWithIdAndValue","_createdAt","ModelSubscriptions","findOneByRoomNameAndUserId","findByUserIdUpdatedAfter","findByRoomIdAndRoles","findByTypeAndUserId","findByTypeNameAndUserId","getLastSeen","hideByRoomIdAndUserId","openByRoomIdAndUserId","setAsReadByRoomIdAndUserId","setAsUnreadByRoomIdAndUserId","firstMessageUnreadTimestamp","setFavoriteByRoomIdAndUserId","favorite","updateNameAndAlertByRoomId","updateNameByRoomId","oldName","incGroup","incUser","setBlockedByRoomId","query2","update2","unsetBlockedByRoomId","updateTypeByRoomId","addRoleById","removeRoleById","setArchivedByUsername","findNotHiddenFilesOfRoom","fileQuery","fileOptions","insertFileInit","ModelUsers","emailAddress","findOneAdmin","admin","findOneByIdAndLoginToken","_hashLoginToken","findUsersNotOffline","findActiveByUsernameOrNameRegexWithExceptions","searchTerm","exceptions","isArray","termRegex","$and","findByActiveUsersExcept","orStmt","acc","el","findUsersByNameOrUsername","nameOrUsername","usernameNameOrEmailAddress","findLDAPUsers","ldap","findCrowdUsers","crowd","getLastLogin","findUsersByUsernames","updateLastLoginById","setServiceId","serviceName","serviceId","serviceIdKey","setEmailVerified","$elemMatch","values","unsetAvatarOrigin","setUserActive","setAllUsersActive","unsetLoginTokens","unsetRequirePasswordChange","resetPasswordAndSetRequirePasswordChange","setLanguage","setProfile","profile","setPreferences","setUtcOffset","saveUserById","phoneNumber","create","usersIds","loki","objectPath","lokiEq","LokiOps","$eq","lokiNe","a","b","lokiIn","subA","subB","findWhere","ignore","traceMethodCalls","target","_stats","property","calls","avg","origMethod","loaded","startTime","round","_getStatsAvg","stats","Adapter","loadDatabase","saveDatabase","deleteDatabase","adapter","indexes","joins","collection","addCollection","hasOne","hasMany","processRemoteJoinInserted","remote","processRemoteJoinRemoved","localRecord","processLocalJoinInserted","local","localRecords","_findByIndex","where","mutableRecord","transform","records","splice","addToAllIndexes","indexName","addToIndex","index","removeFromAllIndexes","removeFromIndex","startSync","updateDiffById","r","direction","valueA","valueB","skip","fieldsToRemove","fieldsToGet","pickFields","picked","omit","processQuery","parentField","and","subValue","observeChanges","_publishCursor","cursor","addDynamicView","updatedFields","updateRecord","topLevelFields","del","$min","curValue","$max","$mul","$pullAll","$pop","shift","pop","valueItem","removeWhere","baseName","trash","Mongo","Collection","_ensureIndex","_deletedAt","isOplogAvailable","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","isOplogEnabled","baseModel","_name","wrapModel","event","processOplogRecord","_defineTooFarBehind","Number","MAX_SAFE_INTEGER","originals","self","defineSyncStrategy","modifier","cacheAllowedModifiers","notAllowedModifiers","placeholderFields","updateHasPositionalOperator","op","o","oplog","listenerCount","strategy","findOptions","insertedId","_returnObject","__collection__","_dropIndex","deletedAt","AccessTokenServices","registerAccessTokenService","handleAccessTokenRequest","registerLoginHandler","accessToken","ObjectIncluding","ServiceConfiguration","configurations","ConfigError","oauth","serviceNames","LoginCancelledError","numericError","oauthResult","updateOrCreateUserFromExternalService","serviceData","getIdentity","access_token","getScopes","idToken","expiresIn","Integer","Maybe","identity","expiresAt","scopes","Google","whitelistedFields","refreshToken","OAuth","_redirectUri","proxy","StatsD","dogstatsd","track","hrtime","decrement","histogram","gauge","arr","applyFind","$size","testWebAppInternals","isString","setBundledJsCssPrefix","startEmailIntercepter","debounce","buildMailURL","MAIL_URL","encodeURIComponent","oauth_updated","_OAuthServicesUpdate","clientId","secret","custom","serverURL","tokenPath","identityPath","authorizePath","buttonLabelText","buttonLabelColor","loginStyle","buttonColor","tokenSentVia","usernameField","mergeUsers","CustomOAuth","appId","consumerKey","OAuthServicesUpdate","OAuthServicesRemove","DEPLOYMENT_ID","readonly","actionText","code","multiline","placeholder","unblock","addOAuthService","capitalize","persistent","refreshOAuthService","addUsersToRoom","userInRoom","canAddUser","newUser","blockUser","subscription2","checkRegistrationSecretURL","cleanChannelHistory","latest","oldest","inclusive","Boolean","createChannel","Optional","createToken","_generateStampedLoginToken","_insertLoginToken","authToken","createPrivateGroup","originalMessage","forceDelete","deleteAllowed","deleteOwn","blockDeleteInMinutes","msgTs","currentTsDiff","deleteUserOwnAccount","bcrypt","_checkPassword","digest","algorithm","Filter","badWordsList","clean","getChannelHistory","unreads","fromUserId","isUndefined","isDate","messages","unreadNotLoaded","firstUnread","firstMsg","unreadMessages","getRoomJoinCode","getRoomRoles","Roles","getServerInfo","getSingleMessage","msgId","getUserRoles","roleIds","findUsersInRoles","intersection","insertOrUpdateUser","joinRoom","leaveRoom","hasRole","numOwners","getUsersInRole","removeOAuthService","restart_server","abort","exit","m","saveSetting","OneOf","sendInvitationEmail","rfcMailPattern","validEmails","message_ts","server_ts","getTime","sandstorm","connection","sendSMTPTestEmail","setAdminStatus","param","joinDefaultChannelsSilenced","unblockUser","editAllowed","editOwn","blockEditInMinutes","roomsListExhibitionMode","mergeChannels","openRoom","findRoom","ChatRoom","roomData","hasAtLeastOnePermission","showJoinLink","hasAllPermission","ChatSubscription","secondaryRoomName","getUserStatus","Session"],"mappings":"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","file":"/packages/rocketchat_lib.js","sourcesContent":["import EventEmitter from 'wolfy87-eventemitter';\nRocketChat = new EventEmitter();\n/*\n* Kick off the global namespace for RocketChat.\n* @namespace RocketChat\n*/\nRocketChat.models = {};\n","RocketChat.getURL = (path, { cdn = true, full = false } = {}) => {\n\tconst cdnPrefix = _.rtrim(_.trim(RocketChat.settings.get('CDN_PREFIX') || ''), '/');\n\tconst pathPrefix = _.rtrim(_.trim(__meteor_runtime_config__.ROOT_URL_PATH_PREFIX || ''), '/');\n\n\tlet basePath;\n\n\tconst finalPath = _.ltrim(_.trim(path), '/');\n\n\tif (cdn && cdnPrefix !== '') {\n\t\tbasePath = cdnPrefix + pathPrefix;\n\t} else if (full || Meteor.isCordova) {\n\t\treturn Meteor.absoluteUrl(finalPath);\n\t} else {\n\t\tbasePath = pathPrefix;\n\t}\n\n\treturn `${ basePath }/${ finalPath }`;\n};\n","\n/*\n* RocketChat.settings holds all packages settings\n* @namespace RocketChat.settings\n*/\nRocketChat.settings = {\n\tcallbacks: {},\n\tregexCallbacks: {},\n\tts: new Date,\n\tget(_id, callback) {\n\t\tif (callback != null) {\n\t\t\tRocketChat.settings.onload(_id, callback);\n\t\t\tif (!Meteor.settings) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_id === '*') {\n\t\t\t\treturn Object.keys(Meteor.settings).forEach(key => {\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tcallback(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (_.isRegExp(_id) && Meteor.settings) {\n\t\t\t\treturn Object.keys(Meteor.settings).forEach(key => {\n\t\t\t\t\tif (!_id.test(key)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tcallback(key, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn Meteor.settings[_id] != null && callback(_id, Meteor.settings[_id]);\n\t\t} else {\n\t\t\tif (!Meteor.settings) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (_.isRegExp(_id)) {\n\t\t\t\treturn Object.keys(Meteor.settings).reduce((items, key) => {\n\t\t\t\t\tconst value = Meteor.settings[key];\n\t\t\t\t\tif (_id.test(key)) {\n\t\t\t\t\t\titems.push({\n\t\t\t\t\t\t\tkey,\n\t\t\t\t\t\t\tvalue\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn items;\n\t\t\t\t}, []);\n\t\t\t}\n\t\t\treturn Meteor.settings && Meteor.settings[_id];\n\t\t}\n\t},\n\tset(_id, value, callback) {\n\t\treturn Meteor.call('saveSetting', _id, value, callback);\n\t},\n\tbatchSet(settings, callback) {\n\t\t// async -> sync\n\t\t// http://daemon.co.za/2012/04/simple-async-with-only-underscore/\n\t\tconst save = function(setting) {\n\t\t\treturn function(callback) {\n\t\t\t\treturn Meteor.call('saveSetting', setting._id, setting.value, setting.editor, callback);\n\t\t\t};\n\t\t};\n\t\tconst actions = _.map(settings, (setting) => save(setting));\n\t\treturn _(actions).reduceRight(_.wrap, (err, success) => callback(err, success))();\n\t},\n\tload(key, value, initialLoad) {\n\t\t['*', key].forEach(item => {\n\t\t\tif (RocketChat.settings.callbacks[item]) {\n\t\t\t\tRocketChat.settings.callbacks[item].forEach(callback => callback(key, value, initialLoad));\n\t\t\t}\n\t\t});\n\t\tObject.keys(RocketChat.settings.regexCallbacks).forEach(cbKey => {\n\t\t\tconst cbValue = RocketChat.settings.regexCallbacks[cbKey];\n\t\t\tif (!cbValue.regex.test(key)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcbValue.callbacks.forEach(callback => callback(key, value, initialLoad));\n\t\t});\n\t},\n\tonload(key, callback) {\n\t\t// if key is '*'\n\t\t// \tfor key, value in Meteor.settings\n\t\t// \t\tcallback key, value, false\n\t\t// else if Meteor.settings?[_id]?\n\t\t// \tcallback key, Meteor.settings[_id], false\n\t\tconst keys = [].concat(key);\n\t\tkeys.forEach(k => {\n\t\t\tif (_.isRegExp(k)) {\n\t\t\t\tRocketChat.settings.regexCallbacks[name = k.source] = RocketChat.settings.regexCallbacks[name = k.source] || {\n\t\t\t\t\tregex: k,\n\t\t\t\t\tcallbacks: []\n\t\t\t\t};\n\t\t\t\tRocketChat.settings.regexCallbacks[k.source].callbacks.push(callback);\n\t\t\t} else {\n\t\t\t\tRocketChat.settings.callbacks[k] = RocketChat.settings.callbacks[k] || [];\n\t\t\t\tRocketChat.settings.callbacks[k].push(callback);\n\t\t\t}\n\t\t});\n\t}\n};\n","/*\n* Callback hooks provide an easy way to add extra steps to common operations.\n* @namespace RocketChat.callbacks\n*/\n\nRocketChat.callbacks = {};\n\nif (Meteor.isServer) {\n\tRocketChat.callbacks.showTime = true;\n\tRocketChat.callbacks.showTotalTime = true;\n} else {\n\tRocketChat.callbacks.showTime = false;\n\tRocketChat.callbacks.showTotalTime = false;\n}\n\n\n/*\n* Callback priorities\n*/\n\nRocketChat.callbacks.priority = {\n\tHIGH: -1000,\n\tMEDIUM: 0,\n\tLOW: 1000\n};\n\n\n/*\n* Add a callback function to a hook\n* @param {String} hook - The name of the hook\n* @param {Function} callback - The callback function\n*/\n\nRocketChat.callbacks.add = function(hook, callback, priority, id) {\n\tif (priority == null) {\n\t\tpriority = RocketChat.callbacks.priority.MEDIUM;\n\t}\n\tif (!_.isNumber(priority)) {\n\t\tpriority = RocketChat.callbacks.priority.MEDIUM;\n\t}\n\tcallback.priority = priority;\n\tcallback.id = id || Random.id();\n\tRocketChat.callbacks[hook] = RocketChat.callbacks[hook] || [];\n\tif (RocketChat.callbacks.showTime === true) {\n\t\tconst err = new Error;\n\t\tcallback.stack = err.stack;\n\t}\n\tif (RocketChat.callbacks[hook].find((cb) => cb.id === callback.id)) {\n\t\treturn;\n\t}\n\tRocketChat.callbacks[hook].push(callback);\n};\n\n\n/*\n* Remove a callback from a hook\n* @param {string} hook - The name of the hook\n* @param {string} id - The callback's id\n*/\n\nRocketChat.callbacks.remove = function(hookName, id) {\n\tRocketChat.callbacks[hookName] = _.reject(RocketChat.callbacks[hookName], (callback) => callback.id === id);\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n* @returns {Object} Returns the item after it's been through all the callbacks for this hook\n*/\n\nRocketChat.callbacks.run = function(hook, item, constant) {\n\tconst callbacks = RocketChat.callbacks[hook];\n\tif (callbacks && callbacks.length) {\n\t\tlet totalTime = 0;\n\t\tconst result = _.sortBy(callbacks, function(callback) {\n\t\t\treturn callback.priority || RocketChat.callbacks.priority.MEDIUM;\n\t\t}).reduce(function(result, callback) {\n\t\t\tlet time = 0;\n\t\t\tif (RocketChat.callbacks.showTime === true || RocketChat.callbacks.showTotalTime === true) {\n\t\t\t\ttime = Date.now();\n\t\t\t}\n\t\t\tconst callbackResult = callback(result, constant);\n\t\t\tif (RocketChat.callbacks.showTime === true || RocketChat.callbacks.showTotalTime === true) {\n\t\t\t\tconst currentTime = Date.now() - time;\n\t\t\t\ttotalTime += currentTime;\n\t\t\t\tif (RocketChat.callbacks.showTime === true) {\n\t\t\t\t\tif (Meteor.isServer) {\n\t\t\t\t\t\tRocketChat.statsTracker.timing('callbacks.time', currentTime, [`hook:${ hook }`, `callback:${ callback.id }`]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet stack = callback.stack && typeof callback.stack.split === 'function' && callback.stack.split('\\n');\n\t\t\t\t\t\tstack = stack && stack[2] && (stack[2].match(/\\(.+\\)/)||[])[0];\n\t\t\t\t\t\tconsole.log(String(currentTime), hook, callback.id, stack);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn (typeof callbackResult === 'undefined') ? result : callbackResult;\n\t\t}, item);\n\t\tif (RocketChat.callbacks.showTotalTime === true) {\n\t\t\tif (Meteor.isServer) {\n\t\t\t\tRocketChat.statsTracker.timing('callbacks.totalTime', totalTime, [`hook:${ hook }`]);\n\t\t\t} else {\n\t\t\t\tconsole.log(`${ hook }:`, totalTime);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t} else {\n\t\treturn item;\n\t}\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n*/\n\nRocketChat.callbacks.runAsync = function(hook, item, constant) {\n\tconst callbacks = RocketChat.callbacks[hook];\n\tif (Meteor.isServer && callbacks && callbacks.length) {\n\t\tMeteor.defer(function() {\n\t\t\t_.sortBy(callbacks, (callback) => callback.priority || RocketChat.callbacks.priority.MEDIUM).forEach((callback) => callback(item, constant));\n\t\t});\n\t} else {\n\t\treturn item;\n\t}\n};\n","RocketChat.fileUploadMediaWhiteList = function() {\n\tconst mediaTypeWhiteList = RocketChat.settings.get('FileUpload_MediaTypeWhiteList');\n\n\tif (!mediaTypeWhiteList || mediaTypeWhiteList === '*') {\n\t\treturn;\n\t}\n\treturn _.map(mediaTypeWhiteList.split(','), function(item) {\n\t\treturn item.trim();\n\t});\n};\n\nRocketChat.fileUploadIsValidContentType = function(type) {\n\tconst list = RocketChat.fileUploadMediaWhiteList();\n\tif (!list) {\n\t\treturn true;\n\t}\n\n\tif (!type) {\n\t\treturn false;\n\t}\n\n\tif (_.contains(list, type)) {\n\t\treturn true;\n\t} else {\n\t\tconst wildCardGlob = '/*';\n\t\tconst wildcards = _.filter(list, function(item) {\n\t\t\treturn item.indexOf(wildCardGlob) > 0;\n\t\t});\n\t\tif (_.contains(wildcards, type.replace(/(\\/.*)$/, wildCardGlob))) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n};\n","RocketChat.getValidRoomName = function getValidRoomName(displayName, rid = '') {\n\tlet slugifiedName = displayName;\n\n\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\tconst room = RocketChat.models.Rooms.findOneByDisplayName(displayName);\n\t\tif (room && room._id !== rid) {\n\t\t\tif (room.archived) {\n\t\t\t\tthrow new Meteor.Error('error-archived-duplicate-name', `There's an archived channel with name ${ displayName }`, { function: 'RocketChat.getValidRoomName', channel_name: displayName });\n\t\t\t} else {\n\t\t\t\tthrow new Meteor.Error('error-duplicate-channel-name', `A channel with name '${ displayName }' exists`, { function: 'RocketChat.getValidRoomName', channel_name: displayName });\n\t\t\t}\n\t\t}\n\t\tslugifiedName = s.slugify(displayName);\n\t}\n\n\tlet nameValidation;\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (error) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\tif (!nameValidation.test(slugifiedName)) {\n\t\tthrow new Meteor.Error('error-invalid-room-name', `${ slugifiedName } is not a valid room name.`, {\n\t\t\t'function': 'RocketChat.getValidRoomName',\n\t\t\tchannel_name: slugifiedName\n\t\t});\n\t}\n\n\tconst room = RocketChat.models.Rooms.findOneByName(slugifiedName);\n\tif (room && room._id !== rid) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\tlet tmpName = slugifiedName;\n\t\t\tlet next = 0;\n\t\t\twhile (RocketChat.models.Rooms.findOneByNameAndNotId(tmpName, rid)) {\n\t\t\t\ttmpName = `${ slugifiedName }-${ ++next }`;\n\t\t\t}\n\t\t\tslugifiedName = tmpName;\n\t\t} else if (room.archived) {\n\t\t\tthrow new Meteor.Error('error-archived-duplicate-name', `There's an archived channel with name ${ slugifiedName }`, { function: 'RocketChat.getValidRoomName', channel_name: slugifiedName });\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-duplicate-channel-name', `A channel with name '${ slugifiedName }' exists`, { function: 'RocketChat.getValidRoomName', channel_name: slugifiedName });\n\t\t}\n\t}\n\n\treturn slugifiedName;\n};\n","RocketChat.placeholders = {};\n\nRocketChat.placeholders.replace = function(str, data) {\n\tif (!str) {\n\t\treturn '';\n\t}\n\n\tstr = str.replace(/\\[Site_Name\\]/g, RocketChat.settings.get('Site_Name') || '');\n\tstr = str.replace(/\\[Site_URL\\]/g, RocketChat.settings.get('Site_Url') || '');\n\n\tif (data) {\n\t\tstr = str.replace(/\\[name\\]/g, data.name || '');\n\t\tstr = str.replace(/\\[fname\\]/g, _.strLeft(data.name, ' ') || '');\n\t\tstr = str.replace(/\\[lname\\]/g, _.strRightBack(data.name, ' ') || '');\n\t\tstr = str.replace(/\\[email\\]/g, data.email || '');\n\t\tstr = str.replace(/\\[password\\]/g, data.password || '');\n\t\tstr = str.replace(/\\[User\\]/g, data.user || '');\n\t\tstr = str.replace(/\\[Room\\]/g, data.room || '');\n\n\t\tif (data.unsubscribe) {\n\t\t\tstr = str.replace(/\\[unsubscribe\\]/g, data.unsubscribe);\n\t\t}\n\t}\n\n\tstr = str.replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + '<br>' + '$2');\n\n\n\treturn str;\n};\n","\n/*\n* Callback hooks provide an easy way to add extra steps to common operations.\n* @namespace RocketChat.promises\n*/\n\nRocketChat.promises = {};\n\n\n/*\n* Callback priorities\n*/\n\nRocketChat.promises.priority = {\n\tHIGH: -1000,\n\tMEDIUM: 0,\n\tLOW: 1000\n};\n\n\n/*\n* Add a callback function to a hook\n* @param {String} hook - The name of the hook\n* @param {Function} callback - The callback function\n*/\n\nRocketChat.promises.add = function(hook, callback, p = RocketChat.promises.priority.MEDIUM, id) {\n\tconst priority = !_.isNumber(p) ? RocketChat.promises.priority.MEDIUM : p;\n\tcallback.priority = priority;\n\tcallback.id = id || Random.id();\n\tRocketChat.promises[hook] = RocketChat.promises[hook] || [];\n\tif (RocketChat.promises[hook].find(cb => cb.id === callback.id)) {\n\t\treturn;\n\t}\n\tRocketChat.promises[hook].push(callback);\n};\n\n\n/*\n* Remove a callback from a hook\n* @param {string} hook - The name of the hook\n* @param {string} id - The callback's id\n*/\n\nRocketChat.promises.remove = function(hookName, id) {\n\tRocketChat.promises[hookName] = _.reject(RocketChat.promises[hookName], (callback) => callback.id === id);\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n* @returns {Object} Returns the item after it's been through all the callbacks for this hook\n*/\n\nRocketChat.promises.run = function(hook, item, constant) {\n\tlet callbacks = RocketChat.promises[hook];\n\tif (callbacks == null || callbacks.length === 0) {\n\t\treturn Promise.resolve(item);\n\t}\n\tcallbacks = _.sortBy(callbacks, (callback) => callback.priority || RocketChat.promises.priority.MEDIUM);\n\treturn callbacks.reduce(function(previousPromise, callback) {\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\treturn previousPromise.then((result) => callback(result, constant).then(resolve, reject));\n\t\t});\n\t}, Promise.resolve(item));\n};\n\n\n/*\n* Successively run all of a hook's callbacks on an item, in async mode (only works on server)\n* @param {String} hook - The name of the hook\n* @param {Object} item - The post, comment, modifier, etc. on which to run the callbacks\n* @param {Object} [constant] - An optional constant that will be passed along to each callback\n*/\n\nRocketChat.promises.runAsync = function(hook, item, constant) {\n\tconst callbacks = RocketChat.promises[hook];\n\tif (!Meteor.isServer || callbacks == null || callbacks.length === 0) {\n\t\treturn item;\n\t}\n\tMeteor.defer(() => {\n\t\t_.sortBy(callbacks, (callback) => callback.priority || RocketChat.promises.priority.MEDIUM).forEach(function(callback) {\n\t\t\tcallback(item, constant);\n\t\t});\n\t});\n};\n","/* globals roomExit*/\nthis.roomTypesCommon = class {\n\tconstructor() {\n\t\tthis.roomTypes = {};\n\t\tthis.roomTypesOrder = [];\n\t\tthis.mainOrder = 1;\n\t}\n\n\t/* Adds a room type to app\n\t@param identifier An identifier to the room type. If a real room, MUST BE the same of `db.rocketchat_room.t` field, if not, can be null\n\t@param order Order number of the type\n\t@param config\n\ticon: icon class\n\tlabel: i18n label\n\troute:\n\tname: route name\n\taction: route action function\n\tidentifier: room type identifier\n\t*/\n\n\tadd(identifier = Random.id(), order, config) {\n\t\tif (this.roomTypes[identifier] != null) {\n\t\t\treturn false;\n\t\t}\n\t\tif (order == null) {\n\t\t\torder = this.mainOrder + 10;\n\t\t\tthis.mainOrder += 10;\n\t\t}\n\t\tthis.roomTypesOrder.push({\n\t\t\tidentifier,\n\t\t\torder\n\t\t});\n\t\tthis.roomTypes[identifier] = {...config, identifier};\n\t\tif (config.route && config.route.path && config.route.name && config.route.action) {\n\t\t\tconst routeConfig = {\n\t\t\t\tname: config.route.name,\n\t\t\t\taction: config.route.action\n\t\t\t};\n\t\t\tif (Meteor.isClient) {\n\t\t\t\trouteConfig.triggersExit = [roomExit];\n\t\t\t}\n\t\t\treturn FlowRouter.route(config.route.path, routeConfig);\n\t\t}\n\t}\n\n\thasCustomLink(roomType) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link != null;\n\t}\n\n\t/*\n\t@param roomType: room type (e.g.: c (for channels), d (for direct channels))\n\t@param subData: the user's subscription data\n\t*/\n\n\tgetRouteLink(roomType, subData) {\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\treturn false;\n\t\t}\n\t\tlet routeData = {};\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link) {\n\t\t\trouteData = this.roomTypes[roomType].route.link(subData);\n\t\t} else if (subData && subData.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name\n\t\t\t};\n\t\t}\n\t\treturn FlowRouter.path(this.roomTypes[roomType].route.name, routeData);\n\t}\n\n\topenRouteLink(roomType, subData, queryParams) {\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\treturn false;\n\t\t}\n\t\tlet routeData = {};\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].route && this.roomTypes[roomType].route.link) {\n\t\t\trouteData = this.roomTypes[roomType].route.link(subData);\n\t\t} else if (subData && subData.name) {\n\t\t\trouteData = {\n\t\t\t\tname: subData.name\n\t\t\t};\n\t\t}\n\t\treturn FlowRouter.go(this.roomTypes[roomType].route.name, routeData, queryParams);\n\t}\n};\nexport default this.roomTypesCommon;\n","RocketChat.slashCommands = {\n\tcommands: {}\n};\n\nRocketChat.slashCommands.add = function(command, callback, options = {}, result) {\n\tRocketChat.slashCommands.commands[command] = {\n\t\tcommand,\n\t\tcallback,\n\t\tparams: options.params,\n\t\tdescription: options.description,\n\t\tclientOnly: options.clientOnly || false,\n\t\tresult\n\t};\n};\n\nRocketChat.slashCommands.run = function(command, params, item) {\n\tif (RocketChat.slashCommands.commands[command] && RocketChat.slashCommands.commands[command].callback) {\n\t\treturn RocketChat.slashCommands.commands[command].callback(command, params, item);\n\t}\n};\n\nMeteor.methods({\n\tslashCommand(command) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'slashCommand'\n\t\t\t});\n\t\t}\n\t\treturn RocketChat.slashCommands.run(command.cmd, command.params, command.msg);\n\t}\n});\n","RocketChat.Message = {\n\tparse(msg, language) {\n\t\tconst messageType = RocketChat.MessageTypes.getType(msg);\n\t\tif (messageType) {\n\t\t\tif (messageType.render) {\n\t\t\t\treturn messageType.render(msg);\n\t\t\t} else if (messageType.template) {\n\t\t\t\t// Render message\n\t\t\t\treturn;\n\t\t\t} else if (messageType.message) {\n\t\t\t\tif (!language && typeof localStorage !== 'undefined') {\n\t\t\t\t\tlanguage = localStorage.getItem('userLanguage');\n\t\t\t\t}\n\t\t\t\tconst data = (typeof messageType.data === 'function' && messageType.data(msg)) || {};\n\t\t\t\treturn TAPi18n.__(messageType.message, data, language);\n\t\t\t}\n\t\t}\n\t\tif (msg.u && msg.u.username === RocketChat.settings.get('Chatops_Username')) {\n\t\t\tmsg.html = msg.msg;\n\t\t\treturn msg.html;\n\t\t}\n\t\tmsg.html = msg.msg;\n\t\tif (_.trim(msg.html) !== '') {\n\t\t\tmsg.html = _.escapeHTML(msg.html);\n\t\t}\n\t\tmsg.html = msg.html.replace(/\\n/gm, '<br/>');\n\t\treturn msg.html;\n\t}\n};\n","RocketChat.messageBox = {};\n\nRocketChat.messageBox.actions = new class {\n\tconstructor() {\n\t\tthis.actions = {};\n\t}\n\n\t/* Add a action to messagebox\n\t@param group\n\t@param label\n\t@param config\n\ticon: icon class\n\taction: action function\n\tcondition: condition to display the action\n\t*/\n\n\tadd(group, label, config) {\n\t\tif (!group && !label && !config) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.actions[group]) {\n\t\t\tthis.actions[group] = [];\n\t\t}\n\n\t\tconst actionExists = this.actions[group].find((action) => {\n\t\t\treturn action.label === label;\n\t\t});\n\n\t\tif (actionExists) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.actions[group].push({...config, label});\n\t}\n\n\tget(group) {\n\t\tif (!group) {\n\t\t\treturn Object.keys(this.actions).reduce((ret, key) => {\n\t\t\t\tconst actions = this.actions[key].filter(action => !action.condition || action.condition());\n\t\t\t\tif (actions.length) {\n\t\t\t\t\tret[key] = actions;\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t}, {});\n\t\t}\n\n\t\treturn this.actions[group].filter(action => !action.condition || action.condition());\n\t}\n\n\tgetById(id) {\n\t\tconst messageActions = this.actions;\n\t\tlet actions = [];\n\t\tObject.keys(messageActions).forEach(function(action) {\n\t\t\tactions = actions.concat(messageActions[action]);\n\t\t});\n\n\t\treturn actions.filter(action => action.id === id);\n\t}\n};\n","RocketChat.MessageTypes = new class {\n\tconstructor() {\n\t\tthis.types = {};\n\t}\n\n\tregisterType(options) {\n\t\treturn this.types[options.id] = options;\n\t}\n\n\tgetType(message) {\n\t\treturn this.types[message && message.t];\n\t}\n\n\tisSystemMessage(message) {\n\t\tconst type = this.types[message && message.t];\n\t\treturn type && type.system;\n\t}\n\n};\n\nMeteor.startup(function() {\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'r',\n\t\tsystem: true,\n\t\tmessage: 'Room_name_changed',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\troom_name: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'au',\n\t\tsystem: true,\n\t\tmessage: 'User_added_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_added: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'ru',\n\t\tsystem: true,\n\t\tmessage: 'User_removed_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_removed: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'ul',\n\t\tsystem: true,\n\t\tmessage: 'User_left',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_left: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'uj',\n\t\tsystem: true,\n\t\tmessage: 'User_joined_channel',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'wm',\n\t\tsystem: true,\n\t\tmessage: 'Welcome',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'rm',\n\t\tsystem: true,\n\t\tmessage: 'Message_removed',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'rtc',\n\t\trender(message) {\n\t\t\treturn RocketChat.callbacks.run('renderRtcMessage', message);\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'user-muted',\n\t\tsystem: true,\n\t\tmessage: 'User_muted_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_muted: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'user-unmuted',\n\t\tsystem: true,\n\t\tmessage: 'User_unmuted_by',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tuser_unmuted: message.msg,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'subscription-role-added',\n\t\tsystem: true,\n\t\tmessage: '__username__was_set__role__by__user_by_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.msg,\n\t\t\t\trole: message.role,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'subscription-role-removed',\n\t\tsystem: true,\n\t\tmessage: '__username__is_no_longer__role__defined_by__user_by_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.msg,\n\t\t\t\trole: message.role,\n\t\t\t\tuser_by: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'room-archived',\n\t\tsystem: true,\n\t\tmessage: 'This_room_has_been_archived_by__username_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.u.username\n\t\t\t};\n\t\t}\n\t});\n\tRocketChat.MessageTypes.registerType({\n\t\tid: 'room-unarchived',\n\t\tsystem: true,\n\t\tmessage: 'This_room_has_been_unarchived_by__username_',\n\t\tdata(message) {\n\t\t\treturn {\n\t\t\t\tusername: message.u.username\n\t\t\t};\n\t\t}\n\t});\n});\n","let logger;\n\nif (Meteor.isServer) {\n\tlogger = new Logger('TemplateVarHandler', {});\n}\n\nRocketChat.templateVarHandler = function(variable, object) {\n\n\tconst templateRegex = /#{([\\w\\-]+)}/gi;\n\tlet match = templateRegex.exec(variable);\n\tlet tmpVariable = variable;\n\n\tif (match == null) {\n\t\tif (!object.hasOwnProperty(variable)) {\n\t\t\tlogger && logger.debug(`user does not have attribute: ${ variable }`);\n\t\t\treturn;\n\t\t}\n\t\treturn object[variable];\n\t} else {\n\t\tlogger && logger.debug('template found. replacing values');\n\t\twhile (match != null) {\n\t\t\tconst tmplVar = match[0];\n\t\t\tconst tmplAttrName = match[1];\n\n\t\t\tif (!object.hasOwnProperty(tmplAttrName)) {\n\t\t\t\tlogger && logger.debug(`user does not have attribute: ${ tmplAttrName }`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst attrVal = object[tmplAttrName];\n\t\t\tlogger && logger.debug(`replacing template var: ${ tmplVar } with value: ${ attrVal }`);\n\t\t\ttmpVariable = tmpVariable.replace(tmplVar, attrVal);\n\t\t\tmatch = templateRegex.exec(variable);\n\t\t}\n\t\treturn tmpVariable;\n\t}\n};\n","/* globals WebAppInternals */\nRocketChat.settings.get('Site_Url', function(key, value) {\n\tif (value == null || value.trim() === '') {\n\t\treturn;\n\t}\n\tlet host = value.replace(/\\/$/, '');\n\t// let prefix = '';\n\tconst match = value.match(/([^\\/]+\\/{2}[^\\/]+)(\\/.+)/);\n\tif (match != null) {\n\t\thost = match[1];\n\t\t// prefix = match[2].replace(/\\/$/, '');\n\t}\n\t__meteor_runtime_config__.ROOT_URL = value;\n\n\tif (Meteor.absoluteUrl.defaultOptions && Meteor.absoluteUrl.defaultOptions.rootUrl) {\n\t\tMeteor.absoluteUrl.defaultOptions.rootUrl = value;\n\t}\n\tif (Meteor.isServer) {\n\t\tRocketChat.hostname = host.replace(/^https?:\\/\\//, '');\n\t\tprocess.env.MOBILE_ROOT_URL = host;\n\t\tprocess.env.MOBILE_DDP_URL = host;\n\t\tif (typeof WebAppInternals !== 'undefined' && WebAppInternals.generateBoilerplate) {\n\t\t\treturn WebAppInternals.generateBoilerplate();\n\t\t}\n\t}\n});\n","/* global InstanceStatus */\nconst logger = new Logger('Meteor', {\n\tmethods: {\n\t\tmethod: {\n\t\t\ttype: 'debug'\n\t\t},\n\t\tpublish: {\n\t\t\ttype: 'debug'\n\t\t}\n\t}\n});\n\nconst wrapMethods = function(name, originalHandler, methodsMap) {\n\tmethodsMap[name] = function() {\n\t\tconst args = name === 'ufsWrite' ? Array.prototype.slice.call(arguments, 1) : arguments;\n\t\tlogger.method(name, '-> userId:', Meteor.userId(), ', arguments: ', args);\n\n\t\treturn originalHandler.apply(this, arguments);\n\t};\n};\n\nconst originalMeteorMethods = Meteor.methods;\n\nMeteor.methods = function(methodMap) {\n\t_.each(methodMap, function(handler, name) {\n\t\twrapMethods(name, handler, methodMap);\n\t});\n\toriginalMeteorMethods(methodMap);\n};\n\nconst originalMeteorPublish = Meteor.publish;\n\nMeteor.publish = function(name, func) {\n\treturn originalMeteorPublish(name, function() {\n\t\tlogger.publish(name, '-> userId:', this.userId, ', arguments: ', arguments);\n\n\t\treturn func.apply(this, arguments);\n\t});\n};\n\nWebApp.rawConnectHandlers.use(function(req, res, next) {\n\tres.setHeader('X-Instance-ID', InstanceStatus.id());\n\treturn next();\n});\n","import bugsnag from 'bugsnag';\n\nRocketChat.bugsnag = bugsnag;\n\nRocketChat.settings.get('Bugsnag_api_key', (key, value) => {\n\tif (value) {\n\t\tbugsnag.register(value);\n\t}\n});\n\nconst notify = function(message, stack) {\n\tif (typeof stack === 'string') {\n\t\tmessage += ` ${ stack }`;\n\t}\n\tlet options = {};\n\tif (RocketChat.Info) {\n\t\toptions = { app: { version: RocketChat.Info.version, info: RocketChat.Info } };\n\t}\n\tconst error = new Error(message);\n\terror.stack = stack;\n\tRocketChat.bugsnag.notify(error, options);\n};\n\nprocess.on('uncaughtException', Meteor.bindEnvironment((error) => {\n\tnotify(error.message, error.stack);\n\tthrow error;\n}));\n\nconst originalMeteorDebug = Meteor._debug;\nMeteor._debug = function() {\n\tnotify(...arguments);\n\treturn originalMeteorDebug(...arguments);\n};\n","const client = require('prom-client');\n\nRocketChat.promclient = client;\n\nRocketChat.metrics = {};\n\n// one sample metrics only - a counter\n\nRocketChat.metrics.messagesSent = new client.Counter('messages_sent', 'cumulated number of messages sent');\n","/* globals RateLimiter */\nRocketChat.RateLimiter = new class {\n\tlimitFunction(fn, numRequests, timeInterval, matchers) {\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\treturn fn;\n\t\t}\n\t\tconst rateLimiter = new RateLimiter();\n\t\trateLimiter.addRule(matchers, numRequests, timeInterval);\n\t\treturn function(...args) {\n\t\t\tconst match = {};\n\t\t\t_.each(matchers, function(matcher, key) {\n\t\t\t\treturn match[key] = args[key];\n\t\t\t});\n\t\t\trateLimiter.increment(match);\n\t\t\tconst rateLimitResult = rateLimiter.check(match);\n\t\t\tif (rateLimitResult.allowed) {\n\t\t\t\treturn fn.apply(null, arguments);\n\t\t\t} else {\n\t\t\t\tthrow new Meteor.Error('error-too-many-requests', `Error, too many requests. Please slow down. You must wait ${ Math.ceil(rateLimitResult.timeToReset / 1000) } seconds before trying again.`, {\n\t\t\t\t\ttimeToReset: rateLimitResult.timeToReset,\n\t\t\t\t\tseconds: Math.ceil(rateLimitResult.timeToReset / 1000)\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tlimitMethod(methodName, numRequests, timeInterval, matchers) {\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\treturn;\n\t\t}\n\t\tconst match = {\n\t\t\ttype: 'method',\n\t\t\tname: methodName\n\t\t};\n\t\t_.each(matchers, function(matcher, key) {\n\t\t\treturn match[key] = matchers[key];\n\t\t});\n\t\treturn DDPRateLimiter.addRule(match, numRequests, timeInterval);\n\t}\n\n};\n","/* globals LoggerManager */\nRocketChat.settings.get('Log_Package', function(key, value) {\n\treturn LoggerManager.showPackage = value;\n});\n\nRocketChat.settings.get('Log_File', function(key, value) {\n\treturn LoggerManager.showFileAndLine = value;\n});\n\nRocketChat.settings.get('Log_Level', function(key, value) {\n\tif (value != null) {\n\t\tLoggerManager.logLevel = parseInt(value);\n\t\tMeteor.setTimeout(() => {\n\t\t\treturn LoggerManager.enable(true);\n\t\t}, 200);\n\t}\n});\n","/* globals Push */\nclass PushNotification {\n\tgetNotificationId(roomId) {\n\t\tconst serverId = RocketChat.settings.get('uniqueID');\n\t\treturn this.hash(`${ serverId }|${ roomId }`); // hash\n\t}\n\n\thash(str) {\n\t\tlet hash = 0;\n\t\tlet i = str.length;\n\n\t\twhile (i) {\n\t\t\thash = ((hash << 5) - hash) + str.charCodeAt(--i);\n\t\t\thash = hash & hash; // Convert to 32bit integer\n\t\t}\n\t\treturn hash;\n\t}\n\n\tsend({ roomName, roomId, username, message, usersTo, payload, badge = 1 }) {\n\t\tlet title;\n\t\tif (roomName && roomName !== '') {\n\t\t\ttitle = `${ roomName }`;\n\t\t\tmessage = `${ username }: ${ message }`;\n\t\t} else {\n\t\t\ttitle = `${ username }`;\n\t\t}\n\t\tconst icon = RocketChat.settings.get('Assets_favicon_192').url || RocketChat.settings.get('Assets_favicon_192').defaultUrl;\n\t\tconst config = {\n\t\t\tfrom: 'push',\n\t\t\tbadge,\n\t\t\tsound: 'default',\n\t\t\ttitle,\n\t\t\ttext: message,\n\t\t\tpayload,\n\t\t\tquery: usersTo,\n\t\t\tnotId: this.getNotificationId(roomId),\n\t\t\tgcm: {\n\t\t\t\tstyle: 'inbox',\n\t\t\t\tsummaryText: '%n% new messages',\n\t\t\t\timage: RocketChat.getURL(icon, { full: true })\n\t\t\t},\n\t\t\tapn: {\n\t\t\t\ttext: title + ((title !== '' && message !== '') ? '\\n' : '') + message\n\t\t\t}\n\t\t};\n\n\t\treturn Push.send(config);\n\t}\n}\n\nRocketChat.PushNotification = new PushNotification();\n","RocketChat.emailDomainDefaultBlackList = [\n\t'0-mail.com',\n\t'0815.ru',\n\t'0815.su',\n\t'0clickemail.com',\n\t'0wnd.net',\n\t'0wnd.org',\n\t'10mail.org',\n\t'10minut.com.pl',\n\t'10minutemail.co.za',\n\t'10minutemail.com',\n\t'10minutemail.de',\n\t'123-m.com',\n\t'1chuan.com',\n\t'1fsdfdsfsdf.tk',\n\t'1pad.de',\n\t'1zhuan.com',\n\t'20email.eu',\n\t'20mail.eu',\n\t'20mail.it',\n\t'20minutemail.com',\n\t'21cn.com',\n\t'2fdgdfgdfgdf.tk',\n\t'2prong.com',\n\t'30minutemail.com',\n\t'33mail.com',\n\t'3d-painting.com',\n\t'3trtretgfrfe.tk',\n\t'4gfdsgfdgfd.tk',\n\t'4warding.com',\n\t'4warding.net',\n\t'4warding.org',\n\t'5ghgfhfghfgh.tk',\n\t'60minutemail.com',\n\t'675hosting.com',\n\t'675hosting.net',\n\t'675hosting.org',\n\t'6hjgjhgkilkj.tk',\n\t'6ip.us',\n\t'6paq.com',\n\t'6url.com',\n\t'75hosting.com',\n\t'75hosting.net',\n\t'75hosting.org',\n\t'7days-printing.com',\n\t'7tags.com',\n\t'99experts.com',\n\t'9ox.net',\n\t'a-bc.net',\n\t'a45.in',\n\t'abcmail.email',\n\t'abyssmail.com',\n\t'acentri.com',\n\t'advantimo.com',\n\t'afrobacon.com',\n\t'ag.us.to',\n\t'agedmail.com',\n\t'ahk.jp',\n\t'ajaxapp.net',\n\t'alivance.com',\n\t'ama-trade.de',\n\t'amail.com',\n\t'amilegit.com',\n\t'amiri.net',\n\t'amiriindustries.com',\n\t'anappthat.com',\n\t'ano-mail.net',\n\t'anonbox.net',\n\t'anonmails.de',\n\t'anonymail.dk',\n\t'anonymbox.com',\n\t'antichef.com',\n\t'antichef.net',\n\t'antireg.ru',\n\t'antispam.de',\n\t'antispammail.de',\n\t'appixie.com',\n\t'armyspy.com',\n\t'artman-conception.com',\n\t'aver.com',\n\t'azmeil.tk',\n\t'baxomale.ht.cx',\n\t'beddly.com',\n\t'beefmilk.com',\n\t'bigprofessor.so',\n\t'bigstring.com',\n\t'binkmail.com',\n\t'bio-muesli.net',\n\t'blogmyway.org',\n\t'bobmail.info',\n\t'bofthew.com',\n\t'bootybay.de',\n\t'boun.cr',\n\t'bouncr.com',\n\t'boxformail.in',\n\t'breakthru.com',\n\t'brefmail.com',\n\t'brennendesreich.de',\n\t'broadbandninja.com',\n\t'bsnow.net',\n\t'bspamfree.org',\n\t'bu.mintemail.com',\n\t'buffemail.com',\n\t'bugmenot.com',\n\t'bumpymail.com',\n\t'bund.us',\n\t'bundes-li.ga',\n\t'burnthespam.info',\n\t'burstmail.info',\n\t'buymoreplays.com',\n\t'buyusedlibrarybooks.org',\n\t'byom.de',\n\t'c2.hu',\n\t'cachedot.net',\n\t'card.zp.ua',\n\t'casualdx.com',\n\t'cbair.com',\n\t'cek.pm',\n\t'cellurl.com',\n\t'centermail.com',\n\t'centermail.net',\n\t'chammy.info',\n\t'cheatmail.de',\n\t'childsavetrust.org',\n\t'chogmail.com',\n\t'choicemail1.com',\n\t'chong-mail.com',\n\t'chong-mail.net',\n\t'chong-mail.org',\n\t'clixser.com',\n\t'cmail.com',\n\t'cmail.net',\n\t'cmail.org',\n\t'coldemail.info',\n\t'consumerriot.com',\n\t'cool.fr.nf',\n\t'correo.blogos.net',\n\t'cosmorph.com',\n\t'courriel.fr.nf',\n\t'courrieltemporaire.com',\n\t'crapmail.org',\n\t'crazymailing.com',\n\t'cubiclink.com',\n\t'curryworld.de',\n\t'cust.in',\n\t'cuvox.de',\n\t'd3p.dk',\n\t'dacoolest.com',\n\t'daintly.com',\n\t'dandikmail.com',\n\t'dayrep.com',\n\t'dbunker.com',\n\t'dcemail.com',\n\t'deadaddress.com',\n\t'deadspam.com',\n\t'deagot.com',\n\t'dealja.com',\n\t'delikkt.de',\n\t'despam.it',\n\t'despammed.com',\n\t'devnullmail.com',\n\t'dfgh.net',\n\t'digitalsanctuary.com',\n\t'dingbone.com',\n\t'discard.email',\n\t'discardmail.com',\n\t'discardmail.de',\n\t'disposableaddress.com',\n\t'disposableemailaddresses.com',\n\t'disposableemailaddresses.emailmiser.com',\n\t'disposableinbox.com',\n\t'dispose.it',\n\t'disposeamail.com',\n\t'disposemail.com',\n\t'dispostable.com',\n\t'dlemail.ru',\n\t'dm.w3internet.co.uk',\n\t'dm.w3internet.co.ukexample.com',\n\t'dodgeit.com',\n\t'dodgit.com',\n\t'dodgit.org',\n\t'doiea.com',\n\t'domozmail.com',\n\t'donemail.ru',\n\t'dontreg.com',\n\t'dontsendmespam.de',\n\t'dotmsg.com',\n\t'drdrb.com',\n\t'drdrb.net',\n\t'droplar.com',\n\t'dropmail.me',\n\t'dt.com',\n\t'duam.net',\n\t'dudmail.com',\n\t'dump-email.info',\n\t'dumpandjunk.com',\n\t'dumpmail.de',\n\t'dumpyemail.com',\n\t'duskmail.com',\n\t'e-mail.com',\n\t'e-mail.org',\n\t'e4ward.com',\n\t'easytrashmail.com',\n\t'einmalmail.de',\n\t'einrot.com',\n\t'einrot.de',\n\t'eintagsmail.de',\n\t'email60.com',\n\t'emaildienst.de',\n\t'emailgo.de',\n\t'emailias.com',\n\t'emailigo.de',\n\t'emailinfive.com',\n\t'emaillime.com',\n\t'emailmiser.com',\n\t'emailproxsy.com',\n\t'emailsensei.com',\n\t'emailtemporanea.com',\n\t'emailtemporanea.net',\n\t'emailtemporar.ro',\n\t'emailtemporario.com.br',\n\t'emailthe.net',\n\t'emailtmp.com',\n\t'emailto.de',\n\t'emailwarden.com',\n\t'emailx.at.hm',\n\t'emailxfer.com',\n\t'emeil.in',\n\t'emeil.ir',\n\t'emil.com',\n\t'emz.net',\n\t'enterto.com',\n\t'ephemail.net',\n\t'ero-tube.org',\n\t'etranquil.com',\n\t'etranquil.net',\n\t'etranquil.org',\n\t'evopo.com',\n\t'explodemail.com',\n\t'express.net.ua',\n\t'eyepaste.com',\n\t'fakeinbox.com',\n\t'fakeinformation.com',\n\t'fakemail.fr',\n\t'fakemailz.com',\n\t'fammix.com',\n\t'fansworldwide.de',\n\t'fantasymail.de',\n\t'fastacura.com',\n\t'fastchevy.com',\n\t'fastchrysler.com',\n\t'fastkawasaki.com',\n\t'fastmazda.com',\n\t'fastmitsubishi.com',\n\t'fastnissan.com',\n\t'fastsubaru.com',\n\t'fastsuzuki.com',\n\t'fasttoyota.com',\n\t'fastyamaha.com',\n\t'fatflap.com',\n\t'fdfdsfds.com',\n\t'fightallspam.com',\n\t'figjs.com',\n\t'fiifke.de',\n\t'filzmail.com',\n\t'fivemail.de',\n\t'fixmail.tk',\n\t'fizmail.com',\n\t'fleckens.hu',\n\t'flemail.ru',\n\t'flyspam.com',\n\t'footard.com',\n\t'forgetmail.com',\n\t'fr33mail.info',\n\t'frapmail.com',\n\t'freundin.ru',\n\t'friendlymail.co.uk',\n\t'front14.org',\n\t'fuckingduh.com',\n\t'fudgerub.com',\n\t'fux0ringduh.com',\n\t'fyii.de',\n\t'garliclife.com',\n\t'gehensiemirnichtaufdensack.de',\n\t'gelitik.in',\n\t'get1mail.com',\n\t'get2mail.fr',\n\t'getairmail.com',\n\t'getmails.eu',\n\t'getonemail.com',\n\t'getonemail.net',\n\t'ghosttexter.de',\n\t'giantmail.de',\n\t'girlsundertheinfluence.com',\n\t'gishpuppy.com',\n\t'gmial.com',\n\t'goemailgo.com',\n\t'gorillaswithdirtyarmpits.com',\n\t'gotmail.com',\n\t'gotmail.net',\n\t'gotmail.org',\n\t'gotti.otherinbox.com',\n\t'gowikibooks.com',\n\t'gowikicampus.com',\n\t'gowikicars.com',\n\t'gowikifilms.com',\n\t'gowikigames.com',\n\t'gowikimusic.com',\n\t'gowikimusic.great-host.in',\n\t'gowikinetwork.com',\n\t'gowikitravel.com',\n\t'gowikitv.com',\n\t'grandmamail.com',\n\t'grandmasmail.com',\n\t'great-host.in',\n\t'greensloth.com',\n\t'grr.la',\n\t'gsrv.co.uk',\n\t'guerillamail.biz',\n\t'guerillamail.com',\n\t'guerillamail.net',\n\t'guerillamail.org',\n\t'guerrillamail.biz',\n\t'guerrillamail.com',\n\t'guerrillamail.de',\n\t'guerrillamail.info',\n\t'guerrillamail.net',\n\t'guerrillamail.org',\n\t'guerrillamailblock.com',\n\t'gustr.com',\n\t'h.mintemail.com',\n\t'h8s.org',\n\t'hacccc.com',\n\t'haltospam.com',\n\t'harakirimail.com',\n\t'hartbot.de',\n\t'hat-geld.de',\n\t'hatespam.org',\n\t'hellodream.mobi',\n\t'herp.in',\n\t'hidemail.de',\n\t'hidzz.com',\n\t'hmamail.com',\n\t'hochsitze.com',\n\t'hopemail.biz',\n\t'hotpop.com',\n\t'hulapla.de',\n\t'iaoss.com',\n\t'ieatspam.eu',\n\t'ieatspam.info',\n\t'ieh-mail.de',\n\t'ihateyoualot.info',\n\t'iheartspam.org',\n\t'ikbenspamvrij.nl',\n\t'imails.info',\n\t'imgof.com',\n\t'imstations.com',\n\t'inbax.tk',\n\t'inbox.si',\n\t'inboxalias.com',\n\t'inboxclean.com',\n\t'inboxclean.org',\n\t'inboxproxy.com',\n\t'incognitomail.com',\n\t'incognitomail.net',\n\t'incognitomail.org',\n\t'infocom.zp.ua',\n\t'inoutmail.de',\n\t'inoutmail.eu',\n\t'inoutmail.info',\n\t'inoutmail.net',\n\t'insorg-mail.info',\n\t'instant-mail.de',\n\t'ip6.li',\n\t'ipoo.org',\n\t'irish2me.com',\n\t'iwi.net',\n\t'jamit.com.au',\n\t'jetable.com',\n\t'jetable.fr.nf',\n\t'jetable.net',\n\t'jetable.org',\n\t'jnxjn.com',\n\t'jourrapide.com',\n\t'jsrsolutions.com',\n\t'junk1e.com',\n\t'kasmail.com',\n\t'kaspop.com',\n\t'keepmymail.com',\n\t'killmail.com',\n\t'killmail.net',\n\t'kimsdisk.com',\n\t'kingsq.ga',\n\t'kir.ch.tc',\n\t'klassmaster.com',\n\t'klassmaster.net',\n\t'klzlk.com',\n\t'kook.ml',\n\t'koszmail.pl',\n\t'kulturbetrieb.info',\n\t'kurzepost.de',\n\t'l33r.eu',\n\t'lackmail.net',\n\t'lags.us',\n\t'lawlita.com',\n\t'lazyinbox.com',\n\t'letthemeatspam.com',\n\t'lhsdv.com',\n\t'lifebyfood.com',\n\t'link2mail.net',\n\t'litedrop.com',\n\t'loadby.us',\n\t'login-email.ml',\n\t'lol.ovpn.to',\n\t'lolfreak.net',\n\t'lookugly.com',\n\t'lopl.co.cc',\n\t'lortemail.dk',\n\t'lovemeleaveme.com',\n\t'lr78.com',\n\t'lroid.com',\n\t'lukop.dk',\n\t'm21.cc',\n\t'm4ilweb.info',\n\t'maboard.com',\n\t'mail-filter.com',\n\t'mail-temporaire.fr',\n\t'mail.by',\n\t'mail.mezimages.net',\n\t'mail.zp.ua',\n\t'mail114.net',\n\t'mail1a.de',\n\t'mail21.cc',\n\t'mail2rss.org',\n\t'mail333.com',\n\t'mail4trash.com',\n\t'mailbidon.com',\n\t'mailbiz.biz',\n\t'mailblocks.com',\n\t'mailbucket.org',\n\t'mailcat.biz',\n\t'mailcatch.com',\n\t'mailde.de',\n\t'mailde.info',\n\t'maildrop.cc',\n\t'maildx.com',\n\t'maileater.com',\n\t'mailed.ro',\n\t'maileimer.de',\n\t'mailexpire.com',\n\t'mailfa.tk',\n\t'mailforspam.com',\n\t'mailfreeonline.com',\n\t'mailfs.com',\n\t'mailguard.me',\n\t'mailimate.com',\n\t'mailin8r.com',\n\t'mailinater.com',\n\t'mailinator.com',\n\t'mailinator.net',\n\t'mailinator.org',\n\t'mailinator.us',\n\t'mailinator2.com',\n\t'mailincubator.com',\n\t'mailismagic.com',\n\t'mailmate.com',\n\t'mailme.ir',\n\t'mailme.lv',\n\t'mailme24.com',\n\t'mailmetrash.com',\n\t'mailmetrash.comilzilla.org',\n\t'mailmoat.com',\n\t'mailms.com',\n\t'mailnator.com',\n\t'mailnesia.com',\n\t'mailnull.com',\n\t'mailorg.org',\n\t'mailpick.biz',\n\t'mailproxsy.com',\n\t'mailquack.com',\n\t'mailrock.biz',\n\t'mailscrap.com',\n\t'mailshell.com',\n\t'mailsiphon.com',\n\t'mailslapping.com',\n\t'mailslite.com',\n\t'mailtemp.info',\n\t'mailtome.de',\n\t'mailtothis.com',\n\t'mailtrash.net',\n\t'mailtv.net',\n\t'mailtv.tv',\n\t'mailzilla.com',\n\t'mailzilla.org',\n\t'mailzilla.orgmbx.cc',\n\t'makemetheking.com',\n\t'manifestgenerator.com',\n\t'manybrain.com',\n\t'mbx.cc',\n\t'mega.zik.dj',\n\t'meinspamschutz.de',\n\t'meltmail.com',\n\t'messagebeamer.de',\n\t'mezimages.net',\n\t'mierdamail.com',\n\t'migumail.com',\n\t'ministry-of-silly-walks.de',\n\t'mintemail.com',\n\t'misterpinball.de',\n\t'mjukglass.nu',\n\t'mmailinater.com',\n\t'moakt.com',\n\t'mobi.web.id',\n\t'mobileninja.co.uk',\n\t'moburl.com',\n\t'mohmal.com',\n\t'moncourrier.fr.nf',\n\t'monemail.fr.nf',\n\t'monmail.fr.nf',\n\t'monumentmail.com',\n\t'msa.minsmail.com',\n\t'mt2009.com',\n\t'mt2014.com',\n\t'mx0.wwwnew.eu',\n\t'my10minutemail.com',\n\t'mycard.net.ua',\n\t'mycleaninbox.net',\n\t'myemailboxy.com',\n\t'mymail-in.net',\n\t'mymailoasis.com',\n\t'mynetstore.de',\n\t'mypacks.net',\n\t'mypartyclip.de',\n\t'myphantomemail.com',\n\t'mysamp.de',\n\t'myspaceinc.com',\n\t'myspaceinc.net',\n\t'myspaceinc.org',\n\t'myspacepimpedup.com',\n\t'myspamless.com',\n\t'mytemp.email',\n\t'mytempemail.com',\n\t'mytempmail.com',\n\t'mytrashmail.com',\n\t'nabuma.com',\n\t'neomailbox.com',\n\t'nepwk.com',\n\t'nervmich.net',\n\t'nervtmich.net',\n\t'netmails.com',\n\t'netmails.net',\n\t'netzidiot.de',\n\t'neverbox.com',\n\t'nice-4u.com',\n\t'nincsmail.com',\n\t'nincsmail.hu',\n\t'nnh.com',\n\t'no-spam.ws',\n\t'noblepioneer.com',\n\t'nobulk.com',\n\t'noclickemail.com',\n\t'nogmailspam.info',\n\t'nomail.pw',\n\t'nomail.xl.cx',\n\t'nomail2me.com',\n\t'nomorespamemails.com',\n\t'nonspam.eu',\n\t'nonspammer.de',\n\t'noref.in',\n\t'nospam.ze.tc',\n\t'nospam4.us',\n\t'nospamfor.us',\n\t'nospammail.net',\n\t'nospamthanks.info',\n\t'notmailinator.com',\n\t'notsharingmy.info',\n\t'nowhere.org',\n\t'nowmymail.com',\n\t'nurfuerspam.de',\n\t'nus.edu.sg',\n\t'nwldx.com',\n\t'objectmail.com',\n\t'obobbo.com',\n\t'odaymail.com',\n\t'odnorazovoe.ru',\n\t'one-time.email',\n\t'oneoffemail.com',\n\t'oneoffmail.com',\n\t'onewaymail.com',\n\t'onlatedotcom.info',\n\t'online.ms',\n\t'oopi.org',\n\t'opayq.com',\n\t'ordinaryamerican.net',\n\t'otherinbox.codupmyspace.com',\n\t'otherinbox.com',\n\t'ourklips.com',\n\t'outlawspam.com',\n\t'ovpn.to',\n\t'owlpic.com',\n\t'pancakemail.com',\n\t'paplease.com',\n\t'pcusers.otherinbox.com',\n\t'pepbot.com',\n\t'pfui.ru',\n\t'pimpedupmyspace.com',\n\t'pjjkp.com',\n\t'plexolan.de',\n\t'poczta.onet.pl',\n\t'politikerclub.de',\n\t'pooae.com',\n\t'poofy.org',\n\t'pookmail.com',\n\t'privacy.net',\n\t'privatdemail.net',\n\t'privy-mail.com',\n\t'privymail.de',\n\t'proxymail.eu',\n\t'prtnx.com',\n\t'prtz.eu',\n\t'punkass.com',\n\t'putthisinyourspamdatabase.com',\n\t'pwrby.com',\n\t'quickinbox.com',\n\t'quickmail.nl',\n\t'rcpt.at',\n\t'reallymymail.com',\n\t'realtyalerts.ca',\n\t'recode.me',\n\t'recursor.net',\n\t'recyclemail.dk',\n\t'regbypass.com',\n\t'regbypass.comsafe-mail.net',\n\t'rejectmail.com',\n\t'reliable-mail.com',\n\t'rhyta.com',\n\t'rklips.com',\n\t'rmqkr.net',\n\t'royal.net',\n\t'rppkn.com',\n\t'rtrtr.com',\n\t's0ny.net',\n\t'safe-mail.net',\n\t'safersignup.de',\n\t'safetymail.info',\n\t'safetypost.de',\n\t'sandelf.de',\n\t'saynotospams.com',\n\t'schafmail.de',\n\t'schrott-email.de',\n\t'secretemail.de',\n\t'secure-mail.biz',\n\t'selfdestructingmail.com',\n\t'selfdestructingmail.org',\n\t'sendspamhere.com',\n\t'sendspamhere.com',\n\t'senseless-entertainment.com',\n\t'services391.com',\n\t'sharedmailbox.org',\n\t'sharklasers.com',\n\t'shieldedmail.com',\n\t'shieldemail.com',\n\t'shiftmail.com',\n\t'shitmail.me',\n\t'shitmail.org',\n\t'shitware.nl',\n\t'shmeriously.com',\n\t'shortmail.net',\n\t'shotmail.ru',\n\t'showslow.de',\n\t'sibmail.com',\n\t'sinnlos-mail.de',\n\t'siteposter.net',\n\t'skeefmail.com',\n\t'slapsfromlastnight.com',\n\t'slaskpost.se',\n\t'slipry.net',\n\t'slopsbox.com',\n\t'slushmail.com',\n\t'smashmail.de',\n\t'smellfear.com',\n\t'smellrear.com',\n\t'snakemail.com',\n\t'sneakemail.com',\n\t'sneakmail.de',\n\t'snkmail.com',\n\t'sofimail.com',\n\t'sofort-mail.de',\n\t'softpls.asia',\n\t'sogetthis.com',\n\t'sohu.com',\n\t'solvemail.info',\n\t'soodonims.com',\n\t'spa.com',\n\t'spaereplease.com',\n\t'spam.la',\n\t'spam.su',\n\t'spam4.me',\n\t'spamail.de',\n\t'spamarrest.com',\n\t'spamavert.com',\n\t'spambob.com',\n\t'spambob.net',\n\t'spambob.org',\n\t'spambog.com',\n\t'spambog.de',\n\t'spambog.net',\n\t'spambog.ru',\n\t'spambox.info',\n\t'spambox.irishspringrealty.com',\n\t'spambox.us',\n\t'spamcannon.com',\n\t'spamcannon.net',\n\t'spamcero.com',\n\t'spamcon.org',\n\t'spamcorptastic.com',\n\t'spamcowboy.com',\n\t'spamcowboy.net',\n\t'spamcowboy.org',\n\t'spamday.com',\n\t'spamex.com',\n\t'spamfree.eu',\n\t'spamfree24.com',\n\t'spamfree24.de',\n\t'spamfree24.eu',\n\t'spamfree24.info',\n\t'spamfree24.net',\n\t'spamfree24.org',\n\t'spamgoes.in',\n\t'spamgourmet.com',\n\t'spamgourmet.net',\n\t'spamgourmet.org',\n\t'spamherelots.com',\n\t'spamhereplease.com',\n\t'spamhole.com',\n\t'spamify.com',\n\t'spaminator.de',\n\t'spamkill.info',\n\t'spaml.com',\n\t'spaml.de',\n\t'spammotel.com',\n\t'spamobox.com',\n\t'spamoff.de',\n\t'spamsalad.in',\n\t'spamslicer.com',\n\t'spamspot.com',\n\t'spamstack.net',\n\t'spamthis.co.uk',\n\t'spamthisplease.com',\n\t'spamtrail.com',\n\t'spamtroll.net',\n\t'speed.1s.fr',\n\t'spikio.com',\n\t'spoofmail.de',\n\t'squizzy.de',\n\t'ssoia.com',\n\t'startkeys.com',\n\t'stinkefinger.net',\n\t'stop-my-spam.com',\n\t'stuffmail.de',\n\t'super-auswahl.de',\n\t'supergreatmail.com',\n\t'supermailer.jp',\n\t'superrito.com',\n\t'superstachel.de',\n\t'suremail.info',\n\t'svk.jp',\n\t'sweetxxx.de',\n\t'tagyourself.com',\n\t'talkinator.com',\n\t'tapchicuoihoi.com',\n\t'teewars.org',\n\t'teleosaurs.xyz',\n\t'teleworm.com',\n\t'teleworm.us',\n\t'temp-mail.org',\n\t'temp-mail.ru',\n\t'temp.emeraldwebmail.com',\n\t'temp.headstrong.de',\n\t'tempalias.com',\n\t'tempe-mail.com',\n\t'tempemail.biz',\n\t'tempemail.co.za',\n\t'tempemail.com',\n\t'tempemail.net',\n\t'tempemail.net',\n\t'tempinbox.co.uk',\n\t'tempinbox.com',\n\t'tempmail.eu',\n\t'tempmail.it',\n\t'tempmail2.com',\n\t'tempmaildemo.com',\n\t'tempmailer.com',\n\t'tempmailer.de',\n\t'tempomail.fr',\n\t'temporarily.de',\n\t'temporarioemail.com.br',\n\t'temporaryemail.net',\n\t'temporaryemail.us',\n\t'temporaryforwarding.com',\n\t'temporaryinbox.com',\n\t'temporarymailaddress.com',\n\t'tempsky.com',\n\t'tempthe.net',\n\t'tempymail.com',\n\t'thanksnospam.info',\n\t'thankyou2010.com',\n\t'thc.st',\n\t'thecloudindex.com',\n\t'thelimestones.com',\n\t'thisisnotmyrealemail.com',\n\t'thismail.net',\n\t'thrma.com',\n\t'throwawayemailaddress.com',\n\t'tilien.com',\n\t'tittbit.in',\n\t'tizi.com',\n\t'tmail.ws',\n\t'tmailinator.com',\n\t'toiea.com',\n\t'toomail.biz',\n\t'topranklist.de',\n\t'tradermail.info',\n\t'trash-amil.com',\n\t'trash-mail.at',\n\t'trash-mail.com',\n\t'trash-mail.de',\n\t'trash2009.com',\n\t'trash2010.com',\n\t'trash2011.com',\n\t'trashdevil.com',\n\t'trashdevil.de',\n\t'trashemail.de',\n\t'trashmail.at',\n\t'trashmail.com',\n\t'trashmail.de',\n\t'trashmail.me',\n\t'trashmail.net',\n\t'trashmail.org',\n\t'trashmail.ws',\n\t'trashmailer.com',\n\t'trashymail.com',\n\t'trashymail.net',\n\t'trbvm.com',\n\t'trbvn.com',\n\t'trialmail.de',\n\t'trillianpro.com',\n\t'tryalert.com',\n\t'turual.com',\n\t'twinmail.de',\n\t'twoweirdtricks.com',\n\t'tyldd.com',\n\t'uggsrock.com',\n\t'umail.net',\n\t'upliftnow.com',\n\t'uplipht.com',\n\t'uroid.com',\n\t'us.af',\n\t'username.e4ward.com',\n\t'venompen.com',\n\t'veryrealemail.com',\n\t'vidchart.com',\n\t'viditag.com',\n\t'viewcastmedia.com',\n\t'viewcastmedia.net',\n\t'viewcastmedia.org',\n\t'viewcastmediae',\n\t'viralplays.com',\n\t'vkcode.ru',\n\t'vomoto.com',\n\t'vpn.st',\n\t'vsimcard.com',\n\t'vubby.com',\n\t'walala.org',\n\t'walkmail.net',\n\t'walkmail.ru',\n\t'wasteland.rfc822.org',\n\t'webemail.me',\n\t'webm4il.info',\n\t'webuser.in',\n\t'wee.my',\n\t'weg-werf-email.de',\n\t'wegwerf-email-addressen.de',\n\t'wegwerf-emails.de',\n\t'wegwerfadresse.de',\n\t'wegwerfemail.com',\n\t'wegwerfemail.de',\n\t'wegwerfmail.de',\n\t'wegwerfmail.info',\n\t'wegwerfmail.net',\n\t'wegwerfmail.org',\n\t'wetrainbayarea.com',\n\t'wetrainbayarea.org',\n\t'wh4f.org',\n\t'whatiaas.com',\n\t'whatpaas.com',\n\t'whatsaas.com',\n\t'whopy.com',\n\t'whtjddn.33mail.com',\n\t'whyspam.me',\n\t'wilemail.com',\n\t'willhackforfood.biz',\n\t'willselfdestruct.com',\n\t'winemaven.info',\n\t'wronghead.com',\n\t'wuzup.net',\n\t'wuzupmail.net',\n\t'www.e4ward.com',\n\t'www.gishpuppy.com',\n\t'www.mailinator.com',\n\t'wwwnew.eu',\n\t'x.ip6.li',\n\t'xagloo.com',\n\t'xemaps.com',\n\t'xents.com',\n\t'xmaily.com',\n\t'xoxy.net',\n\t'xyzfree.net',\n\t'yapped.net',\n\t'yeah.net',\n\t'yep.it',\n\t'yogamaven.com',\n\t'yomail.info',\n\t'yopmail.com',\n\t'yopmail.fr',\n\t'yopmail.net',\n\t'yourdomain.com',\n\t'ypmail.webarnak.fr.eu.org',\n\t'yuurok.com',\n\t'z1p.biz',\n\t'za.com',\n\t'zehnminuten.de',\n\t'zehnminutenmail.de',\n\t'zetmail.com',\n\t'zippymail.info',\n\t'zoaxe.com',\n\t'zoemail.com',\n\t'zoemail.net',\n\t'zoemail.org',\n\t'zomg.info',\n\t'zxcv.com',\n\t'zxcvbnm.com',\n\t'zzz.com'\n];\n\n","import IMAP from 'imap';\nimport POP3 from 'poplib';\nimport { simpleParser } from 'mailparser-node4';\n\nexport class IMAPIntercepter {\n\tconstructor() {\n\t\tthis.imap = new IMAP({\n\t\t\tuser: RocketChat.settings.get('Direct_Reply_Username'),\n\t\t\tpassword: RocketChat.settings.get('Direct_Reply_Password'),\n\t\t\thost: RocketChat.settings.get('Direct_Reply_Host'),\n\t\t\tport: RocketChat.settings.get('Direct_Reply_Port'),\n\t\t\tdebug: RocketChat.settings.get('Direct_Reply_Debug') ? console.log : false,\n\t\t\ttls: !RocketChat.settings.get('Direct_Reply_IgnoreTLS'),\n\t\t\tconnTimeout: 30000,\n\t\t\tkeepalive: true\n\t\t});\n\n\t\tthis.delete = RocketChat.settings.get('Direct_Reply_Delete') ? RocketChat.settings.get('Direct_Reply_Delete') : true;\n\n\t\t// On successfully connected.\n\t\tthis.imap.on('ready', Meteor.bindEnvironment(() => {\n\t\t\tif (this.imap.state !== 'disconnected') {\n\t\t\t\tthis.openInbox(Meteor.bindEnvironment((err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t\t// fetch new emails & wait [IDLE]\n\t\t\t\t\tthis.getEmails();\n\n\t\t\t\t\t// If new message arrived, fetch them\n\t\t\t\t\tthis.imap.on('mail', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\tthis.getEmails();\n\t\t\t\t\t}));\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('IMAP didnot connected.');\n\t\t\t\tthis.imap.end();\n\t\t\t}\n\t\t}));\n\n\t\tthis.imap.on('error', (err) => {\n\t\t\tconsole.log('Error occurred ...');\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\topenInbox(cb) {\n\t\tthis.imap.openBox('INBOX', false, cb);\n\t}\n\n\tstart() {\n\t\tthis.imap.connect();\n\t}\n\n\tisActive() {\n\t\tif (this.imap && this.imap.state && this.imap.state === 'disconnected') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tstop(callback = new Function) {\n\t\tthis.imap.end();\n\t\tthis.imap.once('end', callback);\n\t}\n\n\trestart() {\n\t\tthis.stop(() => {\n\t\t\tconsole.log('Restarting IMAP ....');\n\t\t\tthis.start();\n\t\t});\n\t}\n\n\t// Fetch all UNSEEN messages and pass them for further processing\n\tgetEmails() {\n\t\tthis.imap.search(['UNSEEN'], Meteor.bindEnvironment((err, newEmails) => {\n\t\t\tif (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t\tthrow err;\n\t\t\t}\n\n\t\t\t// newEmails => array containing serials of unseen messages\n\t\t\tif (newEmails.length > 0) {\n\t\t\t\tconst f = this.imap.fetch(newEmails, {\n\t\t\t\t\t// fetch headers & first body part.\n\t\t\t\t\tbodies: ['HEADER.FIELDS (FROM TO DATE MESSAGE-ID)', '1'],\n\t\t\t\t\tstruct: true,\n\t\t\t\t\tmarkSeen: true\n\t\t\t\t});\n\n\t\t\t\tf.on('message', Meteor.bindEnvironment((msg, seqno) => {\n\t\t\t\t\tconst email = {};\n\n\t\t\t\t\tmsg.on('body', (stream, info) => {\n\t\t\t\t\t\tlet headerBuffer = '';\n\t\t\t\t\t\tlet bodyBuffer = '';\n\n\t\t\t\t\t\tstream.on('data', (chunk) => {\n\t\t\t\t\t\t\tif (info.which === '1') {\n\t\t\t\t\t\t\t\tbodyBuffer += chunk.toString('utf8');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\theaderBuffer += chunk.toString('utf8');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tstream.once('end', () => {\n\t\t\t\t\t\t\tif (info.which === '1') {\n\t\t\t\t\t\t\t\temail.body = bodyBuffer;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// parse headers\n\t\t\t\t\t\t\t\temail.headers = IMAP.parseHeader(headerBuffer);\n\n\t\t\t\t\t\t\t\temail.headers.to = email.headers.to[0];\n\t\t\t\t\t\t\t\temail.headers.date = email.headers.date[0];\n\t\t\t\t\t\t\t\temail.headers.from = email.headers.from[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// On fetched each message, pass it further\n\t\t\t\t\tmsg.once('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\t// delete message from inbox\n\t\t\t\t\t\tif (this.delete) {\n\t\t\t\t\t\t\tthis.imap.seq.addFlags(seqno, 'Deleted', (err) => {\n\t\t\t\t\t\t\t\tif (err) { console.log(`Mark deleted error: ${ err }`); }\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tRocketChat.processDirectEmail(email);\n\t\t\t\t\t}));\n\t\t\t\t}));\n\t\t\t\tf.once('error', (err) => {\n\t\t\t\t\tconsole.log(`Fetch error: ${ err }`);\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\t}\n}\n\nexport class POP3Intercepter {\n\tconstructor() {\n\t\tthis.pop3 = new POP3(RocketChat.settings.get('Direct_Reply_Port'), RocketChat.settings.get('Direct_Reply_Host'), {\n\t\t\tenabletls: !RocketChat.settings.get('Direct_Reply_IgnoreTLS'),\n\t\t\tdebug: RocketChat.settings.get('Direct_Reply_Debug') ? console.log : false\n\t\t});\n\n\t\tthis.totalMsgCount = 0;\n\t\tthis.currentMsgCount = 0;\n\n\t\tthis.pop3.on('connect', Meteor.bindEnvironment(() => {\n\t\t\tthis.pop3.login(RocketChat.settings.get('Direct_Reply_Username'), RocketChat.settings.get('Direct_Reply_Password'));\n\t\t}));\n\n\t\tthis.pop3.on('login', Meteor.bindEnvironment((status) => {\n\t\t\tif (status) {\n\t\t\t\t// run on start\n\t\t\t\tthis.pop3.list();\n\t\t\t} else {\n\t\t\t\tconsole.log('Unable to Log-in ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on getting list of all emails\n\t\tthis.pop3.on('list', Meteor.bindEnvironment((status, msgcount) => {\n\t\t\tif (status) {\n\t\t\t\tif (msgcount > 0) {\n\t\t\t\t\tthis.totalMsgCount = msgcount;\n\t\t\t\t\tthis.currentMsgCount = 1;\n\t\t\t\t\t// Retrieve email\n\t\t\t\t\tthis.pop3.retr(this.currentMsgCount);\n\t\t\t\t} else {\n\t\t\t\t\tthis.pop3.quit();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Get Emails ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on retrieved email\n\t\tthis.pop3.on('retr', Meteor.bindEnvironment((status, msgnumber, data) => {\n\t\t\tif (status) {\n\t\t\t\t// parse raw email data to  JSON object\n\t\t\t\tsimpleParser(data, Meteor.bindEnvironment((err, mail) => {\n\t\t\t\t\tthis.initialProcess(mail);\n\t\t\t\t}));\n\n\t\t\t\tthis.currentMsgCount += 1;\n\n\t\t\t\t// delete email\n\t\t\t\tthis.pop3.dele(msgnumber);\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Retrieve Message ....');\n\t\t\t}\n\t\t}));\n\n\t\t// on email deleted\n\t\tthis.pop3.on('dele', Meteor.bindEnvironment((status) => {\n\t\t\tif (status) {\n\t\t\t\t// get next email\n\t\t\t\tif (this.currentMsgCount <= this.totalMsgCount) {\n\t\t\t\t\tthis.pop3.retr(this.currentMsgCount);\n\t\t\t\t} else {\n\t\t\t\t\t// parsed all messages.. so quitting\n\t\t\t\t\tthis.pop3.quit();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconsole.log('Cannot Delete Message....');\n\t\t\t}\n\t\t}));\n\n\t\t// invalid server state\n\t\tthis.pop3.on('invalid-state', function(cmd) {\n\t\t\tconsole.log(`Invalid state. You tried calling ${ cmd }`);\n\t\t});\n\n\t\t// locked => command already running, not finished yet\n\t\tthis.pop3.on('locked', function(cmd) {\n\t\t\tconsole.log(`Current command has not finished yet. You tried calling ${ cmd }`);\n\t\t});\n\t}\n\n\tinitialProcess(mail) {\n\t\tconst email = {\n\t\t\theaders: {\n\t\t\t\tfrom: mail.from.text,\n\t\t\t\tto: mail.to.text,\n\t\t\t\tdate: mail.date,\n\t\t\t\t'message-id': mail.messageId\n\t\t\t},\n\t\t\tbody: mail.text\n\t\t};\n\n\t\tRocketChat.processDirectEmail(email);\n\t}\n}\n\nexport class POP3Helper {\n\tconstructor() {\n\t\tthis.running = false;\n\t}\n\n\tstart() {\n\t\t// run every x-minutes\n\t\tif (RocketChat.settings.get('Direct_Reply_Frequency')) {\n\t\t\tRocketChat.POP3 = new POP3Intercepter();\n\n\t\t\tthis.running = Meteor.setInterval(() => {\n\t\t\t\t// get new emails and process\n\t\t\t\tRocketChat.POP3 = new POP3Intercepter();\n\t\t\t}, Math.max(RocketChat.settings.get('Direct_Reply_Frequency')*60*1000, 2*60*1000));\n\t\t}\n\t}\n\n\tisActive() {\n\t\treturn this.running;\n\t}\n\n\tstop(callback = new Function) {\n\t\tif (this.isActive()) {\n\t\t\tMeteor.clearInterval(this.running);\n\t\t}\n\t\tcallback();\n\t}\n}\n","// Do not disclose if user exists when password is invalid\nconst _runLoginHandlers = Accounts._runLoginHandlers;\nAccounts._runLoginHandlers = function(methodInvocation, options) {\n\tconst result = _runLoginHandlers.call(Accounts, methodInvocation, options);\n\n\tif (result.error && result.error.reason === 'Incorrect password') {\n\t\tresult.error = new Meteor.Error(403, 'User not found');\n\t}\n\n\treturn result;\n};\n","import moment from 'moment';\n\nRocketChat.callbacks.add('afterSaveMessage', function(message, room) {\n\t// skips this callback if the message was edited and increments it if the edit was way in the past (aka imported)\n\tif (message.editedAt && Math.abs(moment(message.editedAt).diff()) > 60000) {\n\t\t//TODO: Review as I am not sure how else to get around this as the incrementing of the msgs count shouldn't be in this callback\n\t\tRocketChat.models.Rooms.incMsgCountById(message.rid, 1);\n\t\treturn message;\n\t} else if (message.editedAt) {\n\t\t// skips this callback if the message was edited\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\tRocketChat.models.Rooms.incMsgCountById(message.rid, 1);\n\t\treturn message;\n\t}\n\n\t/**\n\t * Chechs if a messages contains a user highlight\n\t *\n\t * @param {string} message\n\t * @param {array|undefined} highlights\n\t *\n\t * @returns {boolean}\n     */\n\tfunction messageContainsHighlight(message, highlights) {\n\t\tif (! highlights || highlights.length === 0) { return false; }\n\n\t\tlet has = false;\n\t\thighlights.some(function(highlight) {\n\t\t\tconst regexp = new RegExp(s.escapeRegExp(highlight), 'i');\n\t\t\tif (regexp.test(message.msg)) {\n\t\t\t\thas = true;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\n\t\treturn has;\n\t}\n\n\tif (room != null) {\n\t\tlet toAll = false;\n\t\tlet toHere = false;\n\t\tconst mentionIds = [];\n\t\tconst highlightsIds = [];\n\t\tconst highlights = RocketChat.models.Users.findUsersByUsernamesWithHighlights(room.usernames, { fields: { '_id': 1, 'settings.preferences.highlights': 1 }}).fetch();\n\n\t\tif (message.mentions != null) {\n\t\t\tmessage.mentions.forEach(function(mention) {\n\t\t\t\tif (!toAll && mention._id === 'all') {\n\t\t\t\t\ttoAll = true;\n\t\t\t\t}\n\t\t\t\tif (!toHere && mention._id === 'here') {\n\t\t\t\t\ttoHere = true;\n\t\t\t\t}\n\t\t\t\tif (mention._id !== message.u._id) {\n\t\t\t\t\tmentionIds.push(mention._id);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\thighlights.forEach(function(user) {\n\t\t\tif (user && user.settings && user.settings.preferences && messageContainsHighlight(message, user.settings.preferences.highlights)) {\n\t\t\t\tif (user._id !== message.u._id) {\n\t\t\t\t\thighlightsIds.push(user._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (room.t === 'd') {\n\t\t\tconst unreadCountDM = RocketChat.settings.get('Unread_Count_DM');\n\n\t\t\tif (unreadCountDM === 'all_messages') {\n\t\t\t\tRocketChat.models.Subscriptions.incUnreadForRoomIdExcludingUserId(room._id, message.u._id);\n\t\t\t} else if (toAll || toHere) {\n\t\t\t\tRocketChat.models.Subscriptions.incGroupMentionsAndUnreadForRoomIdExcludingUserId(room._id, message.u._id, 1, 1);\n\t\t\t} else if ((mentionIds && mentionIds.length > 0) || (highlightsIds && highlightsIds.length > 0)) {\n\t\t\t\tRocketChat.models.Subscriptions.incUserMentionsAndUnreadForRoomIdAndUserIds(room._id, _.compact(_.unique(mentionIds.concat(highlightsIds))), 1, 1);\n\t\t\t}\n\t\t} else {\n\t\t\tconst unreadCount = RocketChat.settings.get('Unread_Count');\n\n\t\t\tif (toAll || toHere) {\n\t\t\t\tlet incUnread = 0;\n\t\t\t\tif (['all_messages', 'group_mentions_only', 'user_and_group_mentions_only'].includes(unreadCount)) {\n\t\t\t\t\tincUnread = 1;\n\t\t\t\t}\n\t\t\t\tRocketChat.models.Subscriptions.incGroupMentionsAndUnreadForRoomIdExcludingUserId(room._id, message.u._id, 1, incUnread);\n\t\t\t} else if ((mentionIds && mentionIds.length > 0) || (highlightsIds && highlightsIds.length > 0)) {\n\t\t\t\tlet incUnread = 0;\n\t\t\t\tif (['all_messages', 'user_mentions_only', 'user_and_group_mentions_only'].includes(unreadCount)) {\n\t\t\t\t\tincUnread = 1;\n\t\t\t\t}\n\t\t\t\tRocketChat.models.Subscriptions.incUserMentionsAndUnreadForRoomIdAndUserIds(room._id, _.compact(_.unique(mentionIds.concat(highlightsIds))), 1, incUnread);\n\t\t\t} else if (unreadCount === 'all_messages') {\n\t\t\t\tRocketChat.models.Subscriptions.incUnreadForRoomIdExcludingUserId(room._id, message.u._id);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Update all the room activity tracker fields\n\tRocketChat.models.Rooms.incMsgCountAndSetLastMessageTimestampById(message.rid, 1, message.ts);\n\n\t// Update all other subscriptions to alert their owners but witout incrementing\n\t// the unread counter, as it is only for mentions and direct messages\n\tRocketChat.models.Subscriptions.setAlertForRoomIdExcludingUserId(message.rid, message.u._id);\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'notifyUsersOnMessage');\n","import {EmailReplyParser as reply} from 'emailreplyparser';\nimport moment from 'moment';\n\nRocketChat.processDirectEmail = function(email) {\n\tfunction sendMessage(email) {\n\t\tconst message = {\n\t\t\tts: new Date(email.headers.date),\n\t\t\tmsg: email.body,\n\t\t\tsentByEmail: true,\n\t\t\tgroupable: false\n\t\t};\n\n\t\tif (message.ts) {\n\t\t\tconst tsDiff = Math.abs(moment(message.ts).diff());\n\t\t\tif (tsDiff > 10000) {\n\t\t\t\tmessage.ts = new Date();\n\t\t\t}\n\t\t} else {\n\t\t\tmessage.ts = new Date();\n\t\t}\n\n\t\tif (message.msg && message.msg.length > RocketChat.settings.get('Message_MaxAllowedSize')) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// reduce new lines in multiline message\n\t\tmessage.msg = message.msg.split('\\n\\n').join('\\n');\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email.headers.from, {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1\n\t\t\t}\n\t\t});\n\t\tif (!user) {\n\t\t\t// user not found\n\t\t\treturn false;\n\t\t}\n\n\t\tconst prevMessage = RocketChat.models.Messages.findOneById(email.headers.mid, {\n\t\t\trid: 1,\n\t\t\tu: 1\n\t\t});\n\t\tif (!prevMessage) {\n\t\t\t// message doesn't exist anymore\n\t\t\treturn false;\n\t\t}\n\t\tmessage.rid = prevMessage.rid;\n\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, user._id);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst roomInfo = RocketChat.models.Rooms.findOneById(message.rid, {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t});\n\n\t\t// check mention\n\t\tif (message.msg.indexOf(`@${ prevMessage.u.username }`) === -1 && roomInfo.t !== 'd') {\n\t\t\tmessage.msg = `@${ prevMessage.u.username } ${ message.msg }`;\n\t\t}\n\n\t\t// reply message link\n\t\tlet prevMessageLink = `[ ](${ Meteor.absoluteUrl().replace(/\\/$/, '') }`;\n\t\tif (roomInfo.t === 'c') {\n\t\t\tprevMessageLink += `/channel/${ roomInfo.name }?msg=${ email.headers.mid }) `;\n\t\t} else if (roomInfo.t === 'd') {\n\t\t\tprevMessageLink += `/direct/${ prevMessage.u.username }?msg=${ email.headers.mid }) `;\n\t\t} else if (roomInfo.t === 'p') {\n\t\t\tprevMessageLink += `/group/${ roomInfo.name }?msg=${ email.headers.mid }) `;\n\t\t}\n\t\t// add reply message link\n\t\tmessage.msg = prevMessageLink + message.msg;\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(message.rid, user._id);\n\t\tif (subscription && subscription.blocked || subscription.blocker) {\n\t\t\t// room is blocked\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((room.muted || []).includes(user.username)) {\n\t\t\t// room is muted\n\t\t\treturn false;\n\t\t}\n\n\t\tif (message.alias == null && RocketChat.settings.get('Message_SetNameToAliasEnabled')) {\n\t\t\tmessage.alias = user.name;\n\t\t}\n\n\t\tRocketChat.metrics.messagesSent.inc(); // TODO This line needs to be moved to it's proper place. See the comments on: https://github.com/RocketChat/Rocket.Chat/pull/5736\n\n\t\treturn RocketChat.sendMessage(user, message, room);\n\t}\n\n\t// Extract/parse reply from email body\n\temail.body = reply.parse_reply(email.body);\n\n\t// if 'To' email format is \"Name <username@domain>\"\n\tif (email.headers.to.indexOf('<') >= 0 && email.headers.to.indexOf('>') >= 0) {\n\t\temail.headers.to = email.headers.to.split('<')[1].split('>')[0];\n\t}\n\n\t// if 'From' email format is \"Name <username@domain>\"\n\tif (email.headers.from.indexOf('<') >= 0 && email.headers.from.indexOf('>') >= 0) {\n\t\temail.headers.from = email.headers.from.split('<')[1].split('>')[0];\n\t}\n\n\t// 'To' email format \"username+messageId@domain\"\n\tif (email.headers.to.indexOf('+') >= 0) {\n\t\t// Valid 'To' format\n\t\temail.headers.mid = email.headers.to.split('@')[0].split('+')[1];\n\t\tsendMessage(email);\n\t} else {\n\t\tconsole.log('Invalid Email....If not. Please report it.');\n\t}\n};\n","/* globals roomTypesCommon*/\nRocketChat.roomTypes = new class roomTypesServer extends roomTypesCommon {\n\t/* add a publish for a room type\n\t@param roomType: room type (e.g.: c (for channels), d (for direct channels))\n\t@param callback: function that will return the publish's data\n\t*/\n\n\tsetPublish(roomType, callback) {\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].publish != null) {\n\t\t\tthrow new Meteor.Error('route-publish-exists', 'Publish for the given type already exists');\n\t\t}\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\tthis.roomTypes[roomType] = {};\n\t\t}\n\t\treturn this.roomTypes[roomType].publish = callback;\n\t}\n\n\tsetRoomFind(roomType, callback) {\n\t\tif (this.roomTypes[roomType] && this.roomTypes[roomType].roomFind != null) {\n\t\t\tthrow new Meteor.Error('room-find-exists', 'Room find for the given type already exists');\n\t\t}\n\t\tif (this.roomTypes[roomType] == null) {\n\t\t\tthis.roomTypes[roomType] = {};\n\t\t}\n\t\treturn this.roomTypes[roomType].roomFind = callback;\n\t}\n\tgetRoomFind(roomType) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].roomFind;\n\t}\n\n\n\t/* run the publish for a room type\n\t@param scope: Meteor publish scope\n\t@param roomType: room type (e.g.: c (for channels), d (for direct channels))\n\t@param identifier: identifier of the room\n\t*/\n\n\trunPublish(scope, roomType, identifier) {\n\t\treturn this.roomTypes[roomType] && this.roomTypes[roomType].publish && this.roomTypes[roomType].publish.call(scope, identifier);\n\t}\n\n};\n","import moment from 'moment';\n\nRocketChat.callbacks.add('afterSaveMessage', function(message, room) {\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\treturn message;\n\t}\n\n\tconst getMessageLink = (room, sub) => {\n\t\tconst roomPath = RocketChat.roomTypes.getRouteLink(room.t, sub);\n\t\tconst path = Meteor.absoluteUrl(roomPath ? roomPath.replace(/^\\//, '') : '');\n\t\tconst style = [\n\t\t\t'color: #fff;',\n\t\t\t'padding: 9px 12px;',\n\t\t\t'border-radius: 4px;',\n\t\t\t'background-color: #04436a;',\n\t\t\t'text-decoration: none;'\n\t\t].join(' ');\n\t\tconst message = TAPi18n.__('Offline_Link_Message');\n\t\treturn `<p style=\"text-align:center;margin-bottom:8px;\"><a style=\"${ style }\" href=\"${ path }\">${ message }</a>`;\n\t};\n\n\tconst divisorMessage = '<hr style=\"margin: 20px auto; border: none; border-bottom: 1px solid #dddddd;\">';\n\tlet messageHTML = s.escapeHTML(message.msg);\n\n\tmessage = RocketChat.callbacks.run('renderMessage', message);\n\tif (message.tokens && message.tokens.length > 0) {\n\t\tmessage.tokens.forEach((token) => {\n\t\t\ttoken.text = token.text.replace(/([^\\$])(\\$[^\\$])/gm, '$1$$$2');\n\t\t\tmessageHTML = messageHTML.replace(token.token, token.text);\n\t\t});\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tlet footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\tmessageHTML = messageHTML.replace(/\\n/gm, '<br/>');\n\n\tconst usersToSendEmail = {};\n\tif (room.t === 'd') {\n\t\tusersToSendEmail[message.rid.replace(message.u._id, '')] = 'direct';\n\t} else {\n\t\tlet isMentionAll = message.mentions.find(mention => mention._id === 'all');\n\n\t\tif (isMentionAll) {\n\t\t\tconst maxMembersForNotification = RocketChat.settings.get('Notifications_Max_Room_Members');\n\t\t\tif (maxMembersForNotification !== 0 && room.usernames.length > maxMembersForNotification) {\n\t\t\t\tisMentionAll = undefined;\n\t\t\t}\n\t\t}\n\n\t\tlet query;\n\t\tif (isMentionAll) {\n\t\t\t// Query all users in room limited by the max room members setting\n\t\t\tquery = RocketChat.models.Subscriptions.findByRoomId(room._id);\n\t\t} else {\n\t\t\t// Query only mentioned users, will be always a few users\n\t\t\tconst userIds = message.mentions.map(mention => mention._id);\n\t\t\tquery = RocketChat.models.Subscriptions.findByRoomIdAndUserIdsOrAllMessages(room._id, userIds);\n\t\t}\n\n\t\tquery.forEach((sub) => {\n\t\t\tif (sub.disableNotifications) {\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tconst emailNotifications = sub.emailNotifications;\n\n\t\t\tif (emailNotifications === 'nothing') {\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tconst mentionedUser = isMentionAll || message.mentions.find(mention => mention._id === sub.u._id);\n\n\t\t\tif (emailNotifications === 'default' || emailNotifications == null) {\n\t\t\t\tif (mentionedUser) {\n\t\t\t\t\treturn usersToSendEmail[sub.u._id] = 'default';\n\t\t\t\t}\n\t\t\t\treturn delete usersToSendEmail[sub.u._id];\n\t\t\t}\n\n\t\t\tif (emailNotifications === 'mentions' && mentionedUser) {\n\t\t\t\treturn usersToSendEmail[sub.u._id] = 'mention';\n\t\t\t}\n\n\t\t\tif (emailNotifications === 'all') {\n\t\t\t\treturn usersToSendEmail[sub.u._id] = 'all';\n\t\t\t}\n\t\t});\n\t}\n\tconst userIdsToSendEmail = Object.keys(usersToSendEmail);\n\n\tlet defaultLink;\n\n\tconst linkByUser = {};\n\tif (RocketChat.roomTypes.hasCustomLink(room.t)) {\n\t\tRocketChat.models.Subscriptions.findByRoomIdAndUserIds(room._id, userIdsToSendEmail).forEach((sub) => {\n\t\t\tlinkByUser[sub.u._id] = getMessageLink(room, sub);\n\t\t});\n\t} else {\n\t\tdefaultLink = getMessageLink(room, {\n\t\t\tname: room.name\n\t\t});\n\t}\n\n\tif (userIdsToSendEmail.length > 0) {\n\t\tconst usersOfMention = RocketChat.models.Users.getUsersToSendOfflineEmail(userIdsToSendEmail).fetch();\n\n\t\tif (usersOfMention && usersOfMention.length > 0) {\n\t\t\tusersOfMention.forEach((user) => {\n\t\t\t\tif (usersToSendEmail[user._id] === 'default') {\n\t\t\t\t\tif (!user.settings || !user.settings.preferences || !user.settings.preferences.emailNotificationMode || user.settings.preferences.emailNotificationMode === 'all') { //Mention/DM\n\t\t\t\t\t\tusersToSendEmail[user._id] = 'mention';\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Checks if user is in the room he/she is mentioned (unless it's public channel)\n\t\t\t\tif (room.t !== 'c' && room.usernames.indexOf(user.username) === -1) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Footer in case direct reply is enabled.\n\t\t\t\tif (RocketChat.settings.get('Direct_Reply_Enable')) {\n\t\t\t\t\tfooter = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer_Direct_Reply') || '');\n\t\t\t\t}\n\n\t\t\t\tlet emailSubject;\n\t\t\t\tswitch (usersToSendEmail[user._id]) {\n\t\t\t\t\tcase 'all':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_Mention_All_Email'), {\n\t\t\t\t\t\t\tuser: message.u.username,\n\t\t\t\t\t\t\troom: room.name || room.label\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'direct':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_DM_Email'), {\n\t\t\t\t\t\t\tuser: message.u.username,\n\t\t\t\t\t\t\troom: room.name\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'mention':\n\t\t\t\t\t\temailSubject = RocketChat.placeholders.replace(RocketChat.settings.get('Offline_Mention_Email'), {\n\t\t\t\t\t\t\tuser: message.u.username,\n\t\t\t\t\t\t\troom: room.name\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tuser.emails.some((email) => {\n\t\t\t\t\tif (email.verified) {\n\t\t\t\t\t\temail = {\n\t\t\t\t\t\t\tto: email.address,\n\t\t\t\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\t\t\t\tsubject: emailSubject,\n\t\t\t\t\t\t\thtml: header + messageHTML + divisorMessage + (linkByUser[user._id] || defaultLink) + footer\n\t\t\t\t\t\t};\n\t\t\t\t\t\t// If direct reply enabled, email content with headers\n\t\t\t\t\t\tif (RocketChat.settings.get('Direct_Reply_Enable')) {\n\t\t\t\t\t\t\temail.headers = {\n\t\t\t\t\t\t\t\t// Reply-To header with format \"username+messageId@domain\"\n\t\t\t\t\t\t\t\t'Reply-To': `${ RocketChat.settings.get('Direct_Reply_Username').split('@')[0].split(RocketChat.settings.get('Direct_Reply_Separator'))[0] }${ RocketChat.settings.get('Direct_Reply_Separator') }${ message._id }@${ RocketChat.settings.get('Direct_Reply_Username').split('@')[1] }`\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tMeteor.defer(() => {\n\t\t\t\t\t\t\tEmail.send(email);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'sendEmailOnMessage');\n","/* globals Push */\nimport moment from 'moment';\n\n/**\n * Replaces @username with full name\n *\n * @param {string} message The message to replace\n * @param {object[]} mentions Array of mentions used to make replacements\n *\n * @returns {string}\n */\nfunction replaceMentionedUsernamesWithFullNames(message, mentions) {\n\tif (!mentions || !mentions.length) {\n\t\treturn message;\n\t}\n\tmentions.forEach((mention) => {\n\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\tif (user && user.name) {\n\t\t\tmessage = message.replace(`@${ mention.username }`, user.name);\n\t\t}\n\t});\n\treturn message;\n}\n\n/**\n * This function returns a string ready to be shown in the notification\n *\n * @param {object} message the message to be parsed\n */\nfunction parseMessageText(message, userId) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\tconst lng = user && user.language || RocketChat.settings.get('language') || 'en';\n\n\tif (!message.msg && message.attachments && message.attachments[0]) {\n\t\tmessage.msg = message.attachments[0].image_type ? TAPi18n.__('User_uploaded_image', {lng}) : TAPi18n.__('User_uploaded_file', {lng});\n\t}\n\tmessage.msg = RocketChat.callbacks.run('beforeNotifyUser', message.msg);\n\n\treturn message.msg;\n}\n/**\n * Send notification to user\n *\n * @param {string} userId The user to notify\n * @param {object} user The sender\n * @param {object} room The room send from\n * @param {number} duration Duration of notification\n */\nfunction notifyDesktopUser(userId, user, message, room, duration) {\n\n\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\tmessage.msg = parseMessageText(message, userId);\n\n\tif (UI_Use_Real_Name) {\n\t\tmessage.msg = replaceMentionedUsernamesWithFullNames(message.msg, message.mentions);\n\t}\n\tlet title = UI_Use_Real_Name ? user.name : `@${ user.username }`;\n\tif (room.t !== 'd' && room.name) {\n\t\ttitle += ` @ #${ room.name }`;\n\t}\n\tRocketChat.Notifications.notifyUser(userId, 'notification', {\n\t\ttitle,\n\t\ttext: message.msg,\n\t\tduration,\n\t\tpayload: {\n\t\t\t_id: message._id,\n\t\t\trid: message.rid,\n\t\t\tsender: message.u,\n\t\t\ttype: room.t,\n\t\t\tname: room.name\n\t\t}\n\t});\n}\n\nfunction notifyAudioUser(userId, message, room) {\n\tRocketChat.Notifications.notifyUser(userId, 'audioNotification', {\n\t\tpayload: {\n\t\t\t_id: message._id,\n\t\t\trid: message.rid,\n\t\t\tsender: message.u,\n\t\t\ttype: room.t,\n\t\t\tname: room.name\n\t\t}\n\t});\n}\n\n/**\n * Checks if a message contains a user highlight\n *\n * @param {string} message\n * @param {array|undefined} highlights\n *\n * @returns {boolean}\n */\nfunction messageContainsHighlight(message, highlights) {\n\tif (! highlights || highlights.length === 0) { return false; }\n\n\tlet has = false;\n\thighlights.some(function(highlight) {\n\t\tconst regexp = new RegExp(s.escapeRegExp(highlight), 'i');\n\t\tif (regexp.test(message.msg)) {\n\t\t\thas = true;\n\t\t\treturn true;\n\t\t}\n\t});\n\n\treturn has;\n}\n\nfunction getBadgeCount(userId) {\n\tconst subscriptions = RocketChat.models.Subscriptions.findUnreadByUserId(userId).fetch();\n\n\treturn subscriptions.reduce((unread, sub) => {\n\t\treturn sub.unread + unread;\n\t}, 0);\n}\nconst sendPushNotifications = (userIdsToPushNotify = [], message, room, push_room, push_username, push_message) => {\n\tif (userIdsToPushNotify.length > 0 && Push.enabled === true) {\n\t\t// send a push notification for each user individually (to get his/her badge count)\n\t\tuserIdsToPushNotify.forEach((userIdToNotify) => {\n\t\t\tRocketChat.PushNotification.send({\n\t\t\t\troomId: message.rid,\n\t\t\t\troomName: push_room,\n\t\t\t\tusername: push_username,\n\t\t\t\tmessage: push_message,\n\t\t\t\tbadge: getBadgeCount(userIdToNotify),\n\t\t\t\tpayload: {\n\t\t\t\t\thost: Meteor.absoluteUrl(),\n\t\t\t\t\trid: message.rid,\n\t\t\t\t\tsender: message.u,\n\t\t\t\t\ttype: room.t,\n\t\t\t\t\tname: room.name\n\t\t\t\t},\n\t\t\t\tusersTo: {\n\t\t\t\t\tuserId: userIdToNotify\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n};\nconst callJoin = (user, rid) => user.active && Meteor.runAsUser(user._id, () => Meteor.call('joinRoom', rid));\nRocketChat.callbacks.add('afterSaveMessage', function(message, room, userId) {\n\n\t// skips this callback if the message was edited\n\tif (message.editedAt) {\n\t\treturn message;\n\t}\n\n\tif (message.ts && Math.abs(moment(message.ts).diff()) > 60000) {\n\t\treturn message;\n\t}\n\n\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\n\t/*\n\tIncrement unread couter if direct messages\n\t */\n\tconst settings = {\n\t\talwaysNotifyDesktopUsers: [],\n\t\tdontNotifyDesktopUsers: [],\n\t\talwaysNotifyMobileUsers: [],\n\t\tdontNotifyMobileUsers: [],\n\t\tdesktopNotificationDurations: {},\n\t\talwaysNotifyAudioUsers: [],\n\t\tdontNotifyAudioUsers: [],\n\t\taudioNotificationValues: {}\n\t};\n\n\t/**\n\t * Checks if a given user can be notified\n\t *\n\t * @param {string} id\n\t * @param {string} type - mobile|desktop\n\t *\n\t * @returns {boolean}\n     */\n\tfunction canBeNotified(id, type) {\n\t\tconst types = {\n\t\t\tmobile: [ 'dontNotifyDesktopUsers', 'alwaysNotifyDesktopUsers' ],\n\t\t\tdesktop: [ 'dontNotifyMobileUsers', 'alwaysNotifyMobileUsers' ],\n\t\t\taudio: [ 'dontNotifyAudioUsers', 'alwaysNotifyAudioUsers' ]\n\t\t};\n\n\t\treturn (settings[types[type][0]].indexOf(id) === -1 || settings[types[type][1]].indexOf(id) !== -1);\n\t}\n\n\t// Don't fetch all users if room exceeds max members\n\tconst maxMembersForNotification = RocketChat.settings.get('Notifications_Max_Room_Members');\n\tconst disableAllMessageNotifications = room.usernames.length > maxMembersForNotification && maxMembersForNotification !== 0;\n\tconst subscriptions = RocketChat.models.Subscriptions.findNotificationPreferencesByRoom(room._id, disableAllMessageNotifications);\n\tconst userIds = [];\n\tsubscriptions.forEach((s) => {\n\t\tuserIds.push(s.u._id);\n\t});\n\tconst userSettings = {};\n\tRocketChat.models.Users.findUsersByIds(userIds, { fields: { 'settings.preferences.audioNotifications': 1, 'settings.preferences.desktopNotifications': 1, 'settings.preferences.mobileNotifications': 1 } }).forEach((user) => {\n\t\tuserSettings[user._id] = user.settings;\n\t});\n\n\tsubscriptions.forEach(subscription => {\n\t\tif (subscription.disableNotifications) {\n\t\t\tsettings.dontNotifyDesktopUsers.push(subscription.u._id);\n\t\t\tsettings.dontNotifyMobileUsers.push(subscription.u._id);\n\t\t\tsettings.dontNotifyAudioUsers.push(subscription.u._id);\n\t\t\treturn;\n\t\t}\n\t\tconst preferences = userSettings[subscription.u._id] ? userSettings[subscription.u._id].preferences || {} : {};\n\t\tconst userAudioNotificationPreference = preferences.audioNotifications !== 'default' ? preferences.audioNotifications : undefined;\n\t\tconst userDesktopNotificationPreference = preferences.desktopNotifications !== 'default' ? preferences.desktopNotifications : undefined;\n\t\tconst userMobileNotificationPreference = preferences.mobileNotifications !== 'default' ? preferences.mobileNotifications : undefined;\n\t\t// Set defaults if they don't exist\n\t\tconst {\n\t\t\taudioNotifications = userAudioNotificationPreference || RocketChat.settings.get('Audio_Notifications_Default_Alert'),\n\t\t\tdesktopNotifications = userDesktopNotificationPreference || RocketChat.settings.get('Desktop_Notifications_Default_Alert'),\n\t\t\tmobilePushNotifications = userMobileNotificationPreference || RocketChat.settings.get('Mobile_Notifications_Default_Alert')\n\t\t} = subscription;\n\t\tif (audioNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyAudioUsers.push(subscription.u._id);\n\t\t}\n\t\tif (desktopNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyDesktopUsers.push(subscription.u._id);\n\t\t} else if (desktopNotifications === 'nothing') {\n\t\t\tsettings.dontNotifyDesktopUsers.push(subscription.u._id);\n\t\t}\n\t\tif (mobilePushNotifications === 'all' && !disableAllMessageNotifications) {\n\t\t\tsettings.alwaysNotifyMobileUsers.push(subscription.u._id);\n\t\t} else if (mobilePushNotifications === 'nothing') {\n\t\t\tsettings.dontNotifyMobileUsers.push(subscription.u._id);\n\t\t}\n\n\t\tsettings.audioNotificationValues[subscription.u._id] = subscription.audioNotificationValue;\n\t\tsettings.desktopNotificationDurations[subscription.u._id] = subscription.desktopNotificationDuration;\n\t});\n\tlet userIdsForAudio = [];\n\tlet userIdsToNotify = [];\n\tlet userIdsToPushNotify = [];\n\tconst mentions = [];\n\n\tconst usersWithHighlights = RocketChat.models.Users.findUsersByUsernamesWithHighlights(room.usernames, { fields: { '_id': 1, 'settings.preferences.highlights': 1 }}).fetch()\n\t\t.filter(user => messageContainsHighlight(message, user.settings.preferences.highlights));\n\n\tlet push_message = ' ';\n\t//Set variables depending on Push Notification settings\n\tif (RocketChat.settings.get('Push_show_message')) {\n\t\tpush_message = parseMessageText(message, userId);\n\t}\n\n\tlet push_username = '';\n\tlet push_room = '';\n\tif (RocketChat.settings.get('Push_show_username_room')) {\n\t\tpush_username = user.username;\n\t\tpush_room = `#${ room.name }`;\n\t}\n\n\tif (room.t == null || room.t === 'd') {\n\t\tconst userOfMentionId = message.rid.replace(message.u._id, '');\n\t\tconst userOfMention = RocketChat.models.Users.findOne({\n\t\t\t_id: userOfMentionId\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tstatusConnection: 1\n\t\t\t}\n\t\t});\n\n\t\t// Always notify Sandstorm\n\t\tif (userOfMention != null) {\n\t\t\tRocketChat.Sandstorm.notify(message, [userOfMention._id],\n\t\t\t\t`@${ user.username }: ${ message.msg }`, 'privateMessage');\n\n\t\t}\n\t\tif ((userOfMention != null) && canBeNotified(userOfMentionId, 'mobile')) {\n\t\t\tconst duration = settings.desktopNotificationDurations[userOfMention._id];\n\t\t\tnotifyDesktopUser(userOfMention._id, user, message, room, duration);\n\t\t}\n\n\t\tif ((userOfMention != null) && canBeNotified(userOfMentionId, 'desktop')) {\n\t\t\tif (Push.enabled === true && userOfMention.statusConnection !== 'online') {\n\t\t\t\tRocketChat.PushNotification.send({\n\t\t\t\t\troomId: message.rid,\n\t\t\t\t\tusername: push_username,\n\t\t\t\t\tmessage: push_message,\n\t\t\t\t\tbadge: getBadgeCount(userOfMention._id),\n\t\t\t\t\tpayload: {\n\t\t\t\t\t\thost: Meteor.absoluteUrl(),\n\t\t\t\t\t\trid: message.rid,\n\t\t\t\t\t\tsender: message.u,\n\t\t\t\t\t\ttype: room.t,\n\t\t\t\t\t\tname: room.name\n\t\t\t\t\t},\n\t\t\t\t\tusersTo: {\n\t\t\t\t\t\tuserId: userOfMention._id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn message;\n\t\t\t}\n\t\t}\n\n\t} else {\n\t\tconst mentionIds = (message.mentions || []).map(({_id}) => _id);\n\t\tconst toAll = mentionIds.includes('all');\n\t\tconst toHere = mentionIds.includes('here');\n\t\tif (mentionIds.length + settings.alwaysNotifyDesktopUsers.length > 0) {\n\t\t\tlet desktopMentionIds = _.union(mentionIds, settings.alwaysNotifyDesktopUsers);\n\t\t\tdesktopMentionIds = _.difference(desktopMentionIds, settings.dontNotifyDesktopUsers);\n\n\t\t\tlet usersOfDesktopMentions = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: desktopMentionIds\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t\tmentions.push(...usersOfDesktopMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfDesktopMentions = _.reject(usersOfDesktopMentions, (usersOfMentionItem) => {\n\t\t\t\t\treturn room.usernames.indexOf(usersOfMentionItem.username) === -1;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tuserIdsToNotify = _.pluck(usersOfDesktopMentions, '_id');\n\t\t}\n\n\t\tif (mentionIds.length + settings.alwaysNotifyMobileUsers.length > 0) {\n\t\t\tlet mobileMentionIds = _.union(mentionIds, settings.alwaysNotifyMobileUsers);\n\t\t\tmobileMentionIds = _.difference(mobileMentionIds, settings.dontNotifyMobileUsers);\n\n\t\t\tlet usersOfMobileMentions = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: mobileMentionIds\n\t\t\t\t},\n\t\t\t\tstatusConnection: {\n\t\t\t\t\t$ne:'online'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tstatusConnection: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t\tmentions.push(...usersOfMobileMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfMobileMentions = _.reject(usersOfMobileMentions, usersOfMentionItem => !room.usernames.includes(usersOfMentionItem.username));\n\t\t\t}\n\n\t\t\tuserIdsToPushNotify = _.pluck(usersOfMobileMentions, '_id');\n\t\t}\n\n\t\tif (mentionIds.length + settings.alwaysNotifyAudioUsers.length > 0) {\n\t\t\tlet audioMentionIds = _.union(mentionIds, settings.alwaysNotifyAudioUsers);\n\t\t\taudioMentionIds = _.difference(audioMentionIds, userIdsToNotify);\n\n\t\t\tlet usersOfAudioMentions = RocketChat.models.Users.find({ _id: { $in: audioMentionIds }, statusConnection: {\n\t\t\t\t$ne:'offline'\n\t\t\t} }, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tactive: 1\n\t\t\t\t}\n\t\t\t}).fetch();\n\t\t\tmentions.push(...usersOfAudioMentions);\n\t\t\tif (room.t !== 'c') {\n\t\t\t\tusersOfAudioMentions = _.reject(usersOfAudioMentions, (usersOfMentionItem) => {\n\t\t\t\t\treturn room.usernames.indexOf(usersOfMentionItem.username) === -1;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tuserIdsForAudio = _.pluck(usersOfAudioMentions, '_id');\n\t\t}\n\n\t\tif (room.t === 'c') {\n\t\t\tmentions.filter(user => !room.usernames.includes(user.username))\n\t\t\t\t.forEach(user =>callJoin(user, room._id));\n\t\t}\n\n\n\t\tif ([toAll, toHere].some(e => e) && room.usernames && room.usernames.length > 0) {\n\t\t\tRocketChat.models.Users.find({\n\t\t\t\tusername: { $in: room.usernames },\n\t\t\t\t_id: { $ne: user._id }\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\t_id: 1,\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tstatus: 1,\n\t\t\t\t\tstatusConnection: 1\n\t\t\t\t}\n\t\t\t}).forEach(function(user) {\n\t\t\t\tif (['online', 'away', 'busy'].includes(user.status) && !(settings.dontNotifyDesktopUsers || []).includes(user._id)) {\n\t\t\t\t\tuserIdsToNotify.push(user._id);\n\t\t\t\t\tuserIdsForAudio.push(user._id);\n\t\t\t\t}\n\t\t\t\tif (toAll && user.statusConnection !== 'online' && !(settings.dontNotifyMobileUsers || []).includes(user._id)) {\n\t\t\t\t\treturn userIdsToPushNotify.push(user._id);\n\t\t\t\t}\n\t\t\t\tif (toAll && user.statusConnection !== 'online') {\n\t\t\t\t\tuserIdsForAudio.push(user._id);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (usersWithHighlights.length > 0) {\n\t\t\tconst highlightsIds = _.pluck(usersWithHighlights, '_id');\n\t\t\tuserIdsForAudio = userIdsForAudio.concat(highlightsIds);\n\t\t\tuserIdsToNotify = userIdsToNotify.concat(highlightsIds);\n\t\t\tuserIdsToPushNotify = userIdsToPushNotify.concat(highlightsIds);\n\t\t}\n\n\t\tuserIdsToNotify = _.without(_.compact(_.unique(userIdsToNotify)), message.u._id);\n\t\tuserIdsToPushNotify = _.without(_.compact(_.unique(userIdsToPushNotify)), message.u._id);\n\t\tuserIdsForAudio = _.without(_.compact(_.unique(userIdsForAudio)), message.u._id);\n\n\t\tfor (const usersOfMentionId of userIdsToNotify) {\n\t\t\tconst duration = settings.desktopNotificationDurations[usersOfMentionId];\n\t\t\tnotifyDesktopUser(usersOfMentionId, user, message, room, duration);\n\t\t}\n\t\tfor (const usersOfMentionId of userIdsForAudio) {\n\t\t\tnotifyAudioUser(usersOfMentionId, message, room);\n\t\t}\n\t\tsendPushNotifications(userIdsToPushNotify, message, room, push_room, push_username, push_message);\n\n\t\tconst allUserIdsToNotify = _.unique(userIdsToNotify.concat(userIdsToPushNotify));\n\t\tRocketChat.Sandstorm.notify(message, allUserIdsToNotify,\n\t\t\t`@${ user.username }: ${ message.msg }`, room.t === 'p' ? 'privateMessage' : 'message');\n\t}\n\n\treturn message;\n\n}, RocketChat.callbacks.priority.LOW, 'sendNotificationOnMessage');\n","const dns = Npm.require('dns');\n\nlet emailDomainBlackList = [];\nlet emailDomainWhiteList = [];\nlet useDefaultBlackList = false;\nlet useDNSDomainCheck = false;\n\nRocketChat.settings.get('Accounts_BlockedDomainsList', function(key, value) {\n\temailDomainBlackList = _.map(value.split(','), (domain) => domain.trim());\n});\nRocketChat.settings.get('Accounts_AllowedDomainsList', function(key, value) {\n\temailDomainWhiteList = _.map(value.split(','), (domain) => domain.trim());\n});\nRocketChat.settings.get('Accounts_UseDefaultBlockedDomainsList', function(key, value) {\n\tuseDefaultBlackList = value;\n});\nRocketChat.settings.get('Accounts_UseDNSDomainCheck', function(key, value) {\n\tuseDNSDomainCheck = value;\n});\n\nRocketChat.validateEmailDomain = function(email) {\n\tconst emailValidation = /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\tif (!emailValidation.test(email)) {\n\t\tthrow new Meteor.Error('error-invalid-email', `Invalid email ${ email }`, { function: 'RocketChat.validateEmailDomain', email });\n\t}\n\n\tconst emailDomain = email.substr(email.lastIndexOf('@') + 1);\n\n\t// if not in whitelist\n\tif (emailDomainWhiteList.indexOf(emailDomain) === -1) {\n\t\tif (emailDomainBlackList.indexOf(emailDomain) !== -1 || (useDefaultBlackList && RocketChat.emailDomainDefaultBlackList.indexOf(emailDomain) !== -1)) {\n\t\t\tthrow new Meteor.Error('error-email-domain-blacklisted', 'The email domain is blacklisted', { function: 'RocketChat.validateEmailDomain' });\n\t\t}\n\t}\n\n\tif (useDNSDomainCheck) {\n\t\ttry {\n\t\t\tMeteor.wrapAsync(dns.resolveMx)(emailDomain);\n\t\t} catch (e) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain', 'Invalid domain', { function: 'RocketChat.validateEmailDomain' });\n\t\t}\n\t}\n};\n","import fs from 'fs';\n\nfunction hasDockerEnv() {\n\ttry {\n\t\tfs.statSync('/.dockerenv');\n\t\treturn true;\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\nfunction hasDockerCGroup() {\n\ttry {\n\t\treturn fs.readFileSync('/proc/self/cgroup', 'utf8').indexOf('docker') !== -1;\n\t} catch (err) {\n\t\treturn false;\n\t}\n}\n\nfunction check() {\n\treturn hasDockerEnv() || hasDockerCGroup();\n}\n\nlet isDocker;\nRocketChat.isDocker = function() {\n\tif (isDocker === undefined) {\n\t\tisDocker = check();\n\t}\n\n\treturn isDocker;\n};\n","RocketChat.addUserToDefaultChannels = function(user, silenced) {\n\tRocketChat.callbacks.run('beforeJoinDefaultChannels', user);\n\tconst defaultRooms = RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c', 'p'], {fields: {usernames: 0}}).fetch();\n\tdefaultRooms.forEach((room) => {\n\n\t\t// put user in default rooms\n\t\tconst muted = room.ro && !RocketChat.authz.hasPermission(user._id, 'post-readonly');\n\t\tRocketChat.models.Rooms.addUsernameById(room._id, user.username, muted);\n\n\t\tif (!RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id)) {\n\n\t\t\t// Add a subscription to this user\n\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\tts: new Date(),\n\t\t\t\topen: true,\n\t\t\t\talert: true,\n\t\t\t\tunread: 1,\n\t\t\t\tuserMentions: 1,\n\t\t\t\tgroupMentions: 0\n\t\t\t});\n\n\t\t\t// Insert user joined message\n\t\t\tif (!silenced) {\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(room._id, user);\n\t\t\t}\n\t\t}\n\t});\n};\n","RocketChat.addUserToRoom = function(rid, user, inviter, silenced) {\n\tconst now = new Date();\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t// Check if user is already in room\n\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\tif (subscription) {\n\t\treturn;\n\t}\n\n\tif (room.t === 'c' || room.t === 'p') {\n\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t}\n\n\tconst muted = room.ro && !RocketChat.authz.hasPermission(user._id, 'post-readonly');\n\tRocketChat.models.Rooms.addUsernameById(rid, user.username, muted);\n\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\tts: now,\n\t\topen: true,\n\t\talert: true,\n\t\tunread: 1,\n\t\tuserMentions: 1,\n\t\tgroupMentions: 0\n\t});\n\n\tif (!silenced) {\n\t\tif (inviter) {\n\t\t\tRocketChat.models.Messages.createUserAddedWithRoomIdAndUser(rid, user, {\n\t\t\t\tts: now,\n\t\t\t\tu: {\n\t\t\t\t\t_id: inviter._id,\n\t\t\t\t\tusername: inviter.username\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, { ts: now });\n\t\t}\n\t}\n\n\tif (room.t === 'c' || room.t === 'p') {\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t});\n\t}\n\n\treturn true;\n};\n","RocketChat.archiveRoom = function(rid) {\n\tRocketChat.models.Rooms.archiveById(rid);\n\tRocketChat.models.Subscriptions.archiveByRoomId(rid);\n\n\tRocketChat.callbacks.run('afterRoomArchived', RocketChat.models.Rooms.findOneById(rid), Meteor.user());\n};\n","RocketChat.checkUsernameAvailability = function(username) {\n\treturn RocketChat.settings.get('Accounts_BlockedUsernameList', function(key, value) {\n\t\tconst usernameBlackList = _.map(value.split(','), function(username) {\n\t\t\treturn username.trim();\n\t\t});\n\t\tif (usernameBlackList.length !== 0) {\n\t\t\tif (usernameBlackList.every(restrictedUsername => {\n\t\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(restrictedUsername) }$`, 'i');\n\t\t\t\treturn !regex.test(s.trim(s.escapeRegExp(username)));\n\t\t\t})) {\n\t\t\t\treturn !Meteor.users.findOne({\n\t\t\t\t\tusername: {\n\t\t\t\t\t\t$regex: new RegExp(`^${ s.trim(s.escapeRegExp(username)) }$`, 'i')\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t});\n};\n","RocketChat.checkEmailAvailability = function(email) {\n\treturn !Meteor.users.findOne({ 'emails.address': { $regex : new RegExp(`^${ s.trim(s.escapeRegExp(email)) }$`, 'i') } });\n};\n","/* globals RocketChat */\nRocketChat.createRoom = function(type, name, owner, members, readOnly, extraData={}) {\n\tname = s.trim(name);\n\towner = s.trim(owner);\n\tmembers = [].concat(members);\n\n\tif (!name) {\n\t\tthrow new Meteor.Error('error-invalid-name', 'Invalid name', { function: 'RocketChat.createRoom' });\n\t}\n\n\towner = RocketChat.models.Users.findOneByUsername(owner, { fields: { username: 1 }});\n\tif (!owner) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: 'RocketChat.createRoom' });\n\t}\n\n\tconst slugifiedRoomName = RocketChat.getValidRoomName(name);\n\n\tconst now = new Date();\n\tif (!_.contains(members, owner.username)) {\n\t\tmembers.push(owner.username);\n\t}\n\n\tif (type === 'c') {\n\t\tRocketChat.callbacks.run('beforeCreateChannel', owner, {\n\t\t\tt: 'c',\n\t\t\tname: slugifiedRoomName,\n\t\t\tfname: name,\n\t\t\tts: now,\n\t\t\tro: readOnly === true,\n\t\t\tsysMes: readOnly !== true,\n\t\t\tusernames: members,\n\t\t\tu: {\n\t\t\t\t_id: owner._id,\n\t\t\t\tusername: owner.username\n\t\t\t}\n\t\t});\n\t}\n\n\textraData = Object.assign({}, extraData, {\n\t\tts: now,\n\t\tro: readOnly === true,\n\t\tsysMes: readOnly !== true\n\t});\n\n\tconst room = RocketChat.models.Rooms.createWithTypeNameUserAndUsernames(type, slugifiedRoomName, name, owner, members, extraData);\n\n\tfor (const username of members) {\n\t\tconst member = RocketChat.models.Users.findOneByUsername(username, { fields: { username: 1 }});\n\t\tif (!member) {\n\t\t\tcontinue;\n\t\t}\n\n\t\t// make all room members muted by default, unless they have the post-readonly permission\n\t\tif (readOnly === true && !RocketChat.authz.hasPermission(member._id, 'post-readonly')) {\n\t\t\tRocketChat.models.Rooms.muteUsernameByRoomId(room._id, username);\n\t\t}\n\n\t\tconst extra = { open: true };\n\n\t\tif (username === owner.username) {\n\t\t\textra.ls = now;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, member, extra);\n\t}\n\n\tRocketChat.authz.addUserRoles(owner._id, ['owner'], room._id);\n\n\tif (type === 'c') {\n\t\tMeteor.defer(() => {\n\t\t\tRocketChat.callbacks.run('afterCreateChannel', owner, room);\n\t\t});\n\t} else if (type === 'p') {\n\t\tMeteor.defer(() => {\n\t\t\tRocketChat.callbacks.run('afterCreatePrivateGroup', owner, room);\n\t\t});\n\t}\n\n\treturn {\n\t\trid: room._id,\n\t\tname: slugifiedRoomName\n\t};\n};\n","/* globals FileUpload */\nRocketChat.deleteMessage = function(message, user) {\n\tconst keepHistory = RocketChat.settings.get('Message_KeepHistory');\n\tconst showDeletedStatus = RocketChat.settings.get('Message_ShowDeletedStatus');\n\tlet deletedMsg;\n\n\tif (keepHistory) {\n\t\tif (showDeletedStatus) {\n\t\t\tRocketChat.models.Messages.cloneAndSaveAsHistoryById(message._id);\n\t\t} else {\n\t\t\tRocketChat.models.Messages.setHiddenById(message._id, true);\n\t\t}\n\n\t\tif (message.file && message.file._id) {\n\t\t\tRocketChat.models.Uploads.update(message.file._id, { $set: { _hidden: true } });\n\t\t}\n\t} else {\n\t\tif (!showDeletedStatus) {\n\t\t\tdeletedMsg = RocketChat.models.Messages.findOneById(message._id);\n\t\t\tRocketChat.models.Messages.removeById(message._id);\n\t\t}\n\n\t\tif (message.file && message.file._id) {\n\t\t\tFileUpload.getStore('Uploads').deleteById(message.file._id);\n\t\t}\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterDeleteMessage', deletedMsg);\n\t\t});\n\t}\n\n\tif (showDeletedStatus) {\n\t\tRocketChat.models.Messages.setAsDeletedByIdAndUser(message._id, user);\n\t} else {\n\t\tRocketChat.Notifications.notifyRoom(message.rid, 'deleteMessage', { _id: message._id });\n\t}\n};\n","RocketChat.deleteUser = function(userId) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\tRocketChat.models.Messages.removeByUserId(userId); // Remove user messages\n\tRocketChat.models.Subscriptions.findByUserId(userId).forEach((subscription) => {\n\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\tif (room) {\n\t\t\tif (room.t !== 'c' && room.usernames.length === 1) {\n\t\t\t\tRocketChat.models.Rooms.removeById(subscription.rid); // Remove non-channel rooms with only 1 user (the one being deleted)\n\t\t\t}\n\t\t\tif (room.t === 'd') {\n\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(subscription.rid);\n\t\t\t\tRocketChat.models.Messages.removeByRoomId(subscription.rid);\n\t\t\t}\n\t\t}\n\t});\n\n\tRocketChat.models.Subscriptions.removeByUserId(userId); // Remove user subscriptions\n\tRocketChat.models.Rooms.removeByTypeContainingUsername('d', user.username); // Remove direct rooms with the user\n\tRocketChat.models.Rooms.removeUsernameFromAll(user.username); // Remove user from all other rooms\n\n\t// removes user's avatar\n\tif (user.avatarOrigin === 'upload' || user.avatarOrigin === 'url') {\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t}\n\n\tRocketChat.models.Integrations.disableByUserId(userId); // Disables all the integrations which rely on the user being deleted.\n\n\tRocketChat.models.Users.removeById(userId); // Remove user from users database\n};\n","/* globals RocketChat */\nRocketChat.getFullUserData = function({userId, filter, limit}) {\n\tlet fields = {\n\t\tname: 1,\n\t\tusername: 1,\n\t\tstatus: 1,\n\t\tutcOffset: 1,\n\t\ttype: 1,\n\t\tactive: 1\n\t};\n\n\tif (RocketChat.authz.hasPermission(userId, 'view-full-other-user-info')) {\n\t\tfields = _.extend(fields, {\n\t\t\temails: 1,\n\t\t\tphone: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tcreatedAt: 1,\n\t\t\tlastLogin: 1,\n\t\t\tservices: 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\troles: 1,\n\t\t\tcustomFields: 1\n\t\t});\n\t} else if (limit !== 0) {\n\t\tlimit = 1;\n\t}\n\n\tfilter = s.trim(filter);\n\n\tif (!filter && limit === 1) {\n\t\treturn undefined;\n\t}\n\n\tconst options = {\n\t\tfields,\n\t\tlimit,\n\t\tsort: { username: 1 }\n\t};\n\n\tif (filter) {\n\t\tif (limit === 1) {\n\t\t\treturn RocketChat.models.Users.findByUsername(filter, options);\n\t\t} else {\n\t\t\tconst filterReg = new RegExp(s.escapeRegExp(filter), 'i');\n\t\t\treturn RocketChat.models.Users.findByUsernameNameOrEmailAddress(filterReg, options);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Users.find({}, options);\n};\n","/* globals RocketChat */\nRocketChat.getRoomByNameOrIdWithOptionToJoin = function _getRoomByNameOrIdWithOptionToJoin({ currentUserId, nameOrId, type='', tryDirectByUserIdOnly=false, joinChannel=true, errorOnEmpty=true }) {\n\tlet room;\n\n\t//If the nameOrId starts with #, then let's try to find a channel or group\n\tif (nameOrId.startsWith('#')) {\n\t\tnameOrId = nameOrId.substring(1);\n\t\troom = RocketChat.models.Rooms.findOneByIdOrName(nameOrId);\n\t} else if (nameOrId.startsWith('@') || type === 'd') {\n\t\t//If the nameOrId starts with @ OR type is 'd', then let's try just a direct message\n\t\tnameOrId = nameOrId.replace('@', '');\n\n\t\tlet roomUser;\n\t\tif (tryDirectByUserIdOnly) {\n\t\t\troomUser = RocketChat.models.Users.findOneById(nameOrId);\n\t\t} else {\n\t\t\troomUser = RocketChat.models.Users.findOne({\n\t\t\t\t$or: [{ _id: nameOrId }, { username: nameOrId }]\n\t\t\t});\n\t\t}\n\n\t\tconst rid = _.isObject(roomUser) ? [currentUserId, roomUser._id].sort().join('') : nameOrId;\n\t\troom = RocketChat.models.Rooms.findOneById(rid);\n\n\t\t//If the room hasn't been found yet, let's try some more\n\t\tif (!_.isObject(room)) {\n\t\t\t//If the roomUser wasn't found, then there's no destination to point towards\n\t\t\t//so return out based upon errorOnEmpty\n\t\t\tif (!_.isObject(roomUser)) {\n\t\t\t\tif (errorOnEmpty) {\n\t\t\t\t\tthrow new Meteor.Error('invalid-channel');\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\troom = Meteor.runAsUser(currentUserId, function() {\n\t\t\t\tconst {rid} = Meteor.call('createDirectMessage', roomUser.username);\n\t\t\t\treturn RocketChat.models.Rooms.findOneById(rid);\n\t\t\t});\n\t\t}\n\t} else {\n\t\t//Otherwise, we'll treat this as a channel or group.\n\t\troom = RocketChat.models.Rooms.findOneByIdOrName(nameOrId);\n\t}\n\n\t//If no room was found, handle the room return based upon errorOnEmpty\n\tif (!room && errorOnEmpty) {\n\t\tthrow new Meteor.Error('invalid-channel');\n\t} else if (!room) {\n\t\treturn;\n\t}\n\n\t//If a room was found and they provided a type to search, then check\n\t//and if the type found isn't what we're looking for then handle\n\t//the return based upon errorOnEmpty\n\tif (type && room.t !== type) {\n\t\tif (errorOnEmpty) {\n\t\t\tthrow new Meteor.Error('invalid-channel');\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t}\n\n\t//If the room type is channel and joinChannel has been passed, try to join them\n\t//if they can't join the room, this will error out!\n\tif (room.t === 'c' && joinChannel) {\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, currentUserId);\n\n\t\tif (!sub) {\n\t\t\tMeteor.runAsUser(currentUserId, function() {\n\t\t\t\treturn Meteor.call('joinRoom', room._id);\n\t\t\t});\n\t\t}\n\t}\n\n\treturn room;\n};\n","RocketChat.removeUserFromRoom = function(rid, user) {\n\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\tif (room) {\n\t\tRocketChat.callbacks.run('beforeLeaveRoom', user, room);\n\t\tRocketChat.models.Rooms.removeUsernameById(rid, user.username);\n\n\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\tconst removedUser = user;\n\t\t\tRocketChat.models.Messages.createUserLeaveWithRoomIdAndUser(rid, removedUser);\n\t\t}\n\n\t\tif (room.t === 'l') {\n\t\t\tRocketChat.models.Messages.createCommandWithRoomIdAndUser('survey', rid, user);\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(rid, user._id);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLeaveRoom', user, room);\n\t\t});\n\t}\n};\n","/* globals Gravatar */\nRocketChat.saveUser = function(userId, userData) {\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\tconst existingRoles = _.pluck(RocketChat.authz.getRoles(), '_id');\n\n\tif (userData._id && userId !== userData._id && !RocketChat.authz.hasPermission(userId, 'edit-other-user-info')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing user is not allowed', { method: 'insertOrUpdateUser', action: 'Editing_user' });\n\t}\n\n\tif (!userData._id && !RocketChat.authz.hasPermission(userId, 'create-user')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Adding user is not allowed', { method: 'insertOrUpdateUser', action: 'Adding_user' });\n\t}\n\n\tif (userData.roles && _.difference(userData.roles, existingRoles).length > 0) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'The field Roles consist invalid role name', { method: 'insertOrUpdateUser', action: 'Assign_role' });\n\t}\n\n\tif (userData.roles && _.indexOf(userData.roles, 'admin') >= 0 && !RocketChat.authz.hasPermission(userId, 'assign-admin-role')) {\n\t\tthrow new Meteor.Error('error-action-not-allowed', 'Assigning admin is not allowed', { method: 'insertOrUpdateUser', action: 'Assign_admin' });\n\t}\n\n\tif (!userData._id && !s.trim(userData.name)) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Name is required', { method: 'insertOrUpdateUser', field: 'Name' });\n\t}\n\n\tif (!userData._id && !s.trim(userData.username)) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Username is required', { method: 'insertOrUpdateUser', field: 'Username' });\n\t}\n\n\tlet nameValidation;\n\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (e) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\n\tif (userData.username && !nameValidation.test(userData.username)) {\n\t\tthrow new Meteor.Error('error-input-is-not-a-valid-field', `${ _.escape(userData.username) } is not a valid username`, { method: 'insertOrUpdateUser', input: userData.username, field: 'Username' });\n\t}\n\n\tif (!userData._id && !userData.password) {\n\t\tthrow new Meteor.Error('error-the-field-is-required', 'The field Password is required', { method: 'insertOrUpdateUser', field: 'Password' });\n\t}\n\n\tif (!userData._id) {\n\t\tif (!RocketChat.checkUsernameAvailability(userData.username)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `${ _.escape(userData.username) } is already in use :(`, { method: 'insertOrUpdateUser', field: userData.username });\n\t\t}\n\n\t\tif (userData.email && !RocketChat.checkEmailAvailability(userData.email)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `${ _.escape(userData.email) } is already in use :(`, { method: 'insertOrUpdateUser', field: userData.email });\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(userData.email);\n\n\t\t// insert user\n\t\tconst createUser = {\n\t\t\tusername: userData.username,\n\t\t\tpassword: userData.password,\n\t\t\tjoinDefaultChannels: userData.joinDefaultChannels\n\t\t};\n\t\tif (userData.email) {\n\t\t\tcreateUser.email = userData.email;\n\t\t}\n\n\t\tconst _id = Accounts.createUser(createUser);\n\n\t\tconst updateUser = {\n\t\t\t$set: {\n\t\t\t\tname: userData.name,\n\t\t\t\troles: userData.roles || ['user']\n\t\t\t}\n\t\t};\n\n\t\tif (typeof userData.requirePasswordChange !== 'undefined') {\n\t\t\tupdateUser.$set.requirePasswordChange = userData.requirePasswordChange;\n\t\t}\n\n\t\tif (userData.verified) {\n\t\t\tupdateUser.$set['emails.0.verified'] = true;\n\t\t}\n\n\t\tMeteor.users.update({ _id }, updateUser);\n\n\t\tif (userData.sendWelcomeEmail) {\n\t\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\t\t\tlet subject;\n\t\t\tlet html;\n\n\t\t\tif (RocketChat.settings.get('Accounts_UserAddedEmail_Customized')) {\n\t\t\t\tsubject = RocketChat.settings.get('Accounts_UserAddedEmailSubject');\n\t\t\t\thtml = RocketChat.settings.get('Accounts_UserAddedEmail');\n\t\t\t} else {\n\t\t\t\tsubject = TAPi18n.__('Accounts_UserAddedEmailSubject_Default', { lng: user.language || RocketChat.settings.get('language') || 'en' });\n\t\t\t\thtml = TAPi18n.__('Accounts_UserAddedEmail_Default', { lng: user.language || RocketChat.settings.get('language') || 'en' });\n\t\t\t}\n\n\t\t\tsubject = RocketChat.placeholders.replace(subject);\n\t\t\thtml = RocketChat.placeholders.replace(html, {\n\t\t\t\tname: userData.name,\n\t\t\t\temail: userData.email,\n\t\t\t\tpassword: userData.password\n\t\t\t});\n\n\t\t\tconst email = {\n\t\t\t\tto: userData.email,\n\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\tsubject,\n\t\t\t\thtml: header + html + footer\n\t\t\t};\n\n\t\t\tMeteor.defer(function() {\n\t\t\t\ttry {\n\t\t\t\t\tEmail.send(email);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, { function: 'RocketChat.saveUser', message: error.message });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tuserData._id = _id;\n\n\t\tif (RocketChat.settings.get('Accounts_SetDefaultAvatar') === true && userData.email) {\n\t\t\tconst gravatarUrl = Gravatar.imageUrl(userData.email, {default: '404', size: 200, secure: true});\n\n\t\t\ttry {\n\t\t\t\tRocketChat.setUserAvatar(userData, gravatarUrl, '', 'url');\n\t\t\t} catch (e) {\n\t\t\t\t//Ignore this error for now, as it not being successful isn't bad\n\t\t\t}\n\t\t}\n\n\t\treturn _id;\n\t} else {\n\t\t// update user\n\t\tif (userData.username) {\n\t\t\tRocketChat.setUsername(userData._id, userData.username);\n\t\t}\n\n\t\tif (userData.name) {\n\t\t\tRocketChat.setRealName(userData._id, userData.name);\n\t\t}\n\n\t\tif (userData.email) {\n\t\t\tRocketChat.setEmail(userData._id, userData.email);\n\t\t}\n\n\t\tif (userData.password && userData.password.trim() && RocketChat.authz.hasPermission(userId, 'edit-other-user-password')) {\n\t\t\tAccounts.setPassword(userData._id, userData.password.trim());\n\t\t}\n\n\t\tconst updateUser = {\n\t\t\t$set: {}\n\t\t};\n\n\t\tif (userData.roles) {\n\t\t\tupdateUser.$set.roles = userData.roles;\n\t\t}\n\n\t\tif (typeof userData.requirePasswordChange !== 'undefined') {\n\t\t\tupdateUser.$set.requirePasswordChange = userData.requirePasswordChange;\n\t\t}\n\n\t\tif (userData.verified) {\n\t\t\tupdateUser.$set['emails.0.verified'] = userData.verified;\n\t\t}\n\n\t\tMeteor.users.update({ _id: userData._id }, updateUser);\n\n\t\treturn true;\n\t}\n};\n","RocketChat.saveCustomFields = function(userId, formData) {\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) !== '') {\n\t\tRocketChat.validateCustomFields(formData);\n\t\treturn RocketChat.saveCustomFieldsWithoutValidation(userId, formData);\n\t}\n};\n","RocketChat.saveCustomFieldsWithoutValidation = function(userId, formData) {\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) !== '') {\n\t\tlet customFieldsMeta;\n\t\ttry {\n\t\t\tcustomFieldsMeta = JSON.parse(RocketChat.settings.get('Accounts_CustomFields'));\n\t\t} catch (e) {\n\t\t\tthrow new Meteor.Error('error-invalid-customfield-json', 'Invalid JSON for Custom Fields');\n\t\t}\n\n\t\tconst customFields = {};\n\t\tObject.keys(customFieldsMeta).forEach(key => customFields[key] = formData[key]);\n\t\tRocketChat.models.Users.setCustomFields(userId, customFields);\n\n\t\tObject.keys(customFields).forEach((fieldName) => {\n\t\t\tif (!customFieldsMeta[fieldName].modifyRecordField) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst modifyRecordField = customFieldsMeta[fieldName].modifyRecordField;\n\t\t\tconst update = {};\n\t\t\tif (modifyRecordField.array) {\n\t\t\t\tupdate.$addToSet = {};\n\t\t\t\tupdate.$addToSet[modifyRecordField.field] = customFields[fieldName];\n\t\t\t} else {\n\t\t\t\tupdate.$set = {};\n\t\t\t\tupdate.$set[modifyRecordField.field] = customFields[fieldName];\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.update(userId, update);\n\t\t});\n\t}\n};\n","RocketChat.sendMessage = function(user, message, room, upsert = false) {\n\tif (!user || !message || !room._id) {\n\t\treturn false;\n\t}\n\tif (message.ts == null) {\n\t\tmessage.ts = new Date();\n\t}\n\tmessage.u = _.pick(user, ['_id', 'username', 'name']);\n\tif (!Match.test(message.msg, String)) {\n\t\tmessage.msg = '';\n\t}\n\tmessage.rid = room._id;\n\tif (!room.usernames || room.usernames.length === 0) {\n\t\tconst updated_room = RocketChat.models.Rooms.findOneById(room._id);\n\t\tif (updated_room != null) {\n\t\t\troom = updated_room;\n\t\t} else {\n\t\t\troom.usernames = [];\n\t\t}\n\t}\n\tif (message.parseUrls !== false) {\n\t\tconst urls = message.msg.match(/([A-Za-z]{3,9}):\\/\\/([-;:&=\\+\\$,\\w]+@{1})?([-A-Za-z0-9\\.]+)+:?(\\d+)?((\\/[-\\+=!:~%\\/\\.@\\,\\(\\)\\w]*)?\\??([-\\+=&!:;%@\\/\\.\\,\\w]+)?(?:#([^\\s\\)]+))?)?/g);\n\n\t\tif (urls) {\n\t\t\tmessage.urls = urls.map(function(url) {\n\t\t\t\treturn {\n\t\t\t\t\turl\n\t\t\t\t};\n\t\t\t});\n\t\t}\n\t}\n\tmessage = RocketChat.callbacks.run('beforeSaveMessage', message);\n\tif (message) {\n\t\t// Avoid saving sandstormSessionId to the database\n\t\tlet sandstormSessionId = null;\n\t\tif (message.sandstormSessionId) {\n\t\t\tsandstormSessionId = message.sandstormSessionId;\n\t\t\tdelete message.sandstormSessionId;\n\t\t}\n\t\tif (message._id && upsert) {\n\t\t\tconst _id = message._id;\n\t\t\tdelete message._id;\n\t\t\tRocketChat.models.Messages.upsert({\n\t\t\t\t_id,\n\t\t\t\t'u._id': message.u._id\n\t\t\t}, message);\n\t\t\tmessage._id = _id;\n\t\t} else {\n\t\t\tmessage._id = RocketChat.models.Messages.insert(message);\n\t\t}\n\n\t\t/*\n\t\tDefer other updates as their return is not interesting to the user\n\t\t*/\n\t\tMeteor.defer(() => {\n\t\t\t// Execute all callbacks\n\t\t\tmessage.sandstormSessionId = sandstormSessionId;\n\t\t\treturn RocketChat.callbacks.run('afterSaveMessage', message, room, user._id);\n\t\t});\n\t\treturn message;\n\t}\n};\n","const blockedSettings = {};\n\nif (process.env.SETTINGS_BLOCKED) {\n\tprocess.env.SETTINGS_BLOCKED.split(',').forEach((settingId) => blockedSettings[settingId] = 1);\n}\n\nconst hiddenSettings = {};\nif (process.env.SETTINGS_HIDDEN) {\n\tprocess.env.SETTINGS_HIDDEN.split(',').forEach((settingId) => hiddenSettings[settingId] = 1);\n}\n\nRocketChat.settings._sorter = {};\n\n\n/*\n* Add a setting\n* @param {String} _id\n* @param {Mixed} value\n* @param {Object} setting\n*/\n\nRocketChat.settings.add = function(_id, value, options = {}) {\n\tif (options == null) {\n\t\toptions = {};\n\t}\n\tif (!_id || value == null) {\n\t\treturn false;\n\t}\n\tif (RocketChat.settings._sorter[options.group] == null) {\n\t\tRocketChat.settings._sorter[options.group] = 0;\n\t}\n\toptions.packageValue = value;\n\toptions.valueSource = 'packageValue';\n\toptions.hidden = options.hidden || false;\n\toptions.blocked = options.blocked || false;\n\tif (options.sorter == null) {\n\t\toptions.sorter = RocketChat.settings._sorter[options.group]++;\n\t}\n\tif (options.enableQuery != null) {\n\t\toptions.enableQuery = JSON.stringify(options.enableQuery);\n\t}\n\tif (options.i18nDefaultQuery != null) {\n\t\toptions.i18nDefaultQuery = JSON.stringify(options.i18nDefaultQuery);\n\t}\n\tif (typeof process !== 'undefined' && process.env && process.env[_id]) {\n\t\tvalue = process.env[_id];\n\t\tif (value.toLowerCase() === 'true') {\n\t\t\tvalue = true;\n\t\t} else if (value.toLowerCase() === 'false') {\n\t\t\tvalue = false;\n\t\t}\n\t\toptions.processEnvValue = value;\n\t\toptions.valueSource = 'processEnvValue';\n\t} else if (Meteor.settings && typeof Meteor.settings[_id] !== 'undefined') {\n\t\tif (Meteor.settings[_id] == null) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvalue = Meteor.settings[_id];\n\t\toptions.meteorSettingsValue = value;\n\t\toptions.valueSource = 'meteorSettingsValue';\n\t}\n\tif (options.i18nLabel == null) {\n\t\toptions.i18nLabel = _id;\n\t}\n\tif (options.i18nDescription == null) {\n\t\toptions.i18nDescription = `${ _id }_Description`;\n\t}\n\tif (blockedSettings[_id] != null) {\n\t\toptions.blocked = true;\n\t}\n\tif (hiddenSettings[_id] != null) {\n\t\toptions.hidden = true;\n\t}\n\tif (typeof process !== 'undefined' && process.env && process.env[`OVERWRITE_SETTING_${ _id }`]) {\n\t\tlet value = process.env[`OVERWRITE_SETTING_${ _id }`];\n\t\tif (value.toLowerCase() === 'true') {\n\t\t\tvalue = true;\n\t\t} else if (value.toLowerCase() === 'false') {\n\t\t\tvalue = false;\n\t\t}\n\t\toptions.value = value;\n\t\toptions.processEnvValue = value;\n\t\toptions.valueSource = 'processEnvValue';\n\t}\n\tconst updateOperations = {\n\t\t$set: options,\n\t\t$setOnInsert: {\n\t\t\tcreatedAt: new Date\n\t\t}\n\t};\n\tif (options.editor != null) {\n\t\tupdateOperations.$setOnInsert.editor = options.editor;\n\t\tdelete options.editor;\n\t}\n\tif (options.value == null) {\n\t\tif (options.force === true) {\n\t\t\tupdateOperations.$set.value = options.packageValue;\n\t\t} else {\n\t\t\tupdateOperations.$setOnInsert.value = value;\n\t\t}\n\t}\n\tconst query = _.extend({\n\t\t_id\n\t}, updateOperations.$set);\n\tif (options.section == null) {\n\t\tupdateOperations.$unset = {\n\t\t\tsection: 1\n\t\t};\n\t\tquery.section = {\n\t\t\t$exists: false\n\t\t};\n\t}\n\tconst existantSetting = RocketChat.models.Settings.db.findOne(query);\n\tif (existantSetting != null) {\n\t\tif (existantSetting.editor == null && updateOperations.$setOnInsert.editor != null) {\n\t\t\tupdateOperations.$set.editor = updateOperations.$setOnInsert.editor;\n\t\t\tdelete updateOperations.$setOnInsert.editor;\n\t\t}\n\t} else {\n\t\tupdateOperations.$set.ts = new Date;\n\t}\n\treturn RocketChat.models.Settings.upsert({\n\t\t_id\n\t}, updateOperations);\n};\n\n\n/*\n* Add a setting group\n* @param {String} _id\n*/\n\nRocketChat.settings.addGroup = function(_id, options = {}, cb) {\n\tif (!_id) {\n\t\treturn false;\n\t}\n\tif (_.isFunction(options)) {\n\t\tcb = options;\n\t\toptions = {};\n\t}\n\tif (options.i18nLabel == null) {\n\t\toptions.i18nLabel = _id;\n\t}\n\tif (options.i18nDescription == null) {\n\t\toptions.i18nDescription = `${ _id }_Description`;\n\t}\n\toptions.ts = new Date;\n\toptions.blocked = false;\n\toptions.hidden = false;\n\tif (blockedSettings[_id] != null) {\n\t\toptions.blocked = true;\n\t}\n\tif (hiddenSettings[_id] != null) {\n\t\toptions.hidden = true;\n\t}\n\tRocketChat.models.Settings.upsert({\n\t\t_id\n\t}, {\n\t\t$set: options,\n\t\t$setOnInsert: {\n\t\t\ttype: 'group',\n\t\t\tcreatedAt: new Date\n\t\t}\n\t});\n\tif (cb != null) {\n\t\tcb.call({\n\t\t\tadd(id, value, options) {\n\t\t\t\tif (options == null) {\n\t\t\t\t\toptions = {};\n\t\t\t\t}\n\t\t\t\toptions.group = _id;\n\t\t\t\treturn RocketChat.settings.add(id, value, options);\n\t\t\t},\n\t\t\tsection(section, cb) {\n\t\t\t\treturn cb.call({\n\t\t\t\t\tadd(id, value, options) {\n\t\t\t\t\t\tif (options == null) {\n\t\t\t\t\t\t\toptions = {};\n\t\t\t\t\t\t}\n\t\t\t\t\t\toptions.group = _id;\n\t\t\t\t\t\toptions.section = section;\n\t\t\t\t\t\treturn RocketChat.settings.add(id, value, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n};\n\n\n/*\n* Remove a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.removeById = function(_id) {\n\tif (!_id) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.removeById(_id);\n};\n\n\n/*\n* Update a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.updateById = function(_id, value, editor) {\n\tif (!_id || value == null) {\n\t\treturn false;\n\t}\n\tif (editor != null) {\n\t\treturn RocketChat.models.Settings.updateValueAndEditorById(_id, value, editor);\n\t}\n\treturn RocketChat.models.Settings.updateValueById(_id, value);\n};\n\n\n/*\n* Update options of a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.updateOptionsById = function(_id, options) {\n\tif (!_id || options == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.updateOptionsById(_id, options);\n};\n\n\n/*\n* Update a setting by id\n* @param {String} _id\n*/\n\nRocketChat.settings.clearById = function(_id) {\n\tif (_id == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.models.Settings.updateValueById(_id, undefined);\n};\n\n\n/*\n* Update a setting by id\n*/\n\nRocketChat.settings.init = function() {\n\tRocketChat.settings.initialLoad = true;\n\tRocketChat.models.Settings.find().observe({\n\t\tadded(record) {\n\t\t\tMeteor.settings[record._id] = record.value;\n\t\t\tif (record.env === true) {\n\t\t\t\tprocess.env[record._id] = record.value;\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, record.value, RocketChat.settings.initialLoad);\n\t\t},\n\t\tchanged(record) {\n\t\t\tMeteor.settings[record._id] = record.value;\n\t\t\tif (record.env === true) {\n\t\t\t\tprocess.env[record._id] = record.value;\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, record.value, RocketChat.settings.initialLoad);\n\t\t},\n\t\tremoved(record) {\n\t\t\tdelete Meteor.settings[record._id];\n\t\t\tif (record.env === true) {\n\t\t\t\tdelete process.env[record._id];\n\t\t\t}\n\t\t\treturn RocketChat.settings.load(record._id, undefined, RocketChat.settings.initialLoad);\n\t\t}\n\t});\n\tRocketChat.settings.initialLoad = false;\n\tRocketChat.settings.afterInitialLoad.forEach(fn => fn(Meteor.settings));\n};\n\nRocketChat.settings.afterInitialLoad = [];\n\nRocketChat.settings.onAfterInitialLoad = function(fn) {\n\tRocketChat.settings.afterInitialLoad.push(fn);\n\tif (RocketChat.settings.initialLoad === false) {\n\t\treturn fn(Meteor.settings);\n\t}\n};\n","RocketChat.setUserAvatar = function(user, dataURI, contentType, service) {\n\tlet encoding;\n\tlet image;\n\n\tif (service === 'initials') {\n\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t} else if (service === 'url') {\n\t\tlet result = null;\n\n\t\ttry {\n\t\t\tresult = HTTP.get(dataURI, { npmRequestOptions: {encoding: 'binary'} });\n\t\t} catch (error) {\n\t\t\tif (!error.response || error.response.statusCode !== 404) {\n\t\t\t\tconsole.log(`Error while handling the setting of the avatar from a url (${ dataURI }) for ${ user.username }:`, error);\n\t\t\t\tthrow new Meteor.Error('error-avatar-url-handling', `Error while handling avatar setting from a URL (${ dataURI }) for ${ user.username }`, { function: 'RocketChat.setUserAvatar', url: dataURI, username: user.username });\n\t\t\t}\n\t\t}\n\n\t\tif (result.statusCode !== 200) {\n\t\t\tconsole.log(`Not a valid response, ${ result.statusCode }, from the avatar url: ${ dataURI }`);\n\t\t\tthrow new Meteor.Error('error-avatar-invalid-url', `Invalid avatar URL: ${ dataURI }`, { function: 'RocketChat.setUserAvatar', url: dataURI });\n\t\t}\n\n\t\tif (!/image\\/.+/.test(result.headers['content-type'])) {\n\t\t\tconsole.log(`Not a valid content-type from the provided url, ${ result.headers['content-type'] }, from the avatar url: ${ dataURI }`);\n\t\t\tthrow new Meteor.Error('error-avatar-invalid-url', `Invalid avatar URL: ${ dataURI }`, { function: 'RocketChat.setUserAvatar', url: dataURI });\n\t\t}\n\n\t\tencoding = 'binary';\n\t\timage = result.content;\n\t\tcontentType = result.headers['content-type'];\n\t} else if (service === 'rest') {\n\t\tencoding = 'binary';\n\t\timage = dataURI;\n\t} else {\n\t\tconst fileData = RocketChatFile.dataURIParse(dataURI);\n\t\tencoding = 'base64';\n\t\timage = fileData.image;\n\t\tcontentType = fileData.contentType;\n\t}\n\n\tconst buffer = new Buffer(image, encoding);\n\tconst fileStore = FileUpload.getStore('Avatars');\n\tfileStore.deleteByName(user.username);\n\n\tconst file = {\n\t\tuserId: user._id,\n\t\ttype: contentType,\n\t\tsize: buffer.length\n\t};\n\n\tfileStore.insert(file, buffer, () => {\n\t\tMeteor.setTimeout(function() {\n\t\t\tRocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {username: user.username});\n\t\t}, 500);\n\t});\n};\n","\nRocketChat._setUsername = function(userId, u) {\n\tconst username = s.trim(u);\n\tif (!userId || !username) {\n\t\treturn false;\n\t}\n\tlet nameValidation;\n\ttry {\n\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t} catch (error) {\n\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t}\n\tif (!nameValidation.test(username)) {\n\t\treturn false;\n\t}\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\t// User already has desired username, return\n\tif (user.username === username) {\n\t\treturn user;\n\t}\n\tconst previousUsername = user.username;\n\t// Check username availability or if the user already owns a different casing of the name\n\tif (!previousUsername || !(username.toLowerCase() === previousUsername.toLowerCase())) {\n\t\tif (!RocketChat.checkUsernameAvailability(username)) {\n\t\t\treturn false;\n\t\t}\n\t}\n\t//If first time setting username, send Enrollment Email\n\ttry {\n\t\tif (!previousUsername && user.emails && user.emails.length > 0 && RocketChat.settings.get('Accounts_Enrollment_Email')) {\n\t\t\tAccounts.sendEnrollmentEmail(user._id);\n\t\t}\n\t} catch (e) {\n\t\tconsole.error(e);\n\t}\n\t/* globals getAvatarSuggestionForUser */\n\tuser.username = username;\n\tif (!previousUsername && RocketChat.settings.get('Accounts_SetDefaultAvatar') === true) {\n\t\tconst avatarSuggestions = getAvatarSuggestionForUser(user);\n\t\tlet gravatar;\n\t\tObject.keys(avatarSuggestions).some(service => {\n\t\t\tconst avatarData = avatarSuggestions[service];\n\t\t\tif (service !== 'gravatar') {\n\t\t\t\tRocketChat.setUserAvatar(user, avatarData.blob, avatarData.contentType, service);\n\t\t\t\tgravatar = null;\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\tgravatar = avatarData;\n\t\t\t}\n\t\t});\n\t\tif (gravatar != null) {\n\t\t\tRocketChat.setUserAvatar(user, gravatar.blob, gravatar.contentType, 'gravatar');\n\t\t}\n\t}\n\t// Username is available; if coming from old username, update all references\n\tif (previousUsername) {\n\t\tRocketChat.models.Messages.updateAllUsernamesByUserId(user._id, username);\n\t\tRocketChat.models.Messages.updateUsernameOfEditByUserId(user._id, username);\n\t\tRocketChat.models.Messages.findByMention(previousUsername).forEach(function(msg) {\n\t\t\tconst updatedMsg = msg.msg.replace(new RegExp(`@${ previousUsername }`, 'ig'), `@${ username }`);\n\t\t\treturn RocketChat.models.Messages.updateUsernameAndMessageOfMentionByIdAndOldUsername(msg._id, previousUsername, username, updatedMsg);\n\t\t});\n\t\tRocketChat.models.Rooms.replaceUsername(previousUsername, username);\n\t\tRocketChat.models.Rooms.replaceMutedUsername(previousUsername, username);\n\t\tRocketChat.models.Rooms.replaceUsernameOfUserByUserId(user._id, username);\n\t\tRocketChat.models.Subscriptions.setUserUsernameByUserId(user._id, username);\n\t\tRocketChat.models.Subscriptions.setNameForDirectRoomsWithOldName(previousUsername, username);\n\n\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\tconst file = fileStore.model.findOneByName(previousUsername);\n\t\tif (file) {\n\t\t\tfileStore.model.updateFileNameById(file._id, username);\n\t\t}\n\t}\n\t// Set new username*\n\tRocketChat.models.Users.setUsername(user._id, username);\n\treturn user;\n};\n\nRocketChat.setUsername = RocketChat.RateLimiter.limitFunction(RocketChat._setUsername, 1, 60000, {\n\t[0](userId) {\n\t\treturn !userId || !RocketChat.authz.hasPermission(userId, 'edit-other-user-info');\n\t}\n});\n","RocketChat._setRealName = function(userId, name) {\n\tname = s.trim(name);\n\tif (!userId || !name) {\n\t\treturn false;\n\t}\n\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t// User already has desired name, return\n\tif (user.name === name) {\n\t\treturn user;\n\t}\n\n\t// Set new name\n\tRocketChat.models.Users.setName(user._id, name);\n\tuser.name = name;\n\n\tif (RocketChat.settings.get('UI_Use_Real_Name') === true) {\n\t\tRocketChat.Notifications.notifyLogged('Users:NameChanged', {\n\t\t\t_id: user._id,\n\t\t\tname: user.name,\n\t\t\tusername: user.username\n\t\t});\n\t}\n\n\treturn user;\n};\n\nRocketChat.setRealName = RocketChat.RateLimiter.limitFunction(RocketChat._setRealName, 1, 60000, {\n\t0() { return !Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-info'); } // Administrators have permission to change others names, so don't limit those\n});\n","RocketChat._setEmail = function(userId, email) {\n\temail = s.trim(email);\n\tif (!userId) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: '_setEmail' });\n\t}\n\n\tif (!email) {\n\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email', { function: '_setEmail' });\n\t}\n\n\tRocketChat.validateEmailDomain(email);\n\n\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t// User already has desired username, return\n\tif (user.emails && user.emails[0] && user.emails[0].address === email) {\n\t\treturn user;\n\t}\n\n\t// Check email availability\n\tif (!RocketChat.checkEmailAvailability(email)) {\n\t\tthrow new Meteor.Error('error-field-unavailable', `${ email } is already in use :(`, { function: '_setEmail', field: email });\n\t}\n\n\t// Set new email\n\tRocketChat.models.Users.setEmail(user._id, email);\n\tuser.email = email;\n\treturn user;\n};\n\nRocketChat.setEmail = RocketChat.RateLimiter.limitFunction(RocketChat._setEmail, 1, 60000, {\n\t0() { return !Meteor.userId() || !RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-info'); } // Administrators have permission to change others emails, so don't limit those\n});\n","RocketChat.unarchiveRoom = function(rid) {\n\tRocketChat.models.Rooms.unarchiveById(rid);\n\tRocketChat.models.Subscriptions.unarchiveByRoomId(rid);\n};\n","RocketChat.updateMessage = function(message, user) {\n\t// If we keep history of edits, insert a new message to store history information\n\tif (RocketChat.settings.get('Message_KeepHistory')) {\n\t\tRocketChat.models.Messages.cloneAndSaveAsHistoryById(message._id);\n\t}\n\n\tmessage.editedAt = new Date();\n\tmessage.editedBy = {\n\t\t_id: user._id,\n\t\tusername: user.username\n\t};\n\n\tconst urls = message.msg.match(/([A-Za-z]{3,9}):\\/\\/([-;:&=\\+\\$,\\w]+@{1})?([-A-Za-z0-9\\.]+)+:?(\\d+)?((\\/[-\\+=!:~%\\/\\.@\\,\\w]*)?\\??([-\\+=&!:;%@\\/\\.\\,\\w]+)?(?:#([^\\s\\)]+))?)?/g);\n\tif (urls) {\n\t\tmessage.urls = urls.map((url) => { return { url }; });\n\t}\n\n\tmessage = RocketChat.callbacks.run('beforeSaveMessage', message);\n\n\tconst tempid = message._id;\n\tdelete message._id;\n\n\tRocketChat.models.Messages.update({ _id: tempid }, { $set: message });\n\n\tconst room = RocketChat.models.Rooms.findOneById(message.rid);\n\n\tMeteor.defer(function() {\n\t\tRocketChat.callbacks.run('afterSaveMessage', RocketChat.models.Messages.findOneById(tempid), room, user._id);\n\t});\n};\n","RocketChat.validateCustomFields = function(fields) {\n\t// Special Case:\n\t// If an admin didn't set any custom fields there's nothing to validate against so consider any customFields valid\n\tif (s.trim(RocketChat.settings.get('Accounts_CustomFields')) === '') {\n\t\treturn;\n\t}\n\n\tlet customFieldsMeta;\n\ttry {\n\t\tcustomFieldsMeta = JSON.parse(RocketChat.settings.get('Accounts_CustomFields'));\n\t} catch (e) {\n\t\tthrow new Meteor.Error('error-invalid-customfield-json', 'Invalid JSON for Custom Fields');\n\t}\n\n\tconst customFields = {};\n\n\tObject.keys(customFieldsMeta).forEach((fieldName) => {\n\t\tconst field = customFieldsMeta[fieldName];\n\n\t\tcustomFields[fieldName] = fields[fieldName];\n\t\tconst fieldValue = s.trim(fields[fieldName]);\n\n\t\tif (field.required && fieldValue === '') {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Field ${ fieldName } is required`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.type === 'select' && field.options.indexOf(fields[fieldName]) === -1) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Value for field ${ fieldName } is invalid`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.maxLength && fieldValue.length > field.maxLength) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Max length of field ${ fieldName } ${ field.maxLength }`, {method: 'registerUser'});\n\t\t}\n\n\t\tif (field.minLength && fieldValue.length < field.minLength) {\n\t\t\tthrow new Meteor.Error('error-user-registration-custom-field', `Min length of field ${ fieldName } ${ field.minLength }`, {method: 'registerUser'});\n\t\t}\n\t});\n};\n","RocketChat.Notifications = new class {\n\tconstructor() {\n\t\tthis.debug = false;\n\t\tthis.streamAll = new Meteor.Streamer('notify-all');\n\t\tthis.streamLogged = new Meteor.Streamer('notify-logged');\n\t\tthis.streamRoom = new Meteor.Streamer('notify-room');\n\t\tthis.streamRoomUsers = new Meteor.Streamer('notify-room-users');\n\t\tthis.streamUser = new Meteor.Streamer('notify-user');\n\t\tthis.streamAll.allowWrite('none');\n\t\tthis.streamLogged.allowWrite('none');\n\t\tthis.streamRoom.allowWrite('none');\n\t\tthis.streamRoomUsers.allowWrite(function(eventName, ...args) {\n\t\t\tconst [roomId, e] = eventName.split('/');\n\t\t\t// const user = Meteor.users.findOne(this.userId, {\n\t\t\t// \tfields: {\n\t\t\t// \t\tusername: 1\n\t\t\t// \t}\n\t\t\t// });\n\t\t\tif (RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, this.userId) != null) {\n\t\t\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdAndNotUserId(roomId, this.userId).fetch();\n\t\t\t\tsubscriptions.forEach(subscription => RocketChat.Notifications.notifyUser(subscription.u._id, e, ...args));\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t\tthis.streamUser.allowWrite('logged');\n\t\tthis.streamAll.allowRead('all');\n\t\tthis.streamLogged.allowRead('logged');\n\t\tthis.streamRoom.allowRead(function(eventName) {\n\t\t\tif (this.userId == null) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst [roomId] = eventName.split('/');\n\t\t\tconst user = Meteor.users.findOne(this.userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\t\tif (!room) {\n\t\t\t\tconsole.warn(`Invalid streamRoom eventName: \"${ eventName }\"`);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tif (room.t === 'l' && room.v._id === user._id) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn room.usernames.indexOf(user.username) > -1;\n\t\t});\n\t\tthis.streamRoomUsers.allowRead('none');\n\t\tthis.streamUser.allowRead(function(eventName) {\n\t\t\tconst [userId] = eventName.split('/');\n\t\t\treturn (this.userId != null) && this.userId === userId;\n\t\t});\n\t}\n\n\tnotifyAll(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyAll', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamAll.emit.apply(this.streamAll, args);\n\t}\n\n\tnotifyLogged(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyLogged', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamLogged.emit.apply(this.streamLogged, args);\n\t}\n\n\tnotifyRoom(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyRoom', arguments);\n\t\t}\n\t\targs.unshift(`${ room }/${ eventName }`);\n\t\treturn this.streamRoom.emit.apply(this.streamRoom, args);\n\t}\n\n\tnotifyUser(userId, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyUser', arguments);\n\t\t}\n\t\targs.unshift(`${ userId }/${ eventName }`);\n\t\treturn this.streamUser.emit.apply(this.streamUser, args);\n\t}\n\n\tnotifyAllInThisInstance(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyAll', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamAll.emitWithoutBroadcast.apply(this.streamAll, args);\n\t}\n\n\tnotifyLoggedInThisInstance(eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyLogged', arguments);\n\t\t}\n\t\targs.unshift(eventName);\n\t\treturn this.streamLogged.emitWithoutBroadcast.apply(this.streamLogged, args);\n\t}\n\n\tnotifyRoomInThisInstance(room, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyRoomAndBroadcast', arguments);\n\t\t}\n\t\targs.unshift(`${ room }/${ eventName }`);\n\t\treturn this.streamRoom.emitWithoutBroadcast.apply(this.streamRoom, args);\n\t}\n\n\tnotifyUserInThisInstance(userId, eventName, ...args) {\n\t\tif (this.debug === true) {\n\t\t\tconsole.log('notifyUserAndBroadcast', arguments);\n\t\t}\n\t\targs.unshift(`${ userId }/${ eventName }`);\n\t\treturn this.streamUser.emitWithoutBroadcast.apply(this.streamUser, args);\n\t}\n};\n\nRocketChat.Notifications.streamRoom.allowWrite(function(eventName, username) {\n\tconst [, e] = eventName.split('/');\n\tif (e === 'webrtc') {\n\t\treturn true;\n\t}\n\tif (e === 'typing') {\n\t\tconst user = Meteor.users.findOne(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\t\tif (user != null && user.username === username) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n});\n","import ModelsBaseDb from './_BaseDb';\nimport ModelsBaseCache from './_BaseCache';\n\nRocketChat.models._CacheControl = new Meteor.EnvironmentVariable();\n\nclass ModelsBase {\n\tconstructor(nameOrModel, useCache) {\n\t\tthis._db = new ModelsBaseDb(nameOrModel, this);\n\t\tthis.model = this._db.model;\n\t\tthis.collectionName = this._db.collectionName;\n\t\tthis.name = this._db.name;\n\n\t\tthis._useCache = useCache === true;\n\n\t\tthis.cache = new ModelsBaseCache(this);\n\t\t// TODO_CACHE: remove\n\t\tthis.on = this.cache.on.bind(this.cache);\n\t\tthis.emit = this.cache.emit.bind(this.cache);\n\t\tthis.getDynamicView = this.cache.getDynamicView.bind(this.cache);\n\t\tthis.processQueryOptionsOnResult = this.cache.processQueryOptionsOnResult.bind(this.cache);\n\t\t// END_TODO_CACHE\n\n\t\tthis.db = this;\n\n\t\tif (this._useCache) {\n\t\t\tthis.db = new this.constructor(this.model, false);\n\t\t}\n\t}\n\n\tget useCache() {\n\t\tif (RocketChat.models._CacheControl.get() === false) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this._useCache;\n\t}\n\n\tget origin() {\n\t\treturn this.useCache === true ? 'cache' : '_db';\n\t}\n\n\tarrayToCursor(data) {\n\t\treturn {\n\t\t\tfetch() {\n\t\t\t\treturn data;\n\t\t\t},\n\t\t\tcount() {\n\t\t\t\treturn data.length;\n\t\t\t},\n\t\t\tforEach(fn) {\n\t\t\t\treturn data.forEach(fn);\n\t\t\t}\n\t\t};\n\t}\n\n\tsetUpdatedAt(/*record, checkQuery, query*/) {\n\t\treturn this._db.setUpdatedAt(...arguments);\n\t}\n\n\tfind() {\n\t\ttry {\n\t\t\treturn this[this.origin].find(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOne() {\n\t\ttry {\n\t\t\treturn this[this.origin].findOne(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOneById() {\n\t\ttry {\n\t\t\treturn this[this.origin].findOneById(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\tcheck(ids, [String]);\n\n\t\ttry {\n\t\t\treturn this[this.origin].findOneByIds(ids, options);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on find', e, ...arguments);\n\t\t}\n\t}\n\n\tinsert(/*record*/) {\n\t\treturn this._db.insert(...arguments);\n\t}\n\n\tupdate(/*query, update, options*/) {\n\t\treturn this._db.update(...arguments);\n\t}\n\n\tupsert(/*query, update*/) {\n\t\treturn this._db.upsert(...arguments);\n\t}\n\n\tremove(/*query*/) {\n\t\treturn this._db.remove(...arguments);\n\t}\n\n\tinsertOrUpsert() {\n\t\treturn this._db.insertOrUpsert(...arguments);\n\t}\n\n\tallow() {\n\t\treturn this._db.allow(...arguments);\n\t}\n\n\tdeny() {\n\t\treturn this._db.deny(...arguments);\n\t}\n\n\tensureIndex() {\n\t\treturn this._db.ensureIndex(...arguments);\n\t}\n\n\tdropIndex() {\n\t\treturn this._db.dropIndex(...arguments);\n\t}\n\n\ttryEnsureIndex() {\n\t\treturn this._db.tryEnsureIndex(...arguments);\n\t}\n\n\ttryDropIndex() {\n\t\treturn this._db.tryDropIndex(...arguments);\n\t}\n\n\ttrashFind(/*query, options*/) {\n\t\treturn this._db.trashFind(...arguments);\n\t}\n\n\ttrashFindDeletedAfter(/*deletedAt, query, options*/) {\n\t\treturn this._db.trashFindDeletedAfter(...arguments);\n\t}\n\n\t// dinamicTrashFindAfter(method, deletedAt, ...args) {\n\t// \tconst scope = {\n\t// \t\tfind: (query={}) => {\n\t// \t\t\treturn this.trashFindDeletedAfter(deletedAt, query, { fields: {_id: 1, _deletedAt: 1} });\n\t// \t\t}\n\t// \t};\n\n\t// \tscope.model = {\n\t// \t\tfind: scope.find\n\t// \t};\n\n\t// \treturn this[method].apply(scope, args);\n\t// }\n\n\t// dinamicFindAfter(method, updatedAt, ...args) {\n\t// \tconst scope = {\n\t// \t\tfind: (query={}, options) => {\n\t// \t\t\tquery._updatedAt = {\n\t// \t\t\t\t$gt: updatedAt\n\t// \t\t\t};\n\n\t// \t\t\treturn this.find(query, options);\n\t// \t\t}\n\t// \t};\n\n\t// \tscope.model = {\n\t// \t\tfind: scope.find\n\t// \t};\n\n\t// \treturn this[method].apply(scope, args);\n\t// }\n\n\t// dinamicFindChangesAfter(method, updatedAt, ...args) {\n\t// \treturn {\n\t// \t\tupdate: this.dinamicFindAfter(method, updatedAt, ...args).fetch(),\n\t// \t\tremove: this.dinamicTrashFindAfter(method, updatedAt, ...args).fetch()\n\t// \t};\n\t// }\n\n}\n\nRocketChat.models._Base = ModelsBase;\n","/* globals InstanceStatus */\n\nRocketChat.models.Avatars = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('avatars');\n\n\t\tthis.model.before.insert((userId, doc) => {\n\t\t\tdoc.instanceId = InstanceStatus.id();\n\t\t});\n\n\t\tthis.tryEnsureIndex({ name: 1 });\n\t}\n\n\tinsertAvatarFileInit(name, userId, store, file, extra) {\n\t\tconst fileData = {\n\t\t\t_id: name,\n\t\t\tname,\n\t\t\tuserId,\n\t\t\tstore,\n\t\t\tcomplete: false,\n\t\t\tuploading: true,\n\t\t\tprogress: 0,\n\t\t\textension: s.strRightBack(file.name, '.'),\n\t\t\tuploadedAt: new Date()\n\t\t};\n\n\t\t_.extend(fileData, file, extra);\n\n\t\treturn this.insertOrUpsert(fileData);\n\t}\n\n\tupdateFileComplete(fileId, userId, file) {\n\t\tif (!fileId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\t_id: fileId,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1\n\t\t\t}\n\t\t};\n\n\t\tupdate.$set = _.extend(file, update.$set);\n\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\tfindOneByName(name) {\n\t\treturn this.findOne({ name });\n\t}\n\n\tupdateFileNameById(fileId, name) {\n\t\tconst filter = { _id: fileId };\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\t// @TODO deprecated\n\tupdateFileCompleteByNameAndUserId(name, userId, url) {\n\t\tif (!name) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\tname,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1,\n\t\t\t\turl\n\t\t\t}\n\t\t};\n\n\t\tif (this.model.direct && this.model.direct.update) {\n\t\t\treturn this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\treturn this.update(filter, update);\n\t\t}\n\t}\n\n\tdeleteFile(fileId) {\n\t\tif (this.model.direct && this.model.direct.remove) {\n\t\t\treturn this.model.direct.remove({ _id: fileId });\n\t\t} else {\n\t\t\treturn this.remove({ _id: fileId });\n\t\t}\n\t}\n};\n","RocketChat.models.Messages = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('message');\n\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'editedAt': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'editedBy._id': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 't': 1, 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'expireAt': 1 }, { expireAfterSeconds: 0 });\n\t\tthis.tryEnsureIndex({ 'msg': 'text' });\n\t\tthis.tryEnsureIndex({ 'file._id': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'mentions.username': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'pinned': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'snippeted': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'location': '2dsphere' });\n\t\tthis.tryEnsureIndex({ 'slackBotId': 1, 'slackTs': 1 }, { sparse: 1 });\n\t}\n\n\t// FIND\n\tfindByMention(username, options) {\n\t\tconst query =\t{'mentions.username': username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByMentionAndRoomId(username, rid, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t'mentions.username': username,\n\t\t\trid\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomId(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdNotContainingTypes(roomId, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\n\t\t\trid: roomId\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindInvisibleByRoomId(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdAfterTimestamp(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestamp(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lt: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestampInclusive(roomId, timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lte: timestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestamps(roomId, afterTimestamp, beforeTimestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: afterTimestamp,\n\t\t\t\t$lt: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestampsInclusive(roomId, afterTimestamp, beforeTimestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gte: afterTimestamp,\n\t\t\t\t$lte: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBeforeTimestampNotContainingTypes(roomId, timestamp, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$lt: timestamp\n\t\t\t}\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleByRoomIdBetweenTimestampsNotContainingTypes(roomId, afterTimestamp, beforeTimestamp, types, options) {\n\t\tconst query = {\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t},\n\t\t\trid: roomId,\n\t\t\tts: {\n\t\t\t\t$gt: afterTimestamp,\n\t\t\t\t$lt: beforeTimestamp\n\t\t\t}\n\t\t};\n\n\t\tif (Match.test(types, [String]) && (types.length > 0)) {\n\t\t\tquery.t =\n\t\t\t{$nin: types};\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindVisibleCreatedOrEditedAfterTimestamp(timestamp, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t$or: [{\n\t\t\t\tts: {\n\t\t\t\t\t$gt: timestamp\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\t'editedAt': {\n\t\t\t\t\t$gt: timestamp\n\t\t\t\t}\n\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindStarredByUserAtRoom(userId, roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\t'starred._id': userId,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindPinnedByRoom(roomId, options) {\n\t\tconst query = {\n\t\t\tt: { $ne: 'rm' },\n\t\t\t_hidden: { $ne: true },\n\t\t\tpinned: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindSnippetedByRoom(roomId, options) {\n\t\tconst query = {\n\t\t\t_hidden: { $ne: true },\n\t\t\tsnippeted: true,\n\t\t\trid: roomId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastTimestamp(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { ts: { $exists: 1 } };\n\t\toptions.sort = { ts: -1 };\n\t\toptions.limit = 1;\n\t\tconst [message] = this.find(query, options).fetch();\n\t\treturn message && message.ts;\n\t}\n\n\tfindByRoomIdAndMessageIds(rid, messageIds, options) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t_id: {\n\t\t\t\t$in: messageIds\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindOneBySlackBotIdAndSlackTs(slackBotId, slackTs) {\n\t\tconst query = {\n\t\t\tslackBotId,\n\t\t\tslackTs\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneBySlackTs(slackTs) {\n\t\tconst query =\t{slackTs};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tcloneAndSaveAsHistoryById(_id) {\n\t\tconst me = RocketChat.models.Users.findOneById(Meteor.userId());\n\t\tconst record = this.findOneById(_id);\n\t\trecord._hidden = true;\n\t\trecord.parent = record._id;\n\t\trecord.editedAt = new Date;\n\t\trecord.editedBy = {\n\t\t\t_id: Meteor.userId(),\n\t\t\tusername: me.username\n\t\t};\n\t\tdelete record._id;\n\t\treturn this.insert(record);\n\t}\n\n\t// UPDATE\n\tsetHiddenById(_id, hidden) {\n\t\tif (hidden == null) { hidden = true; }\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t_hidden: hidden\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsDeletedByIdAndUser(_id, user) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tmsg: '',\n\t\t\t\tt: 'rm',\n\t\t\t\turls: [],\n\t\t\t\tmentions: [],\n\t\t\t\tattachments: [],\n\t\t\t\treactions: [],\n\t\t\t\teditedAt: new Date(),\n\t\t\t\teditedBy: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetPinnedByIdAndUserId(_id, pinnedBy, pinned, pinnedAt) {\n\t\tif (pinned == null) { pinned = true; }\n\t\tif (pinnedAt == null) { pinnedAt = 0; }\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tpinned,\n\t\t\t\tpinnedAt: pinnedAt || new Date,\n\t\t\t\tpinnedBy\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetSnippetedByIdAndUserId(message, snippetName, snippetedBy, snippeted, snippetedAt) {\n\t\tif (snippeted == null) { snippeted = true; }\n\t\tif (snippetedAt == null) { snippetedAt = 0; }\n\t\tconst query =\t{_id: message._id};\n\n\t\tconst msg = `\\`\\`\\`${ message.msg }\\`\\`\\``;\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tmsg,\n\t\t\t\tsnippeted,\n\t\t\t\tsnippetedAt: snippetedAt || new Date,\n\t\t\t\tsnippetedBy,\n\t\t\t\tsnippetName\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetUrlsById(_id, urls) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\turls\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateAllUsernamesByUserId(userId, username) {\n\t\tconst query =\t{'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateUsernameOfEditByUserId(userId, username) {\n\t\tconst query =\t{'editedBy._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'editedBy.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateUsernameAndMessageOfMentionByIdAndOldUsername(_id, oldUsername, newUsername, newMessage) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\t'mentions.username': oldUsername\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'mentions.$.username': newUsername,\n\t\t\t\t'msg': newMessage\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateUserStarById(_id, userId, starred) {\n\t\tlet update;\n\t\tconst query =\t{_id};\n\n\t\tif (starred) {\n\t\t\tupdate = {\n\t\t\t\t$addToSet: {\n\t\t\t\t\tstarred: { _id: userId }\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\tupdate = {\n\t\t\t\t$pull: {\n\t\t\t\t\tstarred: { _id: Meteor.userId() }\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupgradeEtsToEditAt() {\n\t\tconst query =\t{ets: { $exists: 1 }};\n\n\t\tconst update = {\n\t\t\t$rename: {\n\t\t\t\t'ets': 'editedAt'\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetMessageAttachments(_id, attachments) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tattachments\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetSlackBotIdAndSlackTs(_id, slackBotId, slackTs) {\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tslackBotId,\n\t\t\t\tslackTs\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\n\t// INSERT\n\tcreateWithTypeRoomIdMessageAndUser(type, roomId, message, user, extraData) {\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId, { fields: { sysMes: 1 }});\n\t\tif ((room != null ? room.sysMes : undefined) === false) {\n\t\t\treturn;\n\t\t}\n\t\tconst record = {\n\t\t\tt: type,\n\t\t\trid: roomId,\n\t\t\tts: new Date,\n\t\t\tmsg: message,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username\n\t\t\t},\n\t\t\tgroupable: false\n\t\t};\n\n\t\t_.extend(record, extraData);\n\n\t\trecord._id = this.insertOrUpsert(record);\n\t\tRocketChat.models.Rooms.incMsgCountById(room._id, 1);\n\t\treturn record;\n\t}\n\n\tcreateUserJoinWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('uj', roomId, message, user, extraData);\n\t}\n\n\tcreateUserLeaveWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('ul', roomId, message, user, extraData);\n\t}\n\n\tcreateUserRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('ru', roomId, message, user, extraData);\n\t}\n\n\tcreateUserAddedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('au', roomId, message, user, extraData);\n\t}\n\n\tcreateCommandWithRoomIdAndUser(command, roomId, user, extraData) {\n\t\treturn this.createWithTypeRoomIdMessageAndUser('command', roomId, command, user, extraData);\n\t}\n\n\tcreateUserMutedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('user-muted', roomId, message, user, extraData);\n\t}\n\n\tcreateUserUnmutedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('user-unmuted', roomId, message, user, extraData);\n\t}\n\n\tcreateNewModeratorWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-moderator', roomId, message, user, extraData);\n\t}\n\n\tcreateModeratorRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('moderator-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateNewOwnerWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-owner', roomId, message, user, extraData);\n\t}\n\n\tcreateOwnerRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('owner-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateNewLeaderWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('new-leader', roomId, message, user, extraData);\n\t}\n\n\tcreateLeaderRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('leader-removed', roomId, message, user, extraData);\n\t}\n\n\tcreateSubscriptionRoleAddedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('subscription-role-added', roomId, message, user, extraData);\n\t}\n\n\tcreateSubscriptionRoleRemovedWithRoomIdAndUser(roomId, user, extraData) {\n\t\tconst message = user.username;\n\t\treturn this.createWithTypeRoomIdMessageAndUser('subscription-role-removed', roomId, message, user, extraData);\n\t}\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query =\t{_id};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomId(roomId) {\n\t\tconst query =\t{rid: roomId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByUserId(userId) {\n\t\tconst query =\t{'u._id': userId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tgetMessageByFileId(fileID) {\n\t\treturn this.findOne({ 'file._id': fileID });\n\t}\n};\n","RocketChat.models.Reports = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('reports');\n\t}\n\tcreateWithMessageDescriptionAndUserId(message, description, userId, extraData) {\n\t\tconst record = {\n\t\t\tmessage,\n\t\t\tdescription,\n\t\t\tts: new Date(),\n\t\t\tuserId\n\t\t};\n\t\t_.extend(record, extraData);\n\t\trecord._id = this.insert(record);\n\t\treturn record;\n\t}\n};\n","class ModelRooms extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'name': 1 }, { unique: 1, sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'default': 1 });\n\t\tthis.tryEnsureIndex({ 'usernames': 1 });\n\t\tthis.tryEnsureIndex({ 't': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1 });\n\n\t\tthis.cache.ignoreUpdatedFields = ['msgs', 'lm'];\n\t\tthis.cache.ensureIndex(['t', 'name'], 'unique');\n\t\tthis.cache.options = {fields: {usernames: 0}};\n\t}\n\n\tfindOneByIdOrName(_idOrName, options) {\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t_id: _idOrName\n\t\t\t}, {\n\t\t\t\tname: _idOrName\n\t\t\t}]\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByImportId(_id, options) {\n\t\tconst query = {importIds: _id};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByName(name, options) {\n\t\tconst query = {name};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndNotId(name, rid) {\n\t\tconst query = {\n\t\t\t_id: { $ne: rid },\n\t\t\tname\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneByDisplayName(fname, options) {\n\t\tconst query = {fname};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndType(name, type, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByIdContainingUsername(_id, username, options) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByNameAndTypeNotContainingUsername(name, type, username, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type,\n\t\t\tusernames: {\n\t\t\t\t$ne: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\n\t// FIND\n\n\tfindById(roomId, options) {\n\t\treturn this.find({ _id: roomId }, options);\n\t}\n\n\tfindByIds(roomIds, options) {\n\t\treturn this.find({ _id: {$in: [].concat(roomIds)} }, options);\n\t}\n\n\tfindByType(type, options) {\n\t\tconst query = {t: type};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypes(types, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUserId(userId, options) {\n\t\tconst query = {'u._id': userId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindBySubscriptionUserId(userId, options) {\n\t\tlet data;\n\t\tif (this.useCache) {\n\t\t\tdata = RocketChat.models.Subscriptions.findByUserId(userId).fetch();\n\t\t\tdata = data.map(function(item) {\n\t\t\t\tif (item._room) {\n\t\t\t\t\treturn item._room;\n\t\t\t\t}\n\t\t\t\tconsole.log('Empty Room for Subscription', item);\n\t\t\t\treturn {};\n\t\t\t});\n\t\t\treturn this.arrayToCursor(this.processQueryOptionsOnResult(data, options));\n\t\t}\n\n\t\tdata = RocketChat.models.Subscriptions.findByUserId(userId, {fields: {rid: 1}}).fetch();\n\t\tdata = data.map(item => item.rid);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: data\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindBySubscriptionUserIdUpdatedAfter(userId, _updatedAt, options) {\n\t\tif (this.useCache) {\n\t\t\tlet data = RocketChat.models.Subscriptions.findByUserId(userId).fetch();\n\t\t\tdata = data.map(function(item) {\n\t\t\t\tif (item._room) {\n\t\t\t\t\treturn item._room;\n\t\t\t\t}\n\t\t\t\tconsole.log('Empty Room for Subscription', item);\n\t\t\t\treturn {};\n\t\t\t});\n\t\t\tdata = data.filter(item => item._updatedAt > _updatedAt);\n\t\t\treturn this.arrayToCursor(this.processQueryOptionsOnResult(data, options));\n\t\t}\n\n\t\tlet ids = RocketChat.models.Subscriptions.findByUserId(userId, {fields: {rid: 1}}).fetch();\n\t\tids = ids.map(item => item.rid);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: ids\n\t\t\t},\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: _updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContaining(name, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst query = {\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContainingTypesWithUsername(name, types, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst $or = [];\n\t\tfor (const type of Array.from(types)) {\n\t\t\tconst obj = {name: nameRegex, t: type.type};\n\t\t\tif (type.username != null) {\n\t\t\t\tobj.usernames = type.username;\n\t\t\t}\n\t\t\tif (type.ids != null) {\n\t\t\t\tobj._id = {$in: type.ids};\n\t\t\t}\n\t\t\t$or.push(obj);\n\t\t}\n\n\t\tconst query = {$or};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindContainingTypesWithUsername(types, options) {\n\n\t\tconst $or = [];\n\t\tfor (const type of Array.from(types)) {\n\t\t\tconst obj = {t: type.type};\n\t\t\tif (type.username != null) {\n\t\t\t\tobj.usernames = type.username;\n\t\t\t}\n\t\t\tif (type.ids != null) {\n\t\t\t\tobj._id = {$in: type.ids};\n\t\t\t}\n\t\t\t$or.push(obj);\n\t\t}\n\n\t\tconst query = {$or};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameContainingAndTypes(name, types, options) {\n\t\tconst nameRegex = new RegExp(s.trim(s.escapeRegExp(name)), 'i');\n\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByNameAndTypeNotDefault(name, type, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tname,\n\t\t\tdefault: {\n\t\t\t\t$ne: true\n\t\t\t}\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindByNameAndTypeNotContainingUsername(name, type, username, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tname,\n\t\t\tusernames: {\n\t\t\t\t$ne: username\n\t\t\t}\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindByNameStartingAndTypes(name, types, options) {\n\t\tconst nameRegex = new RegExp(`^${ s.trim(s.escapeRegExp(name)) }`, 'i');\n\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{name: nameRegex},\n\t\t\t\t{\n\t\t\t\t\tt: 'd',\n\t\t\t\t\tusernames: nameRegex\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByDefaultAndTypes(defaultValue, types, options) {\n\t\tconst query = {\n\t\t\tdefault: defaultValue,\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeContainingUsername(type, username, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeContainingUsernames(type, username, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: { $all: [].concat(username) }\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypesAndNotUserIdContainingUsername(types, userId, username, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t},\n\t\t\tuid: {\n\t\t\t\t$ne: userId\n\t\t\t},\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByContainingUsername(username, options) {\n\t\tconst query = {usernames: username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndName(type, name, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('t,name', [type, name], options);\n\t\t}\n\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndNameContainingUsername(type, name, username, options) {\n\t\tconst query = {\n\t\t\tname,\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndArchivationState(type, archivationstate, options) {\n\t\tconst query = {t: type};\n\n\t\tif (archivationstate) {\n\t\t\tquery.archived = true;\n\t\t} else {\n\t\t\tquery.archived = { $ne: true };\n\t\t}\n\n\t\treturn this.find(query, options);\n\t}\n\n\t// UPDATE\n\taddImportIds(_id, importIds) {\n\t\timportIds = [].concat(importIds);\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\timportIds: {\n\t\t\t\t\t$each: importIds\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tarchiveById(_id) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tunarchiveById(_id) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernameById(_id, username, muted) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\tif (muted) {\n\t\t\tupdate.$addToSet.muted = username;\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernamesById(_id, usernames) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: {\n\t\t\t\t\t$each: usernames\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\taddUsernameByName(name, username) {\n\t\tconst query = {name};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernameById(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernamesById(_id, usernames) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: {\n\t\t\t\t\t$in: usernames\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveUsernameFromAll(username) {\n\t\tconst query = {usernames: username};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tremoveUsernameByName(name, username) {\n\t\tconst query = {name};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tusernames: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetNameById(_id, name, fname) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname,\n\t\t\t\tfname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tincMsgCountById(_id, inc) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$inc: {\n\t\t\t\tmsgs: inc\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tincMsgCountAndSetLastMessageTimestampById(_id, inc, lastMessageTimestamp) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlm: lastMessageTimestamp\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tmsgs: inc\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\treplaceUsername(previousUsername, username) {\n\t\tconst query = {usernames: previousUsername};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'usernames.$': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\treplaceMutedUsername(previousUsername, username) {\n\t\tconst query = {muted: previousUsername};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'muted.$': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\treplaceUsernameOfUserByUserId(userId, username) {\n\t\tconst query = {'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetJoinCodeById(_id, joinCode) {\n\t\tlet update;\n\t\tconst query = {_id};\n\n\t\tif ((joinCode != null ? joinCode.trim() : undefined) !== '') {\n\t\t\tupdate = {\n\t\t\t\t$set: {\n\t\t\t\t\tjoinCodeRequired: true,\n\t\t\t\t\tjoinCode\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\tupdate = {\n\t\t\t\t$set: {\n\t\t\t\t\tjoinCodeRequired: false\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\tjoinCode: 1\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetUserById(_id, user) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTypeById(_id, type) {\n\t\tconst query = {_id};\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tt: type\n\t\t\t}\n\t\t};\n\t\tif (type === 'p') {\n\t\t\tupdate.$unset = {default: ''};\n\t\t}\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTopicById(_id, topic) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\ttopic\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAnnouncementById(_id, announcement) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tannouncement\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tmuteUsernameByRoomId(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\tmuted: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tunmuteUsernameByRoomId(_id, username) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\tmuted: username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsaveDefaultById(_id, defaultValue) {\n\t\tconst query = {_id};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tdefault: defaultValue === 'true'\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetTopicAndTagsById(_id, topic, tags) {\n\t\tconst setData = {};\n\t\tconst unsetData = {};\n\n\t\tif (topic != null) {\n\t\t\tif (!_.isEmpty(s.trim(topic))) {\n\t\t\t\tsetData.topic = s.trim(topic);\n\t\t\t} else {\n\t\t\t\tunsetData.topic = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (tags != null) {\n\t\t\tif (!_.isEmpty(s.trim(tags))) {\n\t\t\t\tsetData.tags = s.trim(tags).split(',').map(tag => s.trim(tag));\n\t\t\t} else {\n\t\t\t\tunsetData.tags = 1;\n\t\t\t}\n\t\t}\n\n\t\tconst update = {};\n\n\t\tif (!_.isEmpty(setData)) {\n\t\t\tupdate.$set = setData;\n\t\t}\n\n\t\tif (!_.isEmpty(unsetData)) {\n\t\t\tupdate.$unset = unsetData;\n\t\t}\n\n\t\tif (_.isEmpty(update)) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this.update({ _id }, update);\n\t}\n\n\t// INSERT\n\tcreateWithTypeNameUserAndUsernames(type, name, fname, user, usernames, extraData) {\n\t\tconst room = {\n\t\t\tname,\n\t\t\tfname,\n\t\t\tt: type,\n\t\t\tusernames,\n\t\t\tmsgs: 0,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username\n\t\t\t}\n\t\t};\n\n\t\t_.extend(room, extraData);\n\n\t\troom._id = this.insert(room);\n\t\treturn room;\n\t}\n\n\tcreateWithIdTypeAndName(_id, type, name, extraData) {\n\t\tconst room = {\n\t\t\t_id,\n\t\t\tts: new Date(),\n\t\t\tt: type,\n\t\t\tname,\n\t\t\tusernames: [],\n\t\t\tmsgs: 0\n\t\t};\n\n\t\t_.extend(room, extraData);\n\n\t\tthis.insert(room);\n\t\treturn room;\n\t}\n\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query = {_id};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByTypeContainingUsername(type, username) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tusernames: username\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Rooms = new ModelRooms('room', true);\n","class ModelSettings extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'blocked': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'hidden': 1 }, { sparse: 1 });\n\t}\n\n\t// FIND\n\tfindById(_id) {\n\t\tconst query = {_id};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindOneNotHiddenById(_id) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindByIds(_id = []) {\n\t\t_id = [].concat(_id);\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: _id\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindByRole(role, options) {\n\t\tconst query = {role};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindPublic(options) {\n\t\tconst query = {public: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindNotHiddenPublic(ids = []) {\n\t\tconst filter = {\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: true\n\t\t};\n\n\t\tif (ids.length > 0) {\n\t\t\tfilter._id =\n\t\t\t\t{$in: ids};\n\t\t}\n\n\t\treturn this.find(filter, { fields: {_id: 1, value: 1} });\n\t}\n\n\tfindNotHiddenPublicUpdatedAfter(updatedAt) {\n\t\tconst filter = {\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: true,\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(filter, { fields: {_id: 1, value: 1} });\n\t}\n\n\tfindNotHiddenPrivate() {\n\t\treturn this.find({\n\t\t\thidden: { $ne: true },\n\t\t\tpublic: { $ne: true }\n\t\t});\n\t}\n\n\tfindNotHidden(options) {\n\t\treturn this.find({ hidden: { $ne: true } }, options);\n\t}\n\n\tfindNotHiddenUpdatedAfter(updatedAt) {\n\t\treturn this.find({\n\t\t\thidden: { $ne: true },\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t});\n\t}\n\n\t// UPDATE\n\tupdateValueById(_id, value) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\tvalue: { $ne: value },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateValueAndEditorById(_id, value, editor) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\tvalue: { $ne: value },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue,\n\t\t\t\teditor\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateValueNotHiddenById(_id, value) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\thidden: { $ne: true },\n\t\t\tblocked: { $ne: true }\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tvalue\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateOptionsById(_id, options) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\t_id\n\t\t};\n\n\t\tconst update = {$set: options};\n\n\t\treturn this.update(query, update);\n\t}\n\n\t// INSERT\n\tcreateWithIdAndValue(_id, value) {\n\t\tconst record = {\n\t\t\t_id,\n\t\t\tvalue,\n\t\t\t_createdAt: new Date\n\t\t};\n\n\t\treturn this.insert(record);\n\t}\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\tconst query = {\n\t\t\tblocked: { $ne: true },\n\t\t\t_id\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Settings = new ModelSettings('settings', true);\n","class ModelSubscriptions extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'u._id': 1 }, { unique: 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'alert': 1, 'u._id': 1 });\n\t\tthis.tryEnsureIndex({ 'rid': 1, 'roles': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t\tthis.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1, 'code': 1 }, { unique: 1 });\n\t\tthis.tryEnsureIndex({ 'open': 1 });\n\t\tthis.tryEnsureIndex({ 'alert': 1 });\n\t\tthis.tryEnsureIndex({ 'unread': 1 });\n\t\tthis.tryEnsureIndex({ 'ts': 1 });\n\t\tthis.tryEnsureIndex({ 'ls': 1 });\n\t\tthis.tryEnsureIndex({ 'audioNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'desktopNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'mobilePushNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'emailNotifications': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'autoTranslate': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'autoTranslateLanguage': 1 }, { sparse: 1 });\n\n\t\tthis.cache.ensureIndex('rid', 'array');\n\t\tthis.cache.ensureIndex('u._id', 'array');\n\t\tthis.cache.ensureIndex('name', 'array');\n\t\tthis.cache.ensureIndex(['rid', 'u._id'], 'unique');\n\t\tthis.cache.ensureIndex(['name', 'u._id'], 'unique');\n\t}\n\n\n\t// FIND ONE\n\tfindOneByRoomIdAndUserId(roomId, userId) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('rid,u._id', [roomId, userId]).fetch();\n\t\t}\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\tfindOneByRoomNameAndUserId(roomName, userId) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('name,u._id', [roomName, userId]).fetch();\n\t\t}\n\t\tconst query = {\n\t\t\tname: roomName,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.findOne(query);\n\t}\n\n\t// FIND\n\tfindByUserId(userId, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('u._id', userId, options);\n\t\t}\n\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUserIdUpdatedAfter(userId, updatedAt, options) {\n\t\tconst query = {\n\t\t\t'u._id': userId,\n\t\t\t_updatedAt: {\n\t\t\t\t$gt: updatedAt\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\t// FIND\n\tfindByRoomIdAndRoles(roomId, roles, options) {\n\t\troles = [].concat(roles);\n\t\tconst query = {\n\t\t\t'rid': roomId,\n\t\t\t'roles': { $in: roles }\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByType(types, options) {\n\t\tconst query = {\n\t\t\tt: {\n\t\t\t\t$in: types\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeAndUserId(type, userId, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByTypeNameAndUserId(type, name, userId, options) {\n\t\tconst query = {\n\t\t\tt: type,\n\t\t\tname,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByRoomId(roomId, options) {\n\t\tif (this.useCache) {\n\t\t\treturn this.cache.findByIndex('rid', roomId, options);\n\t\t}\n\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByRoomIdAndNotUserId(roomId, userId, options) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastSeen(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { ls: { $exists: 1 } };\n\t\toptions.sort = { ls: -1 };\n\t\toptions.limit = 1;\n\t\tconst [subscription] = this.find(query, options).fetch();\n\t\treturn subscription && subscription.ls;\n\t}\n\n\tfindByRoomIdAndUserIds(roomId, userIds) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$in: userIds\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindByRoomIdAndUserIdsOrAllMessages(roomId, userIds) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t$or: [\n\t\t\t\t{ 'u._id': { $in: userIds } },\n\t\t\t\t{ emailNotifications: 'all' }\n\t\t\t]\n\t\t};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindUnreadByUserId(userId) {\n\t\tconst query = {\n\t\t\t'u._id': userId,\n\t\t\tunread: {\n\t\t\t\t$gt: 0\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, { fields: { unread: 1 } });\n\t}\n\n\t// UPDATE\n\tarchiveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: false,\n\t\t\t\tarchived: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tunarchiveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: true,\n\t\t\t\tarchived: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\thideByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: false,\n\t\t\t\topen: false\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\topenByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsReadByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tls: new Date\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetAsUnreadByRoomIdAndUserId(roomId, userId, firstMessageUnreadTimestamp) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\topen: true,\n\t\t\t\talert: true,\n\t\t\t\tls: firstMessageUnreadTimestamp\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetFavoriteByRoomIdAndUserId(roomId, userId, favorite) {\n\t\tif (favorite == null) { favorite = true; }\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tf: favorite\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateNameAndAlertByRoomId(roomId, name, fname) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname,\n\t\t\t\tfname,\n\t\t\t\talert: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tupdateNameByRoomId(roomId, name) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetUserUsernameByUserId(userId, username) {\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'u.username': username\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetNameForDirectRoomsWithOldName(oldName, name) {\n\t\tconst query = {\n\t\t\tname: oldName,\n\t\t\tt: 'd'\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincUnreadForRoomIdExcludingUserId(roomId, userId, inc) {\n\t\tif (inc == null) { inc = 1; }\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: inc\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincGroupMentionsAndUnreadForRoomIdExcludingUserId(roomId, userId, incGroup = 1, incUnread = 1) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: incUnread,\n\t\t\t\tgroupMentions: incGroup\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tincUserMentionsAndUnreadForRoomIdAndUserIds(roomId, userIds, incUser = 1, incUnread = 1) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$in: userIds\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$inc: {\n\t\t\t\tunread: incUnread,\n\t\t\t\tuserMentions: incUser\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\tsetAlertForRoomIdExcludingUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': {\n\t\t\t\t$ne: userId\n\t\t\t},\n\t\t\t$or: [\n\t\t\t\t{ alert: { $ne: true } },\n\t\t\t\t{ open: { $ne: true } }\n\t\t\t]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\talert: true,\n\t\t\t\topen: true\n\t\t\t}\n\t\t};\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\tsetBlockedByRoomId(rid, blocked, blocker) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t'u._id': blocked\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tblocked: true\n\t\t\t}\n\t\t};\n\n\t\tconst query2 = {\n\t\t\trid,\n\t\t\t'u._id': blocker\n\t\t};\n\n\t\tconst update2 = {\n\t\t\t$set: {\n\t\t\t\tblocker: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update) && this.update(query2, update2);\n\t}\n\n\tunsetBlockedByRoomId(rid, blocked, blocker) {\n\t\tconst query = {\n\t\t\trid,\n\t\t\t'u._id': blocked\n\t\t};\n\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\tblocked: 1\n\t\t\t}\n\t\t};\n\n\t\tconst query2 = {\n\t\t\trid,\n\t\t\t'u._id': blocker\n\t\t};\n\n\t\tconst update2 = {\n\t\t\t$unset: {\n\t\t\t\tblocker: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update) && this.update(query2, update2);\n\t}\n\n\tupdateTypeByRoomId(roomId, type) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tt: type\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\taddRoleById(_id, role) {\n\t\tconst query =\n\t\t\t{_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: role\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tremoveRoleById(_id, role) {\n\t\tconst query =\n\t\t\t{_id};\n\n\t\tconst update = {\n\t\t\t$pull: {\n\t\t\t\troles: role\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetArchivedByUsername(username, archived) {\n\t\tconst query = {\n\t\t\tt: 'd',\n\t\t\tname: username\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tarchived\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update, { multi: true });\n\t}\n\n\t// INSERT\n\tcreateWithRoomAndUser(room, user, extraData) {\n\t\tconst subscription = {\n\t\t\topen: false,\n\t\t\talert: false,\n\t\t\tunread: 0,\n\t\t\tuserMentions: 0,\n\t\t\tgroupMentions: 0,\n\t\t\tts: room.ts,\n\t\t\trid: room._id,\n\t\t\tname: room.name,\n\t\t\tfname: room.fname,\n\t\t\tt: room.t,\n\t\t\tu: {\n\t\t\t\t_id: user._id,\n\t\t\t\tusername: user.username,\n\t\t\t\tname: user.name\n\t\t\t}\n\t\t};\n\n\t\t_.extend(subscription, extraData);\n\n\t\treturn this.insert(subscription);\n\t}\n\n\n\t// REMOVE\n\tremoveByUserId(userId) {\n\t\tconst query =\n\t\t\t{'u._id': userId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomId(roomId) {\n\t\tconst query =\n\t\t\t{rid: roomId};\n\n\t\treturn this.remove(query);\n\t}\n\n\tremoveByRoomIdAndUserId(roomId, userId) {\n\t\tconst query = {\n\t\t\trid: roomId,\n\t\t\t'u._id': userId\n\t\t};\n\n\t\treturn this.remove(query);\n\t}\n}\n\nRocketChat.models.Subscriptions = new ModelSubscriptions('subscription', true);\n","/* globals InstanceStatus */\n\nRocketChat.models.Uploads = new class extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper('uploads');\n\n\t\tthis.model.before.insert((userId, doc) => {\n\t\t\tdoc.instanceId = InstanceStatus.id();\n\t\t});\n\n\t\tthis.tryEnsureIndex({ 'rid': 1 });\n\t\tthis.tryEnsureIndex({ 'uploadedAt': 1 });\n\t}\n\n\tfindNotHiddenFilesOfRoom(roomId, limit) {\n\t\tconst fileQuery = {\n\t\t\trid: roomId,\n\t\t\tcomplete: true,\n\t\t\tuploading: false,\n\t\t\t_hidden: {\n\t\t\t\t$ne: true\n\t\t\t}\n\t\t};\n\n\t\tconst fileOptions = {\n\t\t\tlimit,\n\t\t\tsort: {\n\t\t\t\tuploadedAt: -1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tuserId: 1,\n\t\t\t\trid: 1,\n\t\t\t\tname: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\ttype: 1,\n\t\t\t\turl: 1,\n\t\t\t\tuploadedAt: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(fileQuery, fileOptions);\n\t}\n\n\tinsertFileInit(userId, store, file, extra) {\n\t\tconst fileData = {\n\t\t\tuserId,\n\t\t\tstore,\n\t\t\tcomplete: false,\n\t\t\tuploading: true,\n\t\t\tprogress: 0,\n\t\t\textension: s.strRightBack(file.name, '.'),\n\t\t\tuploadedAt: new Date()\n\t\t};\n\n\t\t_.extend(fileData, file, extra);\n\n\t\tif (this.model.direct && this.model.direct.insert != null) {\n\t\t\tfile = this.model.direct.insert(fileData);\n\t\t} else {\n\t\t\tfile = this.insert(fileData);\n\t\t}\n\n\t\treturn file;\n\t}\n\n\tupdateFileComplete(fileId, userId, file) {\n\t\tlet result;\n\t\tif (!fileId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst filter = {\n\t\t\t_id: fileId,\n\t\t\tuserId\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tprogress: 1\n\t\t\t}\n\t\t};\n\n\t\tupdate.$set = _.extend(file, update.$set);\n\n\t\tif (this.model.direct && this.model.direct.update != null) {\n\t\t\tresult = this.model.direct.update(filter, update);\n\t\t} else {\n\t\t\tresult = this.update(filter, update);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tdeleteFile(fileId) {\n\t\tif (this.model.direct && this.model.direct.remove != null) {\n\t\t\treturn this.model.direct.remove({ _id: fileId });\n\t\t} else {\n\t\t\treturn this.remove({ _id: fileId });\n\t\t}\n\t}\n};\n","class ModelUsers extends RocketChat.models._Base {\n\tconstructor() {\n\t\tsuper(...arguments);\n\n\t\tthis.tryEnsureIndex({ 'roles': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'name': 1 });\n\t\tthis.tryEnsureIndex({ 'lastLogin': 1 });\n\t\tthis.tryEnsureIndex({ 'status': 1 });\n\t\tthis.tryEnsureIndex({ 'active': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'statusConnection': 1 }, { sparse: 1 });\n\t\tthis.tryEnsureIndex({ 'type': 1 });\n\n\t\tthis.cache.ensureIndex('username', 'unique');\n\t}\n\n\tfindOneByImportId(_id, options) {\n\t\treturn this.findOne({ importIds: _id }, options);\n\t}\n\n\tfindOneByUsername(username, options) {\n\t\tconst query =\t{username};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByEmailAddress(emailAddress, options) {\n\t\tconst query =\t{'emails.address': new RegExp(`^${ s.escapeRegExp(emailAddress) }$`, 'i')};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneAdmin(admin, options) {\n\t\tconst query =\t{admin};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\tfindOneByIdAndLoginToken(_id, token, options) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\t'services.resume.loginTokens.hashedToken' : Accounts._hashLoginToken(token)\n\t\t};\n\n\t\treturn this.findOne(query, options);\n\t}\n\n\n\t// FIND\n\tfindById(userId) {\n\t\tconst query =\t{_id: userId};\n\n\t\treturn this.find(query);\n\t}\n\n\tfindUsersNotOffline(options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\tstatus: {\n\t\t\t\t$in: ['online', 'away', 'busy']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\n\tfindByUsername(username, options) {\n\t\tconst query =\t{username};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindUsersByUsernamesWithHighlights(usernames, options) {\n\t\tif (this.useCache) {\n\t\t\tconst result = {\n\t\t\t\tfetch() {\n\t\t\t\t\treturn RocketChat.models.Users.getDynamicView('highlights').data().filter(record => usernames.indexOf(record.username) > -1);\n\t\t\t\t},\n\t\t\t\tcount() {\n\t\t\t\t\treturn result.fetch().length;\n\t\t\t\t},\n\t\t\t\tforEach(fn) {\n\t\t\t\t\treturn result.fetch().forEach(fn);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn result;\n\t\t}\n\n\t\tconst query = {\n\t\t\tusername: { $in: usernames },\n\t\t\t'settings.preferences.highlights.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindActiveByUsernameOrNameRegexWithExceptions(searchTerm, exceptions, options) {\n\t\tif (exceptions == null) { exceptions = []; }\n\t\tif (options == null) { options = {}; }\n\t\tif (!_.isArray(exceptions)) {\n\t\t\texceptions = [ exceptions ];\n\t\t}\n\n\t\tconst termRegex = new RegExp(s.escapeRegExp(searchTerm), 'i');\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\tusername: termRegex\n\t\t\t}, {\n\t\t\t\tname: termRegex\n\t\t\t}],\n\t\t\tactive: true,\n\t\t\ttype: {\n\t\t\t\t$in: ['user', 'bot']\n\t\t\t},\n\t\t\t$and: [{\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tusername: {\n\t\t\t\t\t$nin: exceptions\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByActiveUsersExcept(searchTerm, exceptions, options) {\n\t\tif (exceptions == null) { exceptions = []; }\n\t\tif (options == null) { options = {}; }\n\t\tif (!_.isArray(exceptions)) {\n\t\t\texceptions = [ exceptions ];\n\t\t}\n\n\t\tconst termRegex = new RegExp(s.escapeRegExp(searchTerm), 'i');\n\n\t\tconst orStmt = _.reduce(RocketChat.settings.get('Accounts_SearchFields').trim().split(','), function(acc, el) {\n\t\t\tacc.push({ [el.trim()]: termRegex });\n\t\t\treturn acc;\n\t\t}, []);\n\t\tconst query = {\n\t\t\t$and: [\n\t\t\t\t{\n\t\t\t\t\tactive: true,\n\t\t\t\t\t$or: orStmt\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tusername: { $exists: true, $nin: exceptions }\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\t// do not use cache\n\t\treturn this._db.find(query, options);\n\t}\n\n\tfindUsersByNameOrUsername(nameOrUsername, options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$exists: 1\n\t\t\t},\n\n\t\t\t$or: [\n\t\t\t\t{name: nameOrUsername},\n\t\t\t\t{username: nameOrUsername}\n\t\t\t],\n\n\t\t\ttype: {\n\t\t\t\t$in: ['user']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindByUsernameNameOrEmailAddress(usernameNameOrEmailAddress, options) {\n\t\tconst query = {\n\t\t\t$or: [\n\t\t\t\t{name: usernameNameOrEmailAddress},\n\t\t\t\t{username: usernameNameOrEmailAddress},\n\t\t\t\t{'emails.address': usernameNameOrEmailAddress}\n\t\t\t],\n\t\t\ttype: {\n\t\t\t\t$in: ['user', 'bot']\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindLDAPUsers(options) {\n\t\tconst query =\t{ldap: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindCrowdUsers(options) {\n\t\tconst query =\t{crowd: true};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tgetLastLogin(options) {\n\t\tif (options == null) { options = {}; }\n\t\tconst query = { lastLogin: { $exists: 1 } };\n\t\toptions.sort = { lastLogin: -1 };\n\t\toptions.limit = 1;\n\t\tconst [user] = this.find(query, options).fetch();\n\t\treturn user && user.lastLogin;\n\t}\n\n\tfindUsersByUsernames(usernames, options) {\n\t\tconst query = {\n\t\t\tusername: {\n\t\t\t\t$in: usernames\n\t\t\t}\n\t\t};\n\n\t\treturn this.find(query, options);\n\t}\n\n\tfindUsersByIds(ids, options) {\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: ids\n\t\t\t}\n\t\t};\n\t\treturn this.find(query, options);\n\t}\n\n\t// UPDATE\n\taddImportIds(_id, importIds) {\n\t\timportIds = [].concat(importIds);\n\n\t\tconst query =\t{_id};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\timportIds: {\n\t\t\t\t\t$each: importIds\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tupdateLastLoginById(_id) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlastLogin: new Date\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetServiceId(_id, serviceName, serviceId) {\n\t\tconst update =\n\t\t{$set: {}};\n\n\t\tconst serviceIdKey = `services.${ serviceName }.id`;\n\t\tupdate.$set[serviceIdKey] = serviceId;\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUsername(_id, username) {\n\t\tconst update =\n\t\t{$set: {username}};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetEmail(_id, email) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\temails: [{\n\t\t\t\t\taddress: email,\n\t\t\t\t\tverified: false\n\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetEmailVerified(_id, email) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\temails: {\n\t\t\t\t$elemMatch: {\n\t\t\t\t\taddress: email,\n\t\t\t\t\tverified: false\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'emails.$.verified': true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsetName(_id, name) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tname\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetCustomFields(_id, fields) {\n\t\tconst values = {};\n\t\tObject.keys(fields).forEach(key => {\n\t\t\tvalues[`customFields.${ key }`] = fields[key];\n\t\t});\n\n\t\tconst update = {$set: values};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetAvatarOrigin(_id, origin) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tavatarOrigin: origin\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tunsetAvatarOrigin(_id) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\tavatarOrigin: 1\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUserActive(_id, active) {\n\t\tif (active == null) { active = true; }\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tactive\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetAllUsersActive(active) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tactive\n\t\t\t}\n\t\t};\n\n\t\treturn this.update({}, update, { multi: true });\n\t}\n\n\tunsetLoginTokens(_id) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'services.resume.loginTokens' : []\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tunsetRequirePasswordChange(_id) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\t'requirePasswordChange' : true,\n\t\t\t\t'requirePasswordChangeReason' : true\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tresetPasswordAndSetRequirePasswordChange(_id, requirePasswordChange, requirePasswordChangeReason) {\n\t\tconst update = {\n\t\t\t$unset: {\n\t\t\t\t'services.password': 1\n\t\t\t},\n\t\t\t$set: {\n\t\t\t\trequirePasswordChange,\n\t\t\t\trequirePasswordChangeReason\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetLanguage(_id, language) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tlanguage\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetProfile(_id, profile) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'settings.profile': profile\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetPreferences(_id, preferences) {\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\t'settings.preferences': preferences\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(_id, update);\n\t}\n\n\tsetUtcOffset(_id, utcOffset) {\n\t\tconst query = {\n\t\t\t_id,\n\t\t\tutcOffset: {\n\t\t\t\t$ne: utcOffset\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tutcOffset\n\t\t\t}\n\t\t};\n\n\t\treturn this.update(query, update);\n\t}\n\n\tsaveUserById(_id, data) {\n\t\tconst setData = {};\n\t\tconst unsetData = {};\n\n\t\tif (data.name != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.name))) {\n\t\t\t\tsetData.name = s.trim(data.name);\n\t\t\t} else {\n\t\t\t\tunsetData.name = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (data.email != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.email))) {\n\t\t\t\tsetData.emails = [{address: s.trim(data.email)}];\n\t\t\t} else {\n\t\t\t\tunsetData.emails = 1;\n\t\t\t}\n\t\t}\n\n\t\tif (data.phone != null) {\n\t\t\tif (!_.isEmpty(s.trim(data.phone))) {\n\t\t\t\tsetData.phone = [{phoneNumber: s.trim(data.phone)}];\n\t\t\t} else {\n\t\t\t\tunsetData.phone = 1;\n\t\t\t}\n\t\t}\n\n\t\tconst update = {};\n\n\t\tif (!_.isEmpty(setData)) {\n\t\t\tupdate.$set = setData;\n\t\t}\n\n\t\tif (!_.isEmpty(unsetData)) {\n\t\t\tupdate.$unset = unsetData;\n\t\t}\n\n\t\tif (_.isEmpty(update)) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.update({ _id }, update);\n\t}\n\n\t// INSERT\n\tcreate(data) {\n\t\tconst user = {\n\t\t\tcreatedAt: new Date,\n\t\t\tavatarOrigin: 'none'\n\t\t};\n\n\t\t_.extend(user, data);\n\n\t\treturn this.insert(user);\n\t}\n\n\n\t// REMOVE\n\tremoveById(_id) {\n\t\treturn this.remove(_id);\n\t}\n\n\t/*\nFind users to send a message by email if:\n- he is not online\n- has a verified email\n- has not disabled email notifications\n- `active` is equal to true (false means they were deactivated and can't login)\n*/\n\tgetUsersToSendOfflineEmail(usersIds) {\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: usersIds\n\t\t\t},\n\t\t\tactive: true,\n\t\t\tstatus: 'offline',\n\t\t\tstatusConnection: {\n\t\t\t\t$ne: 'online'\n\t\t\t},\n\t\t\t'emails.verified': true\n\t\t};\n\n\t\treturn this.find(query, { fields: { name: 1, username: 1, emails: 1, 'settings.preferences.emailNotificationMode': 1 } });\n\t}\n}\n\nRocketChat.models.Users = new ModelUsers(Meteor.users, true);\n","/* eslint new-cap: 0 */\n\nimport loki from 'lokijs';\nimport {EventEmitter} from 'events';\nimport objectPath from 'object-path';\n\nconst logger = new Logger('BaseCache');\n\nconst lokiEq = loki.LokiOps.$eq;\nconst lokiNe = loki.LokiOps.$ne;\n\nloki.LokiOps.$eq = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.indexOf(b) !== -1;\n\t}\n\treturn lokiEq(a, b);\n};\n\nloki.LokiOps.$ne = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.indexOf(b) === -1;\n\t}\n\treturn lokiNe(a, b);\n};\n\nconst lokiIn = loki.LokiOps.$in;\nloki.LokiOps.$in = function(a, b) {\n\tif (Array.isArray(a)) {\n\t\treturn a.some(subA => lokiIn(subA, b));\n\t}\n\treturn lokiIn(a, b);\n};\n\nloki.LokiOps.$nin = function(a, b) {\n\treturn !loki.LokiOps.$in(a, b);\n};\n\nloki.LokiOps.$all = function(a, b) {\n\treturn b.every(subB => a.includes(subB));\n};\n\nloki.LokiOps.$exists = function(a, b) {\n\tif (b) {\n\t\treturn loki.LokiOps.$ne(a, undefined);\n\t}\n\n\treturn loki.LokiOps.$eq(a, undefined);\n};\n\nloki.LokiOps.$elemMatch = function(a, b) {\n\treturn _.findWhere(a, b);\n};\n\nconst ignore = [\n\t'emit',\n\t'load',\n\t'on',\n\t'addToAllIndexes'\n];\n\nfunction traceMethodCalls(target) {\n\ttarget._stats = {};\n\n\tfor (const property in target) {\n\t\tif (typeof target[property] === 'function' && ignore.indexOf(property) === -1) {\n\t\t\ttarget._stats[property] = {\n\t\t\t\tcalls: 0,\n\t\t\t\ttime: 0,\n\t\t\t\tavg: 0\n\t\t\t};\n\t\t\tconst origMethod = target[property];\n\t\t\ttarget[property] = function(...args) {\n\n\t\t\t\tif (target.loaded !== true) {\n\t\t\t\t\treturn origMethod.apply(target, args);\n\t\t\t\t}\n\n\t\t\t\tconst startTime = RocketChat.statsTracker.now();\n\t\t\t\tconst result = origMethod.apply(target, args);\n\t\t\t\tconst time = Math.round(RocketChat.statsTracker.now() - startTime) / 1000;\n\t\t\t\ttarget._stats[property].time += time;\n\t\t\t\ttarget._stats[property].calls++;\n\t\t\t\ttarget._stats[property].avg = target._stats[property].time / target._stats[property].calls;\n\n\t\t\t\treturn result;\n\t\t\t};\n\t\t}\n\t}\n\n\tsetInterval(function() {\n\t\tfor (const property in target._stats) {\n\t\t\tif (target._stats.hasOwnProperty(property) && target._stats[property].time > 0) {\n\t\t\t\tconst tags = [`property:${ property }`, `collection:${ target.collectionName }`];\n\t\t\t\tRocketChat.statsTracker.timing('cache.methods.time', target._stats[property].avg, tags);\n\t\t\t\tRocketChat.statsTracker.increment('cache.methods.totalTime', target._stats[property].time, tags);\n\t\t\t\tRocketChat.statsTracker.increment('cache.methods.count', target._stats[property].calls, tags);\n\t\t\t\ttarget._stats[property].avg = 0;\n\t\t\t\ttarget._stats[property].time = 0;\n\t\t\t\ttarget._stats[property].calls = 0;\n\t\t\t}\n\t\t}\n\t}, 10000);\n\n\ttarget._getStatsAvg = function() {\n\t\tconst stats = [];\n\t\tfor (const property in target._stats) {\n\t\t\tif (target._stats.hasOwnProperty(property)) {\n\t\t\t\tstats.push([Math.round(target._stats[property].avg*100)/100, property]);\n\t\t\t}\n\t\t}\n\t\treturn _.sortBy(stats, function(record) {\n\t\t\treturn record[0];\n\t\t});\n\t};\n}\n\nclass Adapter {\n\tloadDatabase(/*dbname, callback*/) {}\n\tsaveDatabase(/*dbname, dbstring, callback*/) {}\n\tdeleteDatabase(/*dbname, callback*/) {}\n}\n\nconst db = new loki('rocket.chat.json', {adapter: Adapter});\n\nclass ModelsBaseCache extends EventEmitter {\n\tconstructor(model) {\n\t\tsuper();\n\n\t\ttraceMethodCalls(this);\n\n\t\tthis.indexes = {};\n\t\tthis.ignoreUpdatedFields = ['_updatedAt'];\n\n\t\tthis.query = {};\n\t\tthis.options = {};\n\n\t\tthis.ensureIndex('_id', 'unique');\n\n\t\tthis.joins = {};\n\n\t\tthis.on('inserted', (...args) => { this.emit('changed', 'inserted', ...args); });\n\t\tthis.on('removed', (...args) => { this.emit('changed', 'removed', ...args); });\n\t\tthis.on('updated', (...args) => { this.emit('changed', 'updated', ...args); });\n\n\t\tthis.on('beforeinsert', (...args) => { this.emit('beforechange', 'inserted', ...args); });\n\t\tthis.on('beforeremove', (...args) => { this.emit('beforechange', 'removed', ...args); });\n\t\tthis.on('beforeupdate', (...args) => { this.emit('beforechange', 'updated', ...args); });\n\n\t\tthis.on('inserted', (...args) => { this.emit('sync', 'inserted', ...args); });\n\t\tthis.on('updated', (...args) => { this.emit('sync', 'updated', ...args); });\n\t\tthis.on('beforeremove', (...args) => { this.emit('sync', 'removed', ...args); });\n\n\t\tthis.db = db;\n\n\t\tthis.model = model;\n\n\t\tthis.collectionName = this.model._db.collectionName;\n\t\tthis.collection = this.db.addCollection(this.collectionName);\n\t}\n\n\thasOne(join, {field, link}) {\n\t\tthis.join({join, field, link, multi: false});\n\t}\n\n\thasMany(join, {field, link}) {\n\t\tthis.join({join, field, link, multi: true});\n\t}\n\n\tjoin({join, field, link, multi}) {\n\t\tif (!RocketChat.models[join]) {\n\t\t\tconsole.log(`Invalid cache model ${ join }`);\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models[join].cache.on('inserted', (record) => {\n\t\t\tthis.processRemoteJoinInserted({join, field, link, multi, record});\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('beforeupdate', (record, diff) => {\n\t\t\tif (diff[link.remote]) {\n\t\t\t\tthis.processRemoteJoinRemoved({join, field, link, multi, record});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('updated', (record, diff) => {\n\t\t\tif (diff[link.remote]) {\n\t\t\t\tthis.processRemoteJoinInserted({join, field, link, multi, record});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models[join].cache.on('removed', (record) => {\n\t\t\tthis.processRemoteJoinRemoved({join, field, link, multi, record});\n\t\t});\n\n\t\tthis.on('inserted', (localRecord) => {\n\t\t\tthis.processLocalJoinInserted({join, field, link, multi, localRecord});\n\t\t});\n\n\t\tthis.on('beforeupdate', (localRecord, diff) => {\n\t\t\tif (diff[link.local]) {\n\t\t\t\tif (multi === true) {\n\t\t\t\t\tlocalRecord[field] = [];\n\t\t\t\t} else {\n\t\t\t\t\tlocalRecord[field] = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.on('updated', (localRecord, diff) => {\n\t\t\tif (diff[link.local]) {\n\t\t\t\tthis.processLocalJoinInserted({join, field, link, multi, localRecord});\n\t\t\t}\n\t\t});\n\t}\n\n\tprocessRemoteJoinInserted({field, link, multi, record}) {\n\t\tlet localRecords = this._findByIndex(link.local, objectPath.get(record, link.remote));\n\n\t\tif (!localRecords) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(localRecords)) {\n\t\t\tlocalRecords = [localRecords];\n\t\t}\n\n\t\tfor (let i = 0; i < localRecords.length; i++) {\n\t\t\tconst localRecord = localRecords[i];\n\t\t\tif (multi === true && !localRecord[field]) {\n\t\t\t\tlocalRecord[field] = [];\n\t\t\t}\n\n\t\t\tif (typeof link.where === 'function' && link.where(localRecord, record) === false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet mutableRecord = record;\n\n\t\t\tif (typeof link.transform === 'function') {\n\t\t\t\tmutableRecord = link.transform(localRecord, mutableRecord);\n\t\t\t}\n\n\t\t\tif (multi === true) {\n\t\t\t\tlocalRecord[field].push(mutableRecord);\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = mutableRecord;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:inserted`, localRecord, mutableRecord);\n\t\t\tthis.emit(`join:${ field }:changed`, 'inserted', localRecord, mutableRecord);\n\t\t}\n\t}\n\n\tprocessLocalJoinInserted({join, field, link, multi, localRecord}) {\n\t\tlet records = RocketChat.models[join].cache._findByIndex(link.remote, objectPath.get(localRecord, link.local));\n\n\t\tif (!Array.isArray(records)) {\n\t\t\trecords = [records];\n\t\t}\n\n\t\tfor (let i = 0; i < records.length; i++) {\n\t\t\tlet record = records[i];\n\n\t\t\tif (typeof link.where === 'function' && link.where(localRecord, record) === false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (typeof link.transform === 'function') {\n\t\t\t\trecord = link.transform(localRecord, record);\n\t\t\t}\n\n\t\t\tif (multi === true) {\n\t\t\t\tlocalRecord[field].push(record);\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = record;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:inserted`, localRecord, record);\n\t\t\tthis.emit(`join:${ field }:changed`, 'inserted', localRecord, record);\n\t\t}\n\t}\n\n\tprocessRemoteJoinRemoved({field, link, multi, record}) {\n\t\tlet localRecords = this._findByIndex(link.local, objectPath.get(record, link.remote));\n\n\t\tif (!localRecords) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Array.isArray(localRecords)) {\n\t\t\tlocalRecords = [localRecords];\n\t\t}\n\n\t\tfor (let i = 0; i < localRecords.length; i++) {\n\t\t\tconst localRecord = localRecords[i];\n\n\t\t\tif (multi === true) {\n\t\t\t\tif (Array.isArray(localRecord[field])) {\n\t\t\t\t\tif (typeof link.remove === 'function') {\n\t\t\t\t\t\tlink.remove(localRecord[field], record);\n\t\t\t\t\t} else if (localRecord[field].indexOf(record) > -1) {\n\t\t\t\t\t\tlocalRecord[field].splice(localRecord[field].indexOf(record), 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlocalRecord[field] = undefined;\n\t\t\t}\n\n\t\t\tthis.emit(`join:${ field }:removed`, localRecord, record);\n\t\t\tthis.emit(`join:${ field }:changed`, 'removed', localRecord, record);\n\t\t}\n\t}\n\n\tensureIndex(fields, type='array') {\n\t\tif (!Array.isArray(fields)) {\n\t\t\tfields = [fields];\n\t\t}\n\n\t\tthis.indexes[fields.join(',')] = {\n\t\t\ttype,\n\t\t\tfields,\n\t\t\tdata: {}\n\t\t};\n\t}\n\n\taddToAllIndexes(record) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.addToIndex(indexName, record);\n\t\t\t}\n\t\t}\n\t}\n\n\taddToIndex(indexName, record) {\n\t\tconst index = this.indexes[indexName];\n\t\tif (!index) {\n\t\t\tconsole.error(`Index not defined ${ indexName }`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst keys = [];\n\t\tfor (const field of index.fields) {\n\t\t\tkeys.push(objectPath.get(record, field));\n\t\t}\n\t\tconst key = keys.join('|');\n\n\t\tif (index.type === 'unique') {\n\t\t\tindex.data[key] = record;\n\t\t\treturn;\n\t\t}\n\n\t\tif (index.type === 'array') {\n\t\t\tif (!index.data[key]) {\n\t\t\t\tindex.data[key] = [];\n\t\t\t}\n\t\t\tindex.data[key].push(record);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tremoveFromAllIndexes(record) {\n\t\tfor (const indexName in this.indexes) {\n\t\t\tif (this.indexes.hasOwnProperty(indexName)) {\n\t\t\t\tthis.removeFromIndex(indexName, record);\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveFromIndex(indexName, record) {\n\t\tconst index = this.indexes[indexName];\n\t\tif (!this.indexes[indexName]) {\n\t\t\tconsole.error(`Index not defined ${ indexName }`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!index.data) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet key = [];\n\t\tfor (const field of index.fields) {\n\t\t\tkey.push(objectPath.get(record, field));\n\t\t}\n\t\tkey = key.join('|');\n\n\t\tif (index.type === 'unique') {\n\t\t\tindex.data[key] = undefined;\n\t\t\treturn;\n\t\t}\n\n\t\tif (index.type === 'array') {\n\t\t\tif (!index.data[key]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst i = index.data[key].indexOf(record);\n\t\t\tif (i > -1) {\n\t\t\t\tindex.data[key].splice(i, 1);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t}\n\n\t_findByIndex(index, keys) {\n\t\tconst key = [].concat(keys).join('|');\n\t\tif (!this.indexes[index]) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.indexes[index].data) {\n\t\t\tconst result = this.indexes[index].data[key];\n\t\t\tif (result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\tif (this.indexes[index].type === 'array') {\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tfindByIndex(index, keys, options={}) {\n\t\treturn {\n\t\t\tfetch: () => {\n\t\t\t\treturn this.processQueryOptionsOnResult(this._findByIndex(index, keys), options);\n\t\t\t},\n\n\t\t\tcount: () => {\n\t\t\t\tconst records = this.findByIndex(index, keys, options).fetch();\n\t\t\t\tif (Array.isArray(records)) {\n\t\t\t\t\treturn records.length;\n\t\t\t\t}\n\t\t\t\treturn !records ? 0 : 1;\n\t\t\t},\n\n\t\t\tforEach: (fn) => {\n\t\t\t\tconst records = this.findByIndex(index, keys, options).fetch();\n\t\t\t\tif (Array.isArray(records)) {\n\t\t\t\t\treturn records.forEach(fn);\n\t\t\t\t}\n\t\t\t\tif (records) {\n\t\t\t\t\treturn fn(records);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tload() {\n\t\tif (this.model._useCache === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.log('Will load cache for', this.collectionName);\n\t\tthis.emit('beforeload');\n\t\tthis.loaded = false;\n\t\tconst time = RocketChat.statsTracker.now();\n\t\tconst data = this.model.db.find(this.query, this.options).fetch();\n\t\tfor (let i=0; i < data.length; i++) {\n\t\t\tthis.insert(data[i]);\n\t\t}\n\t\tconsole.log(String(data.length), 'records load from', this.collectionName);\n\t\tRocketChat.statsTracker.timing('cache.load', RocketChat.statsTracker.now() - time, [`collection:${ this.collectionName }`]);\n\n\t\tthis.startSync();\n\t\tthis.loaded = true;\n\t\tthis.emit('afterload');\n\t}\n\n\tstartSync() {\n\t\tif (this.model._useCache === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.model._db.on('change', ({action, id, data/*, oplog*/}) => {\n\t\t\tswitch (action) {\n\t\t\t\tcase 'insert':\n\t\t\t\t\tdata._id = id;\n\t\t\t\t\tthis.insert(data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'remove':\n\t\t\t\t\tthis.removeById(id);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:record':\n\t\t\t\t\tthis.updateDiffById(id, data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:diff':\n\t\t\t\t\tthis.updateDiffById(id, data);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'update:query':\n\t\t\t\t\tthis.update(data.query, data.update, data.options);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t}\n\n\tprocessQueryOptionsOnResult(result, options={}) {\n\t\tif (result === undefined || result === null) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tif (Array.isArray(result)) {\n\t\t\tif (options.sort) {\n\t\t\t\tresult = result.sort((a, b) => {\n\t\t\t\t\tlet r = 0;\n\t\t\t\t\tfor (const field in options.sort) {\n\t\t\t\t\t\tif (options.sort.hasOwnProperty(field)) {\n\t\t\t\t\t\t\tconst direction = options.sort[field];\n\t\t\t\t\t\t\tlet valueA;\n\t\t\t\t\t\t\tlet valueB;\n\t\t\t\t\t\t\tif (field.indexOf('.') > -1) {\n\t\t\t\t\t\t\t\tvalueA = objectPath.get(a, field);\n\t\t\t\t\t\t\t\tvalueB = objectPath.get(b, field);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalueA = a[field];\n\t\t\t\t\t\t\t\tvalueB = b[field];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (valueA > valueB) {\n\t\t\t\t\t\t\t\tr = direction;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (valueA < valueB) {\n\t\t\t\t\t\t\t\tr = -direction;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn r;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (typeof options.skip === 'number') {\n\t\t\t\tresult.splice(0, options.skip);\n\t\t\t}\n\n\t\t\tif (typeof options.limit === 'number' && options.limit !== 0) {\n\t\t\t\tresult.splice(options.limit);\n\t\t\t}\n\t\t}\n\n\t\tif (!options.fields) {\n\t\t\toptions.fields = {};\n\t\t}\n\n\t\tconst fieldsToRemove = [];\n\t\tconst fieldsToGet = [];\n\n\t\tfor (const field in options.fields) {\n\t\t\tif (options.fields.hasOwnProperty(field)) {\n\t\t\t\tif (options.fields[field] === 0) {\n\t\t\t\t\tfieldsToRemove.push(field);\n\t\t\t\t} else if (options.fields[field] === 1) {\n\t\t\t\t\tfieldsToGet.push(field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (fieldsToRemove.length > 0 && fieldsToGet.length > 0) {\n\t\t\tconsole.warn('Can\\'t mix remove and get fields');\n\t\t\tfieldsToRemove.splice(0, fieldsToRemove.length);\n\t\t}\n\n\t\tif (fieldsToGet.length > 0 && fieldsToGet.indexOf('_id') === -1) {\n\t\t\tfieldsToGet.push('_id');\n\t\t}\n\n\t\tconst pickFields = (obj, fields) => {\n\t\t\tconst picked = {};\n\t\t\tfields.forEach((field) => {\n\t\t\t\tif (field.indexOf('.') !== -1) {\n\t\t\t\t\tobjectPath.set(picked, field, objectPath.get(obj, field));\n\t\t\t\t} else {\n\t\t\t\t\tpicked[field] = obj[field];\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn picked;\n\t\t};\n\n\t\tif (fieldsToRemove.length > 0 || fieldsToGet.length > 0) {\n\t\t\tif (Array.isArray(result)) {\n\t\t\t\tresult = result.map((record) => {\n\t\t\t\t\tif (fieldsToRemove.length > 0) {\n\t\t\t\t\t\treturn _.omit(record, ...fieldsToRemove);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (fieldsToGet.length > 0) {\n\t\t\t\t\t\treturn pickFields(record, fieldsToGet);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tif (fieldsToRemove.length > 0) {\n\t\t\t\t\treturn _.omit(result, ...fieldsToRemove);\n\t\t\t\t}\n\n\t\t\t\tif (fieldsToGet.length > 0) {\n\t\t\t\t\treturn pickFields(result, fieldsToGet);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprocessQuery(query, parentField) {\n\t\tif (!query) {\n\t\t\treturn query;\n\t\t}\n\n\t\tif (Match.test(query, String)) {\n\t\t\treturn {\n\t\t\t\t_id: query\n\t\t\t};\n\t\t}\n\n\t\tif (Object.keys(query).length > 1 && parentField !== '$elemMatch') {\n\t\t\tconst and = [];\n\t\t\tfor (const field in query) {\n\t\t\t\tif (query.hasOwnProperty(field)) {\n\t\t\t\t\tand.push({\n\t\t\t\t\t\t[field]: query[field]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tquery = {$and: and};\n\t\t}\n\n\t\tfor (const field in query) {\n\t\t\tif (query.hasOwnProperty(field)) {\n\t\t\t\tconst value = query[field];\n\t\t\t\tif (value instanceof RegExp && field !== '$regex') {\n\t\t\t\t\tquery[field] = {\n\t\t\t\t\t\t$regex: value\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (field === '$and' || field === '$or') {\n\t\t\t\t\tquery[field] = value.map((subValue) => {\n\t\t\t\t\t\treturn this.processQuery(subValue, field);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (Match.test(value, Object) && Object.keys(value).length > 0) {\n\t\t\t\t\tquery[field] = this.processQuery(value, field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn query;\n\t}\n\n\tfind(query, options={}) {\n\t\treturn {\n\t\t\tfetch: () => {\n\t\t\t\ttry {\n\t\t\t\t\tquery = this.processQuery(query);\n\t\t\t\t\treturn this.processQueryOptionsOnResult(this.collection.find(query), options);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Exception on cache find for', this.collectionName);\n\t\t\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\t\t\tconsole.error(e.stack);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tcount: () => {\n\t\t\t\ttry {\n\t\t\t\t\tquery = this.processQuery(query);\n\t\t\t\t\tconst { limit, skip } = options;\n\t\t\t\t\treturn this.processQueryOptionsOnResult(this.collection.find(query), { limit, skip }).length;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error('Exception on cache find for', this.collectionName);\n\t\t\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\t\t\tconsole.error(e.stack);\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tforEach: (fn) => {\n\t\t\t\treturn this.find(query, options).fetch().forEach(fn);\n\t\t\t},\n\n\t\t\tobserve: (obj) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back observe to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments).observe(obj);\n\t\t\t},\n\n\t\t\tobserveChanges: (obj) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back observeChanges to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments).observeChanges(obj);\n\t\t\t},\n\n\t\t\t_publishCursor: (cursor, sub, collection) => {\n\t\t\t\tlogger.debug(this.collectionName, 'Falling back _publishCursor to model with query:', query);\n\t\t\t\treturn this.model.db.find(...arguments)._publishCursor(cursor, sub, collection);\n\t\t\t}\n\t\t};\n\t}\n\n\tfindOne(query, options) {\n\t\ttry {\n\t\t\tquery = this.processQuery(query);\n\t\t\treturn this.processQueryOptionsOnResult(this.collection.findOne(query), options);\n\t\t} catch (e) {\n\t\t\tconsole.error('Exception on cache findOne for', this.collectionName);\n\t\t\tconsole.error('Query:', JSON.stringify(query, null, 2));\n\t\t\tconsole.error('Options:', JSON.stringify(options, null, 2));\n\t\t\tconsole.error(e.stack);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tfindOneById(_id, options) {\n\t\treturn this.findByIndex('_id', _id, options).fetch();\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\tconst query = this.processQuery({ _id: { $in: ids }});\n\t\treturn this.processQueryOptionsOnResult(this.collection.findOne(query), options);\n\t}\n\n\tfindWhere(query, options) {\n\t\tquery = this.processQuery(query);\n\t\treturn this.processQueryOptionsOnResult(this.collection.findWhere(query), options);\n\t}\n\n\taddDynamicView() {\n\t\treturn this.collection.addDynamicView(...arguments);\n\t}\n\n\tgetDynamicView() {\n\t\treturn this.collection.getDynamicView(...arguments);\n\t}\n\n\tinsert(record) {\n\t\tif (Array.isArray(record)) {\n\t\t\tfor (const item of record) {\n\t\t\t\tthis.insert(item);\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO remove - ignore updates in room.usernames\n\t\t\tif (this.collectionName === 'rocketchat_room' && record.usernames) {\n\t\t\t\tdelete record.usernames;\n\t\t\t}\n\t\t\tthis.emit('beforeinsert', record);\n\t\t\tthis.addToAllIndexes(record);\n\t\t\tthis.collection.insert(record);\n\t\t\tthis.emit('inserted', record);\n\t\t}\n\t}\n\n\tupdateDiffById(id, diff) {\n\t\t// TODO remove - ignore updates in room.usernames\n\t\tif (this.collectionName === 'rocketchat_room' && diff.usernames) {\n\t\t\tdelete diff.usernames;\n\t\t}\n\n\t\tconst record = this._findByIndex('_id', id);\n\t\tif (!record) {\n\t\t\tconsole.error('Cache.updateDiffById: No record', this.collectionName, id, diff);\n\t\t\treturn;\n\t\t}\n\t\tthis.removeFromAllIndexes(record);\n\n\t\tconst updatedFields = _.without(Object.keys(diff), ...this.ignoreUpdatedFields);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('beforeupdate', record, diff);\n\t\t}\n\n\t\tfor (const key in diff) {\n\t\t\tif (diff.hasOwnProperty(key)) {\n\t\t\t\tobjectPath.set(record, key, diff[key]);\n\t\t\t}\n\t\t}\n\n\t\tthis.collection.update(record);\n\t\tthis.addToAllIndexes(record);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('updated', record, diff);\n\t\t}\n\t}\n\n\tupdateRecord(record, update) {\n\t\t// TODO remove - ignore updates in room.usernames\n\t\tif (this.collectionName === 'rocketchat_room' && (record.usernames || (record.$set && record.$set.usernames))) {\n\t\t\tdelete record.usernames;\n\t\t\tif (record.$set && record.$set.usernames) {\n\t\t\t\tdelete record.$set.usernames;\n\t\t\t}\n\t\t}\n\n\t\tthis.removeFromAllIndexes(record);\n\n\t\tconst topLevelFields = Object.keys(update).map(field => field.split('.')[0]);\n\t\tconst updatedFields = _.without(topLevelFields, ...this.ignoreUpdatedFields);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('beforeupdate', record, record);\n\t\t}\n\n\t\tif (update.$set) {\n\t\t\t_.each(update.$set, (value, field) => {\n\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$unset) {\n\t\t\t_.each(update.$unset, (value, field) => {\n\t\t\t\tobjectPath.del(record, field);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$min) {\n\t\t\t_.each(update.$min, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined || value < curValue) {\n\t\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$max) {\n\t\t\t_.each(update.$max, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined || value > curValue) {\n\t\t\t\t\tobjectPath.set(record, field, value);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$inc) {\n\t\t\t_.each(update.$inc, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = value;\n\t\t\t\t} else {\n\t\t\t\t\tcurValue += value;\n\t\t\t\t}\n\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$mul) {\n\t\t\t_.each(update.$mul, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcurValue *= value;\n\t\t\t\t}\n\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t});\n\t\t}\n\n\t\tif (update.$rename) {\n\t\t\t_.each(update.$rename, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue !== undefined) {\n\t\t\t\t\tobjectPath.set(record, value, curValue);\n\t\t\t\t\tobjectPath.del(record, field);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$pullAll) {\n\t\t\t_.each(update.$pullAll, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tcurValue = _.difference(curValue, value);\n\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$pop) {\n\t\t\t_.each(update.$pop, (value, field) => {\n\t\t\t\tconst curValue = objectPath.get(record, field);\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tif (value === -1) {\n\t\t\t\t\t\tcurValue.shift();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurValue.pop();\n\t\t\t\t\t}\n\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (update.$addToSet) {\n\t\t\t_.each(update.$addToSet, (value, field) => {\n\t\t\t\tlet curValue = objectPath.get(record, field);\n\t\t\t\tif (curValue === undefined) {\n\t\t\t\t\tcurValue = [];\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(curValue)) {\n\t\t\t\t\tconst length = curValue.length;\n\n\t\t\t\t\tif (value && value.$each && Array.isArray(value.$each)) {\n\t\t\t\t\t\tfor (const valueItem of value.$each) {\n\t\t\t\t\t\t\tif (curValue.indexOf(valueItem) === -1) {\n\t\t\t\t\t\t\t\tcurValue.push(valueItem);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (curValue.indexOf(value) === -1) {\n\t\t\t\t\t\tcurValue.push(value);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (curValue.length > length) {\n\t\t\t\t\t\tobjectPath.set(record, field, curValue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.collection.update(record);\n\t\tthis.addToAllIndexes(record);\n\n\t\tif (updatedFields.length > 0) {\n\t\t\tthis.emit('updated', record, record);\n\t\t}\n\t}\n\n\tupdate(query, update, options = {}) {\n\t\tlet records = options.multi ? this.find(query).fetch() : this.findOne(query) || [];\n\t\tif (!Array.isArray(records)) {\n\t\t\trecords = [records];\n\t\t}\n\n\t\tfor (const record of records) {\n\t\t\tthis.updateRecord(record, update);\n\t\t}\n\t}\n\n\tremoveById(id) {\n\t\tconst record = this._findByIndex('_id', id);\n\t\tif (record) {\n\t\t\tthis.emit('beforeremove', record);\n\t\t\tthis.collection.removeWhere({_id: id});\n\t\t\tthis.removeFromAllIndexes(record);\n\t\t\tthis.emit('removed', record);\n\t\t}\n\t}\n}\n\nexport default ModelsBaseCache;\n","/* globals MongoInternals */\n\nconst baseName = 'rocketchat_';\nimport {EventEmitter} from 'events';\n\nconst trash = new Mongo.Collection(`${ baseName }_trash`);\ntry {\n\ttrash._ensureIndex({ collection: 1 });\n\ttrash._ensureIndex({ _deletedAt: 1 }, { expireAfterSeconds: 60 * 60 * 24 * 30 });\n} catch (e) {\n\tconsole.log(e);\n}\n\nconst isOplogAvailable = MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && !!MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry;\nlet isOplogEnabled = isOplogAvailable;\nRocketChat.settings.get('Force_Disable_OpLog_For_Cache', (key, value) => {\n\tisOplogEnabled = isOplogAvailable && value === false;\n});\n\nclass ModelsBaseDb extends EventEmitter {\n\tconstructor(model, baseModel) {\n\t\tsuper();\n\n\t\tif (Match.test(model, String)) {\n\t\t\tthis.name = model;\n\t\t\tthis.collectionName = this.baseName + this.name;\n\t\t\tthis.model = new Mongo.Collection(this.collectionName);\n\t\t} else {\n\t\t\tthis.name = model._name;\n\t\t\tthis.collectionName = this.name;\n\t\t\tthis.model = model;\n\t\t}\n\n\t\tthis.baseModel = baseModel;\n\n\t\tthis.wrapModel();\n\n\t\t// When someone start listening for changes we start oplog if available\n\t\tthis.once('newListener', (event/*, listener*/) => {\n\t\t\tif (event === 'change') {\n\t\t\t\tif (isOplogEnabled) {\n\t\t\t\t\tconst query = {\n\t\t\t\t\t\tcollection: this.collectionName\n\t\t\t\t\t};\n\n\t\t\t\t\tMongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry(query, this.processOplogRecord.bind(this));\n\t\t\t\t\tMongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle._defineTooFarBehind(Number.MAX_SAFE_INTEGER);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.tryEnsureIndex({ '_updatedAt': 1 });\n\t}\n\n\tget baseName() {\n\t\treturn baseName;\n\t}\n\n\tsetUpdatedAt(record = {}) {\n\n\t\t// TODO: Check if this can be deleted, Rodrigo does not rememebr WHY he added it. So he removed it to fix issue #5541\n\t\t// setUpdatedAt(record = {}, checkQuery = false, query) {\n\t\t// if (checkQuery === true) {\n\t\t// \tif (!query || Object.keys(query).length === 0) {\n\t\t// \t\tthrow new Meteor.Error('Models._Base: Empty query');\n\t\t// \t}\n\t\t// }\n\n\t\tif (/(^|,)\\$/.test(Object.keys(record).join(','))) {\n\t\t\trecord.$set = record.$set || {};\n\t\t\trecord.$set._updatedAt = new Date;\n\t\t} else {\n\t\t\trecord._updatedAt = new Date;\n\t\t}\n\n\t\treturn record;\n\t}\n\n\twrapModel() {\n\t\tthis.originals = {\n\t\t\tinsert: this.model.insert.bind(this.model),\n\t\t\tupdate: this.model.update.bind(this.model),\n\t\t\tremove: this.model.remove.bind(this.model)\n\t\t};\n\t\tconst self = this;\n\n\t\tthis.model.insert = function() {\n\t\t\treturn self.insert(...arguments);\n\t\t};\n\n\t\tthis.model.update = function() {\n\t\t\treturn self.update(...arguments);\n\t\t};\n\n\t\tthis.model.remove = function() {\n\t\t\treturn self.remove(...arguments);\n\t\t};\n\t}\n\n\tfind() {\n\t\treturn this.model.find(...arguments);\n\t}\n\n\tfindOne() {\n\t\treturn this.model.findOne(...arguments);\n\t}\n\n\tfindOneById(_id, options) {\n\t\treturn this.model.findOne({ _id }, options);\n\t}\n\n\tfindOneByIds(ids, options) {\n\t\treturn this.model.findOne({ _id: { $in: ids }}, options);\n\t}\n\n\tdefineSyncStrategy(query, modifier, options) {\n\t\tif (this.baseModel.useCache === false) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\tif (options.upsert === true) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\t// const dbModifiers = [\n\t\t// \t'$currentDate',\n\t\t// \t'$bit',\n\t\t// \t'$pull',\n\t\t// \t'$pushAll',\n\t\t// \t'$push',\n\t\t// \t'$setOnInsert'\n\t\t// ];\n\n\t\tconst cacheAllowedModifiers = [\n\t\t\t'$set',\n\t\t\t'$unset',\n\t\t\t'$min',\n\t\t\t'$max',\n\t\t\t'$inc',\n\t\t\t'$mul',\n\t\t\t'$rename',\n\t\t\t'$pullAll',\n\t\t\t'$pop',\n\t\t\t'$addToSet'\n\t\t];\n\n\t\tconst notAllowedModifiers = Object.keys(modifier).filter(i => i.startsWith('$') && cacheAllowedModifiers.includes(i) === false);\n\n\t\tif (notAllowedModifiers.length > 0) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\tconst placeholderFields = Object.keys(query).filter(item => item.indexOf('$') > -1);\n\t\tif (placeholderFields.length > 0) {\n\t\t\treturn 'db';\n\t\t}\n\n\t\treturn 'cache';\n\t}\n\n\tupdateHasPositionalOperator(update) {\n\t\tfor (const key in update) {\n\t\t\tif (key.includes('.$')) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst value = update[key];\n\n\t\t\tif (Match.test(value, Object)) {\n\t\t\t\tif (this.updateHasPositionalOperator(value) === true) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tprocessOplogRecord(action) {\n\t\tif (isOplogEnabled === false) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'i') {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'insert',\n\t\t\t\tid: action.op.o._id,\n\t\t\t\tdata: action.op.o,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'u') {\n\t\t\tif (!action.op.o.$set && !action.op.o.$unset) {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'update:record',\n\t\t\t\t\tid: action.id,\n\t\t\t\t\tdata: action.op.o,\n\t\t\t\t\toplog: true\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst diff = {};\n\t\t\tif (action.op.o.$set) {\n\t\t\t\tfor (const key in action.op.o.$set) {\n\t\t\t\t\tif (action.op.o.$set.hasOwnProperty(key)) {\n\t\t\t\t\t\tdiff[key] = action.op.o.$set[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (action.op.o.$unset) {\n\t\t\t\tfor (const key in action.op.o.$unset) {\n\t\t\t\t\tif (action.op.o.$unset.hasOwnProperty(key)) {\n\t\t\t\t\t\tdiff[key] = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'update:diff',\n\t\t\t\tid: action.id,\n\t\t\t\tdata: diff,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (action.op.op === 'd') {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'remove',\n\t\t\t\tid: action.id,\n\t\t\t\toplog: true\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\t}\n\n\tinsert(record) {\n\t\tthis.setUpdatedAt(record);\n\n\t\tconst result = this.originals.insert(...arguments);\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tthis.emit('change', {\n\t\t\t\taction: 'insert',\n\t\t\t\tid: result,\n\t\t\t\tdata: _.extend({}, record),\n\t\t\t\toplog: false\n\t\t\t});\n\t\t}\n\n\t\trecord._id = result;\n\n\t\treturn result;\n\t}\n\n\tupdate(query, update, options = {}) {\n\t\tthis.setUpdatedAt(update, true, query);\n\n\t\tconst strategy = this.defineSyncStrategy(query, update, options);\n\t\tlet ids = [];\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0 && strategy === 'db') {\n\t\t\tconst findOptions = {fields: {_id: 1}};\n\t\t\tlet records = options.multi ? this.find(query, findOptions).fetch() : this.findOne(query, findOptions) || [];\n\t\t\tif (!Array.isArray(records)) {\n\t\t\t\trecords = [records];\n\t\t\t}\n\n\t\t\tids = records.map(item => item._id);\n\t\t\tif (options.upsert !== true && this.updateHasPositionalOperator(update) === false) {\n\t\t\t\tquery = {\n\t\t\t\t\t_id: {\n\t\t\t\t\t\t$in: ids\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst result = this.originals.update(query, update, options);\n\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tif (strategy === 'db') {\n\t\t\t\tif (options.upsert === true) {\n\t\t\t\t\tif (result.insertedId) {\n\t\t\t\t\t\tthis.emit('change', {\n\t\t\t\t\t\t\taction: 'insert',\n\t\t\t\t\t\t\tid: result.insertedId,\n\t\t\t\t\t\t\tdata: this.findOne({_id: result.insertedId}),\n\t\t\t\t\t\t\toplog: false\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tquery = {\n\t\t\t\t\t\t_id: {\n\t\t\t\t\t\t\t$in: ids\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tlet records = options.multi ? this.find(query).fetch() : this.findOne(query) || [];\n\t\t\t\tif (!Array.isArray(records)) {\n\t\t\t\t\trecords = [records];\n\t\t\t\t}\n\t\t\t\tfor (const record of records) {\n\t\t\t\t\tthis.emit('change', {\n\t\t\t\t\t\taction: 'update:record',\n\t\t\t\t\t\tid: record._id,\n\t\t\t\t\t\tdata: record,\n\t\t\t\t\t\toplog: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'update:query',\n\t\t\t\t\tid: undefined,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tquery,\n\t\t\t\t\t\tupdate,\n\t\t\t\t\t\toptions\n\t\t\t\t\t},\n\t\t\t\t\toplog: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tupsert(query, update, options = {}) {\n\t\toptions.upsert = true;\n\t\toptions._returnObject = true;\n\t\treturn this.update(query, update, options);\n\t}\n\n\tremove(query) {\n\t\tconst records = this.model.find(query).fetch();\n\n\t\tconst ids = [];\n\t\tfor (const record of records) {\n\t\t\tids.push(record._id);\n\n\t\t\trecord._deletedAt = new Date;\n\t\t\trecord.__collection__ = this.name;\n\n\t\t\ttrash.upsert({_id: record._id}, _.omit(record, '_id'));\n\t\t}\n\n\t\tquery = { _id: { $in: ids } };\n\n\t\tconst result = this.originals.remove(query);\n\n\t\tif (!isOplogEnabled && this.listenerCount('change') > 0) {\n\t\t\tfor (const record of records) {\n\t\t\t\tthis.emit('change', {\n\t\t\t\t\taction: 'remove',\n\t\t\t\t\tid: record._id,\n\t\t\t\t\tdata: _.extend({}, record),\n\t\t\t\t\toplog: false\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tinsertOrUpsert(...args) {\n\t\tif (args[0] && args[0]._id) {\n\t\t\tconst _id = args[0]._id;\n\t\t\tdelete args[0]._id;\n\t\t\targs.unshift({\n\t\t\t\t_id\n\t\t\t});\n\n\t\t\tthis.upsert(...args);\n\t\t\treturn _id;\n\t\t} else {\n\t\t\treturn this.insert(...args);\n\t\t}\n\t}\n\n\tallow() {\n\t\treturn this.model.allow(...arguments);\n\t}\n\n\tdeny() {\n\t\treturn this.model.deny(...arguments);\n\t}\n\n\tensureIndex() {\n\t\treturn this.model._ensureIndex(...arguments);\n\t}\n\n\tdropIndex() {\n\t\treturn this.model._dropIndex(...arguments);\n\t}\n\n\ttryEnsureIndex() {\n\t\ttry {\n\t\t\treturn this.ensureIndex(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Error creating index:', this.name, '->', ...arguments, e);\n\t\t}\n\t}\n\n\ttryDropIndex() {\n\t\ttry {\n\t\t\treturn this.dropIndex(...arguments);\n\t\t} catch (e) {\n\t\t\tconsole.error('Error dropping index:', this.name, '->', ...arguments, e);\n\t\t}\n\t}\n\n\ttrashFind(query, options) {\n\t\tquery.__collection__ = this.name;\n\n\t\treturn trash.find(query, options);\n\t}\n\n\ttrashFindDeletedAfter(deletedAt, query = {}, options) {\n\t\tquery.__collection__ = this.name;\n\t\tquery._deletedAt = {\n\t\t\t$gt: deletedAt\n\t\t};\n\n\t\treturn trash.find(query, options);\n\t}\n}\n\nexport default ModelsBaseDb;\n","const AccessTokenServices = {};\n\nRocketChat.registerAccessTokenService = function(serviceName, handleAccessTokenRequest) {\n\tAccessTokenServices[serviceName] = {\n\t\tserviceName,\n\t\thandleAccessTokenRequest\n\t};\n};\n\n// Listen to calls to `login` with an oauth option set. This is where\n// users actually get logged in to meteor via oauth.\nAccounts.registerLoginHandler(function(options) {\n\tif (!options.accessToken) {\n\t\treturn undefined; // don't handle\n\t}\n\n\tcheck(options, Match.ObjectIncluding({\n\t\tserviceName: String\n\t}));\n\n\tconst service = AccessTokenServices[options.serviceName];\n\n\t// Skip everything if there's no service set by the oauth middleware\n\tif (!service) {\n\t\tthrow new Error(`Unexpected AccessToken service ${ options.serviceName }`);\n\t}\n\n\t// Make sure we're configured\n\tif (!ServiceConfiguration.configurations.findOne({service: service.serviceName})) {\n\t\tthrow new ServiceConfiguration.ConfigError();\n\t}\n\n\tif (!_.contains(Accounts.oauth.serviceNames(), service.serviceName)) {\n\t\t// serviceName was not found in the registered services list.\n\t\t// This could happen because the service never registered itself or\n\t\t// unregisterService was called on it.\n\t\treturn {\n\t\t\ttype: 'oauth',\n\t\t\terror: new Meteor.Error(\n\t\t\t\tAccounts.LoginCancelledError.numericError,\n\t\t\t\t`No registered oauth service found for: ${ service.serviceName }`\n\t\t\t)\n\t\t};\n\t}\n\n\tconst oauthResult = service.handleAccessTokenRequest(options);\n\n\treturn Accounts.updateOrCreateUserFromExternalService(service.serviceName, oauthResult.serviceData, oauthResult.options);\n});\n\n\n\n","/* globals Google */\n\nfunction getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get(\n\t\t\t'https://www.googleapis.com/oauth2/v1/userinfo',\n\t\t\t{params: {access_token: accessToken}}).data;\n\t} catch (err) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Google. ${ err.message }`), {response: err.response});\n\t}\n}\n\nfunction getScopes(accessToken) {\n\ttry {\n\t\treturn HTTP.get(\n\t\t\t'https://www.googleapis.com/oauth2/v1/tokeninfo',\n\t\t\t{params: {access_token: accessToken}}).data.scope.split(' ');\n\t} catch (err) {\n\t\tthrow _.extend(new Error(`Failed to fetch tokeninfo from Google. ${ err.message }`), {response: err.response});\n\t}\n}\n\n\nRocketChat.registerAccessTokenService('google', function(options) {\n\tcheck(options, Match.ObjectIncluding({\n\t\taccessToken: String,\n\t\tidToken: String,\n\t\texpiresIn: Match.Integer,\n\t\tscope: Match.Maybe(String),\n\t\tidentity: Match.Maybe(Object)\n\t}));\n\n\tconst identity = options.identity || getIdentity(options.accessToken);\n\n\tconst serviceData = {\n\t\taccessToken: options.accessToken,\n\t\tidToken: options.idToken,\n\t\texpiresAt: (+new Date) + (1000 * parseInt(options.expiresIn, 10)),\n\t\tscope: options.scopes || getScopes(options.accessToken)\n\t};\n\n\tconst fields = _.pick(identity, Google.whitelistedFields);\n\t_.extend(serviceData, fields);\n\n\t// only set the token in serviceData if it's there. this ensures\n\t// that we don't lose old ones (since we only get this on the first\n\t// log in attempt)\n\tif (options.refreshToken) {\n\t\tserviceData.refreshToken = options.refreshToken;\n\t}\n\n\treturn {\n\t\tserviceData,\n\t\toptions: {\n\t\t\tprofile: {\n\t\t\t\tname: identity.name\n\t\t\t}\n\t\t}\n\t};\n});\n","/* globals OAuth */\n\nOAuth._redirectUri = _.wrap(OAuth._redirectUri, function(func, serviceName, ...args) {\n\tconst proxy = RocketChat.settings.get('Accounts_OAuth_Proxy_services').replace(/\\s/g, '').split(',');\n\tif (proxy.includes(serviceName)) {\n\t\treturn `${ RocketChat.settings.get('Accounts_OAuth_Proxy_host') }/oauth_redirect`;\n\t} else {\n\t\treturn func(serviceName, ...args);\n\t}\n\n});\n","RocketChat.statsTracker = new (class StatsTracker {\n\tconstructor() {\n\t\tthis.StatsD = Npm.require('node-dogstatsd').StatsD;\n\t\tthis.dogstatsd = new this.StatsD();\n\t}\n\n\ttrack(type, stats, ...args) {\n\t\tthis.dogstatsd[type](`RocketChat.${ stats }`, ...args);\n\t}\n\n\tnow() {\n\t\tconst hrtime = process.hrtime();\n\t\treturn (hrtime[0] * 1000000 + hrtime[1] / 1000);\n\t}\n\n\ttiming(stats, time, tags) {\n\t\tthis.track('timing', stats, time, tags);\n\t}\n\n\tincrement(stats, time, tags) {\n\t\tthis.track('increment', stats, time, tags);\n\t}\n\n\tdecrement(stats, time, tags) {\n\t\tthis.track('decrement', stats, time, tags);\n\t}\n\n\thistogram(stats, time, tags) {\n\t\tthis.track('histogram', stats, time, tags);\n\t}\n\n\tgauge(stats, time, tags) {\n\t\tthis.track('gauge', stats, time, tags);\n\t}\n\n\tunique(stats, time, tags) {\n\t\tthis.track('unique', stats, time, tags);\n\t}\n\n\tset(stats, time, tags) {\n\t\tthis.track('set', stats, time, tags);\n\t}\n});\n","RocketChat.models.Rooms.cache.hasMany('Subscriptions', {\n\tfield: 'usernames',\n\tlink: {\n\t\tlocal: '_id',\n\t\tremote: 'rid',\n\t\ttransform(room, subscription) {\n\t\t\treturn subscription.u.username;\n\t\t},\n\t\tremove(arr, subscription) {\n\t\t\tif (arr.indexOf(subscription.u.username) > -1) {\n\t\t\t\tarr.splice(arr.indexOf(subscription.u.username), 1);\n\t\t\t}\n\t\t}\n\t}\n});\n\n\nRocketChat.models.Subscriptions.cache.hasOne('Rooms', {\n\tfield: '_room',\n\tlink: {\n\t\tlocal: 'rid',\n\t\tremote: '_id'\n\t}\n});\n\n\nRocketChat.models.Subscriptions.cache.hasOne('Users', {\n\tfield: '_user',\n\tlink: {\n\t\tlocal: 'u._id',\n\t\tremote: '_id'\n\t}\n});\n\nRocketChat.models.Subscriptions.cache.hasOne('Users', {\n\tfield: 'fname',\n\tlink: {\n\t\tlocal: 'name',\n\t\tremote: 'username',\n\t\twhere(subscription/*, user*/) {\n\t\t\treturn subscription.t === 'd';\n\t\t},\n\t\ttransform(subscription, user) {\n\t\t\tif (user == null || subscription == null) {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\t// Prevent client cache for old subscriptions with new names\n\t\t\t// Cuz when a user change his name, the subscription's _updateAt\n\t\t\t// will not change\n\t\t\tif (subscription._updatedAt < user._updatedAt) {\n\t\t\t\tsubscription._updatedAt = user._updatedAt;\n\t\t\t}\n\t\t\treturn user.name;\n\t\t}\n\t}\n});\n\nRocketChat.models.Users.cache.load();\nRocketChat.models.Rooms.cache.load();\nRocketChat.models.Subscriptions.cache.load();\nRocketChat.models.Settings.cache.load();\n\n\nRocketChat.models.Users.cache.addDynamicView('highlights').applyFind({\n\t'settings.preferences.highlights': {$size: {$gt: 0}}\n});\n\nRocketChat.models.Subscriptions.cache.addDynamicView('notifications').applyFind({\n\t$or: [\n\t\t{desktopNotifications: {$in: ['all', 'nothing']}},\n\t\t{mobilePushNotifications: {$in: ['all', 'nothing']}}\n\t]\n});\n","/* globals WebAppInternals*/\nfunction testWebAppInternals(fn) {\n\ttypeof WebAppInternals !== 'undefined' && fn(WebAppInternals);\n}\nRocketChat.settings.onload('CDN_PREFIX', function(key, value) {\n\tif (_.isString(value) && value.trim()) {\n\t\treturn testWebAppInternals(WebAppInternals => WebAppInternals.setBundledJsCssPrefix(value));\n\t}\n});\n\nMeteor.startup(function() {\n\tconst value = RocketChat.settings.get('CDN_PREFIX');\n\tif (_.isString(value) && value.trim()) {\n\t\treturn testWebAppInternals(WebAppInternals => WebAppInternals.setBundledJsCssPrefix(value));\n\t}\n});\n","import { IMAPIntercepter } from '../lib/interceptDirectReplyEmails.js';\nimport { POP3Helper } from '../lib/interceptDirectReplyEmails.js';\n\nconst startEmailIntercepter = _.debounce(Meteor.bindEnvironment(function() {\n\tconsole.log('Starting Email Intercepter...');\n\n\tif (RocketChat.settings.get('Direct_Reply_Enable') && RocketChat.settings.get('Direct_Reply_Protocol') && RocketChat.settings.get('Direct_Reply_Host') && RocketChat.settings.get('Direct_Reply_Port') && RocketChat.settings.get('Direct_Reply_Username') && RocketChat.settings.get('Direct_Reply_Password')) {\n\t\tif (RocketChat.settings.get('Direct_Reply_Protocol') === 'IMAP') {\n\t\t\t// stop already running IMAP instance\n\t\t\tif (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running IMAP instance...');\n\t\t\t\tRocketChat.IMAP.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else if (RocketChat.POP3 && RocketChat.POP3Helper && RocketChat.POP3Helper.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running POP instance...');\n\t\t\t\tRocketChat.POP3Helper.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('Starting new IMAP instance......');\n\t\t\t\tRocketChat.IMAP = new IMAPIntercepter();\n\t\t\t\tRocketChat.IMAP.start();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t} else if (RocketChat.settings.get('Direct_Reply_Protocol') === 'POP') {\n\t\t\t// stop already running POP instance\n\t\t\tif (RocketChat.POP3 && RocketChat.POP3Helper && RocketChat.POP3Helper.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running POP instance...');\n\t\t\t\tRocketChat.POP3Helper.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else if (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t\t\tconsole.log('Disconnecting already running IMAP instance...');\n\t\t\t\tRocketChat.IMAP.stop(Meteor.bindEnvironment(function() {\n\t\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\t\treturn true;\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconsole.log('Starting new POP instance......');\n\t\t\t\tRocketChat.POP3Helper = new POP3Helper();\n\t\t\t\tRocketChat.POP3Helper.start();\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t} else if (RocketChat.IMAP && RocketChat.IMAP.isActive()) {\n\t\t// stop IMAP instance\n\t\tRocketChat.IMAP.stop();\n\t} else if (RocketChat.POP3 && RocketChat.POP3Helper.isActive()) {\n\t\t// stop POP3 instance\n\t\tRocketChat.POP3Helper.stop();\n\t}\n}), 1000);\n\nRocketChat.settings.onload(/^Direct_Reply_.+/, startEmailIntercepter);\n","const buildMailURL = _.debounce(function() {\n\tconsole.log('Updating process.env.MAIL_URL');\n\n\tif (RocketChat.settings.get('SMTP_Host')) {\n\t\tprocess.env.MAIL_URL = `${ RocketChat.settings.get('SMTP_Protocol') }://`;\n\n\t\tif (RocketChat.settings.get('SMTP_Username') && RocketChat.settings.get('SMTP_Password')) {\n\t\t\tprocess.env.MAIL_URL += `${ encodeURIComponent(RocketChat.settings.get('SMTP_Username')) }:${ encodeURIComponent(RocketChat.settings.get('SMTP_Password')) }@`;\n\t\t}\n\n\t\tprocess.env.MAIL_URL += encodeURIComponent(RocketChat.settings.get('SMTP_Host'));\n\n\t\tif (RocketChat.settings.get('SMTP_Port')) {\n\t\t\tprocess.env.MAIL_URL += `:${ parseInt(RocketChat.settings.get('SMTP_Port')) }`;\n\t\t}\n\n\t\tprocess.env.MAIL_URL += `?pool=${ RocketChat.settings.get('SMTP_Pool') }`;\n\n\t\tif (RocketChat.settings.get('SMTP_Protocol') === 'smtp' && RocketChat.settings.get('SMTP_IgnoreTLS')) {\n\t\t\tprocess.env.MAIL_URL += '&secure=false&ignoreTLS=true';\n\t\t}\n\n\t\treturn process.env.MAIL_URL;\n\t}\n}, 500);\n\nRocketChat.settings.onload('SMTP_Host', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Port', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_Username', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Password', function(key, value) {\n\tif (_.isString(value)) {\n\t\treturn buildMailURL();\n\t}\n});\n\nRocketChat.settings.onload('SMTP_Protocol', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_Pool', function() {\n\treturn buildMailURL();\n});\n\nRocketChat.settings.onload('SMTP_IgnoreTLS', function() {\n\treturn buildMailURL();\n});\n\nMeteor.startup(function() {\n\treturn buildMailURL();\n});\n","/* globals CustomOAuth */\nconst logger = new Logger('rocketchat:lib', {\n\tmethods: {\n\t\toauth_updated: {\n\t\t\ttype: 'info'\n\t\t}\n\t}\n});\n\nfunction _OAuthServicesUpdate() {\n\tconst services = RocketChat.settings.get(/^(Accounts_OAuth_|Accounts_OAuth_Custom-)[a-z0-9_]+$/i);\n\tservices.forEach((service) => {\n\t\tlogger.oauth_updated(service.key);\n\t\tlet serviceName = service.key.replace('Accounts_OAuth_', '');\n\t\tif (serviceName === 'Meteor') {\n\t\t\tserviceName = 'meteor-developer';\n\t\t}\n\t\tif (/Accounts_OAuth_Custom-/.test(service.key)) {\n\t\t\tserviceName = service.key.replace('Accounts_OAuth_Custom-', '');\n\t\t}\n\t\tif (service.value === true) {\n\t\t\tconst data = {\n\t\t\t\tclientId: RocketChat.settings.get(`${ service.key }_id`),\n\t\t\t\tsecret: RocketChat.settings.get(`${ service.key }_secret`)\n\t\t\t};\n\t\t\tif (/Accounts_OAuth_Custom-/.test(service.key)) {\n\t\t\t\tdata.custom = true;\n\t\t\t\tdata.clientId = RocketChat.settings.get(`${ service.key }-id`);\n\t\t\t\tdata.secret = RocketChat.settings.get(`${ service.key }-secret`);\n\t\t\t\tdata.serverURL = RocketChat.settings.get(`${ service.key }-url`);\n\t\t\t\tdata.tokenPath = RocketChat.settings.get(`${ service.key }-token_path`);\n\t\t\t\tdata.identityPath = RocketChat.settings.get(`${ service.key }-identity_path`);\n\t\t\t\tdata.authorizePath = RocketChat.settings.get(`${ service.key }-authorize_path`);\n\t\t\t\tdata.scope = RocketChat.settings.get(`${ service.key }-scope`);\n\t\t\t\tdata.buttonLabelText = RocketChat.settings.get(`${ service.key }-button_label_text`);\n\t\t\t\tdata.buttonLabelColor = RocketChat.settings.get(`${ service.key }-button_label_color`);\n\t\t\t\tdata.loginStyle = RocketChat.settings.get(`${ service.key }-login_style`);\n\t\t\t\tdata.buttonColor = RocketChat.settings.get(`${ service.key }-button_color`);\n\t\t\t\tdata.tokenSentVia = RocketChat.settings.get(`${ service.key }-token_sent_via`);\n\t\t\t\tdata.usernameField = RocketChat.settings.get(`${ service.key }-username_field`);\n\t\t\t\tdata.mergeUsers = RocketChat.settings.get(`${ service.key }-merge_users`);\n\t\t\t\tnew CustomOAuth(serviceName.toLowerCase(), {\n\t\t\t\t\tserverURL: data.serverURL,\n\t\t\t\t\ttokenPath: data.tokenPath,\n\t\t\t\t\tidentityPath: data.identityPath,\n\t\t\t\t\tauthorizePath: data.authorizePath,\n\t\t\t\t\tscope: data.scope,\n\t\t\t\t\tloginStyle: data.loginStyle,\n\t\t\t\t\ttokenSentVia: data.tokenSentVia,\n\t\t\t\t\tusernameField: data.usernameField,\n\t\t\t\t\tmergeUsers: data.mergeUsers\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (serviceName === 'Facebook') {\n\t\t\t\tdata.appId = data.clientId;\n\t\t\t\tdelete data.clientId;\n\t\t\t}\n\t\t\tif (serviceName === 'Twitter') {\n\t\t\t\tdata.consumerKey = data.clientId;\n\t\t\t\tdelete data.clientId;\n\t\t\t}\n\t\t\tServiceConfiguration.configurations.upsert({\n\t\t\t\tservice: serviceName.toLowerCase()\n\t\t\t}, {\n\t\t\t\t$set: data\n\t\t\t});\n\t\t} else {\n\t\t\tServiceConfiguration.configurations.remove({\n\t\t\t\tservice: serviceName.toLowerCase()\n\t\t\t});\n\t\t}\n\t});\n}\n\nconst OAuthServicesUpdate = _.debounce(Meteor.bindEnvironment(_OAuthServicesUpdate), 2000);\n\nfunction OAuthServicesRemove(_id) {\n\tconst serviceName = _id.replace('Accounts_OAuth_Custom-', '');\n\treturn ServiceConfiguration.configurations.remove({\n\t\tservice: serviceName.toLowerCase()\n\t});\n}\n\nRocketChat.settings.get(/^Accounts_OAuth_.+/, function() {\n\treturn OAuthServicesUpdate(); // eslint-disable-line new-cap\n});\n\nRocketChat.settings.get(/^Accounts_OAuth_Custom-[a-z0-9_]+/, function(key, value) {\n\tif (!value) {\n\t\treturn OAuthServicesRemove(key);// eslint-disable-line new-cap\n\t}\n});\n","// Insert server unique id if it doesn't exist\nRocketChat.settings.add('uniqueID', process.env.DEPLOYMENT_ID || Random.id(), {\n\t'public': true,\n\thidden: true\n});\n\n// When you define a setting and want to add a description, you don't need to automatically define the i18nDescription\n// if you add a node to the i18n.json with the same setting name but with `_Description` it will automatically work.\n\nRocketChat.settings.addGroup('Accounts', function() {\n\tthis.add('Accounts_AllowAnonymousRead', false, {\n\t\ttype: 'boolean',\n\t\tpublic: true\n\t});\n\tthis.add('Accounts_AllowAnonymousWrite', false, {\n\t\ttype: 'boolean',\n\t\tpublic: true,\n\t\tenableQuery: {\n\t\t\t_id: 'Accounts_AllowAnonymousRead',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Accounts_AllowDeleteOwnAccount', false, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: {\n\t\t\t_id: 'Accounts_AllowUserProfileChange',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Accounts_AllowUserProfileChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowUserAvatarChange', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowUsernameChange', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowEmailChange', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_AllowPasswordChange', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_CustomFieldsToShowInUserInfo', '', {\n\t\ttype: 'string',\n\t\tpublic: true\n\t});\n\tthis.add('Accounts_LoginExpiration', 90, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_ShowFormLogin', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_EmailOrUsernamePlaceholder', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nLabel: 'Placeholder_for_email_or_username_login_field'\n\t});\n\tthis.add('Accounts_PasswordPlaceholder', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nLabel: 'Placeholder_for_password_login_field'\n\t});\n\tthis.add('Accounts_ForgetUserSessionOnWindowClose', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Accounts_SearchFields', 'username, name, emails.address', {\n\t\ttype: 'string',\n\t\tpublic: true\n\t});\n\n\tthis.section('Registration', function() {\n\t\tthis.add('Accounts_DefaultUsernamePrefixSuggestion', 'user', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_RequireNameForSignUp', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_RequirePasswordConfirmation', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_EmailVerification', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'SMTP_Host',\n\t\t\t\tvalue: {\n\t\t\t\t\t$exists: 1,\n\t\t\t\t\t$ne: ''\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.add('Accounts_ManuallyApproveNewUsers', false, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_AllowedDomainsList', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_BlockedDomainsList', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_BlockedUsernameList', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_UseDefaultBlockedDomainsList', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_UseDNSDomainCheck', false, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm', 'Disabled', {\n\t\t\ttype: 'select',\n\t\t\t'public': true,\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'Public',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Public'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Disabled',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Disabled'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Secret URL',\n\t\t\t\t\ti18nLabel: 'Accounts_RegistrationForm_Secret_URL'\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm_SecretURL', Random.id(), {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Accounts_RegistrationForm_LinkReplacementText', 'New user registration is currently disabled', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Registration_AuthenticationServices_Enabled', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_Registration_AuthenticationServices_Default_Roles', 'user', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Registration_AuthenticationServices_Enabled',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t\tthis.add('Accounts_PasswordReset', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_CustomFields', '', {\n\t\t\ttype: 'code',\n\t\t\t'public': true,\n\t\t\ti18nLabel: 'Custom_Fields'\n\t\t});\n\t});\n\n\tthis.section('Avatar', function() {\n\t\tthis.add('Accounts_AvatarResize', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t\tthis.add('Accounts_AvatarSize', 200, {\n\t\t\ttype: 'int',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_AvatarResize',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\treturn this.add('Accounts_SetDefaultAvatar', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('OAuth', function() {\n\tthis.section('Facebook', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Facebook',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Facebook', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Facebook_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Facebook_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Facebook_callback_url', '_oauth/facebook', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Google', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Google',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Google', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Google_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Google_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Google_callback_url', '_oauth/google', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('GitHub', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Github',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Github', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Github_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Github_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Github_callback_url', '_oauth/github', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Linkedin', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Linkedin',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Linkedin', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Linkedin_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Linkedin_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Linkedin_callback_url', '_oauth/linkedin', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Meteor', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Meteor',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Meteor', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Meteor_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Meteor_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Meteor_callback_url', '_oauth/meteor', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\tthis.section('Twitter', function() {\n\t\tconst enableQuery = {\n\t\t\t_id: 'Accounts_OAuth_Twitter',\n\t\t\tvalue: true\n\t\t};\n\t\tthis.add('Accounts_OAuth_Twitter', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Accounts_OAuth_Twitter_id', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\tthis.add('Accounts_OAuth_Twitter_secret', '', {\n\t\t\ttype: 'string',\n\t\t\tenableQuery\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Twitter_callback_url', '_oauth/twitter', {\n\t\t\ttype: 'relativeUrl',\n\t\t\treadonly: true,\n\t\t\tforce: true,\n\t\t\tenableQuery\n\t\t});\n\t});\n\treturn this.section('Proxy', function() {\n\t\tthis.add('Accounts_OAuth_Proxy_host', 'https://oauth-proxy.rocket.chat', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Accounts_OAuth_Proxy_services', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('General', function() {\n\tthis.add('Site_Url', typeof __meteor_runtime_config__ !== 'undefined' && __meteor_runtime_config__ !== null ? __meteor_runtime_config__.ROOT_URL : null, {\n\t\ttype: 'string',\n\t\ti18nDescription: 'Site_Url_Description',\n\t\t'public': true\n\t});\n\tthis.add('Site_Name', 'Chat+', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Language', '', {\n\t\ttype: 'language',\n\t\t'public': true\n\t});\n\tthis.add('Allow_Invalid_SelfSigned_Certs', false, {\n\t\ttype: 'boolean'\n\t});\n\tthis.add('Favorite_Rooms', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('First_Channel_After_Login', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Unread_Count', 'user_and_group_mentions_only', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: 'all_messages',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'user_mentions_only',\n\t\t\t\ti18nLabel: 'User_mentions_only'\n\t\t\t}, {\n\t\t\t\tkey: 'group_mentions_only',\n\t\t\t\ti18nLabel: 'Group_mentions_only'\n\t\t\t}, {\n\t\t\t\tkey: 'user_and_group_mentions_only',\n\t\t\t\ti18nLabel: 'User_and_group_mentions_only'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('Unread_Count_DM', 'all_messages', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: 'all_messages',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'mentions_only',\n\t\t\t\ti18nLabel: 'Mentions_only'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('CDN_PREFIX', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Force_SSL', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('GoogleTagManager_id', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Bugsnag_api_key', '', {\n\t\ttype: 'string',\n\t\t'public': false\n\t});\n\tthis.add('Force_Disable_OpLog_For_Cache', false, {\n\t\ttype: 'boolean',\n\t\t'public': false\n\t});\n\tthis.add('Restart', 'restart_server', {\n\t\ttype: 'action',\n\t\tactionText: 'Restart_the_server'\n\t});\n\tthis.section('UTF8', function() {\n\t\tthis.add('UTF8_Names_Validation', '[0-9a-zA-Z-_.]+', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'UTF8_Names_Validation_Description'\n\t\t});\n\t\treturn this.add('UTF8_Names_Slugify', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t});\n\tthis.section('Reporting', function() {\n\t\treturn this.add('Statistics_reporting', true, {\n\t\t\ttype: 'boolean'\n\t\t});\n\t});\n\tthis.section('Notifications', function() {\n\t\tthis.add('Desktop_Notifications_Duration', 0, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Desktop_Notification_Durations_Description'\n\t\t});\n\n\t\tthis.add('Audio_Notifications_Value', 'chime', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Audio_Notification_Value_Description'\n\t\t});\n\n\t\tthis.add('Audio_Notifications_Default_Alert', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [{\n\t\t\t\tkey: 'all',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'mentions',\n\t\t\t\ti18nLabel: 'Mentions'\n\t\t\t}, {\n\t\t\t\tkey: 'nothing',\n\t\t\t\ti18nLabel: 'Nothing'\n\t\t\t}],\n\t\t\tpublic: true\n\t\t});\n\n\t\tthis.add('Desktop_Notifications_Default_Alert', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [{\n\t\t\t\tkey: 'all',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'mentions',\n\t\t\t\ti18nLabel: 'Mentions'\n\t\t\t}, {\n\t\t\t\tkey: 'nothing',\n\t\t\t\ti18nLabel: 'Nothing'\n\t\t\t}],\n\t\t\tpublic: true\n\t\t});\n\n\t\tthis.add('Mobile_Notifications_Default_Alert', 'mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [{\n\t\t\t\tkey: 'all',\n\t\t\t\ti18nLabel: 'All_messages'\n\t\t\t}, {\n\t\t\t\tkey: 'mentions',\n\t\t\t\ti18nLabel: 'Mentions'\n\t\t\t}, {\n\t\t\t\tkey: 'nothing',\n\t\t\t\ti18nLabel: 'Nothing'\n\t\t\t}],\n\t\t\tpublic: true\n\t\t});\n\n\t\tthis.add('Notifications_Max_Room_Members', 100, {\n\t\t\ttype: 'int',\n\t\t\tpublic: true,\n\t\t\ti18nDescription: 'Notifications_Max_Room_Members_Description'\n\t\t});\n\t});\n\tthis.section('REST API', function() {\n\t\treturn this.add('API_User_Limit', 500, {\n\t\t\ttype: 'int',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'API_User_Limit'\n\t\t});\n\t});\n\tthis.section('Iframe_Integration', function() {\n\t\tthis.add('Iframe_Integration_send_enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Iframe_Integration_send_target_origin', '*', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Iframe_Integration_send_enable',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t\tthis.add('Iframe_Integration_receive_enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Iframe_Integration_receive_origin', '*', {\n\t\t\ttype: 'string',\n\t\t\t'public': true,\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Iframe_Integration_receive_enable',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Translations', function() {\n\t\treturn this.add('Custom_Translations', '', {\n\t\t\ttype: 'code',\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('Stream_Cast', function() {\n\t\treturn this.add('Stream_Cast_Address', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Email', function() {\n\tthis.section('Subject', function() {\n\t\tthis.add('Offline_DM_Email', '[[Site_Name]] You have been direct messaged by [User]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_DM_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t\tthis.add('Offline_Mention_Email', '[[Site_Name]] You have been mentioned by [User] in #[Room]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_Mention_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t\treturn this.add('Offline_Mention_All_Email', '[User] has posted a message in #[Room]', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Offline_Mention_All_Email',\n\t\t\ti18nDescription: 'Offline_Email_Subject_Description'\n\t\t});\n\t});\n\tthis.section('Header_and_Footer', function() {\n\t\tthis.add('Email_Header', '<html><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:collapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Header'\n\t\t});\n\t\tthis.add('Email_Footer', '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\"></td></tr></table></td></tr></table></html>', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Footer'\n\t\t});\n\t\treturn this.add('Email_Footer_Direct_Reply', '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">You can directly reply to this email.<br>Do not temper reply email<br>Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table></html>', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Footer_Direct_Reply'\n\t\t});\n\t});\n\tthis.section('Direct_Reply', function() {\n\t\tthis.add('Direct_Reply_Enable', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Enable'\n\t\t});\n\t\tthis.add('Direct_Reply_Debug', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Debug',\n\t\t\ti18nDescription: 'Direct_Reply_Debug_Description'\n\t\t});\n\t\tthis.add('Direct_Reply_Protocol', 'IMAP', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'IMAP',\n\t\t\t\t\ti18nLabel: 'IMAP'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'POP',\n\t\t\t\t\ti18nLabel: 'POP'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Protocol'\n\t\t});\n\t\tthis.add('Direct_Reply_Host', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Host'\n\t\t});\n\t\tthis.add('Direct_Reply_Port', '143', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: '143',\n\t\t\t\t\ti18nLabel: '143'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '993',\n\t\t\t\t\ti18nLabel: '993'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '110',\n\t\t\t\t\ti18nLabel: '110'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '995',\n\t\t\t\t\ti18nLabel: '995'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Port'\n\t\t});\n\t\tthis.add('Direct_Reply_IgnoreTLS', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'IgnoreTLS'\n\t\t});\n\t\tthis.add('Direct_Reply_Frequency', 5, {\n\t\t\ttype: 'int',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Frequency',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Direct_Reply_Protocol',\n\t\t\t\tvalue: 'POP'\n\t\t\t}\n\t\t});\n\t\tthis.add('Direct_Reply_Delete', true, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Delete',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Direct_Reply_Protocol',\n\t\t\t\tvalue: 'IMAP'\n\t\t\t}\n\t\t});\n\t\tthis.add('Direct_Reply_Separator', '+', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: '!',\n\t\t\t\t\ti18nLabel: '!'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '#',\n\t\t\t\t\ti18nLabel: '#'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '$',\n\t\t\t\t\ti18nLabel: '$'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '%',\n\t\t\t\t\ti18nLabel: '%'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '&',\n\t\t\t\t\ti18nLabel: '&'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '\\'',\n\t\t\t\t\ti18nLabel: '\\''\n\t\t\t\t}, {\n\t\t\t\t\tkey: '*',\n\t\t\t\t\ti18nLabel: '*'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '+',\n\t\t\t\t\ti18nLabel: '+'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '-',\n\t\t\t\t\ti18nLabel: '-'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '/',\n\t\t\t\t\ti18nLabel: '/'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '=',\n\t\t\t\t\ti18nLabel: '='\n\t\t\t\t}, {\n\t\t\t\t\tkey: '?',\n\t\t\t\t\ti18nLabel: '?'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '^',\n\t\t\t\t\ti18nLabel: '^'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '_',\n\t\t\t\t\ti18nLabel: '_'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '`',\n\t\t\t\t\ti18nLabel: '`'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '{',\n\t\t\t\t\ti18nLabel: '{'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '|',\n\t\t\t\t\ti18nLabel: '|'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '}',\n\t\t\t\t\ti18nLabel: '}'\n\t\t\t\t}, {\n\t\t\t\t\tkey: '~',\n\t\t\t\t\ti18nLabel: '~'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Direct_Reply_Separator'\n\t\t});\n\t\tthis.add('Direct_Reply_Username', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Username',\n\t\t\tplaceholder: 'email@domain'\n\t\t});\n\t\treturn this.add('Direct_Reply_Password', '', {\n\t\t\ttype: 'password',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Password'\n\t\t});\n\t});\n\tthis.section('SMTP', function() {\n\t\tthis.add('SMTP_Protocol', 'smtp', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'smtp',\n\t\t\t\t\ti18nLabel: 'smtp'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'smtps',\n\t\t\t\t\ti18nLabel: 'smtps'\n\t\t\t\t}\n\t\t\t],\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Protocol'\n\t\t});\n\t\tthis.add('SMTP_Host', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Host'\n\t\t});\n\t\tthis.add('SMTP_Port', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Port'\n\t\t});\n\t\tthis.add('SMTP_IgnoreTLS', false, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'IgnoreTLS',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'SMTP_Protocol',\n\t\t\t\tvalue: 'smtp'\n\t\t\t}\n\t\t});\n\t\tthis.add('SMTP_Pool', true, {\n\t\t\ttype: 'boolean',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Pool'\n\t\t});\n\t\tthis.add('SMTP_Username', '', {\n\t\t\ttype: 'string',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Username'\n\t\t});\n\t\tthis.add('SMTP_Password', '', {\n\t\t\ttype: 'password',\n\t\t\tenv: true,\n\t\t\ti18nLabel: 'Password'\n\t\t});\n\t\tthis.add('From_Email', '', {\n\t\t\ttype: 'string',\n\t\t\tplaceholder: 'email@domain'\n\t\t});\n\t\treturn this.add('SMTP_Test_Button', 'sendSMTPTestEmail', {\n\t\t\ttype: 'action',\n\t\t\tactionText: 'Send_a_test_mail_to_my_user'\n\t\t});\n\t});\n\tthis.section('Invitation', function() {\n\t\tthis.add('Invitation_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Invitation_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Invitation_HTML', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Invitation_HTML_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Invitation_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Registration', function() {\n\t\tthis.add('Accounts_Enrollment_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Accounts_Enrollment_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Accounts_Enrollment_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_Enrollment_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Registration_via_Admin', function() {\n\t\tthis.add('Accounts_UserAddedEmail_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Accounts_UserAddedEmailSubject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Accounts_UserAddedEmail', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Accounts_UserAddedEmail_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Accounts_UserAddedEmail_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\tthis.section('Forgot_password_section', function() {\n\t\tthis.add('Forgot_Password_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Forgot_Password_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Forgot_Password_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Forgot_Password_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Forgot_Password_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n\treturn this.section('Verification', function() {\n\t\tthis.add('Verification_Customized', false, {\n\t\t\ttype: 'boolean',\n\t\t\ti18nLabel: 'Custom'\n\t\t});\n\t\tthis.add('Verification_Email_Subject', '', {\n\t\t\ttype: 'string',\n\t\t\ti18nLabel: 'Subject',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t\treturn this.add('Verification_Email', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\ti18nLabel: 'Body',\n\t\t\ti18nDescription: 'Verification_Description',\n\t\t\tenableQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: true\n\t\t\t},\n\t\t\ti18nDefaultQuery: {\n\t\t\t\t_id: 'Verification_Customized',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Message', function() {\n\tthis.section('Message_Attachments', function() {\n\t\tthis.add('Message_Attachments_GroupAttach', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Message_Attachments_GroupAttachDescription'\n\t\t});\n\t\tthis.add('Message_AudioRecorderEnabled', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Message_AudioRecorderEnabledDescription'\n\t\t});\n\t});\n\tthis.add('Message_AllowEditing', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowEditing_BlockEditInMinutes', 0, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_AllowEditing_BlockEditInMinutesDescription'\n\t});\n\tthis.add('Message_AllowDeleting', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowDeleting_BlockDeleteInMinutes', 0, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_AllowDeleting_BlockDeleteInMinutes'\n\t});\n\tthis.add('Message_AllowUnrecognizedSlashCommand', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AlwaysSearchRegExp', false, {\n\t\ttype: 'boolean'\n\t});\n\tthis.add('Message_ShowEditedStatus', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_ShowDeletedStatus', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_AllowBadWordsFilter', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_BadWordsFilterList', '', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('Message_KeepHistory', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_MaxAll', 0, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_MaxAllowedSize', 5000, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_ShowFormattingTips', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_SetNameToAliasEnabled', false, {\n\t\ttype: 'boolean',\n\t\t'public': false,\n\t\ti18nDescription: 'Message_SetNameToAliasEnabled_Description'\n\t});\n\tthis.add('Message_GroupingPeriod', 300, {\n\t\ttype: 'int',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_GroupingPeriodDescription'\n\t});\n\tthis.add('API_Embed', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('API_Embed_UserAgent', 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36', {\n\t\ttype: 'string',\n\t\t'public': true\n\t});\n\tthis.add('API_EmbedCacheExpirationDays', 30, {\n\t\ttype: 'int',\n\t\t'public': false\n\t});\n\tthis.add('API_Embed_clear_cache_now', 'OEmbedCacheCleanup', {\n\t\ttype: 'action',\n\t\tactionText: 'clear',\n\t\ti18nLabel: 'clear_cache_now'\n\t});\n\tthis.add('API_EmbedDisabledFor', '', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'API_EmbedDisabledFor_Description'\n\t});\n\tthis.add('API_EmbedIgnoredHosts', 'localhost, 127.0.0.1, 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16', {\n\t\ttype: 'string',\n\t\ti18nDescription: 'API_EmbedIgnoredHosts_Description'\n\t});\n\tthis.add('API_EmbedSafePorts', '80, 443', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Message_TimeFormat', 'LT', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_TimeFormat_Description'\n\t});\n\tthis.add('Message_DateFormat', 'LL', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_DateFormat_Description'\n\t});\n\tthis.add('Message_TimeAndDateFormat', 'LLL', {\n\t\ttype: 'string',\n\t\t'public': true,\n\t\ti18nDescription: 'Message_TimeAndDateFormat_Description'\n\t});\n\tthis.add('Message_QuoteChainLimit', 2, {\n\t\ttype: 'int',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_uj', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_ul', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_ru', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Message_HideType_au', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\n\treturn this.add('Message_HideType_mute_unmute', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n});\n\nRocketChat.settings.addGroup('Meta', function() {\n\tthis.add('Meta_language', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_fb_app_id', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_robots', 'INDEX,FOLLOW', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_google-site-verification', '', {\n\t\ttype: 'string'\n\t});\n\tthis.add('Meta_msvalidate01', '', {\n\t\ttype: 'string'\n\t});\n\treturn this.add('Meta_custom', '', {\n\t\ttype: 'code',\n\t\tcode: 'text/html',\n\t\tmultiline: true\n\t});\n});\n\nRocketChat.settings.addGroup('Push', function() {\n\tthis.add('Push_enable', true, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Push_debug', false, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Push_enable_gateway', true, {\n\t\ttype: 'boolean',\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.add('Push_gateway', 'https://gateway.rocket.chat', {\n\t\ttype: 'string',\n\t\tenableQuery: [\n\t\t\t{\n\t\t\t\t_id: 'Push_enable',\n\t\t\t\tvalue: true\n\t\t\t}, {\n\t\t\t\t_id: 'Push_enable_gateway',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t]\n\t});\n\tthis.add('Push_production', true, {\n\t\ttype: 'boolean',\n\t\t'public': true,\n\t\tenableQuery: [\n\t\t\t{\n\t\t\t\t_id: 'Push_enable',\n\t\t\t\tvalue: true\n\t\t\t}, {\n\t\t\t\t_id: 'Push_enable_gateway',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t]\n\t});\n\tthis.add('Push_test_push', 'push_test', {\n\t\ttype: 'action',\n\t\tactionText: 'Send_a_test_push_to_my_user',\n\t\tenableQuery: {\n\t\t\t_id: 'Push_enable',\n\t\t\tvalue: true\n\t\t}\n\t});\n\tthis.section('Certificates_and_Keys', function() {\n\t\tthis.add('Push_apn_passphrase', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Push_apn_key', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_cert', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_dev_passphrase', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\tthis.add('Push_apn_dev_key', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_apn_dev_cert', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true\n\t\t});\n\t\tthis.add('Push_gcm_api_key', '', {\n\t\t\ttype: 'string'\n\t\t});\n\t\treturn this.add('Push_gcm_project_number', '', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('Privacy', function() {\n\t\tthis.add('Push_show_username_room', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Push_show_message', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Layout', function() {\n\tthis.section('Content', function() {\n\t\tthis.add('Layout_Home_Title', 'Home', {\n\t\t\ttype: 'string',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Home_Body', 'Welcome to Chat <br> Go to APP SETTINGS -> Layout to customize this intro.', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Terms_of_Service', 'Terms of Service <br> Go to APP SETTINGS -> Layout to customize this page.', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Login_Terms', '', {\n\t\t\ttype: 'string',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('Layout_Privacy_Policy', 'Privacy Policy <br> Go to APP SETTINGS -> Layout to customize this page.', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Layout_Sidenav_Footer', '', {\n\t\t\ttype: 'code',\n\t\t\tcode: 'text/html',\n\t\t\t'public': true,\n\t\t\ti18nDescription: 'Layout_Sidenav_Footer_description'\n\t\t});\n\t});\n\tthis.section('Custom_Scripts', function() {\n\t\tthis.add('Custom_Script_Logged_Out', '//Add your script', {\n\t\t\ttype: 'code',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t\treturn this.add('Custom_Script_Logged_In', '//Add your script', {\n\t\t\ttype: 'code',\n\t\t\tmultiline: true,\n\t\t\t'public': true\n\t\t});\n\t});\n\treturn this.section('User_Interface', function() {\n\t\tthis.add('UI_DisplayRoles', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Merge_Channels_Groups', true, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Use_Name_Avatar', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Use_Real_Name', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Click_Direct_Message', false, {\n\t\t\ttype: 'boolean',\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Unread_Counter_Style', 'Different_Style_For_User_Mentions', {\n\t\t\ttype: 'select',\n\t\t\tvalues: [\n\t\t\t\t{\n\t\t\t\t\tkey: 'Same_Style_For_Mentions',\n\t\t\t\t\ti18nLabel: 'Same_Style_For_Mentions'\n\t\t\t\t}, {\n\t\t\t\t\tkey: 'Different_Style_For_User_Mentions',\n\t\t\t\t\ti18nLabel: 'Different_Style_For_User_Mentions'\n\t\t\t\t}\n\t\t\t],\n\t\t\t'public': true\n\t\t});\n\t\tthis.add('UI_Allow_room_names_with_special_chars', false, {\n\t\t\ttype: 'boolean',\n\t\t\tpublic: true\n\t\t});\n\t});\n});\n\nRocketChat.settings.addGroup('Logs', function() {\n\tthis.add('Log_Level', '0', {\n\t\ttype: 'select',\n\t\tvalues: [\n\t\t\t{\n\t\t\t\tkey: '0',\n\t\t\t\ti18nLabel: '0_Errors_Only'\n\t\t\t}, {\n\t\t\t\tkey: '1',\n\t\t\t\ti18nLabel: '1_Errors_and_Information'\n\t\t\t}, {\n\t\t\t\tkey: '2',\n\t\t\t\ti18nLabel: '2_Erros_Information_and_Debug'\n\t\t\t}\n\t\t],\n\t\t'public': true\n\t});\n\tthis.add('Log_Package', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\tthis.add('Log_File', false, {\n\t\ttype: 'boolean',\n\t\t'public': true\n\t});\n\treturn this.add('Log_View_Limit', 1000, {\n\t\ttype: 'int'\n\t});\n});\n\nRocketChat.settings.init();\n","Meteor.methods({\n\t'public-settings/get'(updatedAt) {\n\t\tthis.unblock();\n\t\tconst records = RocketChat.models.Settings.find().fetch().filter(function(record) {\n\t\t\treturn record.hidden !== true && record['public'] === true;\n\t\t});\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Settings.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\thidden: {\n\t\t\t\t\t\t$ne: true\n\t\t\t\t\t},\n\t\t\t\t\t'public': true\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t},\n\t'private-settings/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\t\tthis.unblock();\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-privileged-setting')) {\n\t\t\treturn [];\n\t\t}\n\t\tconst records = RocketChat.models.Settings.find().fetch().filter(function(record) {\n\t\t\treturn record.hidden !== true;\n\t\t});\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Settings.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\thidden: {\n\t\t\t\t\t\t$ne: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Settings.cache.on('changed', function(type, setting) {\n\tif (setting['public'] === true) {\n\t\tRocketChat.Notifications.notifyAllInThisInstance('public-settings-changed', type, _.pick(setting, '_id', 'value', 'editor', 'properties'));\n\t}\n\treturn RocketChat.Notifications.notifyLoggedInThisInstance('private-settings-changed', type, setting);\n});\n\nRocketChat.Notifications.streamAll.allowRead('private-settings-changed', function() {\n\tif (this.userId == null) {\n\t\treturn false;\n\t}\n\treturn RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting');\n});\n","/* eslint no-multi-spaces: 0 */\n/* eslint comma-spacing: 0 */\n\nMeteor.methods({\n\taddOAuthService(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'addOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Adding OAuth Services is not allowed', { method: 'addOAuthService', action: 'Adding_OAuth_Services' });\n\t\t}\n\n\t\tname = name.toLowerCase().replace(/[^a-z0-9_]/g, '');\n\t\tname = s.capitalize(name);\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }`                   , false             , { type: 'boolean', group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Enable', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-url`               , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'URL', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-token_path`        , '/oauth/token'    , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Token_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-identity_path`     , '/me'             , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Identity_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-authorize_path`    , '/oauth/authorize', { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Authorize_Path', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-scope`             , 'openid'          , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Scope', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-token_sent_via`    , 'payload'         , { type: 'select' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Token_Sent_Via', persistent: true, values: [ { key: 'header', i18nLabel: 'Header' }, { key: 'payload', i18nLabel: 'Payload' } ] });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-id`                , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_id', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-secret`            , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Secret', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-login_style`       , 'popup'           , { type: 'select' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Login_Style', persistent: true, values: [ { key: 'redirect', i18nLabel: 'Redirect' }, { key: 'popup', i18nLabel: 'Popup' }, { key: '', i18nLabel: 'Default' } ] });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_label_text` , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Label_Text', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_label_color`, '#FFFFFF'         , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Label_Color', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-button_color`      , '#13679A'         , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Button_Color', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-username_field`    , ''                , { type: 'string' , group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Username_Field', persistent: true });\n\t\tRocketChat.settings.add(`Accounts_OAuth_Custom-${ name }-merge_users`       , false             , { type: 'boolean', group: 'OAuth', section: `Custom OAuth: ${ name }`, i18nLabel: 'Accounts_OAuth_Custom_Merge_Users', persistent: true });\n\t}});\n","Meteor.methods({\n\trefreshOAuthService() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'refreshOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Refresh OAuth Services is not allowed', { method: 'refreshOAuthService', action: 'Refreshing_OAuth_Services' });\n\t\t}\n\n\t\tServiceConfiguration.configurations.remove({});\n\n\t\tRocketChat.models.Settings.update({_id: /^Accounts_OAuth_.+/}, {$set: {_updatedAt: new Date}}, {multi: true});\n\t}\n});\n","Meteor.methods({\n\taddUserToRoom(data) {\n\t\treturn Meteor.call('addUsersToRoom', {\n\t\t\trid: data.rid,\n\t\t\tusers: [ data.username ]\n\t\t});\n\t}\n});\n","Meteor.methods({\n\taddUsersToRoom(data = {}) {\n\t\t// Validate user and room\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!Match.test(data.rid, String)) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Get user and room details\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\t\tconst userId = Meteor.userId();\n\t\tconst user = Meteor.user();\n\t\tconst userInRoom = Array.isArray(room.usernames) && room.usernames.includes(user.username);\n\n\t\t// Can't add to direct room ever\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-cant-invite-for-direct-room', 'Can\\'t invite user to direct rooms', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Can add to any room you're in, with permission, otherwise need specific room type permission\n\t\tlet canAddUser = false;\n\t\tif (userInRoom && RocketChat.authz.hasPermission(userId, 'add-user-to-joined-room', room._id)) {\n\t\t\tcanAddUser = true;\n\t\t} else if (room.t === 'c' && RocketChat.authz.hasPermission(userId, 'add-user-to-any-c-room')) {\n\t\t\tcanAddUser = true;\n\t\t} else if (room.t === 'p' && RocketChat.authz.hasPermission(userId, 'add-user-to-any-p-room')) {\n\t\t\tcanAddUser = true;\n\t\t}\n\n\t\t// Adding wasn't allowed\n\t\tif (!canAddUser) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Missing the users to be added\n\t\tif (!Array.isArray(data.users)) {\n\t\t\tthrow new Meteor.Error('error-invalid-arguments', 'Invalid arguments', {\n\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t});\n\t\t}\n\n\t\t// Validate each user, then add to room\n\t\tdata.users.forEach((username) => {\n\t\t\tconst newUser = RocketChat.models.Users.findOneByUsername(username);\n\t\t\tif (!newUser) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-username', 'Invalid username', {\n\t\t\t\t\tmethod: 'addUsersToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.addUserToRoom(data.rid, newUser, user);\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tarchiveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'archiveRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'archiveRoom' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'archive-room', room._id)) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'archiveRoom' });\n\t\t}\n\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-direct-message-room', 'Direct Messages can not be archived', { method: 'archiveRoom' });\n\t\t}\n\n\t\treturn RocketChat.archiveRoom(rid);\n\t}\n});\n","Meteor.methods({\n\tblockUser({rid, blocked}) {\n\n\t\tcheck(rid, String);\n\t\tcheck(blocked, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'blockUser' });\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tconst subscription2 = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, blocked);\n\n\t\tif (!subscription || !subscription2) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'blockUser' });\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.setBlockedByRoomId(rid, blocked, Meteor.userId());\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tcheckRegistrationSecretURL(hash) {\n\n\t\tcheck(hash, String);\n\n\t\treturn hash === RocketChat.settings.get('Accounts_RegistrationForm_SecretURL');\n\t}\n});\n","Meteor.methods({\n\tcheckUsernameAvailability(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setUsername' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (user.username && !RocketChat.settings.get('Accounts_AllowUsernameChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setUsername' });\n\t\t}\n\n\t\tif (user.username === username) {\n\t\t\treturn true;\n\t\t}\n\t\treturn RocketChat.checkUsernameAvailability(username);\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('checkUsernameAvailability', 1, 1000, {\n\tuserId() { return true; }\n});\n","Meteor.methods({\n\tcleanChannelHistory({roomId, latest, oldest, inclusive}) {\n\t\tcheck(roomId, String);\n\t\tcheck(latest, Date);\n\t\tcheck(oldest, Date);\n\t\tcheck(inclusive, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'cleanChannelHistory' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'clean-channel-history')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'cleanChannelHistory' });\n\t\t}\n\n\t\tif (inclusive) {\n\t\t\tRocketChat.models.Messages.remove({\n\t\t\t\trid: roomId,\n\t\t\t\tts: {\n\t\t\t\t\t$gte: oldest,\n\t\t\t\t\t$lte: latest\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tRocketChat.models.Messages.remove({\n\t\t\t\trid: roomId,\n\t\t\t\tts: {\n\t\t\t\t\t$gt: oldest,\n\t\t\t\t\t$lt: latest\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tcreateChannel(name, members, readOnly = false, customFields = {}) {\n\t\tcheck(name, String);\n\t\tcheck(members, Match.Optional([String]));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'createChannel' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-c')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'createChannel' });\n\t\t}\n\n\t\treturn RocketChat.createRoom('c', name, Meteor.user() && Meteor.user().username, members, readOnly, {customFields});\n\t}\n});\n","Meteor.methods({\n\tcreateToken(userId) {\n\t\tif (Meteor.userId() !== userId && !RocketChat.authz.hasPermission(Meteor.userId(), 'user-generate-access-token')) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'createToken' });\n\t\t}\n\t\tconst token = Accounts._generateStampedLoginToken();\n\t\tAccounts._insertLoginToken(userId, token);\n\t\treturn {\n\t\t\tuserId,\n\t\t\tauthToken: token.token\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreatePrivateGroup(name, members, readOnly = false, customFields = {}) {\n\t\tcheck(name, String);\n\t\tcheck(members, Match.Optional([String]));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'createPrivateGroup' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-p')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'createPrivateGroup' });\n\t\t}\n\n\t\treturn RocketChat.createRoom('p', name, Meteor.user() && Meteor.user().username, members, readOnly, {customFields});\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tdeleteMessage(message) {\n\t\tcheck(message, Match.ObjectIncluding({\n\t\t\t_id: String\n\t\t}));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteMessage'\n\t\t\t});\n\t\t}\n\t\tconst originalMessage = RocketChat.models.Messages.findOneById(message._id, {\n\t\t\tfields: {\n\t\t\t\tu: 1,\n\t\t\t\trid: 1,\n\t\t\t\tfile: 1,\n\t\t\t\tts: 1\n\t\t\t}\n\t\t});\n\t\tif (originalMessage == null) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteMessage',\n\t\t\t\taction: 'Delete_message'\n\t\t\t});\n\t\t}\n\t\tconst forceDelete = RocketChat.authz.hasPermission(Meteor.userId(), 'force-delete-message', originalMessage.rid);\n\t\tconst hasPermission = RocketChat.authz.hasPermission(Meteor.userId(), 'delete-message', originalMessage.rid);\n\t\tconst deleteAllowed = RocketChat.settings.get('Message_AllowDeleting');\n\t\tconst deleteOwn = originalMessage && originalMessage.u && originalMessage.u._id === Meteor.userId();\n\t\tif (!(hasPermission || (deleteAllowed && deleteOwn)) && !(forceDelete)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteMessage',\n\t\t\t\taction: 'Delete_message'\n\t\t\t});\n\t\t}\n\t\tconst blockDeleteInMinutes = RocketChat.settings.get('Message_AllowDeleting_BlockDeleteInMinutes');\n\t\tif (blockDeleteInMinutes != null && blockDeleteInMinutes !== 0 && !forceDelete) {\n\t\t\tif (originalMessage.ts == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst msgTs = moment(originalMessage.ts);\n\t\t\tif (msgTs == null) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst currentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\tif (currentTsDiff > blockDeleteInMinutes) {\n\t\t\t\tthrow new Meteor.Error('error-message-deleting-blocked', 'Message deleting is blocked', {\n\t\t\t\t\tmethod: 'deleteMessage'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn RocketChat.deleteMessage(originalMessage, Meteor.user());\n\t}\n});\n","Meteor.methods({\n\tdeleteUserOwnAccount(password) {\n\n\t\tcheck(password, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowDeleteOwnAccount')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tconst userId = Meteor.userId();\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tif (user.services && user.services.password && s.trim(user.services.password.bcrypt)) {\n\t\t\tconst result = Accounts._checkPassword(user, { digest: password, algorithm: 'sha-256' });\n\t\t\tif (result.error) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', { method: 'deleteUserOwnAccount' });\n\t\t\t}\n\t\t} else if (user.username !== s.trim(password)) {\n\t\t\tthrow new Meteor.Error('error-invalid-username', 'Invalid username', { method: 'deleteUserOwnAccount' });\n\t\t}\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.deleteUser(userId);\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","const Filter = Npm.require('bad-words');\n\nRocketChat.callbacks.add('beforeSaveMessage', function(message) {\n\n\tif (RocketChat.settings.get('Message_AllowBadWordsFilter')) {\n\t\tconst badWordsList = RocketChat.settings.get('Message_BadWordsFilterList');\n\t\tlet options;\n\n\t\t// Add words to the blacklist\n\t\tif (!!badWordsList && badWordsList.length) {\n\t\t\toptions = {\n\t\t\t\tlist: badWordsList.split(',')\n\t\t\t};\n\t\t}\n\t\tconst filter = new Filter(options);\n\t\tmessage.msg = filter.clean(message.msg);\n\t}\n\n\treturn message;\n\n}, 1, 'filterBadWords');\n","RocketChat.callbacks.add('beforeSaveMessage', function(message) {\n\t// Test if the message mentions include @all.\n\tif (message.mentions != null &&\n\t\t_.pluck(message.mentions, '_id').some((item) => item === 'all')) {\n\n\t\t// Check if the user has permissions to use @all.\n\t\tif (!RocketChat.authz.hasPermission(message.u._id, 'mention-all')) {\n\n\t\t\t// Get the language of the user for the error notification.\n\t\t\tconst language = RocketChat.models.Users.findOneById(message.u._id).language;\n\t\t\tconst action = TAPi18n.__('Notify_all_in_this_room', {}, language);\n\n\t\t\t// Add a notification to the chat, informing the user that this\n\t\t\t// action is not allowed.\n\t\t\tRocketChat.Notifications.notifyUser(message.u._id, 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: message.rid,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('error-action-not-allowed', { action }, language)\n\t\t\t});\n\n\t\t\t// Also throw to stop propagation of 'sendMessage'.\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Notify all in this room not allowed', {\n\t\t\t\tmethod: 'filterATAllTag',\n\t\t\t\taction: 'Notify_all_in_this_room'\n\t\t\t});\n\t\t}\n\t}\n\n\treturn message;\n\n}, 1, 'filterATAllTag');\n","Meteor.methods({\n\tgetChannelHistory({rid, latest, oldest, inclusive, count = 20, unreads}) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getChannelHistory' });\n\t\t}\n\n\t\tconst fromUserId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromUserId);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//Make sure they can access the room\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(fromUserId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\t//Ensure latest is always defined.\n\t\tif (_.isUndefined(latest)) {\n\t\t\tlatest = new Date();\n\t\t}\n\n\t\t//Verify oldest is a date if it exists\n\t\tif (!_.isUndefined(oldest) && !_.isDate(oldest)) {\n\t\t\tthrow new Meteor.Error('error-invalid-date', 'Invalid date', { method: 'getChannelHistory' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: count\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = { 'editedAt': 0 };\n\t\t}\n\n\t\tlet records = [];\n\t\tif (_.isUndefined(oldest) && inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampInclusive(rid, latest, options).fetch();\n\t\t} else if (_.isUndefined(oldest) && !inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(rid, latest, options).fetch();\n\t\t} else if (!_.isUndefined(oldest) && inclusive) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsInclusive(rid, oldest, latest, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestamps(rid, oldest, latest, options).fetch();\n\t\t}\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst messages = _.map(records, (message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, { _id: fromUserId });\n\t\t\tif (message.u && message.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\t\t\t\tmessage.u.name = user && user.name;\n\t\t\t}\n\t\t\tif (message.mentions && message.mentions.length && UI_Use_Real_Name) {\n\t\t\t\tmessage.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn message;\n\t\t});\n\n\t\tif (unreads) {\n\t\t\tlet unreadNotLoaded = 0;\n\t\t\tlet firstUnread = undefined;\n\n\t\t\tif (!_.isUndefined(oldest)) {\n\t\t\t\tconst firstMsg = messages[messages.length - 1];\n\t\t\t\tif (!_.isUndefined(firstMsg) && firstMsg.ts > oldest) {\n\t\t\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestamps(rid, oldest, firstMsg.ts, { limit: 1, sort: { ts: 1 } });\n\t\t\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmessages: messages || [],\n\t\t\t\tfirstUnread,\n\t\t\t\tunreadNotLoaded\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tmessages: messages || []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tgetFullUserData({ filter = '', limit }) {\n\t\tconst result = RocketChat.getFullUserData({ userId: Meteor.userId(), filter, limit });\n\n\t\tif (!result) {\n\t\t\treturn result;\n\t\t}\n\n\t\treturn result.fetch();\n\t}\n});\n","Meteor.methods({\n\tgetRoomJoinCode(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getJoinCode' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-join-code')) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'getJoinCode' });\n\t\t}\n\n\t\tconst [ room ] = RocketChat.models.Rooms.findById(rid).fetch();\n\n\t\treturn room && room.joinCode;\n\t}\n});\n","Meteor.methods({\n\tgetRoomRoles(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomRoles' });\n\t\t}\n\n\t\tcheck(rid, String);\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\t'u.username': 1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\trid: 1,\n\t\t\t\tu: 1,\n\t\t\t\troles: 1\n\t\t\t}\n\t\t};\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst roles = RocketChat.models.Roles.find({ scope: 'Subscriptions', description: { $exists: 1, $ne: '' } }).fetch();\n\t\tconst subscriptions = RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, _.pluck(roles, '_id'), options).fetch();\n\n\t\tif (!UI_Use_Real_Name) {\n\t\t\treturn subscriptions;\n\t\t} else {\n\t\t\treturn subscriptions.map(subscription => {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(subscription.u._id);\n\t\t\t\tsubscription.u.name = user && user.name;\n\t\t\t\treturn subscription;\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tgetServerInfo() {\n\t\treturn RocketChat.Info;\n\t}\n});\n","Meteor.methods({\n\tgetSingleMessage(msgId) {\n\t\tcheck(msgId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getSingleMessage' });\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(msgId);\n\n\t\tif (!msg && !msg.rid) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tMeteor.call('canAccessRoom', msg.rid, Meteor.userId());\n\n\t\treturn msg;\n\t}\n});\n","Meteor.methods({\n\tgetUserRoles() {\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUserRoles' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\t'username': 1\n\t\t\t},\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\troles: 1\n\t\t\t}\n\t\t};\n\n\t\tconst roles = RocketChat.models.Roles.find({ scope: 'Users', description: { $exists: 1, $ne: '' } }).fetch();\n\t\tconst roleIds = _.pluck(roles, '_id');\n\n\t\t// Security issue: we should not send all user's roles to all clients, only the 'public' roles\n\t\t// We must remove all roles that are not part of the query from the returned users\n\t\tconst users = RocketChat.models.Users.findUsersInRoles(roleIds, null, options).fetch();\n\t\tfor (const user of users) {\n\t\t\tuser.roles = _.intersection(user.roles, roleIds);\n\t\t}\n\t\treturn users;\n\t}\n});\n","Meteor.methods({\n\tinsertOrUpdateUser(userData) {\n\n\t\tcheck(userData, Object);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'insertOrUpdateUser' });\n\t\t}\n\n\t\treturn RocketChat.saveUser(Meteor.userId(), userData);\n\t}\n});\n","Meteor.methods({\n\tjoinDefaultChannels(silenced) {\n\t\tcheck(silenced, Match.Optional(Boolean));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'joinDefaultChannels' });\n\t\t}\n\n\t\tthis.unblock();\n\t\treturn RocketChat.addUserToDefaultChannels(Meteor.user(), silenced);\n\t}\n});\n","Meteor.methods({\n\tjoinRoom(rid, code) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'joinRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'joinRoom' });\n\t\t}\n\n\t\tif ((room.t !== 'c') || (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'joinRoom' });\n\t\t}\n\n\t\tif ((room.joinCodeRequired === true) && (code !== room.joinCode) && !RocketChat.authz.hasPermission(Meteor.userId(), 'join-without-join-code')) {\n\t\t\tthrow new Meteor.Error('error-code-invalid', 'Invalid Room Password', { method: 'joinRoom' });\n\t\t}\n\n\t\treturn RocketChat.addUserToRoom(rid, Meteor.user());\n\t}\n});\n","Meteor.methods({\n\tleaveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'leaveRoom' });\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tconst user = Meteor.user();\n\n\t\tif (room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'leaveRoom' });\n\t\t}\n\n\t\tif (!Array.from(room.usernames || []).includes(user.username)) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'You are not in this room', { method: 'leaveRoom' });\n\t\t}\n\n\t\t// If user is room owner, check if there are other owners. If there isn't anyone else, warn user to set a new owner.\n\t\tif (RocketChat.authz.hasRole(user._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', { method: 'leaveRoom' });\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.removeUserFromRoom(rid, Meteor.user());\n\t}\n});\n","Meteor.methods({\n\tremoveOAuthService(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'removeOAuthService' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'add-oauth-service') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'removeOAuthService' });\n\t\t}\n\n\t\tname = name.toLowerCase().replace(/[^a-z0-9_]/g, '');\n\t\tname = s.capitalize(name);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-url`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-token_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-identity_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-authorize_path`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-scope`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-token_sent_via`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-id`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-secret`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_label_text`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_label_color`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-button_color`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-login_style`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-username_field`);\n\t\tRocketChat.settings.removeById(`Accounts_OAuth_Custom-${ name }-merge_users`);\n\t}\n});\n","Meteor.methods({\n\trestart_server() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'restart_server' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasRole(Meteor.userId(), 'admin') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'restart_server' });\n\t\t}\n\n\t\tMeteor.setTimeout(() => {\n\t\t\tMeteor.setTimeout(() => {\n\t\t\t\tconsole.warn('Call to process.exit() timed out, aborting.');\n\t\t\t\tprocess.abort();\n\t\t\t}, 1000);\n\t\t\tprocess.exit(1);\n\t\t}, 1000);\n\n\t\treturn {\n\t\t\tmessage: 'The_server_will_restart_in_s_seconds',\n\t\t\tparams: [2]\n\t\t};\n\t}\n});\n","Meteor.methods({\n\t'robot.modelCall'(model, method, args) {\n\t\tcheck(model, String);\n\t\tcheck(method, String);\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tif (!RocketChat.authz.hasRole(Meteor.userId(), 'robot')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tconst m = RocketChat.models[model];\n\n\t\tif (!m || !_.isFunction(m[method])) {\n\t\t\tthrow new Meteor.Error('error-invalid-method', 'Invalid method', {\n\t\t\t\tmethod: 'robot.modelCall'\n\t\t\t});\n\t\t}\n\t\tconst cursor = RocketChat.models[model][method].apply(RocketChat.models[model], args);\n\t\treturn cursor && cursor.fetch ? cursor.fetch() : cursor;\n\t}\n});\n","/* eslint new-cap: 0 */\n\nMeteor.methods({\n\tsaveSetting(_id, value, editor) {\n\t\tif (Meteor.userId() === null) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing settings is not allowed', {\n\t\t\t\tmethod: 'saveSetting'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'edit-privileged-setting')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Editing settings is not allowed', {\n\t\t\t\tmethod: 'saveSetting'\n\t\t\t});\n\t\t}\n\n\t\t//Verify the _id passed in is a string.\n\t\tcheck(_id, String);\n\n\t\tconst setting = RocketChat.models.Settings.db.findOneById(_id);\n\n\t\t//Verify the value is what it should be\n\t\tswitch (setting.type) {\n\t\t\tcase 'roomPick':\n\t\t\t\tcheck(value, Match.OneOf([Object], ''));\n\t\t\t\tbreak;\n\t\t\tcase 'boolean':\n\t\t\t\tcheck(value, Boolean);\n\t\t\t\tbreak;\n\t\t\tcase 'int':\n\t\t\t\tcheck(value, Number);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tcheck(value, String);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tRocketChat.settings.updateById(_id, value, editor);\n\t\treturn true;\n\t}\n});\n","\nMeteor.methods({\n\tsendInvitationEmail(emails) {\n\t\tcheck(emails, [String]);\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendInvitationEmail'\n\t\t\t});\n\t\t}\n\t\tif (!RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'sendInvitationEmail'\n\t\t\t});\n\t\t}\n\t\tconst rfcMailPattern = /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\n\t\tconst validEmails = _.compact(_.map(emails, function(email) {\n\t\t\tif (rfcMailPattern.test(email)) {\n\t\t\t\treturn email;\n\t\t\t}\n\t\t}));\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\t\tlet html;\n\t\tlet subject;\n\t\tconst user = Meteor.user();\n\t\tconst lng = user.language || RocketChat.settings.get('language') || 'en';\n\t\tif (RocketChat.settings.get('Invitation_Customized')) {\n\t\t\tsubject = RocketChat.settings.get('Invitation_Subject');\n\t\t\thtml = RocketChat.settings.get('Invitation_HTML');\n\t\t} else {\n\t\t\tsubject = TAPi18n.__('Invitation_Subject_Default', {\n\t\t\t\tlng\n\t\t\t});\n\t\t\thtml = TAPi18n.__('Invitation_HTML_Default', {\n\t\t\t\tlng\n\t\t\t});\n\t\t}\n\t\tsubject = RocketChat.placeholders.replace(subject);\n\t\tvalidEmails.forEach(email => {\n\t\t\tthis.unblock();\n\t\t\thtml = RocketChat.placeholders.replace(html, {\n\t\t\t\temail\n\t\t\t});\n\t\t\ttry {\n\t\t\t\tEmail.send({\n\t\t\t\t\tto: email,\n\t\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\t\tsubject,\n\t\t\t\t\thtml: header + html + footer\n\t\t\t\t});\n\t\t\t} catch ({message}) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ message }`, {\n\t\t\t\t\tmethod: 'sendInvitationEmail',\n\t\t\t\t\tmessage\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn validEmails;\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tsendMessage(message) {\n\t\tcheck(message, Object);\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendMessage'\n\t\t\t});\n\t\t}\n\t\tif (message.ts) {\n\t\t\tconst tsDiff = Math.abs(moment(message.ts).diff());\n\t\t\tif (tsDiff > 60000) {\n\t\t\t\tthrow new Meteor.Error('error-message-ts-out-of-sync', 'Message timestamp is out of sync', {\n\t\t\t\t\tmethod: 'sendMessage',\n\t\t\t\t\tmessage_ts: message.ts,\n\t\t\t\t\tserver_ts: new Date().getTime()\n\t\t\t\t});\n\t\t\t} else if (tsDiff > 10000) {\n\t\t\t\tmessage.ts = new Date();\n\t\t\t}\n\t\t} else {\n\t\t\tmessage.ts = new Date();\n\t\t}\n\t\tif (message.msg && message.msg.length > RocketChat.settings.get('Message_MaxAllowedSize')) {\n\t\t\tthrow new Meteor.Error('error-message-size-exceeded', 'Message size exceeds Message_MaxAllowedSize', {\n\t\t\t\tmethod: 'sendMessage'\n\t\t\t});\n\t\t}\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId(), {\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1\n\t\t\t}\n\t\t});\n\t\tconst room = Meteor.call('canAccessRoom', message.rid, user._id);\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(message.rid, Meteor.userId());\n\t\tif (subscription && subscription.blocked || subscription.blocker) {\n\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: room._id,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('room_is_blocked', {}, user.language)\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((room.muted||[]).includes(user.username)) {\n\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: room._id,\n\t\t\t\tts: new Date,\n\t\t\t\tmsg: TAPi18n.__('You_have_been_muted', {}, user.language)\n\t\t\t});\n\t\t\treturn false;\n\t\t}\n\t\tif (message.alias == null && RocketChat.settings.get('Message_SetNameToAliasEnabled')) {\n\t\t\tmessage.alias = user.name;\n\t\t}\n\t\tif (Meteor.settings['public'].sandstorm) {\n\t\t\tmessage.sandstormSessionId = this.connection.sandstormSessionId();\n\t\t}\n\t\tRocketChat.metrics.messagesSent.inc(); // TODO This line needs to be moved to it's proper place. See the comments on: https://github.com/RocketChat/Rocket.Chat/pull/5736\n\t\treturn RocketChat.sendMessage(user, message, room);\n\t}\n});\n// Limit a user, who does not have the \"bot\" role, to sending 5 msgs/second\nRocketChat.RateLimiter.limitMethod('sendMessage', 5, 1000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t}\n});\n","Meteor.methods({\n\tsendSMTPTestEmail() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'sendSMTPTestEmail'\n\t\t\t});\n\t\t}\n\t\tconst user = Meteor.user();\n\t\tif (!user.emails && !user.emails[0] && user.emails[0].address) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email', {\n\t\t\t\tmethod: 'sendSMTPTestEmail'\n\t\t\t});\n\t\t}\n\t\tthis.unblock();\n\t\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\t\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\t\tconsole.log(`Sending test email to ${ user.emails[0].address }`);\n\t\ttry {\n\t\t\tEmail.send({\n\t\t\t\tto: user.emails[0].address,\n\t\t\t\tfrom: RocketChat.settings.get('From_Email'),\n\t\t\t\tsubject: 'SMTP Test Email',\n\t\t\t\thtml: `${ header }<p>You have successfully sent an email</p>${ footer }`\n\t\t\t});\n\t\t} catch ({message}) {\n\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ message }`, {\n\t\t\t\tmethod: 'sendSMTPTestEmail',\n\t\t\t\tmessage\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tmessage: 'Your_mail_was_sent_to_s',\n\t\t\tparams: [user.emails[0].address]\n\t\t};\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'sendSMTPTestEmail',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 1000);\n","Meteor.methods({\n\tsetAdminStatus(userId, admin) {\n\n\t\tcheck(userId, String);\n\t\tcheck(admin, Match.Optional(Boolean));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setAdminStatus' });\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'assign-admin-role') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setAdminStatus' });\n\t\t}\n\n\t\tconst user = Meteor.users.findOne({ _id: userId }, { fields: { username: 1 } });\n\n\t\tif (admin) {\n\t\t\treturn Meteor.call('authorization:addUserToRole', 'admin', user.username);\n\t\t} else {\n\t\t\treturn Meteor.call('authorization:removeUserFromRole', 'admin', user.username);\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tsetRealName(name) {\n\n\t\tcheck(name, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setRealName' });\n\t\t}\n\n\t\tif (!RocketChat.setRealName(Meteor.userId(), name)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-name', 'Could not change name', { method: 'setRealName' });\n\t\t}\n\n\t\treturn name;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setRealName', 1, 1000, {\n\tuserId: () => true\n});\n","Meteor.methods({\n\tsetUsername(username, param = {}) {\n\t\tconst { joinDefaultChannelsSilenced } = param;\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setUsername' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (user.username && !RocketChat.settings.get('Accounts_AllowUsernameChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { method: 'setUsername' });\n\t\t}\n\n\t\tif (user.username === username || (user.username && user.username.toLowerCase() === username.toLowerCase())) {\n\t\t\treturn username;\n\t\t}\n\n\t\tlet nameValidation;\n\t\ttry {\n\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t} catch (error) {\n\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t}\n\n\t\tif (!nameValidation.test(username)) {\n\t\t\tthrow new Meteor.Error('username-invalid', `${ _.escape(username) } is not a valid username, use only letters, numbers, dots, hyphens and underscores`);\n\t\t}\n\n\t\tif (!RocketChat.checkUsernameAvailability(username)) {\n\t\t\tthrow new Meteor.Error('error-field-unavailable', `<strong>${ _.escape(username) }</strong> is already in use :(`, { method: 'setUsername', field: username });\n\t\t}\n\n\t\tif (!RocketChat.setUsername(user._id, username)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-username', 'Could not change username', { method: 'setUsername' });\n\t\t}\n\n\t\tif (!user.username) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('joinDefaultChannels', joinDefaultChannelsSilenced));\n\t\t\tMeteor.defer(function() {\n\t\t\t\treturn RocketChat.callbacks.run('afterCreateUser', RocketChat.models.Users.findOneById(user._id));\n\t\t\t});\n\t\t}\n\n\t\treturn username;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setUsername', 1, 1000, {\n\tuserId() { return true; }\n});\n","Meteor.methods({\n\tsetEmail(email) {\n\n\t\tcheck (email, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'setEmail' });\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowEmailChange')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Changing email is not allowed', { method: 'setEmail', action: 'Changing_email' });\n\t\t}\n\n\t\tif (user.emails && user.emails[0] && user.emails[0].address === email) {\n\t\t\treturn email;\n\t\t}\n\n\t\tif (!RocketChat.setEmail(user._id, email)) {\n\t\t\tthrow new Meteor.Error('error-could-not-change-email', 'Could not change email', { method: 'setEmail' });\n\t\t}\n\n\t\treturn email;\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('setEmail', 1, 1000, {\n\tuserId(/*userId*/) { return true; }\n});\n","Meteor.methods({\n\tunarchiveRoom(rid) {\n\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'unarchive-room', room._id)) {\n\t\t\tthrow new Meteor.Error('error-not-authorized', 'Not authorized', { method: 'unarchiveRoom' });\n\t\t}\n\n\t\treturn RocketChat.unarchiveRoom(rid);\n\t}\n});\n","Meteor.methods({\n\tunblockUser({rid, blocked}) {\n\n\t\tcheck(rid, String);\n\t\tcheck(blocked, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'blockUser' });\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, Meteor.userId());\n\t\tconst subscription2 = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, blocked);\n\n\t\tif (!subscription || !subscription2) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'blockUser' });\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.unsetBlockedByRoomId(rid, blocked, Meteor.userId());\n\n\t\treturn true;\n\t}\n});\n","import moment from 'moment';\n\nMeteor.methods({\n\tupdateMessage(message) {\n\n\t\tcheck(message, Match.ObjectIncluding({_id:String}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'updateMessage' });\n\t\t}\n\n\t\tconst originalMessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!originalMessage || !originalMessage._id) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasPermission = RocketChat.authz.hasPermission(Meteor.userId(), 'edit-message', message.rid);\n\t\tconst editAllowed = RocketChat.settings.get('Message_AllowEditing');\n\t\tconst editOwn = originalMessage.u && originalMessage.u._id === Meteor.userId();\n\n\t\tif (!hasPermission && (!editAllowed || !editOwn)) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Message editing not allowed', { method: 'updateMessage', action: 'Message_editing' });\n\t\t}\n\n\t\tconst blockEditInMinutes = RocketChat.settings.get('Message_AllowEditing_BlockEditInMinutes');\n\t\tif (Match.test(blockEditInMinutes, Number) && blockEditInMinutes !== 0) {\n\t\t\tlet currentTsDiff;\n\t\t\tlet msgTs;\n\n\t\t\tif (Match.test(originalMessage.ts, Number)) {\n\t\t\t\tmsgTs = moment(originalMessage.ts);\n\t\t\t}\n\t\t\tif (msgTs) {\n\t\t\t\tcurrentTsDiff = moment().diff(msgTs, 'minutes');\n\t\t\t}\n\t\t\tif (currentTsDiff > blockEditInMinutes) {\n\t\t\t\tthrow new Meteor.Error('error-message-editing-blocked', 'Message editing is blocked', { method: 'updateMessage' });\n\t\t\t}\n\t\t}\n\n\t\t// It is possible to have an empty array as the attachments property, so ensure both things exist\n\t\tif (originalMessage.attachments && originalMessage.attachments.length > 0 && originalMessage.attachments[0].description !== undefined) {\n\t\t\tmessage.attachments = originalMessage.attachments;\n\t\t\tmessage.attachments[0].description = message.msg;\n\t\t\tmessage.msg = originalMessage.msg;\n\t\t}\n\n\t\tmessage.u = originalMessage.u;\n\n\t\treturn RocketChat.updateMessage(message, Meteor.user());\n\t}\n});\n","/* globals openRoom */\nRocketChat.roomTypes.add('unread', 10, {\n\tunread: true,\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst preferences = (user && user.settings && user.settings.preferences && user.settings.preferences) || {};\n\t\treturn preferences.roomsListExhibitionMode === 'unread';\n\t},\n\tlabel: 'Unread'\n});\n\nRocketChat.roomTypes.add('f', 20, {\n\theader: 'favorite',\n\ticon: 'star',\n\tlabel: 'Favorites'\n});\n\n// activity\nRocketChat.roomTypes.add('activity', 30, {\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst preferences = (user && user.settings && user.settings.preferences && user.settings.preferences) || {};\n\t\treturn preferences.roomsListExhibitionMode === 'activity';\n\t},\n\tlabel: 'Conversations'\n});\n\nRocketChat.roomTypes.add('channels', 30, {\n\tlabel: 'Channels',\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst preferences = (user && user.settings && user.settings.preferences && user.settings.preferences) || {};\n\t\treturn ['unread', 'category'].includes(preferences.roomsListExhibitionMode) && preferences.mergeChannels;\n\t}\n});\n// public\nRocketChat.roomTypes.add('c', 30, {\n\ticon: 'hashtag',\n\tlabel: 'Channels',\n\troute: {\n\t\tname: 'channel',\n\t\tpath: '/channel/:name',\n\t\taction(params) {\n\t\t\treturn openRoom('c', params.name);\n\t\t}\n\t},\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'c',\n\t\t\tname: identifier\n\t\t};\n\t\treturn ChatRoom.findOne(query);\n\t},\n\n\troomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\treturn roomData.fname || roomData.name;\n\t\t}\n\t\treturn roomData.name;\n\t},\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst preferences = (user && user.settings && user.settings.preferences && user.settings.preferences) || {};\n\t\treturn !preferences.roomsListExhibitionMode || ['unread', 'category'].includes(preferences.roomsListExhibitionMode) && !preferences.mergeChannels && (RocketChat.authz.hasAtLeastOnePermission(['view-c-room', 'view-joined-room']) || RocketChat.settings.get('Accounts_AllowAnonymousRead') === true);\n\t},\n\n\tshowJoinLink(roomId) {\n\t\treturn !!ChatRoom.findOne({ _id: roomId, t: 'c' });\n\t}\n});\n\n// private\nRocketChat.roomTypes.add('p', 40, {\n\ticon: 'lock',\n\tlabel: 'Private_Groups',\n\troute: {\n\t\tname: 'group',\n\t\tpath: '/group/:name',\n\t\taction(params) {\n\t\t\treturn openRoom('p', params.name);\n\t\t}\n\t},\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tname: identifier\n\t\t};\n\t\treturn ChatRoom.findOne(query);\n\t},\n\n\troomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Allow_room_names_with_special_chars')) {\n\t\t\treturn roomData.fname || roomData.name;\n\t\t}\n\t\treturn roomData.name;\n\t},\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst preferences = (user && user.settings && user.settings.preferences && user.settings.preferences) || {};\n\t\treturn !preferences.roomsListExhibitionMode || ['unread', 'category'].includes(preferences.roomsListExhibitionMode) && !preferences.mergeChannels && RocketChat.authz.hasAllPermission('view-p-room');\n\t}\n});\n\n\n// direct\nRocketChat.roomTypes.add('d', 50, {\n\ticon: false,\n\tlabel: 'Direct_Messages',\n\troute: {\n\t\tname: 'direct',\n\t\tpath: '/direct/:username',\n\t\taction(params) {\n\t\t\treturn openRoom('d', params.username);\n\t\t},\n\t\tlink(sub) {\n\t\t\treturn { username: sub.name };\n\t\t}\n\t},\n\n\tfindRoom(identifier) {\n\t\tconst query = {\n\t\t\tt: 'd',\n\t\t\tname: identifier\n\t\t};\n\n\t\tconst subscription = ChatSubscription.findOne(query);\n\t\tif (subscription && subscription.rid) {\n\t\t\treturn ChatRoom.findOne(subscription.rid);\n\t\t}\n\t},\n\n\troomName(roomData) {\n\t\tconst subscription = ChatSubscription.findOne({ rid: roomData._id }, { fields: { name: 1, fname: 1 } });\n\t\tif (!subscription) {\n\t\t\treturn '';\n\t\t}\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name') && subscription.fname) {\n\t\t\treturn subscription.fname;\n\t\t}\n\n\t\treturn subscription.name;\n\t},\n\n\tsecondaryRoomName(roomData) {\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tconst subscription = ChatSubscription.findOne({ rid: roomData._id }, { fields: { name: 1 } });\n\t\t\treturn subscription && subscription.name;\n\t\t}\n\t},\n\n\tcondition() {\n\t\tconst user = Meteor.user();\n\t\tconst preferences = (user && user.settings && user.settings.preferences && user.settings.preferences) || {};\n\t\treturn !preferences.roomsListExhibitionMode || ['unread', 'category'].includes(preferences.roomsListExhibitionMode) && RocketChat.authz.hasAtLeastOnePermission(['view-d-room', 'view-joined-room']);\n\t},\n\n\tgetUserStatus(roomId) {\n\t\tconst subscription = RocketChat.models.Subscriptions.findOne({rid: roomId});\n\t\tif (subscription == null) { return; }\n\n\t\treturn Session.get(`user_${ subscription.name }_status`);\n\t}\n});\n"]}