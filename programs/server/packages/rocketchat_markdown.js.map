{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:markdown/settings.js","meteor://ðŸ’»app/packages/rocketchat:markdown/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/marked/marked.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/code.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/original.js"],"names":["Meteor","module","watch","require","v","RocketChat","startup","settings","add","type","values","key","i18nLabel","group","section","enableQueryOriginal","_id","value","enableQuery","i18nDescription","enableQueryMarked","Blaze","marked","original","parsers","MarkdownClass","parse","text","message","html","_","escapeHTML","mountTokensBack","parseMessageNotEscaped","parseNotEscaped","parser","get","tokens","length","token","replace","Markdown","MarkdownMessage","trim","undefined","callbacks","priority","HIGH","isClient","registerHelper","export","Random","hljs","_marked","renderer","Renderer","msg","code","lang","escaped","options","highlight","out","escape","isString","id","push","codespan","blockquote","quote","e","gfm","tables","breaks","pedantic","smartLists","smartypants","unescapeHTML","sanitize","inlinecode","match","p1","p2","p3","noHtml","codeblocks","count","msgParts","split","index","part","codeMatch","singleLine","indexOf","Array","from","listLanguages","includes","s","result","highlightAuto","language","stripTags","join","markdown","addAsToken","schemes","RegExp","title","url","target","absoluteUrl"],"mappings":"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","file":"/packages/rocketchat_markdown.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.startup(() => {\n\tRocketChat.settings.add('Markdown_Parser', 'original', {\n\t\ttype: 'select',\n\t\tvalues: [{\n\t\t\tkey: 'disabled',\n\t\t\ti18nLabel: 'Disabled'\n\t\t}, {\n\t\t\tkey: 'original',\n\t\t\ti18nLabel: 'Original'\n\t\t}, {\n\t\t\tkey: 'marked',\n\t\t\ti18nLabel: 'Marked'\n\t\t}],\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true\n\t});\n\n\tconst enableQueryOriginal = {_id: 'Markdown_Parser', value: 'original'};\n\tRocketChat.settings.add('Markdown_Headers', false, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryOriginal\n\t});\n\tRocketChat.settings.add('Markdown_SupportSchemesForLink', 'http,https', {\n\t\ttype: 'string',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\ti18nDescription: 'Markdown_SupportSchemesForLink_Description',\n\t\tenableQuery: enableQueryOriginal\n\t});\n\n\tconst enableQueryMarked = {_id: 'Markdown_Parser', value: 'marked'};\n\tRocketChat.settings.add('Markdown_Marked_GFM', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Tables', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Breaks', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Pedantic', false, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: [{\n\t\t\t_id: 'Markdown_Parser',\n\t\t\tvalue: 'marked'\n\t\t}, {\n\t\t\t_id: 'Markdown_Marked_GFM',\n\t\t\tvalue: false\n\t\t}]\n\t});\n\tRocketChat.settings.add('Markdown_Marked_SmartLists', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Smartypants', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n});\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { Meteor } from 'meteor/meteor';\nimport { Blaze } from 'meteor/blaze';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { marked } from './parser/marked/marked.js';\nimport { original } from './parser/original/original.js';\n\nconst parsers = {\n\toriginal,\n\tmarked\n};\n\nclass MarkdownClass {\n\tparse(text) {\n\t\tconst message = {\n\t\t\thtml: _.escapeHTML(text)\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseNotEscaped(text) {\n\t\tconst message = {\n\t\t\thtml: text\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseMessageNotEscaped(message) {\n\t\tconst parser = RocketChat.settings.get('Markdown_Parser');\n\n\t\tif (parser === 'disabled') {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (typeof parsers[parser] === 'function') {\n\t\t\treturn parsers[parser](message);\n\t\t}\n\t\treturn parsers['original'](message);\n\t}\n\n\tmountTokensBack(message) {\n\t\tif (message.tokens && message.tokens.length > 0) {\n\t\t\tfor (const {token, text} of message.tokens) {\n\t\t\t\tmessage.html = message.html.replace(token, () => text); // Uses lambda so doesn't need to escape $\n\t\t\t}\n\t\t}\n\n\t\treturn message;\n\t}\n}\n\nconst Markdown = new MarkdownClass;\nRocketChat.Markdown = Markdown;\n\n// renderMessage already did html escape\nconst MarkdownMessage = (message) => {\n\tif (_.trim(message != null ? message.html : undefined)) {\n\t\tmessage = Markdown.parseMessageNotEscaped(message);\n\t}\n\n\treturn message;\n};\n\nRocketChat.callbacks.add('renderMessage', MarkdownMessage, RocketChat.callbacks.priority.HIGH, 'markdown');\n\nif (Meteor.isClient) {\n\tBlaze.registerHelper('RocketChatMarkdown', text => Markdown.parse(text));\n\tBlaze.registerHelper('RocketChatMarkdownUnescape', text => Markdown.parseNotEscaped(text));\n}\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport { Random } from 'meteor/random';\nimport { _ } from 'meteor/underscore';\nimport hljs from 'highlight.js';\nimport _marked from 'marked';\n\nconst renderer = new _marked.Renderer();\n\nlet msg = null;\n\nrenderer.code = function(code, lang, escaped) {\n\tif (this.options.highlight) {\n\t\tconst out = this.options.highlight(code, lang);\n\t\tif (out != null && out !== code) {\n\t\t\tescaped = true;\n\t\t\tcode = out;\n\t\t}\n\t}\n\n\tlet text = null;\n\n\tif (!lang) {\n\t\ttext = `<pre><code class=\"code-colors hljs\">${ (escaped ? code : _.escapeHTML(code, true)) }</code></pre>`;\n\t} else {\n\t\ttext = `<pre><code class=\"code-colors hljs ${ escape(lang, true) }\">${ (escaped ? code : _.escapeHTML(code, true)) }</code></pre>`;\n\t}\n\n\tif (_.isString(msg)) {\n\t\treturn text;\n\t}\n\n\tconst token = `=!=${ Random.id() }=!=`;\n\tmsg.tokens.push({\n\t\thighlight: true,\n\t\ttoken,\n\t\ttext\n\t});\n\n\treturn token;\n};\n\nrenderer.codespan = function(text) {\n\ttext = `<code class=\"code-colors inline\">${ text }</code>`;\n\tif (_.isString(msg)) {\n\t\treturn text;\n\t}\n\n\tconst token = `=!=${ Random.id() }=!=`;\n\tmsg.tokens.push({\n\t\ttoken,\n\t\ttext\n\t});\n\n\treturn token;\n};\n\nrenderer.blockquote = function(quote) {\n\treturn `<blockquote class=\"background-transparent-darker-before\">${ quote }</blockquote>`;\n};\n\nconst highlight = function(code, lang) {\n\tif (!lang) {\n\t\treturn code;\n\t}\n\ttry {\n\t\treturn hljs.highlight(lang, code).value;\n\t} catch (e) {\n\t\t// Unknown language\n\t\treturn code;\n\t}\n};\n\nlet gfm = null;\nlet tables = null;\nlet breaks = null;\nlet pedantic = null;\nlet smartLists = null;\nlet smartypants = null;\n\nexport const marked = (message) => {\n\tmsg = message;\n\n\tif (!msg.tokens) {\n\t\tmsg.tokens = [];\n\t}\n\n\tif (gfm == null) { gfm = RocketChat.settings.get('Markdown_Marked_GFM'); }\n\tif (tables == null) { tables = RocketChat.settings.get('Markdown_Marked_Tables'); }\n\tif (breaks == null) { breaks = RocketChat.settings.get('Markdown_Marked_Breaks'); }\n\tif (pedantic == null) { pedantic = RocketChat.settings.get('Markdown_Marked_Pedantic'); }\n\tif (smartLists == null) { smartLists = RocketChat.settings.get('Markdown_Marked_SmartLists'); }\n\tif (smartypants == null) { smartypants = RocketChat.settings.get('Markdown_Marked_Smartypants'); }\n\n\tmsg.html = _marked(_.unescapeHTML(msg.html), {\n\t\tgfm,\n\t\ttables,\n\t\tbreaks,\n\t\tpedantic,\n\t\tsmartLists,\n\t\tsmartypants,\n\t\trenderer,\n\t\tsanitize: true,\n\t\thighlight\n\t});\n\n\treturn msg;\n};\n","/*\n * code() is a named function that will parse `inline code` and ```codeblock``` syntaxes\n * @param {Object} message - The message object\n */\nimport { Random } from 'meteor/random';\nimport { _ } from 'meteor/underscore';\nimport hljs from 'highlight.js';\n\nconst inlinecode = (message) => {\n\t// Support `text`\n\treturn message.html = message.html.replace(/(^|&gt;|[ >_*~])\\`([^`\\r\\n]+)\\`([<_*~]|\\B|\\b|$)/gm, (match, p1, p2, p3) => {\n\t\tconst token = `=!=${ Random.id() }=!=`;\n\n\t\tmessage.tokens.push({\n\t\t\ttoken,\n\t\t\ttext: `${ p1 }<span class=\\\"copyonly\\\">\\`</span><span><code class=\\\"code-colors inline\\\">${ p2 }</code></span><span class=\\\"copyonly\\\">\\`</span>${ p3 }`,\n\t\t\tnoHtml: match\n\t\t});\n\n\t\treturn token;\n\t});\n};\n\nconst codeblocks = (message) => {\n\t// Count occurencies of ```\n\tconst count = (message.html.match(/```/g) || []).length;\n\n\tif (count) {\n\n\t\t// Check if we need to add a final ```\n\t\tif ((count % 2) > 0) {\n\t\t\tmessage.html = `${ message.html }\\n\\`\\`\\``;\n\t\t\tmessage.msg = `${ message.msg }\\n\\`\\`\\``;\n\t\t}\n\n\t\t// Separate text in code blocks and non code blocks\n\t\tconst msgParts = message.html.split(/(^.*)(```(?:[a-zA-Z]+)?(?:(?:.|\\r|\\n)*?)```)(.*\\n?)$/gm);\n\n\t\tfor (let index = 0; index < msgParts.length; index++) {\n\t\t\t// Verify if this part is code\n\t\t\tconst part = msgParts[index];\n\t\t\tconst codeMatch = part.match(/^```(.*[\\r\\n\\ ]?)([\\s\\S]*?)```+?$/);\n\n\t\t\tif (codeMatch != null) {\n\t\t\t\t// Process highlight if this part is code\n\t\t\t\tconst singleLine = codeMatch[0].indexOf('\\n') === -1;\n\t\t\t\tconst lang = !singleLine && Array.from(hljs.listLanguages()).includes(s.trim(codeMatch[1])) ? s.trim(codeMatch[1]) : '';\n\t\t\t\tconst code =\n\t\t\t\t\tsingleLine ?\n\t\t\t\t\t\t_.unescapeHTML(codeMatch[1]) :\n\t\t\t\t\t\tlang === '' ?\n\t\t\t\t\t\t\t_.unescapeHTML(codeMatch[1] + codeMatch[2]) :\n\t\t\t\t\t\t\t_.unescapeHTML(codeMatch[2]);\n\n\t\t\t\tconst result = lang === '' ? hljs.highlightAuto((lang + code)) : hljs.highlight(lang, code);\n\t\t\t\tconst token = `=!=${ Random.id() }=!=`;\n\n\t\t\t\tmessage.tokens.push({\n\t\t\t\t\thighlight: true,\n\t\t\t\t\ttoken,\n\t\t\t\t\ttext: `<pre><code class='code-colors hljs ${ result.language }'><span class='copyonly'>\\`\\`\\`<br></span>${ result.value }<span class='copyonly'><br>\\`\\`\\`</span></code></pre>`,\n\t\t\t\t\tnoHtml: `\\`\\`\\`\\n${ s.stripTags(result.value) }\\n\\`\\`\\``\n\t\t\t\t});\n\n\t\t\t\tmsgParts[index] = token;\n\t\t\t} else {\n\t\t\t\tmsgParts[index] = part;\n\t\t\t}\n\t\t}\n\n\t\t// Re-mount message\n\t\treturn message.html = msgParts.join('');\n\t}\n};\n\nexport const code = (message) => {\n\tif (s.trim(message.html)) {\n\t\tif (message.tokens == null) {\n\t\t\tmessage.tokens = [];\n\t\t}\n\n\t\tcodeblocks(message);\n\t\tinlinecode(message);\n\t}\n\n\treturn message;\n};\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {String} msg - The message html\n */\nimport { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { _ } from 'meteor/underscore';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nconst parseNotEscaped = function(msg, message) {\n\tif (message && message.tokens == null) {\n\t\tmessage.tokens = [];\n\t}\n\n\tconst addAsToken = function(html) {\n\t\tconst token = `=!=${ Random.id() }=!=`;\n\t\tmessage.tokens.push({\n\t\t\ttoken,\n\t\t\ttext: html\n\t\t});\n\n\t\treturn token;\n\t};\n\n\tconst schemes = RocketChat.settings.get('Markdown_SupportSchemesForLink').split(',').join('|');\n\n\tif (RocketChat.settings.get('Markdown_Headers')) {\n\t\t// Support # Text for h1\n\t\tmsg = msg.replace(/^# (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h1>$1</h1>');\n\n\t\t// Support # Text for h2\n\t\tmsg = msg.replace(/^## (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h2>$1</h2>');\n\n\t\t// Support # Text for h3\n\t\tmsg = msg.replace(/^### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h3>$1</h3>');\n\n\t\t// Support # Text for h4\n\t\tmsg = msg.replace(/^#### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h4>$1</h4>');\n\t}\n\n\t// Support *text* to make bold\n\tmsg = msg.replace(/(^|&gt;|[ >_~`])\\*{1,2}([^\\*\\r\\n]+)\\*{1,2}([<_~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">*</span><strong>$2</strong><span class=\"copyonly\">*</span>$3');\n\n\t// Support _text_ to make italics\n\tmsg = msg.replace(/(^|&gt;|[ >*~`])\\_{1,2}([^\\_\\r\\n]+)\\_{1,2}([<*~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">_</span><em>$2</em><span class=\"copyonly\">_</span>$3');\n\n\t// Support ~text~ to strike through text\n\tmsg = msg.replace(/(^|&gt;|[ >_*`])\\~{1,2}([^~\\r\\n]+)\\~{1,2}([<_*`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">~</span><strike>$2</strike><span class=\"copyonly\">~</span>$3');\n\n\t// Support for block quote\n\t// >>>\n\t// Text\n\t// <<<\n\tmsg = msg.replace(/(?:&gt;){3}\\n+([\\s\\S]*?)\\n+(?:&lt;){3}/g, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;&gt;&gt;</span>$1<span class=\"copyonly\">&lt;&lt;&lt;</span></blockquote>');\n\n\t// Support >Text for quote\n\tmsg = msg.replace(/^&gt;(.*)$/gm, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;</span>$1</blockquote>');\n\n\t// Remove white-space around blockquote (prevent <br>). Because blockquote is block element.\n\tmsg = msg.replace(/\\s*<blockquote class=\"background-transparent-darker-before\">/gm, '<blockquote class=\"background-transparent-darker-before\">');\n\tmsg = msg.replace(/<\\/blockquote>\\s*/gm, '</blockquote>');\n\n\t// Remove new-line between blockquotes.\n\tmsg = msg.replace(/<\\/blockquote>\\n<blockquote/gm, '</blockquote><blockquote');\n\n\t// Support ![alt text](http://image url)\n\tmsg = msg.replace(new RegExp(`!\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ _.escapeHTML(url) }\" title=\"${ _.escapeHTML(title) }\" target=\"${ _.escapeHTML(target) }\" rel=\"noopener noreferrer\"><div class=\"inline-image\" style=\"background-image: url(${ _.escapeHTML(url) });\"></div></a>`);\n\t});\n\n\t// Support [Text](http://link)\n\tmsg = msg.replace(new RegExp(`\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ _.escapeHTML(url) }\" target=\"${ _.escapeHTML(target) }\" rel=\"noopener noreferrer\">${ _.escapeHTML(title) }</a>`);\n\t});\n\n\t// Support <http://link|Text>\n\tmsg = msg.replace(new RegExp(`(?:<|&lt;)((?:${ schemes }):\\\\/\\\\/[^\\\\|]+)\\\\|(.+?)(?=>|&gt;)(?:>|&gt;)`, 'gm'), (match, url, title) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ _.escapeHTML(url) }\" target=\"${ _.escapeHTML(target) }\" rel=\"noopener noreferrer\">${ _.escapeHTML(title) }</a>`);\n\t});\n\n\treturn msg;\n};\n\nexport const markdown = function(message) {\n\tmessage.html = parseNotEscaped(message.html, message);\n\treturn message;\n};\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { markdown } from './markdown.js';\nimport { code } from './code.js';\n\nexport const original = (message) => {\n\t// Parse markdown code\n\tmessage = code(message);\n\n\t// Parse markdown\n\tmessage = markdown(message);\n\n\t// Replace linebreak to br\n\tmessage.html = message.html.replace(/\\n/gm, '<br>');\n\n\treturn message;\n};\n"]}